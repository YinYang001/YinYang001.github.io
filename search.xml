<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Netty-NIOåŸºç¡€</title>
      <link href="/posts/37846.html"/>
      <url>/posts/37846.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€-NIO-åŸºç¡€"><a href="#ä¸€-NIO-åŸºç¡€" class="headerlink" title="ä¸€. NIO åŸºç¡€"></a>ä¸€. NIO åŸºç¡€</h1><p>non-blocking io éé˜»å¡ IO</p><h2 id="1-ä¸‰å¤§ç»„ä»¶"><a href="#1-ä¸‰å¤§ç»„ä»¶" class="headerlink" title="1. ä¸‰å¤§ç»„ä»¶"></a>1. ä¸‰å¤§ç»„ä»¶</h2><h3 id="1-1-Channel-amp-Buffer"><a href="#1-1-Channel-amp-Buffer" class="headerlink" title="1.1 Channel &amp; Buffer"></a>1.1 Channel &amp; Buffer</h3><p>channel æœ‰ä¸€ç‚¹ç±»ä¼¼äº streamï¼Œå®ƒå°±æ˜¯è¯»å†™æ•°æ®çš„<strong>åŒå‘é€šé“</strong>ï¼Œå¯ä»¥ä» channel å°†æ•°æ®è¯»å…¥ bufferï¼Œä¹Ÿå¯ä»¥å°† buffer çš„æ•°æ®å†™å…¥ channelï¼Œè€Œä¹‹å‰çš„ stream è¦ä¹ˆæ˜¯è¾“å…¥ï¼Œè¦ä¹ˆæ˜¯è¾“å‡ºï¼Œchannel æ¯” stream æ›´ä¸ºåº•å±‚</p><pre class="line-numbers language-mermaid"><code class="language-mermaid">graph LRchannel --> bufferbuffer --> channel<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¸¸è§çš„ Channel æœ‰</p><ul><li>FileChannel</li><li>DatagramChannel</li><li>SocketChannel</li><li>ServerSocketChannel</li></ul><p>buffer åˆ™ç”¨æ¥ç¼“å†²è¯»å†™æ•°æ®ï¼Œå¸¸è§çš„ buffer æœ‰</p><ul><li>ByteBuffer<ul><li>MappedByteBuffer</li><li>DirectByteBuffer</li><li>HeapByteBuffer</li></ul></li><li>ShortBuffer</li><li>IntBuffer</li><li>LongBuffer</li><li>FloatBuffer</li><li>DoubleBuffer</li><li>CharBuffer</li></ul><h3 id="1-2-Selector"><a href="#1-2-Selector" class="headerlink" title="1.2 Selector"></a>1.2 Selector</h3><p>selector å•ä»å­—é¢æ„æ€ä¸å¥½ç†è§£ï¼Œéœ€è¦ç»“åˆæœåŠ¡å™¨çš„è®¾è®¡æ¼”åŒ–æ¥ç†è§£å®ƒçš„ç”¨é€”</p><h4 id="å¤šçº¿ç¨‹ç‰ˆè®¾è®¡"><a href="#å¤šçº¿ç¨‹ç‰ˆè®¾è®¡" class="headerlink" title="å¤šçº¿ç¨‹ç‰ˆè®¾è®¡"></a>å¤šçº¿ç¨‹ç‰ˆè®¾è®¡</h4><pre class="line-numbers language-mermaid"><code class="language-mermaid">graph TDsubgraph å¤šçº¿ç¨‹ç‰ˆt1(thread) --> s1(socket1)t2(thread) --> s2(socket2)t3(thread) --> s3(socket3)end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="âš ï¸-å¤šçº¿ç¨‹ç‰ˆç¼ºç‚¹"><a href="#âš ï¸-å¤šçº¿ç¨‹ç‰ˆç¼ºç‚¹" class="headerlink" title="âš ï¸ å¤šçº¿ç¨‹ç‰ˆç¼ºç‚¹"></a>âš ï¸ å¤šçº¿ç¨‹ç‰ˆç¼ºç‚¹</h4><ul><li>å†…å­˜å ç”¨é«˜</li><li>çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬é«˜</li><li>åªé€‚åˆè¿æ¥æ•°å°‘çš„åœºæ™¯</li></ul><h4 id="çº¿ç¨‹æ± ç‰ˆè®¾è®¡"><a href="#çº¿ç¨‹æ± ç‰ˆè®¾è®¡" class="headerlink" title="çº¿ç¨‹æ± ç‰ˆè®¾è®¡"></a>çº¿ç¨‹æ± ç‰ˆè®¾è®¡</h4><pre class="line-numbers language-mermaid"><code class="language-mermaid">graph TDsubgraph çº¿ç¨‹æ± ç‰ˆt4(thread) --> s4(socket1)t5(thread) --> s5(socket2)t4(thread) -.-> s6(socket3)t5(thread) -.-> s7(socket4)end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="âš ï¸-çº¿ç¨‹æ± ç‰ˆç¼ºç‚¹"><a href="#âš ï¸-çº¿ç¨‹æ± ç‰ˆç¼ºç‚¹" class="headerlink" title="âš ï¸ çº¿ç¨‹æ± ç‰ˆç¼ºç‚¹"></a>âš ï¸ çº¿ç¨‹æ± ç‰ˆç¼ºç‚¹</h4><ul><li>é˜»å¡æ¨¡å¼ä¸‹ï¼Œçº¿ç¨‹ä»…èƒ½å¤„ç†ä¸€ä¸ª socket è¿æ¥</li><li>ä»…é€‚åˆçŸ­è¿æ¥åœºæ™¯</li></ul><h4 id="selector-ç‰ˆè®¾è®¡"><a href="#selector-ç‰ˆè®¾è®¡" class="headerlink" title="selector ç‰ˆè®¾è®¡"></a>selector ç‰ˆè®¾è®¡</h4><p>selector çš„ä½œç”¨å°±æ˜¯é…åˆä¸€ä¸ªçº¿ç¨‹æ¥ç®¡ç†å¤šä¸ª channelï¼Œè·å–è¿™äº› channel ä¸Šå‘ç”Ÿçš„äº‹ä»¶ï¼Œè¿™äº› channel å·¥ä½œåœ¨éé˜»å¡æ¨¡å¼ä¸‹ï¼Œä¸ä¼šè®©çº¿ç¨‹åŠæ­»åœ¨ä¸€ä¸ª channel ä¸Šã€‚é€‚åˆè¿æ¥æ•°ç‰¹åˆ«å¤šï¼Œä½†æµé‡ä½çš„åœºæ™¯ï¼ˆlow trafficï¼‰</p><pre class="line-numbers language-mermaid"><code class="language-mermaid">graph TDsubgraph selector ç‰ˆthread --> selectorselector --> c1(channel)selector --> c2(channel)selector --> c3(channel)end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è°ƒç”¨ selector çš„ select() ä¼šé˜»å¡ç›´åˆ° channel å‘ç”Ÿäº†è¯»å†™å°±ç»ªäº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶å‘ç”Ÿï¼Œselect æ–¹æ³•å°±ä¼šè¿”å›è¿™äº›äº‹ä»¶äº¤ç»™ thread æ¥å¤„ç†</p><h2 id="2-ByteBuffer"><a href="#2-ByteBuffer" class="headerlink" title="2. ByteBuffer"></a>2. ByteBuffer</h2><p>æœ‰ä¸€æ™®é€šæ–‡æœ¬æ–‡ä»¶ data.txtï¼Œå†…å®¹ä¸º</p><pre><code>1234567890abcd</code></pre><p>ä½¿ç”¨ FileChannel æ¥è¯»å–æ–‡ä»¶å†…å®¹</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChannelDemo1</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span>RandomAccessFile file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span><span class="token string">"helloword/data.txt"</span><span class="token punctuation">,</span> <span class="token string">"rw"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            FileChannel channel <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ByteBuffer buffer <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">do</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// å‘ buffer å†™å…¥</span>                <span class="token keyword">int</span> len <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"è¯»åˆ°å­—èŠ‚æ•°ï¼š{}"</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">// åˆ‡æ¢ buffer è¯»æ¨¡å¼</span>                buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">while</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span>buffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">// åˆ‡æ¢ buffer å†™æ¨¡å¼</span>                buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre><code>10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - è¯»åˆ°å­—èŠ‚æ•°ï¼š1010:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 110:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 210:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 310:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 410:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 510:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 610:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 710:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 810:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 910:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 010:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - è¯»åˆ°å­—èŠ‚æ•°ï¼š410:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - a10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - b10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - c10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - d10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - è¯»åˆ°å­—èŠ‚æ•°ï¼š-1</code></pre><h3 id="2-1-ByteBuffer-æ­£ç¡®ä½¿ç”¨å§¿åŠ¿"><a href="#2-1-ByteBuffer-æ­£ç¡®ä½¿ç”¨å§¿åŠ¿" class="headerlink" title="2.1  ByteBuffer æ­£ç¡®ä½¿ç”¨å§¿åŠ¿"></a>2.1  ByteBuffer æ­£ç¡®ä½¿ç”¨å§¿åŠ¿</h3><ol><li>å‘ buffer å†™å…¥æ•°æ®ï¼Œä¾‹å¦‚è°ƒç”¨ channel.read(buffer)</li><li>è°ƒç”¨ flip() åˆ‡æ¢è‡³<strong>è¯»æ¨¡å¼</strong></li><li>ä» buffer è¯»å–æ•°æ®ï¼Œä¾‹å¦‚è°ƒç”¨ buffer.get()</li><li>è°ƒç”¨ clear() æˆ– compact() åˆ‡æ¢è‡³<strong>å†™æ¨¡å¼</strong></li><li>é‡å¤ 1~4 æ­¥éª¤</li></ol><h3 id="2-2-ByteBuffer-ç»“æ„"><a href="#2-2-ByteBuffer-ç»“æ„" class="headerlink" title="2.2 ByteBuffer ç»“æ„"></a>2.2 ByteBuffer ç»“æ„</h3><p>ByteBuffer æœ‰ä»¥ä¸‹é‡è¦å±æ€§</p><ul><li>capacity</li><li>position</li><li>limit</li></ul><p>ä¸€å¼€å§‹</p><img src="/posts/undefined/0021.png"><p>å†™æ¨¡å¼ä¸‹ï¼Œposition æ˜¯å†™å…¥ä½ç½®ï¼Œlimit ç­‰äºå®¹é‡ï¼Œä¸‹å›¾è¡¨ç¤ºå†™å…¥äº† 4 ä¸ªå­—èŠ‚åçš„çŠ¶æ€</p><img src="/posts/undefined/0018.png"><p>flip åŠ¨ä½œå‘ç”Ÿåï¼Œposition åˆ‡æ¢ä¸ºè¯»å–ä½ç½®ï¼Œlimit åˆ‡æ¢ä¸ºè¯»å–é™åˆ¶</p><img src="/posts/undefined/0019.png"><p>è¯»å– 4 ä¸ªå­—èŠ‚åï¼ŒçŠ¶æ€</p><img src="/posts/undefined/0020.png"><p>clear åŠ¨ä½œå‘ç”Ÿåï¼ŒçŠ¶æ€</p><img src="/posts/undefined/0021.png"><p>compact æ–¹æ³•ï¼Œæ˜¯æŠŠæœªè¯»å®Œçš„éƒ¨åˆ†å‘å‰å‹ç¼©ï¼Œç„¶ååˆ‡æ¢è‡³å†™æ¨¡å¼</p><img src="/posts/undefined/0022.png"><h4 id="ğŸ’¡-è°ƒè¯•å·¥å…·ç±»"><a href="#ğŸ’¡-è°ƒè¯•å·¥å…·ç±»" class="headerlink" title="ğŸ’¡ è°ƒè¯•å·¥å…·ç±»"></a>ğŸ’¡ è°ƒè¯•å·¥å…·ç±»</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ByteBufferUtil</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> BYTE2CHAR <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">char</span><span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> HEXDUMP_TABLE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">char</span><span class="token punctuation">[</span><span class="token number">256</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String<span class="token punctuation">[</span><span class="token punctuation">]</span> HEXPADDING <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String<span class="token punctuation">[</span><span class="token punctuation">]</span> HEXDUMP_ROWPREFIXES <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">65536</span> <span class="token operator">>>></span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String<span class="token punctuation">[</span><span class="token punctuation">]</span> BYTE2HEX <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String<span class="token punctuation">[</span><span class="token punctuation">]</span> BYTEPADDING <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token punctuation">{</span>        <span class="token keyword">final</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> DIGITS <span class="token operator">=</span> <span class="token string">"0123456789abcdef"</span><span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">256</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            HEXDUMP_TABLE<span class="token punctuation">[</span>i <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> DIGITS<span class="token punctuation">[</span>i <span class="token operator">>>></span> <span class="token number">4</span> <span class="token operator">&amp;</span> <span class="token number">0x0F</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            HEXDUMP_TABLE<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> DIGITS<span class="token punctuation">[</span>i <span class="token operator">&amp;</span> <span class="token number">0x0F</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">int</span> i<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// Generate the lookup table for hex dump paddings</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> HEXPADDING<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">int</span> padding <span class="token operator">=</span> HEXPADDING<span class="token punctuation">.</span>length <span class="token operator">-</span> i<span class="token punctuation">;</span>            StringBuilder buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span>padding <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> padding<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                buf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"   "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            HEXPADDING<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// Generate the lookup table for the start-offset header in each row (up to 64KiB).</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> HEXDUMP_ROWPREFIXES<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            StringBuilder buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            buf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>NEWLINE<span class="token punctuation">)</span><span class="token punctuation">;</span>            buf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>Long<span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>i <span class="token operator">&lt;&lt;</span> <span class="token number">4</span> <span class="token operator">&amp;</span> 0xFFFFFFFFL <span class="token operator">|</span> 0x100000000L<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            buf<span class="token punctuation">.</span><span class="token function">setCharAt</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            buf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            HEXDUMP_ROWPREFIXES<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// Generate the lookup table for byte-to-hex-dump conversion</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> BYTE2HEX<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            BYTE2HEX<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">' '</span> <span class="token operator">+</span> StringUtil<span class="token punctuation">.</span><span class="token function">byteToHexStringPadded</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// Generate the lookup table for byte dump paddings</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> BYTEPADDING<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">int</span> padding <span class="token operator">=</span> BYTEPADDING<span class="token punctuation">.</span>length <span class="token operator">-</span> i<span class="token punctuation">;</span>            StringBuilder buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span>padding<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> padding<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                buf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            BYTEPADDING<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// Generate the lookup table for byte-to-char conversion</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> BYTE2CHAR<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> <span class="token number">0x1f</span> <span class="token operator">||</span> i <span class="token operator">>=</span> <span class="token number">0x7f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                BYTE2CHAR<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'.'</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                BYTE2CHAR<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> i<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * æ‰“å°æ‰€æœ‰å†…å®¹     * @param buffer     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">debugAll</span><span class="token punctuation">(</span>ByteBuffer buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> oldlimit <span class="token operator">=</span> buffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        buffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        StringBuilder origin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">appendPrettyHexDump</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"+--------+-------------------- all ------------------------+----------------+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"position: [%d], limit: [%d]\n"</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> oldlimit<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>        buffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>oldlimit<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * æ‰“å°å¯è¯»å–å†…å®¹     * @param buffer     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">debugRead</span><span class="token punctuation">(</span>ByteBuffer buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>        StringBuilder builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">appendPrettyHexDump</span><span class="token punctuation">(</span>builder<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> buffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> buffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"+--------+-------------------- read -----------------------+----------------+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"position: [%d], limit: [%d]\n"</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">appendPrettyHexDump</span><span class="token punctuation">(</span>StringBuilder dump<span class="token punctuation">,</span> ByteBuffer buf<span class="token punctuation">,</span> <span class="token keyword">int</span> offset<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isOutOfBounds</span><span class="token punctuation">(</span>offset<span class="token punctuation">,</span> length<span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IndexOutOfBoundsException</span><span class="token punctuation">(</span>                    <span class="token string">"expected: "</span> <span class="token operator">+</span> <span class="token string">"0 &lt;= offset("</span> <span class="token operator">+</span> offset <span class="token operator">+</span> <span class="token string">") &lt;= offset + length("</span> <span class="token operator">+</span> length                            <span class="token operator">+</span> <span class="token string">") &lt;= "</span> <span class="token operator">+</span> <span class="token string">"buf.capacity("</span> <span class="token operator">+</span> buf<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">')'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>                <span class="token string">"         +-------------------------------------------------+"</span> <span class="token operator">+</span>                        NEWLINE <span class="token operator">+</span> <span class="token string">"         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |"</span> <span class="token operator">+</span>                        NEWLINE <span class="token operator">+</span> <span class="token string">"+--------+-------------------------------------------------+----------------+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">final</span> <span class="token keyword">int</span> startIndex <span class="token operator">=</span> offset<span class="token punctuation">;</span>        <span class="token keyword">final</span> <span class="token keyword">int</span> fullRows <span class="token operator">=</span> length <span class="token operator">>>></span> <span class="token number">4</span><span class="token punctuation">;</span>        <span class="token keyword">final</span> <span class="token keyword">int</span> remainder <span class="token operator">=</span> length <span class="token operator">&amp;</span> <span class="token number">0xF</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// Dump the rows which have 16 bytes.</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> row <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> row <span class="token operator">&lt;</span> fullRows<span class="token punctuation">;</span> row<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">int</span> rowStartIndex <span class="token operator">=</span> <span class="token punctuation">(</span>row <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">+</span> startIndex<span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// Per-row prefix.</span>            <span class="token function">appendHexDumpRowPrefix</span><span class="token punctuation">(</span>dump<span class="token punctuation">,</span> row<span class="token punctuation">,</span> rowStartIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// Hex dump</span>            <span class="token keyword">int</span> rowEndIndex <span class="token operator">=</span> rowStartIndex <span class="token operator">+</span> <span class="token number">16</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> rowStartIndex<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> rowEndIndex<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>BYTE2HEX<span class="token punctuation">[</span><span class="token function">getUnsignedByte</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" |"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// ASCII dump</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> rowStartIndex<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> rowEndIndex<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>BYTE2CHAR<span class="token punctuation">[</span><span class="token function">getUnsignedByte</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// Dump the last row which has less than 16 bytes.</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>remainder <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">int</span> rowStartIndex <span class="token operator">=</span> <span class="token punctuation">(</span>fullRows <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">+</span> startIndex<span class="token punctuation">;</span>            <span class="token function">appendHexDumpRowPrefix</span><span class="token punctuation">(</span>dump<span class="token punctuation">,</span> fullRows<span class="token punctuation">,</span> rowStartIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// Hex dump</span>            <span class="token keyword">int</span> rowEndIndex <span class="token operator">=</span> rowStartIndex <span class="token operator">+</span> remainder<span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> rowStartIndex<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> rowEndIndex<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>BYTE2HEX<span class="token punctuation">[</span><span class="token function">getUnsignedByte</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>HEXPADDING<span class="token punctuation">[</span>remainder<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" |"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// Ascii dump</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> rowStartIndex<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> rowEndIndex<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>BYTE2CHAR<span class="token punctuation">[</span><span class="token function">getUnsignedByte</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>BYTEPADDING<span class="token punctuation">[</span>remainder<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>NEWLINE <span class="token operator">+</span>                <span class="token string">"+--------+-------------------------------------------------+----------------+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">appendHexDumpRowPrefix</span><span class="token punctuation">(</span>StringBuilder dump<span class="token punctuation">,</span> <span class="token keyword">int</span> row<span class="token punctuation">,</span> <span class="token keyword">int</span> rowStartIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>row <span class="token operator">&lt;</span> HEXDUMP_ROWPREFIXES<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>            dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>HEXDUMP_ROWPREFIXES<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>NEWLINE<span class="token punctuation">)</span><span class="token punctuation">;</span>            dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>Long<span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>rowStartIndex <span class="token operator">&amp;</span> 0xFFFFFFFFL <span class="token operator">|</span> 0x100000000L<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            dump<span class="token punctuation">.</span><span class="token function">setCharAt</span><span class="token punctuation">(</span>dump<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">short</span> <span class="token function">getUnsignedByte</span><span class="token punctuation">(</span>ByteBuffer buffer<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-3-ByteBuffer-å¸¸è§æ–¹æ³•"><a href="#2-3-ByteBuffer-å¸¸è§æ–¹æ³•" class="headerlink" title="2.3 ByteBuffer å¸¸è§æ–¹æ³•"></a>2.3 ByteBuffer å¸¸è§æ–¹æ³•</h3><h4 id="åˆ†é…ç©ºé—´"><a href="#åˆ†é…ç©ºé—´" class="headerlink" title="åˆ†é…ç©ºé—´"></a>åˆ†é…ç©ºé—´</h4><p>å¯ä»¥ä½¿ç”¨ allocate æ–¹æ³•ä¸º ByteBuffer åˆ†é…ç©ºé—´ï¼Œå…¶å®ƒ buffer ç±»ä¹Ÿæœ‰è¯¥æ–¹æ³•</p><pre class="line-numbers language-java"><code class="language-java">Bytebuffer buf <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="å‘-buffer-å†™å…¥æ•°æ®"><a href="#å‘-buffer-å†™å…¥æ•°æ®" class="headerlink" title="å‘ buffer å†™å…¥æ•°æ®"></a>å‘ buffer å†™å…¥æ•°æ®</h4><p>æœ‰ä¸¤ç§åŠæ³•</p><ul><li>è°ƒç”¨ channel çš„ read æ–¹æ³•</li><li>è°ƒç”¨ buffer è‡ªå·±çš„ put æ–¹æ³•</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">int</span> readBytes <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å’Œ</p><pre class="line-numbers language-java"><code class="language-java">buf<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="ä»-buffer-è¯»å–æ•°æ®"><a href="#ä»-buffer-è¯»å–æ•°æ®" class="headerlink" title="ä» buffer è¯»å–æ•°æ®"></a>ä» buffer è¯»å–æ•°æ®</h4><p>åŒæ ·æœ‰ä¸¤ç§åŠæ³•</p><ul><li>è°ƒç”¨ channel çš„ write æ–¹æ³•</li><li>è°ƒç”¨ buffer è‡ªå·±çš„ get æ–¹æ³•</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">int</span> writeBytes <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å’Œ</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">byte</span> b <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>get æ–¹æ³•ä¼šè®© position è¯»æŒ‡é’ˆå‘åèµ°ï¼Œå¦‚æœæƒ³é‡å¤è¯»å–æ•°æ®</p><ul><li>å¯ä»¥è°ƒç”¨ rewind æ–¹æ³•å°† position é‡æ–°ç½®ä¸º 0</li><li>æˆ–è€…è°ƒç”¨ get(int i) æ–¹æ³•è·å–ç´¢å¼• i çš„å†…å®¹ï¼Œå®ƒä¸ä¼šç§»åŠ¨è¯»æŒ‡é’ˆ</li></ul><h4 id="mark-å’Œ-reset"><a href="#mark-å’Œ-reset" class="headerlink" title="mark å’Œ reset"></a>mark å’Œ reset</h4><p>mark æ˜¯åœ¨è¯»å–æ—¶ï¼Œåšä¸€ä¸ªæ ‡è®°ï¼Œå³ä½¿ position æ”¹å˜ï¼Œåªè¦è°ƒç”¨ reset å°±èƒ½å›åˆ° mark çš„ä½ç½®</p><blockquote><p><strong>æ³¨æ„</strong></p><p>rewind å’Œ flip éƒ½ä¼šæ¸…é™¤ mark ä½ç½®</p></blockquote><h4 id="å­—ç¬¦ä¸²ä¸-ByteBuffer-äº’è½¬"><a href="#å­—ç¬¦ä¸²ä¸-ByteBuffer-äº’è½¬" class="headerlink" title="å­—ç¬¦ä¸²ä¸ ByteBuffer äº’è½¬"></a>å­—ç¬¦ä¸²ä¸ ByteBuffer äº’è½¬</h4><pre class="line-numbers language-java"><code class="language-java">ByteBuffer buffer1 <span class="token operator">=</span> StandardCharsets<span class="token punctuation">.</span>UTF_8<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"ä½ å¥½"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ByteBuffer buffer2 <span class="token operator">=</span> Charset<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"ä½ å¥½"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">debug</span><span class="token punctuation">(</span>buffer1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">debug</span><span class="token punctuation">(</span>buffer2<span class="token punctuation">)</span><span class="token punctuation">;</span>CharBuffer buffer3 <span class="token operator">=</span> StandardCharsets<span class="token punctuation">.</span>UTF_8<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>buffer1<span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer3<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer3<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre><code>         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| e4 bd a0 e5 a5 bd                               |......          |+--------+-------------------------------------------------+----------------+         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| e4 bd a0 e5 a5 bd                               |......          |+--------+-------------------------------------------------+----------------+class java.nio.HeapCharBufferä½ å¥½</code></pre><h4 id="âš ï¸-Buffer-çš„çº¿ç¨‹å®‰å…¨"><a href="#âš ï¸-Buffer-çš„çº¿ç¨‹å®‰å…¨" class="headerlink" title="âš ï¸ Buffer çš„çº¿ç¨‹å®‰å…¨"></a>âš ï¸ Buffer çš„çº¿ç¨‹å®‰å…¨</h4><blockquote><p>Buffer æ˜¯<strong>éçº¿ç¨‹å®‰å…¨çš„</strong></p></blockquote><h3 id="2-4-Scattering-Reads"><a href="#2-4-Scattering-Reads" class="headerlink" title="2.4 Scattering Reads"></a>2.4 Scattering Reads</h3><p>åˆ†æ•£è¯»å–ï¼Œæœ‰ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ 3parts.txt</p><pre><code>onetwothree</code></pre><p>ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è¯»å–ï¼Œå¯ä»¥å°†æ•°æ®å¡«å……è‡³å¤šä¸ª buffer</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">try</span> <span class="token punctuation">(</span>RandomAccessFile file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span><span class="token string">"helloword/3parts.txt"</span><span class="token punctuation">,</span> <span class="token string">"rw"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    FileChannel channel <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ByteBuffer a <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ByteBuffer b <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ByteBuffer c <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    a<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    b<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    c<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">debug</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">debug</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">debug</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»“æœ</p><pre><code>         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 6f 6e 65                                        |one             |+--------+-------------------------------------------------+----------------+         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 74 77 6f                                        |two             |+--------+-------------------------------------------------+----------------+         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 74 68 72 65 65                                  |three           |+--------+-------------------------------------------------+----------------+</code></pre><h3 id="2-5-Gathering-Writes"><a href="#2-5-Gathering-Writes" class="headerlink" title="2.5 Gathering Writes"></a>2.5 Gathering Writes</h3><p>ä½¿ç”¨å¦‚ä¸‹æ–¹å¼å†™å…¥ï¼Œå¯ä»¥å°†å¤šä¸ª buffer çš„æ•°æ®å¡«å……è‡³ channel</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">try</span> <span class="token punctuation">(</span>RandomAccessFile file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span><span class="token string">"helloword/3parts.txt"</span><span class="token punctuation">,</span> <span class="token string">"rw"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    FileChannel channel <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ByteBuffer d <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ByteBuffer e <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    channel<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    d<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">,</span> <span class="token string">'u'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    e<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token string">'i'</span><span class="token punctuation">,</span> <span class="token string">'v'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    d<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    e<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">debug</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">debug</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    channel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>d<span class="token punctuation">,</span> e<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre><code>         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 66 6f 75 72                                     |four            |+--------+-------------------------------------------------+----------------+         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 66 69 76 65                                     |five            |+--------+-------------------------------------------------+----------------+</code></pre><p>æ–‡ä»¶å†…å®¹</p><pre><code>onetwothreefourfive</code></pre><h3 id="2-6-ç»ƒä¹ "><a href="#2-6-ç»ƒä¹ " class="headerlink" title="2.6 ç»ƒä¹ "></a>2.6 ç»ƒä¹ </h3><p>ç½‘ç»œä¸Šæœ‰å¤šæ¡æ•°æ®å‘é€ç»™æœåŠ¡ç«¯ï¼Œæ•°æ®ä¹‹é—´ä½¿ç”¨ \n è¿›è¡Œåˆ†éš”<br>ä½†ç”±äºæŸç§åŸå› è¿™äº›æ•°æ®åœ¨æ¥æ”¶æ—¶ï¼Œè¢«è¿›è¡Œäº†é‡æ–°ç»„åˆï¼Œä¾‹å¦‚åŸå§‹æ•°æ®æœ‰3æ¡ä¸º</p><ul><li>Hello,world\n</li><li>Iâ€™m zhangsan\n</li><li>How are you?\n</li></ul><p>å˜æˆäº†ä¸‹é¢çš„ä¸¤ä¸ª byteBuffer (é»åŒ…ï¼ŒåŠåŒ…)</p><ul><li>Hello,world\nIâ€™m zhangsan\nHo</li><li>w are you?\n</li></ul><p>ç°åœ¨è¦æ±‚ä½ ç¼–å†™ç¨‹åºï¼Œå°†é”™ä¹±çš„æ•°æ®æ¢å¤æˆåŸå§‹çš„æŒ‰ \n åˆ†éš”çš„æ•°æ®</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>    ByteBuffer source <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//                     11            24</span>    source<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"Hello,world\nI'm zhangsan\nHo"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">split</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>    source<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"w are you?\nhaha!\n"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">split</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">split</span><span class="token punctuation">(</span>ByteBuffer source<span class="token punctuation">)</span> <span class="token punctuation">{</span>    source<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> oldLimit <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> oldLimit<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'\n'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>            ByteBuffer target <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">-</span> source<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// 0 ~ limit</span>            source<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            target<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ä»source è¯»ï¼Œå‘ target å†™</span>            <span class="token function">debugAll</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>            source<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>oldLimit<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    source<span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-æ–‡ä»¶ç¼–ç¨‹"><a href="#3-æ–‡ä»¶ç¼–ç¨‹" class="headerlink" title="3. æ–‡ä»¶ç¼–ç¨‹"></a>3. æ–‡ä»¶ç¼–ç¨‹</h2><h3 id="3-1-FileChannel"><a href="#3-1-FileChannel" class="headerlink" title="3.1 FileChannel"></a>3.1 FileChannel</h3><h4 id="âš ï¸-FileChannel-å·¥ä½œæ¨¡å¼"><a href="#âš ï¸-FileChannel-å·¥ä½œæ¨¡å¼" class="headerlink" title="âš ï¸ FileChannel å·¥ä½œæ¨¡å¼"></a>âš ï¸ FileChannel å·¥ä½œæ¨¡å¼</h4><blockquote><p>FileChannel åªèƒ½å·¥ä½œåœ¨é˜»å¡æ¨¡å¼ä¸‹</p></blockquote><h4 id="è·å–"><a href="#è·å–" class="headerlink" title="è·å–"></a>è·å–</h4><p>ä¸èƒ½ç›´æ¥æ‰“å¼€ FileChannelï¼Œå¿…é¡»é€šè¿‡ FileInputStreamã€FileOutputStream æˆ–è€… RandomAccessFile æ¥è·å– FileChannelï¼Œå®ƒä»¬éƒ½æœ‰ getChannel æ–¹æ³•</p><ul><li>é€šè¿‡ FileInputStream è·å–çš„ channel åªèƒ½è¯»</li><li>é€šè¿‡ FileOutputStream è·å–çš„ channel åªèƒ½å†™</li><li>é€šè¿‡ RandomAccessFile æ˜¯å¦èƒ½è¯»å†™æ ¹æ®æ„é€  RandomAccessFile æ—¶çš„è¯»å†™æ¨¡å¼å†³å®š</li></ul><h4 id="è¯»å–"><a href="#è¯»å–" class="headerlink" title="è¯»å–"></a>è¯»å–</h4><p>ä¼šä» channel è¯»å–æ•°æ®å¡«å…… ByteBufferï¼Œè¿”å›å€¼è¡¨ç¤ºè¯»åˆ°äº†å¤šå°‘å­—èŠ‚ï¼Œ-1 è¡¨ç¤ºåˆ°è¾¾äº†æ–‡ä»¶çš„æœ«å°¾</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">int</span> readBytes <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="å†™å…¥"><a href="#å†™å…¥" class="headerlink" title="å†™å…¥"></a>å†™å…¥</h4><p>å†™å…¥çš„æ­£ç¡®å§¿åŠ¿å¦‚ä¸‹ï¼Œ SocketChannel</p><pre class="line-numbers language-java"><code class="language-java">ByteBuffer buffer <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>buffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// å­˜å…¥æ•°æ®</span>buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// åˆ‡æ¢è¯»æ¨¡å¼</span><span class="token keyword">while</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    channel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ while ä¸­è°ƒç”¨ channel.write æ˜¯å› ä¸º write æ–¹æ³•å¹¶ä¸èƒ½ä¿è¯ä¸€æ¬¡å°† buffer ä¸­çš„å†…å®¹å…¨éƒ¨å†™å…¥ channel</p><h4 id="å…³é—­"><a href="#å…³é—­" class="headerlink" title="å…³é—­"></a>å…³é—­</h4><p>channel å¿…é¡»å…³é—­ï¼Œä¸è¿‡è°ƒç”¨äº† FileInputStreamã€FileOutputStream æˆ–è€… RandomAccessFile çš„ close æ–¹æ³•ä¼šé—´æ¥åœ°è°ƒç”¨ channel çš„ close æ–¹æ³•</p><h4 id="ä½ç½®"><a href="#ä½ç½®" class="headerlink" title="ä½ç½®"></a>ä½ç½®</h4><p>è·å–å½“å‰ä½ç½®</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">long</span> pos <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è®¾ç½®å½“å‰ä½ç½®</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">long</span> newPos <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>channel<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span>newPos<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è®¾ç½®å½“å‰ä½ç½®æ—¶ï¼Œå¦‚æœè®¾ç½®ä¸ºæ–‡ä»¶çš„æœ«å°¾</p><ul><li>è¿™æ—¶è¯»å–ä¼šè¿”å› -1 </li><li>è¿™æ—¶å†™å…¥ï¼Œä¼šè¿½åŠ å†…å®¹ï¼Œä½†è¦æ³¨æ„å¦‚æœ position è¶…è¿‡äº†æ–‡ä»¶æœ«å°¾ï¼Œå†å†™å…¥æ—¶åœ¨æ–°å†…å®¹å’ŒåŸæœ«å°¾ä¹‹é—´ä¼šæœ‰ç©ºæ´ï¼ˆ00ï¼‰</li></ul><h4 id="å¤§å°"><a href="#å¤§å°" class="headerlink" title="å¤§å°"></a>å¤§å°</h4><p>ä½¿ç”¨ size æ–¹æ³•è·å–æ–‡ä»¶çš„å¤§å°</p><h4 id="å¼ºåˆ¶å†™å…¥"><a href="#å¼ºåˆ¶å†™å…¥" class="headerlink" title="å¼ºåˆ¶å†™å…¥"></a>å¼ºåˆ¶å†™å…¥</h4><p>æ“ä½œç³»ç»Ÿå‡ºäºæ€§èƒ½çš„è€ƒè™‘ï¼Œä¼šå°†æ•°æ®ç¼“å­˜ï¼Œä¸æ˜¯ç«‹åˆ»å†™å…¥ç£ç›˜ã€‚å¯ä»¥è°ƒç”¨ force(true)  æ–¹æ³•å°†æ–‡ä»¶å†…å®¹å’Œå…ƒæ•°æ®ï¼ˆæ–‡ä»¶çš„æƒé™ç­‰ä¿¡æ¯ï¼‰ç«‹åˆ»å†™å…¥ç£ç›˜</p><h3 id="3-2-ä¸¤ä¸ª-Channel-ä¼ è¾“æ•°æ®"><a href="#3-2-ä¸¤ä¸ª-Channel-ä¼ è¾“æ•°æ®" class="headerlink" title="3.2 ä¸¤ä¸ª Channel ä¼ è¾“æ•°æ®"></a>3.2 ä¸¤ä¸ª Channel ä¼ è¾“æ•°æ®</h3><pre class="line-numbers language-java"><code class="language-java">String FROM <span class="token operator">=</span> <span class="token string">"helloword/data.txt"</span><span class="token punctuation">;</span>String TO <span class="token operator">=</span> <span class="token string">"helloword/to.txt"</span><span class="token punctuation">;</span><span class="token keyword">long</span> start <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token punctuation">(</span>FileChannel from <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>FROM<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     FileChannel to <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>TO<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">)</span> <span class="token punctuation">{</span>    from<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> from<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">long</span> end <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"transferTo ç”¨æ—¶ï¼š"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">/</span> 1000_000<span class="token number">.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre><code>transferTo ç”¨æ—¶ï¼š8.2011</code></pre><p>è¶…è¿‡ 2g å¤§å°çš„æ–‡ä»¶ä¼ è¾“</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestFileChannelTransferTo</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span>                FileChannel from <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"data.txt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                FileChannel to <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">"to.txt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// æ•ˆç‡é«˜ï¼Œåº•å±‚ä¼šåˆ©ç”¨æ“ä½œç³»ç»Ÿçš„é›¶æ‹·è´è¿›è¡Œä¼˜åŒ–</span>            <span class="token keyword">long</span> size <span class="token operator">=</span> from<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// left å˜é‡ä»£è¡¨è¿˜å‰©ä½™å¤šå°‘å­—èŠ‚</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> left <span class="token operator">=</span> size<span class="token punctuation">;</span> left <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"position:"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>size <span class="token operator">-</span> left<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" left:"</span> <span class="token operator">+</span> left<span class="token punctuation">)</span><span class="token punctuation">;</span>                left <span class="token operator">-=</span> from<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span><span class="token punctuation">(</span>size <span class="token operator">-</span> left<span class="token punctuation">)</span><span class="token punctuation">,</span> left<span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®é™…ä¼ è¾“ä¸€ä¸ªè¶…å¤§æ–‡ä»¶</p><pre><code>position:0 left:7769948160position:2147483647 left:5622464513position:4294967294 left:3474980866position:6442450941 left:1327497219</code></pre><h3 id="3-3-Path"><a href="#3-3-Path" class="headerlink" title="3.3 Path"></a>3.3 Path</h3><p>jdk7 å¼•å…¥äº† Path å’Œ Paths ç±»</p><ul><li>Path ç”¨æ¥è¡¨ç¤ºæ–‡ä»¶è·¯å¾„</li><li>Paths æ˜¯å·¥å…·ç±»ï¼Œç”¨æ¥è·å– Path å®ä¾‹</li></ul><pre class="line-numbers language-java"><code class="language-java">Path source <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"1.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ç›¸å¯¹è·¯å¾„ ä½¿ç”¨ user.dir ç¯å¢ƒå˜é‡æ¥å®šä½ 1.txt</span>Path source <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"d:\\1.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ç»å¯¹è·¯å¾„ ä»£è¡¨äº†  d:\1.txt</span>Path source <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"d:/1.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ç»å¯¹è·¯å¾„ åŒæ ·ä»£è¡¨äº†  d:\1.txt</span>Path projects <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"d:\\data"</span><span class="token punctuation">,</span> <span class="token string">"projects"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ä»£è¡¨äº†  d:\data\projects</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>.</code> ä»£è¡¨äº†å½“å‰è·¯å¾„</li><li><code>..</code> ä»£è¡¨äº†ä¸Šä¸€çº§è·¯å¾„</li></ul><p>ä¾‹å¦‚ç›®å½•ç»“æ„å¦‚ä¸‹</p><pre><code>d:    |- data        |- projects            |- a            |- b</code></pre><p>ä»£ç </p><pre class="line-numbers language-java"><code class="language-java">Path path <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"d:\\data\\projects\\a\\..\\b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// æ­£å¸¸åŒ–è·¯å¾„</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¼šè¾“å‡º</p><pre><code>d:\data\projects\a\..\bd:\data\projects\b</code></pre><h3 id="3-4-Files"><a href="#3-4-Files" class="headerlink" title="3.4 Files"></a>3.4 Files</h3><p>æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</p><pre class="line-numbers language-java"><code class="language-java">Path path <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/d1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Files<span class="token punctuation">.</span><span class="token function">createDirectory</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åˆ›å»ºä¸€çº§ç›®å½•</p><pre class="line-numbers language-java"><code class="language-java">Path path <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/d1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Files<span class="token punctuation">.</span><span class="token function">createDirectory</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>å¦‚æœç›®å½•å·²å­˜åœ¨ï¼Œä¼šæŠ›å¼‚å¸¸ FileAlreadyExistsException</li><li>ä¸èƒ½ä¸€æ¬¡åˆ›å»ºå¤šçº§ç›®å½•ï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸ NoSuchFileException</li></ul><p>åˆ›å»ºå¤šçº§ç›®å½•ç”¨</p><pre class="line-numbers language-java"><code class="language-java">Path path <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/d1/d2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Files<span class="token punctuation">.</span><span class="token function">createDirectories</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ‹·è´æ–‡ä»¶</p><pre class="line-numbers language-java"><code class="language-java">Path source <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/data.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Path target <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/target.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Files<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œä¼šæŠ›å¼‚å¸¸ FileAlreadyExistsException</li></ul><p>å¦‚æœå¸Œæœ›ç”¨ source è¦†ç›–æ‰ targetï¼Œéœ€è¦ç”¨ StandardCopyOption æ¥æ§åˆ¶</p><pre class="line-numbers language-java"><code class="language-java">Files<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">,</span> StandardCopyOption<span class="token punctuation">.</span>REPLACE_EXISTING<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç§»åŠ¨æ–‡ä»¶</p><pre class="line-numbers language-java"><code class="language-java">Path source <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/data.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Path target <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/data.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Files<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">,</span> StandardCopyOption<span class="token punctuation">.</span>ATOMIC_MOVE<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>StandardCopyOption.ATOMIC_MOVE ä¿è¯æ–‡ä»¶ç§»åŠ¨çš„åŸå­æ€§</li></ul><p>åˆ é™¤æ–‡ä»¶</p><pre class="line-numbers language-java"><code class="language-java">Path target <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/target.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Files<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¼šæŠ›å¼‚å¸¸ NoSuchFileException</li></ul><p>åˆ é™¤ç›®å½•</p><pre class="line-numbers language-java"><code class="language-java">Path target <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/d1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Files<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>å¦‚æœç›®å½•è¿˜æœ‰å†…å®¹ï¼Œä¼šæŠ›å¼‚å¸¸ DirectoryNotEmptyException</li></ul><p>éå†ç›®å½•æ–‡ä»¶</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>    Path path <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"C:\\Program Files\\Java\\jdk1.8.0_91"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    AtomicInteger dirCount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    AtomicInteger fileCount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Files<span class="token punctuation">.</span><span class="token function">walkFileTree</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SimpleFileVisitor</span><span class="token operator">&lt;</span>Path<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> FileVisitResult <span class="token function">preVisitDirectory</span><span class="token punctuation">(</span>Path dir<span class="token punctuation">,</span> BasicFileAttributes attrs<span class="token punctuation">)</span>             <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>            dirCount<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">preVisitDirectory</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> FileVisitResult <span class="token function">visitFile</span><span class="token punctuation">(</span>Path file<span class="token punctuation">,</span> BasicFileAttributes attrs<span class="token punctuation">)</span>             <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>            fileCount<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">visitFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dirCount<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 133</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>fileCount<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 1479</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»Ÿè®¡ jar çš„æ•°ç›®</p><pre class="line-numbers language-java"><code class="language-java">Path path <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"C:\\Program Files\\Java\\jdk1.8.0_91"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>AtomicInteger fileCount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Files<span class="token punctuation">.</span><span class="token function">walkFileTree</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SimpleFileVisitor</span><span class="token operator">&lt;</span>Path<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> FileVisitResult <span class="token function">visitFile</span><span class="token punctuation">(</span>Path file<span class="token punctuation">,</span> BasicFileAttributes attrs<span class="token punctuation">)</span>         <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">toFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">".jar"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            fileCount<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">visitFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>fileCount<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 724</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ é™¤å¤šçº§ç›®å½•</p><pre class="line-numbers language-java"><code class="language-java">Path path <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"d:\\a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Files<span class="token punctuation">.</span><span class="token function">walkFileTree</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SimpleFileVisitor</span><span class="token operator">&lt;</span>Path<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> FileVisitResult <span class="token function">visitFile</span><span class="token punctuation">(</span>Path file<span class="token punctuation">,</span> BasicFileAttributes attrs<span class="token punctuation">)</span>         <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>        Files<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">visitFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> FileVisitResult <span class="token function">postVisitDirectory</span><span class="token punctuation">(</span>Path dir<span class="token punctuation">,</span> IOException exc<span class="token punctuation">)</span>         <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>        Files<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">postVisitDirectory</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> exc<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="âš ï¸-åˆ é™¤å¾ˆå±é™©"><a href="#âš ï¸-åˆ é™¤å¾ˆå±é™©" class="headerlink" title="âš ï¸ åˆ é™¤å¾ˆå±é™©"></a>âš ï¸ åˆ é™¤å¾ˆå±é™©</h4><blockquote><p>åˆ é™¤æ˜¯å±é™©æ“ä½œï¼Œç¡®ä¿è¦é€’å½’åˆ é™¤çš„æ–‡ä»¶å¤¹æ²¡æœ‰é‡è¦å†…å®¹</p></blockquote><p>æ‹·è´å¤šçº§ç›®å½•</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">long</span> start <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>String source <span class="token operator">=</span> <span class="token string">"D:\\Snipaste-1.16.2-x64"</span><span class="token punctuation">;</span>String target <span class="token operator">=</span> <span class="token string">"D:\\Snipaste-1.16.2-x64aaa"</span><span class="token punctuation">;</span>Files<span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>path <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        String targetName <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// æ˜¯ç›®å½•</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>Files<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            Files<span class="token punctuation">.</span><span class="token function">createDirectory</span><span class="token punctuation">(</span>Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>targetName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// æ˜¯æ™®é€šæ–‡ä»¶</span>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Files<span class="token punctuation">.</span><span class="token function">isRegularFile</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            Files<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>targetName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">long</span> end <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-ç½‘ç»œç¼–ç¨‹"><a href="#4-ç½‘ç»œç¼–ç¨‹" class="headerlink" title="4. ç½‘ç»œç¼–ç¨‹"></a>4. ç½‘ç»œç¼–ç¨‹</h2><h3 id="4-1-éé˜»å¡-vs-é˜»å¡"><a href="#4-1-éé˜»å¡-vs-é˜»å¡" class="headerlink" title="4.1 éé˜»å¡ vs é˜»å¡"></a>4.1 éé˜»å¡ vs é˜»å¡</h3><h4 id="é˜»å¡"><a href="#é˜»å¡" class="headerlink" title="é˜»å¡"></a>é˜»å¡</h4><ul><li>é˜»å¡æ¨¡å¼ä¸‹ï¼Œç›¸å…³æ–¹æ³•éƒ½ä¼šå¯¼è‡´çº¿ç¨‹æš‚åœ<ul><li>ServerSocketChannel.accept ä¼šåœ¨æ²¡æœ‰è¿æ¥å»ºç«‹æ—¶è®©çº¿ç¨‹æš‚åœ</li><li>SocketChannel.read ä¼šåœ¨æ²¡æœ‰æ•°æ®å¯è¯»æ—¶è®©çº¿ç¨‹æš‚åœ</li><li>é˜»å¡çš„è¡¨ç°å…¶å®å°±æ˜¯çº¿ç¨‹æš‚åœäº†ï¼Œæš‚åœæœŸé—´ä¸ä¼šå ç”¨ cpuï¼Œä½†çº¿ç¨‹ç›¸å½“äºé—²ç½®</li></ul></li><li>å•çº¿ç¨‹ä¸‹ï¼Œé˜»å¡æ–¹æ³•ä¹‹é—´ç›¸äº’å½±å“ï¼Œå‡ ä¹ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œéœ€è¦å¤šçº¿ç¨‹æ”¯æŒ</li><li>ä½†å¤šçº¿ç¨‹ä¸‹ï¼Œæœ‰æ–°çš„é—®é¢˜ï¼Œä½“ç°åœ¨ä»¥ä¸‹æ–¹é¢<ul><li>32 ä½ jvm ä¸€ä¸ªçº¿ç¨‹ 320kï¼Œ64 ä½ jvm ä¸€ä¸ªçº¿ç¨‹ 1024kï¼Œå¦‚æœè¿æ¥æ•°è¿‡å¤šï¼Œå¿…ç„¶å¯¼è‡´ OOMï¼Œå¹¶ä¸”çº¿ç¨‹å¤ªå¤šï¼Œåè€Œä¼šå› ä¸ºé¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¼è‡´æ€§èƒ½é™ä½</li><li>å¯ä»¥é‡‡ç”¨çº¿ç¨‹æ± æŠ€æœ¯æ¥å‡å°‘çº¿ç¨‹æ•°å’Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä½†æ²»æ ‡ä¸æ²»æœ¬ï¼Œå¦‚æœæœ‰å¾ˆå¤šè¿æ¥å»ºç«‹ï¼Œä½†é•¿æ—¶é—´ inactiveï¼Œä¼šé˜»å¡çº¿ç¨‹æ± ä¸­æ‰€æœ‰çº¿ç¨‹ï¼Œå› æ­¤ä¸é€‚åˆé•¿è¿æ¥ï¼Œåªé€‚åˆçŸ­è¿æ¥</li></ul></li></ul><p>æœåŠ¡å™¨ç«¯</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// ä½¿ç”¨ nio æ¥ç†è§£éé˜»å¡æ¨¡å¼, å•çº¿ç¨‹</span><span class="token comment" spellcheck="true">// 0. ByteBuffer</span>ByteBuffer buffer <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 1. åˆ›å»ºäº†æœåŠ¡å™¨</span>ServerSocketChannel ssc <span class="token operator">=</span> ServerSocketChannel<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ssc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// éé˜»å¡æ¨¡å¼</span><span class="token comment" spellcheck="true">// 2. ç»‘å®šç›‘å¬ç«¯å£</span>ssc<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 3. è¿æ¥é›†åˆ</span>List<span class="token operator">&lt;</span>SocketChannel<span class="token operator">></span> channels <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 4. accept å»ºç«‹ä¸å®¢æˆ·ç«¯è¿æ¥ï¼Œ SocketChannel ç”¨æ¥ä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡</span>    SocketChannel sc <span class="token operator">=</span> ssc<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// éé˜»å¡ï¼Œçº¿ç¨‹è¿˜ä¼šç»§ç»­è¿è¡Œï¼Œå¦‚æœæ²¡æœ‰è¿æ¥å»ºç«‹ï¼Œä½†scæ˜¯null</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>sc <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"connected... {}"</span><span class="token punctuation">,</span> sc<span class="token punctuation">)</span><span class="token punctuation">;</span>        sc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// éé˜»å¡æ¨¡å¼</span>        channels<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>SocketChannel channel <span class="token operator">:</span> channels<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 5. æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®</span>        <span class="token keyword">int</span> read <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// éé˜»å¡ï¼Œçº¿ç¨‹ä»ç„¶ä¼šç»§ç»­è¿è¡Œï¼Œå¦‚æœæ²¡æœ‰è¯»åˆ°æ•°æ®ï¼Œread è¿”å› 0</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>read <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">debugRead</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>            buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"after read...{}"</span><span class="token punctuation">,</span> channel<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¢æˆ·ç«¯</p><pre class="line-numbers language-java"><code class="language-java">SocketChannel sc <span class="token operator">=</span> SocketChannel<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>sc<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"waiting..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="éé˜»å¡"><a href="#éé˜»å¡" class="headerlink" title="éé˜»å¡"></a>éé˜»å¡</h4><ul><li>éé˜»å¡æ¨¡å¼ä¸‹ï¼Œç›¸å…³æ–¹æ³•éƒ½ä¼šä¸ä¼šè®©çº¿ç¨‹æš‚åœ<ul><li>åœ¨ ServerSocketChannel.accept åœ¨æ²¡æœ‰è¿æ¥å»ºç«‹æ—¶ï¼Œä¼šè¿”å› nullï¼Œç»§ç»­è¿è¡Œ</li><li>SocketChannel.read åœ¨æ²¡æœ‰æ•°æ®å¯è¯»æ—¶ï¼Œä¼šè¿”å› 0ï¼Œä½†çº¿ç¨‹ä¸å¿…é˜»å¡ï¼Œå¯ä»¥å»æ‰§è¡Œå…¶å®ƒ SocketChannel çš„ read æˆ–æ˜¯å»æ‰§è¡Œ ServerSocketChannel.accept </li><li>å†™æ•°æ®æ—¶ï¼Œçº¿ç¨‹åªæ˜¯ç­‰å¾…æ•°æ®å†™å…¥ Channel å³å¯ï¼Œæ— éœ€ç­‰ Channel é€šè¿‡ç½‘ç»œæŠŠæ•°æ®å‘é€å‡ºå»</li></ul></li><li>ä½†éé˜»å¡æ¨¡å¼ä¸‹ï¼Œå³ä½¿æ²¡æœ‰è¿æ¥å»ºç«‹ï¼Œå’Œå¯è¯»æ•°æ®ï¼Œçº¿ç¨‹ä»ç„¶åœ¨ä¸æ–­è¿è¡Œï¼Œç™½ç™½æµªè´¹äº† cpu</li><li>æ•°æ®å¤åˆ¶è¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹å®é™…è¿˜æ˜¯é˜»å¡çš„ï¼ˆAIO æ”¹è¿›çš„åœ°æ–¹ï¼‰</li></ul><p>æœåŠ¡å™¨ç«¯ï¼Œå®¢æˆ·ç«¯ä»£ç ä¸å˜</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// ä½¿ç”¨ nio æ¥ç†è§£éé˜»å¡æ¨¡å¼, å•çº¿ç¨‹</span><span class="token comment" spellcheck="true">// 0. ByteBuffer</span>ByteBuffer buffer <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 1. åˆ›å»ºäº†æœåŠ¡å™¨</span>ServerSocketChannel ssc <span class="token operator">=</span> ServerSocketChannel<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ssc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// éé˜»å¡æ¨¡å¼</span><span class="token comment" spellcheck="true">// 2. ç»‘å®šç›‘å¬ç«¯å£</span>ssc<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 3. è¿æ¥é›†åˆ</span>List<span class="token operator">&lt;</span>SocketChannel<span class="token operator">></span> channels <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 4. accept å»ºç«‹ä¸å®¢æˆ·ç«¯è¿æ¥ï¼Œ SocketChannel ç”¨æ¥ä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡</span>    SocketChannel sc <span class="token operator">=</span> ssc<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// éé˜»å¡ï¼Œçº¿ç¨‹è¿˜ä¼šç»§ç»­è¿è¡Œï¼Œå¦‚æœæ²¡æœ‰è¿æ¥å»ºç«‹ï¼Œä½†scæ˜¯null</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>sc <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"connected... {}"</span><span class="token punctuation">,</span> sc<span class="token punctuation">)</span><span class="token punctuation">;</span>        sc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// éé˜»å¡æ¨¡å¼</span>        channels<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>SocketChannel channel <span class="token operator">:</span> channels<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 5. æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®</span>        <span class="token keyword">int</span> read <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// éé˜»å¡ï¼Œçº¿ç¨‹ä»ç„¶ä¼šç»§ç»­è¿è¡Œï¼Œå¦‚æœæ²¡æœ‰è¯»åˆ°æ•°æ®ï¼Œread è¿”å› 0</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>read <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">debugRead</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>            buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"after read...{}"</span><span class="token punctuation">,</span> channel<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å¤šè·¯å¤ç”¨"><a href="#å¤šè·¯å¤ç”¨" class="headerlink" title="å¤šè·¯å¤ç”¨"></a>å¤šè·¯å¤ç”¨</h4><p>å•çº¿ç¨‹å¯ä»¥é…åˆ Selector å®Œæˆå¯¹å¤šä¸ª Channel å¯è¯»å†™äº‹ä»¶çš„ç›‘æ§ï¼Œè¿™ç§°ä¹‹ä¸ºå¤šè·¯å¤ç”¨</p><ul><li>å¤šè·¯å¤ç”¨ä»…é’ˆå¯¹ç½‘ç»œ IOã€æ™®é€šæ–‡ä»¶ IO æ²¡æ³•åˆ©ç”¨å¤šè·¯å¤ç”¨</li><li>å¦‚æœä¸ç”¨ Selector çš„éé˜»å¡æ¨¡å¼ï¼Œçº¿ç¨‹å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨åšæ— ç”¨åŠŸï¼Œè€Œ Selector èƒ½å¤Ÿä¿è¯<ul><li>æœ‰å¯è¿æ¥äº‹ä»¶æ—¶æ‰å»è¿æ¥</li><li>æœ‰å¯è¯»äº‹ä»¶æ‰å»è¯»å–</li><li>æœ‰å¯å†™äº‹ä»¶æ‰å»å†™å…¥<ul><li>é™äºç½‘ç»œä¼ è¾“èƒ½åŠ›ï¼ŒChannel æœªå¿…æ—¶æ—¶å¯å†™ï¼Œä¸€æ—¦ Channel å¯å†™ï¼Œä¼šè§¦å‘ Selector çš„å¯å†™äº‹ä»¶</li></ul></li></ul></li></ul><h3 id="4-2-Selector"><a href="#4-2-Selector" class="headerlink" title="4.2 Selector"></a>4.2 Selector</h3><pre class="line-numbers language-mermaid"><code class="language-mermaid">graph TDsubgraph selector ç‰ˆthread --> selectorselector --> c1(channel)selector --> c2(channel)selector --> c3(channel)end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¥½å¤„</p><ul><li>ä¸€ä¸ªçº¿ç¨‹é…åˆ selector å°±å¯ä»¥ç›‘æ§å¤šä¸ª channel çš„äº‹ä»¶ï¼Œäº‹ä»¶å‘ç”Ÿçº¿ç¨‹æ‰å»å¤„ç†ã€‚é¿å…éé˜»å¡æ¨¡å¼ä¸‹æ‰€åšæ— ç”¨åŠŸ</li><li>è®©è¿™ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¢«å……åˆ†åˆ©ç”¨</li><li>èŠ‚çº¦äº†çº¿ç¨‹çš„æ•°é‡</li><li>å‡å°‘äº†çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</li></ul><h4 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h4><pre class="line-numbers language-java"><code class="language-java">Selector selector <span class="token operator">=</span> Selector<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="ç»‘å®š-Channel-äº‹ä»¶"><a href="#ç»‘å®š-Channel-äº‹ä»¶" class="headerlink" title="ç»‘å®š Channel äº‹ä»¶"></a>ç»‘å®š Channel äº‹ä»¶</h4><p>ä¹Ÿç§°ä¹‹ä¸ºæ³¨å†Œäº‹ä»¶ï¼Œç»‘å®šçš„äº‹ä»¶ selector æ‰ä¼šå…³å¿ƒ </p><pre class="line-numbers language-java"><code class="language-java">channel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>SelectionKey key <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selecchannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>SelectionKey key <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> ç»‘å®šäº‹ä»¶<span class="token punctuation">)</span><span class="token punctuation">;</span>tor<span class="token punctuation">,</span> ç»‘å®šäº‹ä»¶<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>channel å¿…é¡»å·¥ä½œåœ¨éé˜»å¡æ¨¡å¼</li><li>FileChannel æ²¡æœ‰éé˜»å¡æ¨¡å¼ï¼Œå› æ­¤ä¸èƒ½é…åˆ selector ä¸€èµ·ä½¿ç”¨</li><li>ç»‘å®šçš„äº‹ä»¶ç±»å‹å¯ä»¥æœ‰<ul><li>connect - å®¢æˆ·ç«¯è¿æ¥æˆåŠŸæ—¶è§¦å‘</li><li>accept - æœåŠ¡å™¨ç«¯æˆåŠŸæ¥å—è¿æ¥æ—¶è§¦å‘</li><li>read - æ•°æ®å¯è¯»å…¥æ—¶è§¦å‘ï¼Œæœ‰å› ä¸ºæ¥æ”¶èƒ½åŠ›å¼±ï¼Œæ•°æ®æš‚ä¸èƒ½è¯»å…¥çš„æƒ…å†µ</li><li>write - æ•°æ®å¯å†™å‡ºæ—¶è§¦å‘ï¼Œæœ‰å› ä¸ºå‘é€èƒ½åŠ›å¼±ï¼Œæ•°æ®æš‚ä¸èƒ½å†™å‡ºçš„æƒ…å†µ</li></ul></li></ul><h4 id="ç›‘å¬-Channel-äº‹ä»¶"><a href="#ç›‘å¬-Channel-äº‹ä»¶" class="headerlink" title="ç›‘å¬ Channel äº‹ä»¶"></a>ç›‘å¬ Channel äº‹ä»¶</h4><p>å¯ä»¥é€šè¿‡ä¸‹é¢ä¸‰ç§æ–¹æ³•æ¥ç›‘å¬æ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼Œæ–¹æ³•çš„è¿”å›å€¼ä»£è¡¨æœ‰å¤šå°‘ channel å‘ç”Ÿäº†äº‹ä»¶</p><p>æ–¹æ³•1ï¼Œé˜»å¡ç›´åˆ°ç»‘å®šäº‹ä»¶å‘ç”Ÿ</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">int</span> count <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ–¹æ³•2ï¼Œé˜»å¡ç›´åˆ°ç»‘å®šäº‹ä»¶å‘ç”Ÿï¼Œæˆ–æ˜¯è¶…æ—¶ï¼ˆæ—¶é—´å•ä½ä¸º msï¼‰</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">int</span> count <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ–¹æ³•3ï¼Œä¸ä¼šé˜»å¡ï¼Œä¹Ÿå°±æ˜¯ä¸ç®¡æœ‰æ²¡æœ‰äº‹ä»¶ï¼Œç«‹åˆ»è¿”å›ï¼Œè‡ªå·±æ ¹æ®è¿”å›å€¼æ£€æŸ¥æ˜¯å¦æœ‰äº‹ä»¶</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">int</span> count <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="ğŸ’¡-select-ä½•æ—¶ä¸é˜»å¡"><a href="#ğŸ’¡-select-ä½•æ—¶ä¸é˜»å¡" class="headerlink" title="ğŸ’¡ select ä½•æ—¶ä¸é˜»å¡"></a>ğŸ’¡ select ä½•æ—¶ä¸é˜»å¡</h4><blockquote><ul><li>äº‹ä»¶å‘ç”Ÿæ—¶<ul><li>å®¢æˆ·ç«¯å‘èµ·è¿æ¥è¯·æ±‚ï¼Œä¼šè§¦å‘ accept äº‹ä»¶</li><li>å®¢æˆ·ç«¯å‘é€æ•°æ®è¿‡æ¥ï¼Œå®¢æˆ·ç«¯æ­£å¸¸ã€å¼‚å¸¸å…³é—­æ—¶ï¼Œéƒ½ä¼šè§¦å‘ read äº‹ä»¶ï¼Œå¦å¤–å¦‚æœå‘é€çš„æ•°æ®å¤§äº buffer ç¼“å†²åŒºï¼Œä¼šè§¦å‘å¤šæ¬¡è¯»å–äº‹ä»¶</li><li>channel å¯å†™ï¼Œä¼šè§¦å‘ write äº‹ä»¶</li><li>åœ¨ linux ä¸‹ nio bug å‘ç”Ÿæ—¶</li></ul></li><li>è°ƒç”¨ selector.wakeup()</li><li>è°ƒç”¨ selector.close()</li><li>selector æ‰€åœ¨çº¿ç¨‹ interrupt</li></ul></blockquote><h3 id="4-3-å¤„ç†-accept-äº‹ä»¶"><a href="#4-3-å¤„ç†-accept-äº‹ä»¶" class="headerlink" title="4.3 å¤„ç† accept äº‹ä»¶"></a>4.3 å¤„ç† accept äº‹ä»¶</h3><p>å®¢æˆ·ç«¯ä»£ç ä¸º</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span>Socket socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">;</span>            socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            System<span class="token punctuation">.</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœåŠ¡å™¨ç«¯ä»£ç ä¸º</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChannelDemo6</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span>ServerSocketChannel channel <span class="token operator">=</span> ServerSocketChannel<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            channel<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span>            Selector selector <span class="token operator">=</span> Selector<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> SelectionKey<span class="token punctuation">.</span>OP_ACCEPT<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">int</span> count <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//                int count = selector.selectNow();</span>                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"select count: {}"</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//                if(count &lt;= 0) {</span><span class="token comment" spellcheck="true">//                    continue;</span><span class="token comment" spellcheck="true">//                }</span>                <span class="token comment" spellcheck="true">// è·å–æ‰€æœ‰äº‹ä»¶</span>                Set<span class="token operator">&lt;</span>SelectionKey<span class="token operator">></span> keys <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// éå†æ‰€æœ‰äº‹ä»¶ï¼Œé€ä¸€å¤„ç†</span>                Iterator<span class="token operator">&lt;</span>SelectionKey<span class="token operator">></span> iter <span class="token operator">=</span> keys<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    SelectionKey key <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment" spellcheck="true">// åˆ¤æ–­äº‹ä»¶ç±»å‹</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        ServerSocketChannel c <span class="token operator">=</span> <span class="token punctuation">(</span>ServerSocketChannel<span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment" spellcheck="true">// å¿…é¡»å¤„ç†</span>                        SocketChannel sc <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> sc<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token comment" spellcheck="true">// å¤„ç†å®Œæ¯•ï¼Œå¿…é¡»å°†äº‹ä»¶ç§»é™¤</span>                    iter<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ğŸ’¡-äº‹ä»¶å‘ç”Ÿåèƒ½å¦ä¸å¤„ç†"><a href="#ğŸ’¡-äº‹ä»¶å‘ç”Ÿåèƒ½å¦ä¸å¤„ç†" class="headerlink" title="ğŸ’¡ äº‹ä»¶å‘ç”Ÿåèƒ½å¦ä¸å¤„ç†"></a>ğŸ’¡ äº‹ä»¶å‘ç”Ÿåèƒ½å¦ä¸å¤„ç†</h4><blockquote><p>äº‹ä»¶å‘ç”Ÿåï¼Œè¦ä¹ˆå¤„ç†ï¼Œè¦ä¹ˆå–æ¶ˆï¼ˆcancelï¼‰ï¼Œä¸èƒ½ä»€ä¹ˆéƒ½ä¸åšï¼Œå¦åˆ™ä¸‹æ¬¡è¯¥äº‹ä»¶ä»ä¼šè§¦å‘ï¼Œè¿™æ˜¯å› ä¸º nio åº•å±‚ä½¿ç”¨çš„æ˜¯æ°´å¹³è§¦å‘</p></blockquote><h3 id="4-4-å¤„ç†-read-äº‹ä»¶"><a href="#4-4-å¤„ç†-read-äº‹ä»¶" class="headerlink" title="4.4 å¤„ç† read äº‹ä»¶"></a>4.4 å¤„ç† read äº‹ä»¶</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChannelDemo6</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span>ServerSocketChannel channel <span class="token operator">=</span> ServerSocketChannel<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            channel<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span>            Selector selector <span class="token operator">=</span> Selector<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> SelectionKey<span class="token punctuation">.</span>OP_ACCEPT<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">int</span> count <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//                int count = selector.selectNow();</span>                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"select count: {}"</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//                if(count &lt;= 0) {</span><span class="token comment" spellcheck="true">//                    continue;</span><span class="token comment" spellcheck="true">//                }</span>                <span class="token comment" spellcheck="true">// è·å–æ‰€æœ‰äº‹ä»¶</span>                Set<span class="token operator">&lt;</span>SelectionKey<span class="token operator">></span> keys <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// éå†æ‰€æœ‰äº‹ä»¶ï¼Œé€ä¸€å¤„ç†</span>                Iterator<span class="token operator">&lt;</span>SelectionKey<span class="token operator">></span> iter <span class="token operator">=</span> keys<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    SelectionKey key <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment" spellcheck="true">// åˆ¤æ–­äº‹ä»¶ç±»å‹</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        ServerSocketChannel c <span class="token operator">=</span> <span class="token punctuation">(</span>ServerSocketChannel<span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment" spellcheck="true">// å¿…é¡»å¤„ç†</span>                        SocketChannel sc <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        sc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        sc<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> SelectionKey<span class="token punctuation">.</span>OP_READ<span class="token punctuation">)</span><span class="token punctuation">;</span>                        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"è¿æ¥å·²å»ºç«‹: {}"</span><span class="token punctuation">,</span> sc<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        SocketChannel sc <span class="token operator">=</span> <span class="token punctuation">(</span>SocketChannel<span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        ByteBuffer buffer <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">int</span> read <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span>read <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            key<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            sc<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                            buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token function">debug</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                    <span class="token comment" spellcheck="true">// å¤„ç†å®Œæ¯•ï¼Œå¿…é¡»å°†äº‹ä»¶ç§»é™¤</span>                    iter<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¼€å¯ä¸¤ä¸ªå®¢æˆ·ç«¯ï¼Œä¿®æ”¹ä¸€ä¸‹å‘é€æ–‡å­—ï¼Œè¾“å‡º</p><pre><code>sun.nio.ch.ServerSocketChannelImpl[/0:0:0:0:0:0:0:0:8080]21:16:39 [DEBUG] [main] c.i.n.ChannelDemo6 - select count: 121:16:39 [DEBUG] [main] c.i.n.ChannelDemo6 - è¿æ¥å·²å»ºç«‹: java.nio.channels.SocketChannel[connected local=/127.0.0.1:8080 remote=/127.0.0.1:60367]21:16:39 [DEBUG] [main] c.i.n.ChannelDemo6 - select count: 1         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 68 65 6c 6c 6f                                  |hello           |+--------+-------------------------------------------------+----------------+21:16:59 [DEBUG] [main] c.i.n.ChannelDemo6 - select count: 121:16:59 [DEBUG] [main] c.i.n.ChannelDemo6 - è¿æ¥å·²å»ºç«‹: java.nio.channels.SocketChannel[connected local=/127.0.0.1:8080 remote=/127.0.0.1:60378]21:16:59 [DEBUG] [main] c.i.n.ChannelDemo6 - select count: 1         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 77 6f 72 6c 64                                  |world           |+--------+-------------------------------------------------+----------------+</code></pre><h4 id="ğŸ’¡-ä¸ºä½•è¦-iter-remove"><a href="#ğŸ’¡-ä¸ºä½•è¦-iter-remove" class="headerlink" title="ğŸ’¡ ä¸ºä½•è¦ iter.remove()"></a>ğŸ’¡ ä¸ºä½•è¦ iter.remove()</h4><blockquote><p>å› ä¸º select åœ¨äº‹ä»¶å‘ç”Ÿåï¼Œå°±ä¼šå°†ç›¸å…³çš„ key æ”¾å…¥ selectedKeys é›†åˆï¼Œä½†ä¸ä¼šåœ¨å¤„ç†å®Œåä» selectedKeys é›†åˆä¸­ç§»é™¤ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±ç¼–ç åˆ é™¤ã€‚ä¾‹å¦‚</p><ul><li>ç¬¬ä¸€æ¬¡è§¦å‘äº† ssckey ä¸Šçš„ accept äº‹ä»¶ï¼Œæ²¡æœ‰ç§»é™¤ ssckey </li><li>ç¬¬äºŒæ¬¡è§¦å‘äº† sckey ä¸Šçš„ read äº‹ä»¶ï¼Œä½†è¿™æ—¶ selectedKeys ä¸­è¿˜æœ‰ä¸Šæ¬¡çš„ ssckey ï¼Œåœ¨å¤„ç†æ—¶å› ä¸ºæ²¡æœ‰çœŸæ­£çš„ serverSocket è¿ä¸Šäº†ï¼Œå°±ä¼šå¯¼è‡´ç©ºæŒ‡é’ˆå¼‚å¸¸</li></ul></blockquote><h4 id="ğŸ’¡-cancel-çš„ä½œç”¨"><a href="#ğŸ’¡-cancel-çš„ä½œç”¨" class="headerlink" title="ğŸ’¡ cancel çš„ä½œç”¨"></a>ğŸ’¡ cancel çš„ä½œç”¨</h4><blockquote><p>cancel ä¼šå–æ¶ˆæ³¨å†Œåœ¨ selector ä¸Šçš„ channelï¼Œå¹¶ä» keys é›†åˆä¸­åˆ é™¤ key åç»­ä¸ä¼šå†ç›‘å¬äº‹ä»¶</p></blockquote><h4 id="âš ï¸-ä¸å¤„ç†è¾¹ç•Œçš„é—®é¢˜"><a href="#âš ï¸-ä¸å¤„ç†è¾¹ç•Œçš„é—®é¢˜" class="headerlink" title="âš ï¸  ä¸å¤„ç†è¾¹ç•Œçš„é—®é¢˜"></a>âš ï¸  ä¸å¤„ç†è¾¹ç•Œçš„é—®é¢˜</h4><p>ä»¥å‰æœ‰åŒå­¦å†™è¿‡è¿™æ ·çš„ä»£ç ï¼Œæ€è€ƒæ³¨é‡Šä¸­ä¸¤ä¸ªé—®é¢˜ï¼Œä»¥ bio ä¸ºä¾‹ï¼Œå…¶å® nio é“ç†æ˜¯ä¸€æ ·çš„</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Server</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>        ServerSocket ss<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">9000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            Socket s <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            InputStream in <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// è¿™é‡Œè¿™ä¹ˆå†™ï¼Œæœ‰æ²¡æœ‰é—®é¢˜</span>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">int</span> read <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// è¿™é‡Œè¿™ä¹ˆå†™ï¼Œæœ‰æ²¡æœ‰é—®é¢˜</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>read <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> read<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¢æˆ·ç«¯</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>        Socket max <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">9000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        OutputStream out <span class="token operator">=</span> max<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"ä½ å¥½"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        max<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre><code>helloworldï¿½ï¿½å¥½</code></pre><p>ä¸ºä»€ä¹ˆï¼Ÿ</p><h4 id="å¤„ç†æ¶ˆæ¯çš„è¾¹ç•Œ"><a href="#å¤„ç†æ¶ˆæ¯çš„è¾¹ç•Œ" class="headerlink" title="å¤„ç†æ¶ˆæ¯çš„è¾¹ç•Œ"></a>å¤„ç†æ¶ˆæ¯çš„è¾¹ç•Œ</h4><img src="/posts/undefined/0023.png"><ul><li>ä¸€ç§æ€è·¯æ˜¯å›ºå®šæ¶ˆæ¯é•¿åº¦ï¼Œæ•°æ®åŒ…å¤§å°ä¸€æ ·ï¼ŒæœåŠ¡å™¨æŒ‰é¢„å®šé•¿åº¦è¯»å–ï¼Œç¼ºç‚¹æ˜¯æµªè´¹å¸¦å®½</li><li>å¦ä¸€ç§æ€è·¯æ˜¯æŒ‰åˆ†éš”ç¬¦æ‹†åˆ†ï¼Œç¼ºç‚¹æ˜¯æ•ˆç‡ä½</li><li>TLV æ ¼å¼ï¼Œå³ Type ç±»å‹ã€Length é•¿åº¦ã€Value æ•°æ®ï¼Œç±»å‹å’Œé•¿åº¦å·²çŸ¥çš„æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥æ–¹ä¾¿è·å–æ¶ˆæ¯å¤§å°ï¼Œåˆ†é…åˆé€‚çš„ bufferï¼Œç¼ºç‚¹æ˜¯ buffer éœ€è¦æå‰åˆ†é…ï¼Œå¦‚æœå†…å®¹è¿‡å¤§ï¼Œåˆ™å½±å“ server ååé‡<ul><li>Http 1.1 æ˜¯ TLV æ ¼å¼</li><li>Http 2.0 æ˜¯ LTV æ ¼å¼</li></ul></li></ul><pre class="line-numbers language-mermaid"><code class="language-mermaid">sequenceDiagram participant c1 as å®¢æˆ·ç«¯1participant s as æœåŠ¡å™¨participant b1 as ByteBuffer1participant b2 as ByteBuffer2c1 ->> s: å‘é€ 01234567890abcdef3333\rs ->> b1: ç¬¬ä¸€æ¬¡ read å­˜å…¥ 01234567890abcdefs ->> b2: æ‰©å®¹b1 ->> b2: æ‹·è´ 01234567890abcdefs ->> b2: ç¬¬äºŒæ¬¡ read å­˜å…¥ 3333\rb2 ->> b2: 01234567890abcdef3333\r<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœåŠ¡å™¨ç«¯</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">split</span><span class="token punctuation">(</span>ByteBuffer source<span class="token punctuation">)</span> <span class="token punctuation">{</span>    source<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> source<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// æ‰¾åˆ°ä¸€æ¡å®Œæ•´æ¶ˆæ¯</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'\n'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">int</span> length <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">-</span> source<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// æŠŠè¿™æ¡å®Œæ•´æ¶ˆæ¯å­˜å…¥æ–°çš„ ByteBuffer</span>            ByteBuffer target <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// ä» source è¯»ï¼Œå‘ target å†™</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                target<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token function">debugAll</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    source<span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 0123456789abcdef  position 16 limit 16</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 1. åˆ›å»º selector, ç®¡ç†å¤šä¸ª channel</span>    Selector selector <span class="token operator">=</span> Selector<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ServerSocketChannel ssc <span class="token operator">=</span> ServerSocketChannel<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ssc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 2. å»ºç«‹ selector å’Œ channel çš„è”ç³»ï¼ˆæ³¨å†Œï¼‰</span>    <span class="token comment" spellcheck="true">// SelectionKey å°±æ˜¯å°†æ¥äº‹ä»¶å‘ç”Ÿåï¼Œé€šè¿‡å®ƒå¯ä»¥çŸ¥é“äº‹ä»¶å’Œå“ªä¸ªchannelçš„äº‹ä»¶</span>    SelectionKey sscKey <span class="token operator">=</span> ssc<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// key åªå…³æ³¨ accept äº‹ä»¶</span>    sscKey<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span>SelectionKey<span class="token punctuation">.</span>OP_ACCEPT<span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"sscKey:{}"</span><span class="token punctuation">,</span> sscKey<span class="token punctuation">)</span><span class="token punctuation">;</span>    ssc<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 3. select æ–¹æ³•, æ²¡æœ‰äº‹ä»¶å‘ç”Ÿï¼Œçº¿ç¨‹é˜»å¡ï¼Œæœ‰äº‹ä»¶ï¼Œçº¿ç¨‹æ‰ä¼šæ¢å¤è¿è¡Œ</span>        <span class="token comment" spellcheck="true">// select åœ¨äº‹ä»¶æœªå¤„ç†æ—¶ï¼Œå®ƒä¸ä¼šé˜»å¡, äº‹ä»¶å‘ç”Ÿåè¦ä¹ˆå¤„ç†ï¼Œè¦ä¹ˆå–æ¶ˆï¼Œä¸èƒ½ç½®ä¹‹ä¸ç†</span>        selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 4. å¤„ç†äº‹ä»¶, selectedKeys å†…éƒ¨åŒ…å«äº†æ‰€æœ‰å‘ç”Ÿçš„äº‹ä»¶</span>        Iterator<span class="token operator">&lt;</span>SelectionKey<span class="token operator">></span> iter <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// accept, read</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            SelectionKey key <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// å¤„ç†key æ—¶ï¼Œè¦ä» selectedKeys é›†åˆä¸­åˆ é™¤ï¼Œå¦åˆ™ä¸‹æ¬¡å¤„ç†å°±ä¼šæœ‰é—®é¢˜</span>            iter<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"key: {}"</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// 5. åŒºåˆ†äº‹ä»¶ç±»å‹</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// å¦‚æœæ˜¯ accept</span>                ServerSocketChannel channel <span class="token operator">=</span> <span class="token punctuation">(</span>ServerSocketChannel<span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                SocketChannel sc <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                sc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                ByteBuffer buffer <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// attachment</span>                <span class="token comment" spellcheck="true">// å°†ä¸€ä¸ª byteBuffer ä½œä¸ºé™„ä»¶å…³è”åˆ° selectionKey ä¸Š</span>                SelectionKey scKey <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                scKey<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span>SelectionKey<span class="token punctuation">.</span>OP_READ<span class="token punctuation">)</span><span class="token punctuation">;</span>                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> sc<span class="token punctuation">)</span><span class="token punctuation">;</span>                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"scKey:{}"</span><span class="token punctuation">,</span> scKey<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// å¦‚æœæ˜¯ read</span>                <span class="token keyword">try</span> <span class="token punctuation">{</span>                    SocketChannel channel <span class="token operator">=</span> <span class="token punctuation">(</span>SocketChannel<span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// æ‹¿åˆ°è§¦å‘äº‹ä»¶çš„channel</span>                    <span class="token comment" spellcheck="true">// è·å– selectionKey ä¸Šå…³è”çš„é™„ä»¶</span>                    ByteBuffer buffer <span class="token operator">=</span> <span class="token punctuation">(</span>ByteBuffer<span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">attachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">int</span> read <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// å¦‚æœæ˜¯æ­£å¸¸æ–­å¼€ï¼Œread çš„æ–¹æ³•çš„è¿”å›å€¼æ˜¯ -1</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>read <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        key<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                        <span class="token function">split</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment" spellcheck="true">// éœ€è¦æ‰©å®¹</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> buffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            ByteBuffer newBuffer <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            newBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 0123456789abcdef3333\n</span>                            key<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>newBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    key<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// å› ä¸ºå®¢æˆ·ç«¯æ–­å¼€äº†,å› æ­¤éœ€è¦å°† key å–æ¶ˆï¼ˆä» selector çš„ keys é›†åˆä¸­çœŸæ­£åˆ é™¤ keyï¼‰</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¢æˆ·ç«¯</p><pre class="line-numbers language-java"><code class="language-java">SocketChannel sc <span class="token operator">=</span> SocketChannel<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>sc<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>SocketAddress address <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">getLocalAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// sc.write(Charset.defaultCharset().encode("hello\nworld\n"));</span>sc<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>Charset<span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"0123\n456789abcdef"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>sc<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>Charset<span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"0123456789abcdef3333\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ByteBuffer-å¤§å°åˆ†é…"><a href="#ByteBuffer-å¤§å°åˆ†é…" class="headerlink" title="ByteBuffer å¤§å°åˆ†é…"></a>ByteBuffer å¤§å°åˆ†é…</h4><ul><li>æ¯ä¸ª channel éƒ½éœ€è¦è®°å½•å¯èƒ½è¢«åˆ‡åˆ†çš„æ¶ˆæ¯ï¼Œå› ä¸º ByteBuffer ä¸èƒ½è¢«å¤šä¸ª channel å…±åŒä½¿ç”¨ï¼Œå› æ­¤éœ€è¦ä¸ºæ¯ä¸ª channel ç»´æŠ¤ä¸€ä¸ªç‹¬ç«‹çš„ ByteBuffer</li><li>ByteBuffer ä¸èƒ½å¤ªå¤§ï¼Œæ¯”å¦‚ä¸€ä¸ª ByteBuffer 1Mb çš„è¯ï¼Œè¦æ”¯æŒç™¾ä¸‡è¿æ¥å°±è¦ 1Tb å†…å­˜ï¼Œå› æ­¤éœ€è¦è®¾è®¡å¤§å°å¯å˜çš„ ByteBuffer<ul><li>ä¸€ç§æ€è·¯æ˜¯é¦–å…ˆåˆ†é…ä¸€ä¸ªè¾ƒå°çš„ bufferï¼Œä¾‹å¦‚ 4kï¼Œå¦‚æœå‘ç°æ•°æ®ä¸å¤Ÿï¼Œå†åˆ†é… 8k çš„ bufferï¼Œå°† 4k buffer å†…å®¹æ‹·è´è‡³ 8k bufferï¼Œä¼˜ç‚¹æ˜¯æ¶ˆæ¯è¿ç»­å®¹æ˜“å¤„ç†ï¼Œç¼ºç‚¹æ˜¯æ•°æ®æ‹·è´è€—è´¹æ€§èƒ½ï¼Œå‚è€ƒå®ç° <a href="http://tutorials.jenkov.com/java-performance/resizable-array.html" target="_blank" rel="noopener">http://tutorials.jenkov.com/java-performance/resizable-array.html</a></li><li>å¦ä¸€ç§æ€è·¯æ˜¯ç”¨å¤šä¸ªæ•°ç»„ç»„æˆ bufferï¼Œä¸€ä¸ªæ•°ç»„ä¸å¤Ÿï¼ŒæŠŠå¤šå‡ºæ¥çš„å†…å®¹å†™å…¥æ–°çš„æ•°ç»„ï¼Œä¸å‰é¢çš„åŒºåˆ«æ˜¯æ¶ˆæ¯å­˜å‚¨ä¸è¿ç»­è§£æå¤æ‚ï¼Œä¼˜ç‚¹æ˜¯é¿å…äº†æ‹·è´å¼•èµ·çš„æ€§èƒ½æŸè€—</li></ul></li></ul><h3 id="4-5-å¤„ç†-write-äº‹ä»¶"><a href="#4-5-å¤„ç†-write-äº‹ä»¶" class="headerlink" title="4.5 å¤„ç† write äº‹ä»¶"></a>4.5 å¤„ç† write äº‹ä»¶</h3><h4 id="ä¸€æ¬¡æ— æ³•å†™å®Œä¾‹å­"><a href="#ä¸€æ¬¡æ— æ³•å†™å®Œä¾‹å­" class="headerlink" title="ä¸€æ¬¡æ— æ³•å†™å®Œä¾‹å­"></a>ä¸€æ¬¡æ— æ³•å†™å®Œä¾‹å­</h4><ul><li>éé˜»å¡æ¨¡å¼ä¸‹ï¼Œæ— æ³•ä¿è¯æŠŠ buffer ä¸­æ‰€æœ‰æ•°æ®éƒ½å†™å…¥ channelï¼Œå› æ­¤éœ€è¦è¿½è¸ª write æ–¹æ³•çš„è¿”å›å€¼ï¼ˆä»£è¡¨å®é™…å†™å…¥å­—èŠ‚æ•°ï¼‰</li><li>ç”¨ selector ç›‘å¬æ‰€æœ‰ channel çš„å¯å†™äº‹ä»¶ï¼Œæ¯ä¸ª channel éƒ½éœ€è¦ä¸€ä¸ª key æ¥è·Ÿè¸ª bufferï¼Œä½†è¿™æ ·åˆä¼šå¯¼è‡´å ç”¨å†…å­˜è¿‡å¤šï¼Œå°±æœ‰ä¸¤é˜¶æ®µç­–ç•¥<ul><li>å½“æ¶ˆæ¯å¤„ç†å™¨ç¬¬ä¸€æ¬¡å†™å…¥æ¶ˆæ¯æ—¶ï¼Œæ‰å°† channel æ³¨å†Œåˆ° selector ä¸Š</li><li>selector æ£€æŸ¥ channel ä¸Šçš„å¯å†™äº‹ä»¶ï¼Œå¦‚æœæ‰€æœ‰çš„æ•°æ®å†™å®Œäº†ï¼Œå°±å–æ¶ˆ channel çš„æ³¨å†Œ</li><li>å¦‚æœä¸å–æ¶ˆï¼Œä¼šæ¯æ¬¡å¯å†™å‡ä¼šè§¦å‘ write äº‹ä»¶</li></ul></li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WriteServer</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>        ServerSocketChannel ssc <span class="token operator">=</span> ServerSocketChannel<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ssc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ssc<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Selector selector <span class="token operator">=</span> Selector<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ssc<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> SelectionKey<span class="token punctuation">.</span>OP_ACCEPT<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            Iterator<span class="token operator">&lt;</span>SelectionKey<span class="token operator">></span> iter <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                SelectionKey key <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                iter<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    SocketChannel sc <span class="token operator">=</span> ssc<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    sc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    SelectionKey sckey <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> SelectionKey<span class="token punctuation">.</span>OP_READ<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment" spellcheck="true">// 1. å‘å®¢æˆ·ç«¯å‘é€å†…å®¹</span>                    StringBuilder sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    ByteBuffer buffer <span class="token operator">=</span> Charset<span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">int</span> write <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment" spellcheck="true">// 3. write è¡¨ç¤ºå®é™…å†™äº†å¤šå°‘å­—èŠ‚</span>                    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å®é™…å†™å…¥å­—èŠ‚:"</span> <span class="token operator">+</span> write<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment" spellcheck="true">// 4. å¦‚æœæœ‰å‰©ä½™æœªè¯»å­—èŠ‚ï¼Œæ‰éœ€è¦å…³æ³¨å†™äº‹ä»¶</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token comment" spellcheck="true">// read 1  write 4</span>                        <span class="token comment" spellcheck="true">// åœ¨åŸæœ‰å…³æ³¨äº‹ä»¶çš„åŸºç¡€ä¸Šï¼Œå¤šå…³æ³¨ å†™äº‹ä»¶</span>                        sckey<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span>sckey<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> SelectionKey<span class="token punctuation">.</span>OP_WRITE<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment" spellcheck="true">// æŠŠ buffer ä½œä¸ºé™„ä»¶åŠ å…¥ sckey</span>                        sckey<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    ByteBuffer buffer <span class="token operator">=</span> <span class="token punctuation">(</span>ByteBuffer<span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">attachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    SocketChannel sc <span class="token operator">=</span> <span class="token punctuation">(</span>SocketChannel<span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">int</span> write <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å®é™…å†™å…¥å­—èŠ‚:"</span> <span class="token operator">+</span> write<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>buffer<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// å†™å®Œäº†</span>                        key<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> SelectionKey<span class="token punctuation">.</span>OP_WRITE<span class="token punctuation">)</span><span class="token punctuation">;</span>                        key<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¢æˆ·ç«¯</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WriteClient</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>        Selector selector <span class="token operator">=</span> Selector<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        SocketChannel sc <span class="token operator">=</span> SocketChannel<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sc<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> SelectionKey<span class="token punctuation">.</span>OP_CONNECT <span class="token operator">|</span> SelectionKey<span class="token punctuation">.</span>OP_READ<span class="token punctuation">)</span><span class="token punctuation">;</span>        sc<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            Iterator<span class="token operator">&lt;</span>SelectionKey<span class="token operator">></span> iter <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                SelectionKey key <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                iter<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isConnectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sc<span class="token punctuation">.</span><span class="token function">finishConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    ByteBuffer buffer <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    count <span class="token operator">+=</span> sc<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                    buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ğŸ’¡-write-ä¸ºä½•è¦å–æ¶ˆ"><a href="#ğŸ’¡-write-ä¸ºä½•è¦å–æ¶ˆ" class="headerlink" title="ğŸ’¡ write ä¸ºä½•è¦å–æ¶ˆ"></a>ğŸ’¡ write ä¸ºä½•è¦å–æ¶ˆ</h4><p>åªè¦å‘ channel å‘é€æ•°æ®æ—¶ï¼Œsocket ç¼“å†²å¯å†™ï¼Œè¿™ä¸ªäº‹ä»¶ä¼šé¢‘ç¹è§¦å‘ï¼Œå› æ­¤åº”å½“åªåœ¨ socket ç¼“å†²åŒºå†™ä¸ä¸‹æ—¶å†å…³æ³¨å¯å†™äº‹ä»¶ï¼Œæ•°æ®å†™å®Œä¹‹åå†å–æ¶ˆå…³æ³¨</p><h3 id="4-6-æ›´è¿›ä¸€æ­¥"><a href="#4-6-æ›´è¿›ä¸€æ­¥" class="headerlink" title="4.6 æ›´è¿›ä¸€æ­¥"></a>4.6 æ›´è¿›ä¸€æ­¥</h3><h4 id="ğŸ’¡-åˆ©ç”¨å¤šçº¿ç¨‹ä¼˜åŒ–"><a href="#ğŸ’¡-åˆ©ç”¨å¤šçº¿ç¨‹ä¼˜åŒ–" class="headerlink" title="ğŸ’¡ åˆ©ç”¨å¤šçº¿ç¨‹ä¼˜åŒ–"></a>ğŸ’¡ åˆ©ç”¨å¤šçº¿ç¨‹ä¼˜åŒ–</h4><blockquote><p>ç°åœ¨éƒ½æ˜¯å¤šæ ¸ cpuï¼Œè®¾è®¡æ—¶è¦å……åˆ†è€ƒè™‘åˆ«è®© cpu çš„åŠ›é‡è¢«ç™½ç™½æµªè´¹</p></blockquote><p>å‰é¢çš„ä»£ç åªæœ‰ä¸€ä¸ªé€‰æ‹©å™¨ï¼Œæ²¡æœ‰å……åˆ†åˆ©ç”¨å¤šæ ¸ cpuï¼Œå¦‚ä½•æ”¹è¿›å‘¢ï¼Ÿ</p><p>åˆ†ä¸¤ç»„é€‰æ‹©å™¨</p><ul><li>å•çº¿ç¨‹é…ä¸€ä¸ªé€‰æ‹©å™¨ï¼Œä¸“é—¨å¤„ç† accept äº‹ä»¶</li><li>åˆ›å»º cpu æ ¸å¿ƒæ•°çš„çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹é…ä¸€ä¸ªé€‰æ‹©å™¨ï¼Œè½®æµå¤„ç† read äº‹ä»¶</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChannelDemo7</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>        <span class="token keyword">new</span> <span class="token class-name">BossEventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Slf4j</span>    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">BossEventLoop</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>        <span class="token keyword">private</span> Selector boss<span class="token punctuation">;</span>        <span class="token keyword">private</span> WorkerEventLoop<span class="token punctuation">[</span><span class="token punctuation">]</span> workers<span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> start <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        AtomicInteger index <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>start<span class="token punctuation">)</span> <span class="token punctuation">{</span>                ServerSocketChannel ssc <span class="token operator">=</span> ServerSocketChannel<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                ssc<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                ssc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                boss <span class="token operator">=</span> Selector<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                SelectionKey ssckey <span class="token operator">=</span> ssc<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>boss<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>                ssckey<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span>SelectionKey<span class="token punctuation">.</span>OP_ACCEPT<span class="token punctuation">)</span><span class="token punctuation">;</span>                workers <span class="token operator">=</span> <span class="token function">initEventLoops</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"boss"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"boss start..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                start <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> WorkerEventLoop<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">initEventLoops</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//        EventLoop[] eventLoops = new EventLoop[Runtime.getRuntime().availableProcessors()];</span>            WorkerEventLoop<span class="token punctuation">[</span><span class="token punctuation">]</span> workerEventLoops <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WorkerEventLoop</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> workerEventLoops<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                workerEventLoops<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WorkerEventLoop</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> workerEventLoops<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">try</span> <span class="token punctuation">{</span>                    boss<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    Iterator<span class="token operator">&lt;</span>SelectionKey<span class="token operator">></span> iter <span class="token operator">=</span> boss<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        SelectionKey key <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        iter<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            ServerSocketChannel c <span class="token operator">=</span> <span class="token punctuation">(</span>ServerSocketChannel<span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            SocketChannel sc <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            sc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"{} connected"</span><span class="token punctuation">,</span> sc<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            workers<span class="token punctuation">[</span>index<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> workers<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Slf4j</span>    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WorkerEventLoop</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>        <span class="token keyword">private</span> Selector worker<span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> start <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token keyword">int</span> index<span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token keyword">final</span> ConcurrentLinkedQueue<span class="token operator">&lt;</span>Runnable<span class="token operator">></span> tasks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentLinkedQueue</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token function">WorkerEventLoop</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">=</span> index<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span>SocketChannel sc<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>start<span class="token punctuation">)</span> <span class="token punctuation">{</span>                worker <span class="token operator">=</span> Selector<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"worker-"</span> <span class="token operator">+</span> index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                start <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            tasks<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>                <span class="token keyword">try</span> <span class="token punctuation">{</span>                    SelectionKey sckey <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>worker<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>                    sckey<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span>SelectionKey<span class="token punctuation">.</span>OP_READ<span class="token punctuation">)</span><span class="token punctuation">;</span>                    worker<span class="token punctuation">.</span><span class="token function">selectNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            worker<span class="token punctuation">.</span><span class="token function">wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">try</span> <span class="token punctuation">{</span>                    worker<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    Runnable task <span class="token operator">=</span> tasks<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>task <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        task<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    Set<span class="token operator">&lt;</span>SelectionKey<span class="token operator">></span> keys <span class="token operator">=</span> worker<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    Iterator<span class="token operator">&lt;</span>SelectionKey<span class="token operator">></span> iter <span class="token operator">=</span> keys<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        SelectionKey key <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            SocketChannel sc <span class="token operator">=</span> <span class="token punctuation">(</span>SocketChannel<span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            ByteBuffer buffer <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">try</span> <span class="token punctuation">{</span>                                <span class="token keyword">int</span> read <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token keyword">if</span> <span class="token punctuation">(</span>read <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                    key<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    sc<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                                    buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"{} message:"</span><span class="token punctuation">,</span> sc<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    <span class="token function">debugAll</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token punctuation">}</span>                            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                key<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                sc<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">}</span>                        <span class="token punctuation">}</span>                        iter<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ğŸ’¡-å¦‚ä½•æ‹¿åˆ°-cpu-ä¸ªæ•°"><a href="#ğŸ’¡-å¦‚ä½•æ‹¿åˆ°-cpu-ä¸ªæ•°" class="headerlink" title="ğŸ’¡ å¦‚ä½•æ‹¿åˆ° cpu ä¸ªæ•°"></a>ğŸ’¡ å¦‚ä½•æ‹¿åˆ° cpu ä¸ªæ•°</h4><blockquote><ul><li>Runtime.getRuntime().availableProcessors() å¦‚æœå·¥ä½œåœ¨ docker å®¹å™¨ä¸‹ï¼Œå› ä¸ºå®¹å™¨ä¸æ˜¯ç‰©ç†éš”ç¦»çš„ï¼Œä¼šæ‹¿åˆ°ç‰©ç† cpu ä¸ªæ•°ï¼Œè€Œä¸æ˜¯å®¹å™¨ç”³è¯·æ—¶çš„ä¸ªæ•°</li><li>è¿™ä¸ªé—®é¢˜ç›´åˆ° jdk 10 æ‰ä¿®å¤ï¼Œä½¿ç”¨ jvm å‚æ•° UseContainerSupport é…ç½®ï¼Œ é»˜è®¤å¼€å¯</li></ul></blockquote><h3 id="4-7-UDP"><a href="#4-7-UDP" class="headerlink" title="4.7 UDP"></a>4.7 UDP</h3><ul><li>UDP æ˜¯æ— è¿æ¥çš„ï¼Œclient å‘é€æ•°æ®ä¸ä¼šç®¡ server æ˜¯å¦å¼€å¯</li><li>server è¿™è¾¹çš„ receive æ–¹æ³•ä¼šå°†æ¥æ”¶åˆ°çš„æ•°æ®å­˜å…¥ byte bufferï¼Œä½†å¦‚æœæ•°æ®æŠ¥æ–‡è¶…è¿‡ buffer å¤§å°ï¼Œå¤šå‡ºæ¥çš„æ•°æ®ä¼šè¢«é»˜é»˜æŠ›å¼ƒ</li></ul><p>é¦–å…ˆå¯åŠ¨æœåŠ¡å™¨ç«¯</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UdpServer</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span>DatagramChannel channel <span class="token operator">=</span> DatagramChannel<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            channel<span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"waiting..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ByteBuffer buffer <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>            buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">debug</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre><code>waiting...</code></pre><p>è¿è¡Œå®¢æˆ·ç«¯</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UdpClient</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span>DatagramChannel channel <span class="token operator">=</span> DatagramChannel<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            ByteBuffer buffer <span class="token operator">=</span> StandardCharsets<span class="token punctuation">.</span>UTF_8<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            InetSocketAddress address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> address<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ä¸‹æ¥æœåŠ¡å™¨ç«¯è¾“å‡º</p><pre><code>         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 68 65 6c 6c 6f                                  |hello           |+--------+-------------------------------------------------+----------------+</code></pre><h2 id="5-NIO-vs-BIO"><a href="#5-NIO-vs-BIO" class="headerlink" title="5. NIO vs BIO"></a>5. NIO vs BIO</h2><h3 id="5-1-stream-vs-channel"><a href="#5-1-stream-vs-channel" class="headerlink" title="5.1 stream vs channel"></a>5.1 stream vs channel</h3><ul><li>stream ä¸ä¼šè‡ªåŠ¨ç¼“å†²æ•°æ®ï¼Œchannel ä¼šåˆ©ç”¨ç³»ç»Ÿæä¾›çš„å‘é€ç¼“å†²åŒºã€æ¥æ”¶ç¼“å†²åŒºï¼ˆæ›´ä¸ºåº•å±‚ï¼‰</li><li>stream ä»…æ”¯æŒé˜»å¡ APIï¼Œchannel åŒæ—¶æ”¯æŒé˜»å¡ã€éé˜»å¡ APIï¼Œç½‘ç»œ channel å¯é…åˆ selector å®ç°å¤šè·¯å¤ç”¨</li><li>äºŒè€…å‡ä¸ºå…¨åŒå·¥ï¼Œå³è¯»å†™å¯ä»¥åŒæ—¶è¿›è¡Œ</li></ul><h3 id="5-2-IO-æ¨¡å‹"><a href="#5-2-IO-æ¨¡å‹" class="headerlink" title="5.2 IO æ¨¡å‹"></a>5.2 IO æ¨¡å‹</h3><p>åŒæ­¥é˜»å¡ã€åŒæ­¥éé˜»å¡ã€åŒæ­¥å¤šè·¯å¤ç”¨ã€å¼‚æ­¥é˜»å¡ï¼ˆæ²¡æœ‰æ­¤æƒ…å†µï¼‰ã€å¼‚æ­¥éé˜»å¡</p><ul><li>åŒæ­¥ï¼šçº¿ç¨‹è‡ªå·±å»è·å–ç»“æœï¼ˆä¸€ä¸ªçº¿ç¨‹ï¼‰</li><li>å¼‚æ­¥ï¼šçº¿ç¨‹è‡ªå·±ä¸å»è·å–ç»“æœï¼Œè€Œæ˜¯ç”±å…¶å®ƒçº¿ç¨‹é€ç»“æœï¼ˆè‡³å°‘ä¸¤ä¸ªçº¿ç¨‹ï¼‰</li></ul><p>å½“è°ƒç”¨ä¸€æ¬¡ channel.read æˆ– stream.read åï¼Œä¼šåˆ‡æ¢è‡³æ“ä½œç³»ç»Ÿå†…æ ¸æ€æ¥å®ŒæˆçœŸæ­£æ•°æ®è¯»å–ï¼Œè€Œè¯»å–åˆåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«ä¸ºï¼š</p><ul><li><p>ç­‰å¾…æ•°æ®é˜¶æ®µ</p></li><li><p>å¤åˆ¶æ•°æ®é˜¶æ®µ</p><img src="/posts/undefined/0033.png"></li><li><p>é˜»å¡ IO</p><img src="/posts/undefined/0039.png"></li><li><p>éé˜»å¡  IO</p><img src="/posts/undefined/0035.png"></li><li><p>å¤šè·¯å¤ç”¨</p><img src="/posts/undefined/0038.png"></li><li><p>ä¿¡å·é©±åŠ¨</p></li><li><p>å¼‚æ­¥ IO</p><img src="/posts/undefined/0037.png"></li><li><p>é˜»å¡ IO vs å¤šè·¯å¤ç”¨</p><img src="/posts/undefined/0034.png"><img src="/posts/undefined/0036.png"></li></ul><h4 id="ğŸ”–-å‚è€ƒ"><a href="#ğŸ”–-å‚è€ƒ" class="headerlink" title="ğŸ”– å‚è€ƒ"></a>ğŸ”– å‚è€ƒ</h4><p>UNIX ç½‘ç»œç¼–ç¨‹ - å· I</p><h3 id="5-3-é›¶æ‹·è´"><a href="#5-3-é›¶æ‹·è´" class="headerlink" title="5.3 é›¶æ‹·è´"></a>5.3 é›¶æ‹·è´</h3><h4 id="ä¼ ç»Ÿ-IO-é—®é¢˜"><a href="#ä¼ ç»Ÿ-IO-é—®é¢˜" class="headerlink" title="ä¼ ç»Ÿ IO é—®é¢˜"></a>ä¼ ç»Ÿ IO é—®é¢˜</h4><p>ä¼ ç»Ÿçš„ IO å°†ä¸€ä¸ªæ–‡ä»¶é€šè¿‡ socket å†™å‡º</p><pre class="line-numbers language-java"><code class="language-java">File f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"helloword/data.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>RandomAccessFile file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>file<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>Socket socket <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å†…éƒ¨å·¥ä½œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><img src="/posts/undefined/0024.png"><ol><li><p>java æœ¬èº«å¹¶ä¸å…·å¤‡ IO è¯»å†™èƒ½åŠ›ï¼Œå› æ­¤ read æ–¹æ³•è°ƒç”¨åï¼Œè¦ä» java ç¨‹åºçš„<strong>ç”¨æˆ·æ€</strong>åˆ‡æ¢è‡³<strong>å†…æ ¸æ€</strong>ï¼Œå»è°ƒç”¨æ“ä½œç³»ç»Ÿï¼ˆKernelï¼‰çš„è¯»èƒ½åŠ›ï¼Œå°†æ•°æ®è¯»å…¥<strong>å†…æ ¸ç¼“å†²åŒº</strong>ã€‚è¿™æœŸé—´ç”¨æˆ·çº¿ç¨‹é˜»å¡ï¼Œæ“ä½œç³»ç»Ÿä½¿ç”¨ DMAï¼ˆDirect Memory Accessï¼‰æ¥å®ç°æ–‡ä»¶è¯»ï¼Œå…¶é—´ä¹Ÿä¸ä¼šä½¿ç”¨ cpu</p><blockquote><p>DMA ä¹Ÿå¯ä»¥ç†è§£ä¸ºç¡¬ä»¶å•å…ƒï¼Œç”¨æ¥è§£æ”¾ cpu å®Œæˆæ–‡ä»¶ IO</p></blockquote></li><li><p>ä»<strong>å†…æ ¸æ€</strong>åˆ‡æ¢å›<strong>ç”¨æˆ·æ€</strong>ï¼Œå°†æ•°æ®ä»<strong>å†…æ ¸ç¼“å†²åŒº</strong>è¯»å…¥<strong>ç”¨æˆ·ç¼“å†²åŒº</strong>ï¼ˆå³ byte[] bufï¼‰ï¼Œè¿™æœŸé—´ cpu ä¼šå‚ä¸æ‹·è´ï¼Œæ— æ³•åˆ©ç”¨ DMA</p></li><li><p>è°ƒç”¨ write æ–¹æ³•ï¼Œè¿™æ—¶å°†æ•°æ®ä»<strong>ç”¨æˆ·ç¼“å†²åŒº</strong>ï¼ˆbyte[] bufï¼‰å†™å…¥ <strong>socket ç¼“å†²åŒº</strong>ï¼Œcpu ä¼šå‚ä¸æ‹·è´</p></li><li><p>æ¥ä¸‹æ¥è¦å‘ç½‘å¡å†™æ•°æ®ï¼Œè¿™é¡¹èƒ½åŠ› java åˆä¸å…·å¤‡ï¼Œå› æ­¤åˆå¾—ä»<strong>ç”¨æˆ·æ€</strong>åˆ‡æ¢è‡³<strong>å†…æ ¸æ€</strong>ï¼Œè°ƒç”¨æ“ä½œç³»ç»Ÿçš„å†™èƒ½åŠ›ï¼Œä½¿ç”¨ DMA å°† <strong>socket ç¼“å†²åŒº</strong>çš„æ•°æ®å†™å…¥ç½‘å¡ï¼Œä¸ä¼šä½¿ç”¨ cpu</p></li></ol><p>å¯ä»¥çœ‹åˆ°ä¸­é—´ç¯èŠ‚è¾ƒå¤šï¼Œjava çš„ IO å®é™…ä¸æ˜¯ç‰©ç†è®¾å¤‡çº§åˆ«çš„è¯»å†™ï¼Œè€Œæ˜¯ç¼“å­˜çš„å¤åˆ¶ï¼Œåº•å±‚çš„çœŸæ­£è¯»å†™æ˜¯æ“ä½œç³»ç»Ÿæ¥å®Œæˆçš„</p><ul><li>ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢å‘ç”Ÿäº† 3 æ¬¡ï¼Œè¿™ä¸ªæ“ä½œæ¯”è¾ƒé‡é‡çº§</li><li>æ•°æ®æ‹·è´äº†å…± 4 æ¬¡</li></ul><h4 id="NIO-ä¼˜åŒ–"><a href="#NIO-ä¼˜åŒ–" class="headerlink" title="NIO ä¼˜åŒ–"></a>NIO ä¼˜åŒ–</h4><p>é€šè¿‡ DirectByteBuf </p><ul><li><p>ByteBuffer.allocate(10)  HeapByteBuffer ä½¿ç”¨çš„è¿˜æ˜¯ java å†…å­˜</p></li><li><p>ByteBuffer.allocateDirect(10)  DirectByteBuffer ä½¿ç”¨çš„æ˜¯æ“ä½œç³»ç»Ÿå†…å­˜</p><img src="/posts/undefined/0025.png"></li></ul><p>å¤§éƒ¨åˆ†æ­¥éª¤ä¸ä¼˜åŒ–å‰ç›¸åŒï¼Œä¸å†èµ˜è¿°ã€‚å”¯æœ‰ä¸€ç‚¹ï¼šjava å¯ä»¥ä½¿ç”¨ DirectByteBuf å°†å †å¤–å†…å­˜æ˜ å°„åˆ° jvm å†…å­˜ä¸­æ¥ç›´æ¥è®¿é—®ä½¿ç”¨</p><ul><li>è¿™å—å†…å­˜ä¸å— jvm åƒåœ¾å›æ”¶çš„å½±å“ï¼Œå› æ­¤å†…å­˜åœ°å€å›ºå®šï¼Œæœ‰åŠ©äº IO è¯»å†™</li><li>java ä¸­çš„ DirectByteBuf å¯¹è±¡ä»…ç»´æŠ¤äº†æ­¤å†…å­˜çš„è™šå¼•ç”¨ï¼Œå†…å­˜å›æ”¶åˆ†æˆä¸¤æ­¥<ul><li>DirectByteBuf å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼Œå°†è™šå¼•ç”¨åŠ å…¥å¼•ç”¨é˜Ÿåˆ—</li><li>é€šè¿‡ä¸“é—¨çº¿ç¨‹è®¿é—®å¼•ç”¨é˜Ÿåˆ—ï¼Œæ ¹æ®è™šå¼•ç”¨é‡Šæ”¾å †å¤–å†…å­˜</li></ul></li><li>å‡å°‘äº†ä¸€æ¬¡æ•°æ®æ‹·è´ï¼Œç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢æ¬¡æ•°æ²¡æœ‰å‡å°‘</li></ul><p>è¿›ä¸€æ­¥ä¼˜åŒ–ï¼ˆåº•å±‚é‡‡ç”¨äº† linux 2.1 åæä¾›çš„ sendFile æ–¹æ³•ï¼‰ï¼Œjava ä¸­å¯¹åº”ç€ä¸¤ä¸ª channel è°ƒç”¨ transferTo/transferFrom æ–¹æ³•æ‹·è´æ•°æ®</p><img src="/posts/undefined/0026.png"><ol><li>java è°ƒç”¨ transferTo æ–¹æ³•åï¼Œè¦ä» java ç¨‹åºçš„<strong>ç”¨æˆ·æ€</strong>åˆ‡æ¢è‡³<strong>å†…æ ¸æ€</strong>ï¼Œä½¿ç”¨ DMAå°†æ•°æ®è¯»å…¥<strong>å†…æ ¸ç¼“å†²åŒº</strong>ï¼Œä¸ä¼šä½¿ç”¨ cpu</li><li>æ•°æ®ä»<strong>å†…æ ¸ç¼“å†²åŒº</strong>ä¼ è¾“åˆ° <strong>socket ç¼“å†²åŒº</strong>ï¼Œcpu ä¼šå‚ä¸æ‹·è´</li><li>æœ€åä½¿ç”¨ DMA å°† <strong>socket ç¼“å†²åŒº</strong>çš„æ•°æ®å†™å…¥ç½‘å¡ï¼Œä¸ä¼šä½¿ç”¨ cpu</li></ol><p>å¯ä»¥çœ‹åˆ°</p><ul><li>åªå‘ç”Ÿäº†ä¸€æ¬¡ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢</li><li>æ•°æ®æ‹·è´äº† 3 æ¬¡</li></ul><p>è¿›ä¸€æ­¥ä¼˜åŒ–ï¼ˆlinux 2.4ï¼‰</p><ol><li>java è°ƒç”¨ transferTo æ–¹æ³•åï¼Œè¦ä» java ç¨‹åºçš„<strong>ç”¨æˆ·æ€</strong>åˆ‡æ¢è‡³<strong>å†…æ ¸æ€</strong>ï¼Œä½¿ç”¨ DMAå°†æ•°æ®è¯»å…¥<strong>å†…æ ¸ç¼“å†²åŒº</strong>ï¼Œä¸ä¼šä½¿ç”¨ cpu</li><li>åªä¼šå°†ä¸€äº› offset å’Œ length ä¿¡æ¯æ‹·å…¥ <strong>socket ç¼“å†²åŒº</strong>ï¼Œå‡ ä¹æ— æ¶ˆè€—</li><li>ä½¿ç”¨ DMA å°† <strong>å†…æ ¸ç¼“å†²åŒº</strong>çš„æ•°æ®å†™å…¥ç½‘å¡ï¼Œä¸ä¼šä½¿ç”¨ cpu</li></ol><p>æ•´ä¸ªè¿‡ç¨‹ä»…åªå‘ç”Ÿäº†ä¸€æ¬¡ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢ï¼Œæ•°æ®æ‹·è´äº† 2 æ¬¡ã€‚æ‰€è°“çš„ã€é›¶æ‹·è´ã€‘ï¼Œå¹¶ä¸æ˜¯çœŸæ­£æ— æ‹·è´ï¼Œè€Œæ˜¯åœ¨ä¸ä¼šæ‹·è´é‡å¤æ•°æ®åˆ° jvm å†…å­˜ä¸­ï¼Œé›¶æ‹·è´çš„ä¼˜ç‚¹æœ‰</p><ul><li>æ›´å°‘çš„ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢</li><li>ä¸åˆ©ç”¨ cpu è®¡ç®—ï¼Œå‡å°‘ cpu ç¼“å­˜ä¼ªå…±äº«</li><li>é›¶æ‹·è´é€‚åˆå°æ–‡ä»¶ä¼ è¾“</li></ul><h3 id="5-3-AIO"><a href="#5-3-AIO" class="headerlink" title="5.3 AIO"></a>5.3 AIO</h3><p>AIO ç”¨æ¥è§£å†³æ•°æ®å¤åˆ¶é˜¶æ®µçš„é˜»å¡é—®é¢˜</p><ul><li>åŒæ­¥æ„å‘³ç€ï¼Œåœ¨è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œçº¿ç¨‹éœ€è¦ç­‰å¾…ç»“æœï¼Œè¿˜æ˜¯ç›¸å½“äºé—²ç½®</li><li>å¼‚æ­¥æ„å‘³ç€ï¼Œåœ¨è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œçº¿ç¨‹ä¸å¿…ç­‰å¾…ç»“æœï¼Œè€Œæ˜¯å°†æ¥ç”±æ“ä½œç³»ç»Ÿæ¥é€šè¿‡å›è°ƒæ–¹å¼ç”±å¦å¤–çš„çº¿ç¨‹æ¥è·å¾—ç»“æœ</li></ul><blockquote><p>å¼‚æ­¥æ¨¡å‹éœ€è¦åº•å±‚æ“ä½œç³»ç»Ÿï¼ˆKernelï¼‰æä¾›æ”¯æŒ</p><ul><li>Windows ç³»ç»Ÿé€šè¿‡ IOCP å®ç°äº†çœŸæ­£çš„å¼‚æ­¥ IO</li><li>Linux ç³»ç»Ÿå¼‚æ­¥ IO åœ¨ 2.6 ç‰ˆæœ¬å¼•å…¥ï¼Œä½†å…¶åº•å±‚å®ç°è¿˜æ˜¯ç”¨å¤šè·¯å¤ç”¨æ¨¡æ‹Ÿäº†å¼‚æ­¥ IOï¼Œæ€§èƒ½æ²¡æœ‰ä¼˜åŠ¿</li></ul></blockquote><h4 id="æ–‡ä»¶-AIO"><a href="#æ–‡ä»¶-AIO" class="headerlink" title="æ–‡ä»¶ AIO"></a>æ–‡ä»¶ AIO</h4><p>å…ˆæ¥çœ‹çœ‹ AsynchronousFileChannel</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AioDemo1</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>        <span class="token keyword">try</span><span class="token punctuation">{</span>            AsynchronousFileChannel s <span class="token operator">=</span>                 AsynchronousFileChannel<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>                    Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"1.txt"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> StandardOpenOption<span class="token punctuation">.</span>READ<span class="token punctuation">)</span><span class="token punctuation">;</span>            ByteBuffer buffer <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"begin..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            s<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> null<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CompletionHandler</span><span class="token operator">&lt;</span>Integer<span class="token punctuation">,</span> ByteBuffer<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">completed</span><span class="token punctuation">(</span>Integer result<span class="token punctuation">,</span> ByteBuffer attachment<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"read completed...{}"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>                    buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token function">debug</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">failed</span><span class="token punctuation">(</span>Throwable exc<span class="token punctuation">,</span> ByteBuffer attachment<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"read failed..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"do other things..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre><code>13:44:56 [DEBUG] [main] c.i.aio.AioDemo1 - begin...13:44:56 [DEBUG] [main] c.i.aio.AioDemo1 - do other things...13:44:56 [DEBUG] [Thread-5] c.i.aio.AioDemo1 - read completed...2         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 61 0d                                           |a.              |+--------+-------------------------------------------------+----------------+</code></pre><p>å¯ä»¥çœ‹åˆ°</p><ul><li>å“åº”æ–‡ä»¶è¯»å–æˆåŠŸçš„æ˜¯å¦ä¸€ä¸ªçº¿ç¨‹ Thread-5</li><li>ä¸»çº¿ç¨‹å¹¶æ²¡æœ‰ IO æ“ä½œé˜»å¡</li></ul><h4 id="ğŸ’¡-å®ˆæŠ¤çº¿ç¨‹"><a href="#ğŸ’¡-å®ˆæŠ¤çº¿ç¨‹" class="headerlink" title="ğŸ’¡ å®ˆæŠ¤çº¿ç¨‹"></a>ğŸ’¡ å®ˆæŠ¤çº¿ç¨‹</h4><p>é»˜è®¤æ–‡ä»¶ AIO ä½¿ç”¨çš„çº¿ç¨‹éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œæ‰€ä»¥æœ€åè¦æ‰§è¡Œ <code>System.in.read()</code> ä»¥é¿å…å®ˆæŠ¤çº¿ç¨‹æ„å¤–ç»“æŸ</p><h4 id="ç½‘ç»œ-AIO"><a href="#ç½‘ç»œ-AIO" class="headerlink" title="ç½‘ç»œ AIO"></a>ç½‘ç»œ AIO</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AioServer</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>        AsynchronousServerSocketChannel ssc <span class="token operator">=</span> AsynchronousServerSocketChannel<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ssc<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ssc<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>null<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">AcceptHandler</span><span class="token punctuation">(</span>ssc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">closeChannel</span><span class="token punctuation">(</span>AsynchronousSocketChannel sc<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[%s] %s close\n"</span><span class="token punctuation">,</span> Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sc<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            sc<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ReadHandler</span> <span class="token keyword">implements</span> <span class="token class-name">CompletionHandler</span><span class="token operator">&lt;</span>Integer<span class="token punctuation">,</span> ByteBuffer<span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">private</span> <span class="token keyword">final</span> AsynchronousSocketChannel sc<span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token function">ReadHandler</span><span class="token punctuation">(</span>AsynchronousSocketChannel sc<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>sc <span class="token operator">=</span> sc<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">completed</span><span class="token punctuation">(</span>Integer result<span class="token punctuation">,</span> ByteBuffer attachment<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token function">closeChannel</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">return</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[%s] %s read\n"</span><span class="token punctuation">,</span> Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sc<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                attachment<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Charset<span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>attachment<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                attachment<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// å¤„ç†å®Œç¬¬ä¸€ä¸ª read æ—¶ï¼Œéœ€è¦å†æ¬¡è°ƒç”¨ read æ–¹æ³•æ¥å¤„ç†ä¸‹ä¸€ä¸ª read äº‹ä»¶</span>                sc<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>attachment<span class="token punctuation">,</span> attachment<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">failed</span><span class="token punctuation">(</span>Throwable exc<span class="token punctuation">,</span> ByteBuffer attachment<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">closeChannel</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>            exc<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WriteHandler</span> <span class="token keyword">implements</span> <span class="token class-name">CompletionHandler</span><span class="token operator">&lt;</span>Integer<span class="token punctuation">,</span> ByteBuffer<span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">private</span> <span class="token keyword">final</span> AsynchronousSocketChannel sc<span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token function">WriteHandler</span><span class="token punctuation">(</span>AsynchronousSocketChannel sc<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>sc <span class="token operator">=</span> sc<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">completed</span><span class="token punctuation">(</span>Integer result<span class="token punctuation">,</span> ByteBuffer attachment<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// å¦‚æœä½œä¸ºé™„ä»¶çš„ buffer è¿˜æœ‰å†…å®¹ï¼Œéœ€è¦å†æ¬¡ write å†™å‡ºå‰©ä½™å†…å®¹</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>attachment<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                sc<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>attachment<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">failed</span><span class="token punctuation">(</span>Throwable exc<span class="token punctuation">,</span> ByteBuffer attachment<span class="token punctuation">)</span> <span class="token punctuation">{</span>            exc<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">closeChannel</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">AcceptHandler</span> <span class="token keyword">implements</span> <span class="token class-name">CompletionHandler</span><span class="token operator">&lt;</span>AsynchronousSocketChannel<span class="token punctuation">,</span> Object<span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">private</span> <span class="token keyword">final</span> AsynchronousServerSocketChannel ssc<span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token function">AcceptHandler</span><span class="token punctuation">(</span>AsynchronousServerSocketChannel ssc<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>ssc <span class="token operator">=</span> ssc<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">completed</span><span class="token punctuation">(</span>AsynchronousSocketChannel sc<span class="token punctuation">,</span> Object attachment<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[%s] %s connected\n"</span><span class="token punctuation">,</span> Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sc<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            ByteBuffer buffer <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// è¯»äº‹ä»¶ç”± ReadHandler å¤„ç†</span>            sc<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ReadHandler</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// å†™äº‹ä»¶ç”± WriteHandler å¤„ç†</span>            sc<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>Charset<span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"server hello!"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">WriteHandler</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// å¤„ç†å®Œç¬¬ä¸€ä¸ª accpet æ—¶ï¼Œéœ€è¦å†æ¬¡è°ƒç”¨ accept æ–¹æ³•æ¥å¤„ç†ä¸‹ä¸€ä¸ª accept äº‹ä»¶</span>            ssc<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>null<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">failed</span><span class="token punctuation">(</span>Throwable exc<span class="token punctuation">,</span> Object attachment<span class="token punctuation">)</span> <span class="token punctuation">{</span>            exc<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç½‘ç»œç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> netty </tag>
            
            <tag> nio </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŒºå—é“¾æŠ€æœ¯è®¤çŸ¥</title>
      <link href="/posts/48583.html"/>
      <url>/posts/48583.html</url>
      
        <content type="html"><![CDATA[<h1 id="1-åŒºå—é“¾ä¸P2P"><a href="#1-åŒºå—é“¾ä¸P2P" class="headerlink" title="1. åŒºå—é“¾ä¸P2P"></a>1. åŒºå—é“¾ä¸P2P</h1><h2 id="1-1-P2Pç½‘ç»œæ¦‚å¿µ"><a href="#1-1-P2Pç½‘ç»œæ¦‚å¿µ" class="headerlink" title="1.1 P2Pç½‘ç»œæ¦‚å¿µ"></a>1.1 P2Pç½‘ç»œæ¦‚å¿µ</h2><ul><li>P2Pç½‘ç»œåˆç§°ä¸ºå¯¹ç­‰å¼ç½‘ç»œï¼Œæˆ–è€…ç‚¹å¯¹ç‚¹ç½‘ç»œ</li><li>æ˜¯ä¸€ç§ æ— ä¸­å¿ƒçš„æœåŠ¡å™¨ã€å®Œå…¨ç”±ç”¨æˆ·ç¾¤è¿›è¡Œäº¤æ¢ä¿¡æ¯çš„ äº’è”ç½‘ä½“ç³»ï¼Œp2pç½‘ç»œçš„æ¯ä¸€ä¸ªç”¨æˆ·éƒ½æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ï¼ŒåŒæ—¶ä¹Ÿå…·å¤‡æœåŠ¡å™¨çš„åŠŸèƒ½.</li></ul><p><code>ç®€å•æ€»ç»“</code>:  </p><ol><li>åœ¨p2pçš„ä¸–ç•Œé‡Œï¼Œæ¯ä¸ªèŠ‚ç‚¹å³å……å½“æœåŠ¡å™¨ï¼Œä¸ºå…¶ä»–èŠ‚ç‚¹æä¾›æœåŠ¡ï¼Œä¹Ÿå……å½“å®¢æˆ·äº«ç”¨å…¶ä»–èŠ‚ç‚¹æä¾›çš„æœåŠ¡ã€‚</li><li>æ‰“ç ´ä¼ ç»Ÿçš„C/Sæ¨¡å¼ï¼Œæ¯ä¸ªèŠ‚ç‚¹åœ°ä½éƒ½æ˜¯å¯¹ç­‰çš„ã€‚</li></ol><h2 id="1-2-P2Pç½‘ç»œåˆ†ç±»"><a href="#1-2-P2Pç½‘ç»œåˆ†ç±»" class="headerlink" title="1.2 P2Pç½‘ç»œåˆ†ç±»"></a>1.2 P2Pç½‘ç»œåˆ†ç±»</h2><p>æ ¹æ®P2Pç½‘ç»œ<code>æ˜¯å¦å»ä¸­å¿ƒåŒ–</code>ã€<code>èŠ‚ç‚¹åœ°å€æ˜¯å¦ç»“æ„åŒ–</code>ä¸¤ä¸ªæ–¹é¢ï¼Œå°†P2Pç½‘ç»œåˆ†ä¸ºäº†å¦‚ä¸‹å››ç±»:</p><blockquote><ol><li>ä¸­å¿ƒåŒ–P2Pç½‘ç»œ</li><li>å…¨åˆ†å¸ƒå¼ éç»“æ„åŒ– P2Pç½‘ç»œ</li><li>å…¨åˆ†å¸ƒå¼ ç»“æ„åŒ– P2Pç½‘ç»œ</li><li>åŠåˆ†å¸ƒå¼ P2P ç½‘ç»œ</li></ol></blockquote><p><code>è¾…åŠ©ç†è§£</code>:</p><ol><li><p>ç»“æ„åŒ–ç†è§£ï¼šç»“æ„åŒ–èŠ‚ç‚¹å€¼çš„æ˜¯ ç½‘ç»œèŠ‚ç‚¹å‘ˆç°ç‰¹å®šç»„ç»‡çš„æ¶æ„ã€‚</p></li><li><p>éç»“æ„åŒ–ç†è§£ï¼šç½‘ç»œèŠ‚ç‚¹ä¸å…·å¤‡ä»»ä½•ç‰¹å®šç»„ç»‡çš„ç‰¹å¾ã€‚å‚ä¸èŠ‚ç‚¹éšæœºä¸å…¶ä»–èŠ‚ç‚¹è¿›è¡Œé€šè®¯</p></li></ol><h3 id="1-2-1-ç†è§£ä¸­å¿ƒåŒ–P2Pç½‘ç»œ"><a href="#1-2-1-ç†è§£ä¸­å¿ƒåŒ–P2Pç½‘ç»œ" class="headerlink" title="1.2.1 ç†è§£ä¸­å¿ƒåŒ–P2Pç½‘ç»œ"></a>1.2.1 ç†è§£ä¸­å¿ƒåŒ–P2Pç½‘ç»œ</h3><ul><li>åœ¨P2Pç½‘ç»œä¸­å­˜åœ¨â€ä¸­å¿ƒæœåŠ¡å™¨â€ï¼Œè€Œå…¶ä½œç”¨ä¸ºä¿å­˜æ¥å…¥èŠ‚ç‚¹çš„åœ°å€ä¿¡æ¯</li><li>å€˜è‹¥ä¸¤ä¸ªpeerä¹‹é—´ç›¸åº”è¿›è¡Œé€šä¿¡ï¼Œé‚£ä¹ˆå®ƒä»¬å¯ä»¥é€šè¿‡ä¸­å¿ƒæœåŠ¡å™¨è¿›è¡Œå¯¹æ–¹åœ°å€çš„ç´¢è¦ã€‚</li></ul><img src="/posts/48583/1.png"><h3 id="1-2-2-ç†è§£å…¨åˆ†å¸ƒå¼éç»“æ„åŒ–P2P"><a href="#1-2-2-ç†è§£å…¨åˆ†å¸ƒå¼éç»“æ„åŒ–P2P" class="headerlink" title="1.2.2 ç†è§£å…¨åˆ†å¸ƒå¼éç»“æ„åŒ–P2P"></a>1.2.2 ç†è§£å…¨åˆ†å¸ƒå¼éç»“æ„åŒ–P2P</h3><blockquote><ol><li>å…¨åˆ†å¸ƒP2PèŠ‚ç‚¹å¯ä»¥è‡ªç”±åŠ å…¥é€€å‡ºï¼Œå¹¶ä¸”æ²¡æœ‰ä¸­å¿ƒèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹åœ°å€æ²¡æœ‰ç»“æ„åŒ–ç»Ÿä¸€æ ‡å‡†ï¼Œæ•´ä¸ªç½‘ç»œç»“æ„å‘ˆéšæœºå›¾çš„ç»“æ„ï¼Œæ— å›ºå®šç½‘ç»œç»“æ„å›¾</li><li>èŠ‚ç‚¹é—´æ²¡æœ‰å›ºå®šè§„åˆ™çº¦æŸï¼Œæ— æ³•ç²¾å‡†å®šä½èŠ‚ç‚¹ä¿¡æ¯ï¼Œåªèƒ½é€šè¿‡æ´ªæ³›æŸ¥è¯¢æ–¹å¼è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¯¹ç½‘ç»œçš„æ¶ˆè€—å¾ˆå¤§</li></ol></blockquote><p><strong>å…¸å‹åº”ç”¨</strong>: æ¯”ç‰¹å¸</p><h3 id="1-2-3-P2Pç½‘ç»œ-å…¨åˆ†å¸ƒå¼ç»“æ„åŒ–"><a href="#1-2-3-P2Pç½‘ç»œ-å…¨åˆ†å¸ƒå¼ç»“æ„åŒ–" class="headerlink" title="1.2.3 P2Pç½‘ç»œ-å…¨åˆ†å¸ƒå¼ç»“æ„åŒ–"></a>1.2.3 P2Pç½‘ç»œ-å…¨åˆ†å¸ƒå¼ç»“æ„åŒ–</h3><ul><li>å…¨åˆ†å¸ƒå¼æœ€å¤§çš„é—®é¢˜å°±æ˜¯ <code>èŠ‚ç‚¹åœ°å€ç®¡ç†</code>, è€Œç»“æ„åŒ–ç½‘ç»œé‡‡ç”¨<code>åˆ†å¸ƒå¼å“ˆå¸Œè¡¨</code>ï¼Œé€šè¿‡ Hash å‡½æ•°ä¸€ç±»çš„<code>åŠ å¯†æ•£åˆ—å‡½æ•°</code>ï¼Œå°†ä¸åŒèŠ‚ç‚¹åœ°å€è§„èŒƒä¸º<code>æ ‡å‡†é•¿åº¦æ•°æ®</code></li><li>ç»“æ„åŒ–æ¨¡å‹ä¸éç»“æ„åŒ–æ¨¡å‹ç›¸ä¼¼ï¼Œä½†ç»“æ„åŒ–æ¨¡å‹çš„èŠ‚ç‚¹ç®¡ç†æœ‰å›ºå®šç»“æ„å›¾ã€‚æ¯”å¦‚å½¢æˆä¸€ä¸ªç¯çŠ¶ç½‘ç»œæˆ–æ ‘çŠ¶ç½‘ç»œã€‚</li></ul><p><strong>å…¸å‹åº”ç”¨</strong>: ä»¥å¤ªåŠ</p><h3 id="1-2-4-P2Pç½‘ç»œ-åŠåˆ†å¸ƒå¼"><a href="#1-2-4-P2Pç½‘ç»œ-åŠåˆ†å¸ƒå¼" class="headerlink" title="1.2.4 P2Pç½‘ç»œ-åŠåˆ†å¸ƒå¼"></a>1.2.4 P2Pç½‘ç»œ-åŠåˆ†å¸ƒå¼</h3><blockquote><ol><li>åŠåˆ†å¸ƒå¼ P2P ç½‘ç»œå°†èŠ‚ç‚¹åˆ†ç±»æˆ<strong>æ™®é€šèŠ‚ç‚¹</strong>å’Œ<strong>è¶…çº§èŠ‚ç‚¹</strong>ï¼Œä»è€Œæ„æˆäº†åŠåˆ†å¸ƒå¼ç½‘ç»œç»“æ„</li><li>æ¯ä¸ªè¶…çº§èŠ‚ç‚¹ï¼Œç»´æŠ¤éƒ¨åˆ†ç½‘ç»œèŠ‚ç‚¹åœ°å€ã€æ–‡ä»¶ç´¢å¼•ç­‰å·¥ä½œï¼Œæ‰€æœ‰è¶…çº§èŠ‚ç‚¹å…±åŒå®ç°ä¸­å¿ƒæœåŠ¡å™¨çš„åŠŸèƒ½</li><li>è¶…çº§èŠ‚ç‚¹æœ¬èº«ç¡®å®åˆ†å¸ƒå¼ï¼Œå¯ä»¥è‡ªç”±æ‰©å±•é€€å‡ºï¼Œå…·å¤‡åˆ†å¸ƒå¼ç½‘ç»œä¼˜ç‚¹</li></ol></blockquote><p><strong>å…¸å‹åº”ç”¨</strong>: Fabric</p><img src="/posts/48583/2.png"><h3 id="1-2-5-å››ç§ç»“æ„æ¯”è¾ƒ"><a href="#1-2-5-å››ç§ç»“æ„æ¯”è¾ƒ" class="headerlink" title="1.2.5 å››ç§ç»“æ„æ¯”è¾ƒ"></a>1.2.5 å››ç§ç»“æ„æ¯”è¾ƒ</h3><img src="/posts/48583/3.png"><h1 id="2-åŒºå—é“¾ä¸åˆ†å¸ƒå¼å­˜å‚¨"><a href="#2-åŒºå—é“¾ä¸åˆ†å¸ƒå¼å­˜å‚¨" class="headerlink" title="2. åŒºå—é“¾ä¸åˆ†å¸ƒå¼å­˜å‚¨"></a>2. åŒºå—é“¾ä¸åˆ†å¸ƒå¼å­˜å‚¨</h1><h2 id="2-1-ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼å­˜å‚¨"><a href="#2-1-ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼å­˜å‚¨" class="headerlink" title="2.1 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼å­˜å‚¨"></a>2.1 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼å­˜å‚¨</h2><ul><li>åˆ†å¸ƒå¼å­˜å‚¨æ˜¯ä¸€ç§<code>æ•°æ®å­˜å‚¨æŠ€æœ¯</code>.ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å°†æ•°æ®åˆ†æ•£å­˜å‚¨åˆ°å¤šä¸ªå­˜å‚¨æœåŠ¡å™¨ä¸Šï¼Œå¹¶ä¸”å°†è¿™äº›åˆ†æ•£çš„å­˜å‚¨èµ„æºæ„æˆä¸€ä¸ªè™šæ‹Ÿçš„å­˜å‚¨è®¾å¤‡ï¼Œå®é™…ä¸Šæ•°æ®åˆ†æ•£åœ°å­˜å‚¨åœ¨æœåŠ¡å™¨çš„å„ä¸ªè§’è½.</li><li><code>åˆ†å¸ƒå¼å­˜å‚¨æ¨¡å¼ä¸€èˆ¬ä¸P2Pç½‘ç»œç›¸å¯¹åº”</code></li></ul><h2 id="2-2-åˆ†å¸ƒå¼å­˜å‚¨åˆ†ç±»"><a href="#2-2-åˆ†å¸ƒå¼å­˜å‚¨åˆ†ç±»" class="headerlink" title="2.2 åˆ†å¸ƒå¼å­˜å‚¨åˆ†ç±»"></a>2.2 åˆ†å¸ƒå¼å­˜å‚¨åˆ†ç±»</h2><p>â€‹    <img src="/posts/48583/4.png"></p><h2 id="2-3-åˆ†å¸ƒå¼å­˜å‚¨ä¼˜åŠ¿"><a href="#2-3-åˆ†å¸ƒå¼å­˜å‚¨ä¼˜åŠ¿" class="headerlink" title="2.3 åˆ†å¸ƒå¼å­˜å‚¨ä¼˜åŠ¿"></a>2.3 åˆ†å¸ƒå¼å­˜å‚¨ä¼˜åŠ¿</h2><p><strong>é«˜æ€§èƒ½ï¼Œåˆ†çº§å­˜å‚¨ï¼Œå¤šå‰¯æœ¬æŠ€æœ¯ï¼Œå®¹ç¾ä¸å¤‡ä»½ï¼Œå¼¹æ€§æ‰©å±•</strong></p><blockquote><ol><li><p>é«˜æ€§èƒ½ï¼š åˆ†å¸ƒå¼å­˜å‚¨å¯ä»¥é«˜æ•ˆåœ°ç®¡ç† è¯»ç¼“å­˜å’Œå†™ç¼“å­˜ï¼Œå¹¶ä¸”æ”¯æŒè‡ªåŠ¨çš„åˆ†çº§å­˜å‚¨ï¼Œé€šè¿‡å°†çƒ­ç‚¹åŒºåŸŸå†…çš„æ•°æ®æ˜ å°„åˆ°é«˜é€Ÿå­˜å‚¨ä¸­ï¼Œä»¥æé«˜ç³»ç»Ÿå“åº”é€Ÿåº¦ã€‚</p><p><code>ç®€å•ç†è§£å°±æ˜¯ï¼›ç¼“å­˜çš„è¯»å†™åœ¨åˆ†å¸ƒå¼ä¸‹å¾ˆé«˜æ•ˆï¼›ç„¶åç»å¸¸è®¿é—®çš„æ•°æ®ä¼šè‡ªåŠ¨æ”¾åˆ°é«˜é€Ÿå­˜å‚¨ä¸­</code></p></li><li><p>åˆ†çº§å­˜å‚¨ï¼š å…è®¸é«˜é€Ÿå­˜å‚¨å’Œä½é€Ÿå­˜å‚¨åˆ†å¼€éƒ¨ç½²ï¼Œæˆ–æŒ‰ä»»æ„æ¯”ä¾‹æ··å¸ƒï¼Œåœ¨ä¸å¯é¢„æµ‹çš„ä¸šåŠ¡ç¯å¢ƒæˆ–è€…æ•æ·åº”ç”¨æƒ…å†µä¸‹ï¼Œå°†å­˜å‚¨æ•ˆç›Šå‘æŒ¥æè‡´</p><p><code>ç®€å•ç†è§£å°±æ˜¯ï¼›åˆ†çº§å­˜å‚¨å°±æ˜¯åˆ†ä¸ºé«˜é€Ÿå­˜å‚¨å’Œä½é€Ÿå­˜å‚¨ï¼›ä¸€èµ·åè°ƒï¼Œè·å–æœ€å¤§å­˜å‚¨æ•ˆç›Š</code></p></li><li><p>å¤šå‰¯æœ¬æŠ€æœ¯ï¼šåˆ†å¸ƒå¼å­˜å‚¨é‡‡ç”¨å¤šå‰¯æœ¬å¤‡ä»½æè‡´ï¼Œå¹¶ä½¿ç”¨é•œåƒã€åˆ†å¸ƒå¼æ ¡éªŒç­‰æ–¹å¼æ»¡è¶³ç”¨æˆ·å¯¹äºå¯é æ€§ä¸åŒçš„éœ€æ±‚</p><p><code>æš‚æ—¶ä¸æ˜¯å¾ˆç†è§£</code></p></li><li><p>å®¹ç¾ä¸å¤‡ä»½: åˆ†å¸ƒå¼å­˜å‚¨æ”¯æŒå¤šæ—¶é—´ç‚¹<code>å¿«ç…§å¤‡ä»½</code>ï¼Œå¯åŒæ—¶æå–å¤šä¸ªæ—¶é—´ç‚¹æ ·æœ¬åŒæ—¶æ¢å¤ï¼Œé™ä½äº†æ•…éšœå®šä½çš„éš¾åº¦ï¼Œç»“åˆå‘¨æœŸå¢é‡å¤‡ä»½æœºåˆ¶ã€‚</p></li><li><p>å¼¹æ€§æ‰©å±•: å¾—ç›Šäºåˆç†çš„åˆ†å¸ƒå¼æ¶æ„ï¼Œè¿˜å¯é¢„ä¼°å¹¶å¼¹æ€§æ‰©å±•è®¡ç®—ã€å­˜å‚¨å®¹é‡å’Œæ€§èƒ½ï¼Œæ‰©å±•åæ—§æ•°æ®ä¼šè¿ç§»è‡³æ–°èŠ‚ç‚¹ï¼Œå®ç°è´Ÿè½½å‡è¡¡ï¼Œé¿å…å•ç‚¹è¿‡çƒ­</p></li></ol></blockquote><h2 id="2-4-åŒºå—é“¾ä¸€ç§â€œç‰¹æ®Šâ€çš„åˆ†å¸ƒå¼å­˜å‚¨"><a href="#2-4-åŒºå—é“¾ä¸€ç§â€œç‰¹æ®Šâ€çš„åˆ†å¸ƒå¼å­˜å‚¨" class="headerlink" title="2.4 åŒºå—é“¾ä¸€ç§â€œç‰¹æ®Šâ€çš„åˆ†å¸ƒå¼å­˜å‚¨"></a>2.4 åŒºå—é“¾ä¸€ç§â€œç‰¹æ®Šâ€çš„åˆ†å¸ƒå¼å­˜å‚¨</h2><ul><li>é¦–å…ˆï¼ŒåŒºå—é“¾æ˜¯ä¸€ç§<code>åˆ†å¸ƒå¼æ•°æ®åº“</code>,è¿™é‡Œçš„â€œåˆ†å¸ƒå¼â€ä¸ä»…ä½“ç°ä¸ºæ•°æ®çš„åˆ†å¸ƒå¼å­˜å‚¨ï¼Œä¹Ÿä½“ç°ä¸ºæ•°æ®çš„è®°å½•ï¼ˆå³ç”±ç³»ç»Ÿå‚ä¸è€…æ¥é›†ä½“ç»´æŠ¤ï¼‰</li><li>å…¶æ¬¡ï¼Œä»»ä½•äººéƒ½å¯ä»¥æ¶è®¾æœåŠ¡å™¨ï¼ŒåŠ ä¸ŠåŒºå—é“¾çš„ç½‘ç»œï¼Œæˆä¸ºä¸€ä¸ªèŠ‚ç‚¹ã€‚åœ¨åŒºå—é“¾ä¸–ç•Œä¸­ï¼Œæ²¡æœ‰ä¸­å¿ƒèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹æ˜¯ç›¸ç­‰çš„ï¼Œå¹¶ä¸”ä¿å­˜æ•´ä¸ªæ•°æ®åº“ã€‚</li></ul><img src="/posts/48583/5.png"><h1 id="3-åŒºå—é“¾ä¸å¯†ç å­¦"><a href="#3-åŒºå—é“¾ä¸å¯†ç å­¦" class="headerlink" title="3. åŒºå—é“¾ä¸å¯†ç å­¦"></a>3. åŒºå—é“¾ä¸å¯†ç å­¦</h1><h2 id="3-1-å‘å±•å†ç¨‹"><a href="#3-1-å‘å±•å†ç¨‹" class="headerlink" title="3.1 å‘å±•å†ç¨‹"></a>3.1 å‘å±•å†ç¨‹</h2><p>ç‹¸è¯­ -&gt; å¤å…¸å¯†ç å­¦ -&gt; ç°ä»£å¯†ç å­¦</p><table><thead><tr><th>å¤å…¸å¯†ç å­¦</th><th>â‘ éšè—æ³• â‘¡ç§»ä½æ³•/æ›¿ä»£æ³• â‘¢ç»´å‰å°¼äºšå¯†ç ï¼ˆé’¥åŒ™ï¼‰â‘£æ©å°¼æ ¼ç›æœº</th></tr></thead><tbody><tr><td>ç°ä»£å¯†ç </td><td>â‘ é­”ç‹åŠ å¯†ç³»ç»Ÿ â‘¡å¯¹ç§°åŠ å¯†ï¼Œéå¯¹ç§°åŠ å¯†ï¼Œå“ˆå¸Œç®—æ³•â‘¢é‡å­åŠ å¯†</td></tr></tbody></table><h2 id="3-2-ä»€ä¹ˆæ˜¯å¯†ç å­¦"><a href="#3-2-ä»€ä¹ˆæ˜¯å¯†ç å­¦" class="headerlink" title="3.2 ä»€ä¹ˆæ˜¯å¯†ç å­¦"></a>3.2 ä»€ä¹ˆæ˜¯å¯†ç å­¦</h2><p>å¯†ç å­¦å°±æ˜¯ç ”ç©¶ç¼–åˆ¶å¯†ç å’Œç ´è¯‘å¯†ç ã€ä»¥åŠä¿è¯ä¿¡æ¯æ•°æ®å®‰å…¨çš„æŠ€æœ¯ç§‘å­¦ã€‚  <code>ç¼–è¯‘å­¦</code>å’Œ<code>ç ´è¯‘å­¦</code>ç»Ÿç§°ä¸ºå¯†ç å­¦</p><h2 id="3-3-åŠ å¯†å’Œè§£å¯†"><a href="#3-3-åŠ å¯†å’Œè§£å¯†" class="headerlink" title="3.3 åŠ å¯†å’Œè§£å¯†"></a>3.3 åŠ å¯†å’Œè§£å¯†</h2><p>åŠ å¯†: æ˜æ–‡-&gt;å¯†æ–‡   è§£å¯†ï¼šå¯†æ–‡-&gt;æ˜æ–‡</p><h3 id="3-3-1-åŒºå—é“¾å¸¸ç”¨å¯†ç å­¦æŠ€æœ¯"><a href="#3-3-1-åŒºå—é“¾å¸¸ç”¨å¯†ç å­¦æŠ€æœ¯" class="headerlink" title="3.3.1 åŒºå—é“¾å¸¸ç”¨å¯†ç å­¦æŠ€æœ¯"></a>3.3.1 åŒºå—é“¾å¸¸ç”¨å¯†ç å­¦æŠ€æœ¯</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>å“ˆå¸Œç®—æ³•</td><td>ä¿éšœæ•°æ®çš„å”¯ä¸€æ€§</td></tr><tr><td>éå¯¹ç§°åŠ å¯†ç®—æ³•</td><td>ç§é’¥ç­¾åï¼Œå…¬é’¥éªŒç­¾ï¼Œå…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†</td></tr><tr><td>å¯¹ç§°åŠ å¯†ç®—æ³•</td><td>æ•°æ®åŠ è§£å¯†æ•ˆç‡é«˜</td></tr><tr><td>é›¶çŸ¥è¯†è¯æ˜</td><td>ç”¨æˆ·éšç§ä¿æŠ¤</td></tr></tbody></table><h2 id="3-4-å“ˆå¸Œç®—æ³•"><a href="#3-4-å“ˆå¸Œç®—æ³•" class="headerlink" title="3.4 å“ˆå¸Œç®—æ³•"></a>3.4 å“ˆå¸Œç®—æ³•</h2><ul><li>å“ˆå¸Œ(Hash)ç®—æ³•åˆå«æ•£åˆ—æˆ–æ‚å‡‘å‡½æ•°ï¼Œæ˜¯å°†<code>æ¯”ç‰¹ä¸²æ˜ å°„ä¸ºå›ºå®šé•¿åº¦çš„æ¯”ç‰¹ä¸²çš„å‡½æ•°</code></li><li>æˆ‘ä»¬å¸¸è¯´çš„Hashç®—æ³•ä¸€èˆ¬æŒ‡çš„æ˜¯<code>SHA</code>å®¶æ—,å³å®‰å…¨æ•£åˆ—ç®—æ³•å®¶æ—ï¼›å¦å¤–è¿˜åŒ…æ‹¬å›½å¯†SM3;MD5ä¿¡æ¯æ‘˜è¦ç®—æ³•</li></ul><p><code>MD5,SM3,SHA</code>:hashåŠ å¯†</p><h3 id="3-4-1-å¸¸è§å“ˆå¸Œç®—æ³•çš„ç”±æ¥"><a href="#3-4-1-å¸¸è§å“ˆå¸Œç®—æ³•çš„ç”±æ¥" class="headerlink" title="3.4.1  å¸¸è§å“ˆå¸Œç®—æ³•çš„ç”±æ¥"></a>3.4.1  å¸¸è§å“ˆå¸Œç®—æ³•çš„ç”±æ¥</h3><ul><li>SHAï¼ˆå®‰å…¨æ•£åˆ—ç®—æ³•ï¼‰ï¼Œè¯¥ç®—æ³•çš„è¾“å‡ºç”±<code>å­—æ¯å’Œæ•°å­—</code>ç»„æˆï¼Œç§°ä¸ºå“ˆå¸Œå€¼ã€‚ç”±ç¾å›½å›½å®¶å®‰å…¨å±€æ‰€è®¾è®¡ã€‚</li><li>MD5ä¿¡æ¯æ‘˜è¦ç®—æ³•ï¼Œä¸€ç§è¢«å¹¿æ³›ä½¿ç”¨çš„å¯†ç æ•£åˆ—å‡½æ•°ï¼Œå¯ä»¥äº§ç”Ÿå‡ºä¸€ä¸ª128ä½ï¼ˆ16å­—èŠ‚ï¼‰çš„æ•£åˆ—å€¼ï¼Œç”±ç¾å›½å¯†ç å­¦å®¶</li><li>SM3æ˜¯ä¸­åäººæ°‘å…±å’Œå›½æ”¿åºœé‡‡ç”¨çš„ä¸€ç§å¯†ç æ•£åˆ—å‡½æ•°æ ‡å‡†ï¼Œ</li><li>å±±ä¸œç‹å°äº‘æ•™æˆï¼Œå‘å¸ƒäº†å¯¹MD5,MD4,RIPEMD,HAVAL-128çš„å››ä¸ªè‘—åå¯†ç ç®—æ³•çš„ç ´è¯‘ç»“æœï¼Œæ¬¡å¹´å®£å¸ƒç ´è§£SHA-1å¯†ç </li></ul><h3 id="3-4-2-å“ˆå¸Œç®—æ³•ä¼˜åŠ¿"><a href="#3-4-2-å“ˆå¸Œç®—æ³•ä¼˜åŠ¿" class="headerlink" title="3.4.2 å“ˆå¸Œç®—æ³•ä¼˜åŠ¿"></a>3.4.2 å“ˆå¸Œç®—æ³•ä¼˜åŠ¿</h3><img src="/posts/48583/6.png"><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>ä¿¡æ¯æŸ¥æ‰¾é€Ÿåº¦æ›´å¿«</td><td>å› ä¸ºå“ˆå¸Œå€¼é€šå¸¸<code>æ›´çŸ­</code>æ‰€ä»¥æ›´å®¹æ˜“è¢«æ‰¾åˆ°</td></tr><tr><td>æ•°æ®å”¯ä¸€æ€§</td><td>å“ˆå¸Œèƒ½å¤Ÿå¯¹ä¿¡æ¯è¿›è¡ŒåŠ å¯†ï¼Œä¸€ä¸ªå¥½çš„å“ˆå¸Œå‡½æ•°åœ¨è¾“å…¥åŸŸä¸­å¾ˆå°‘å‡ºç°å“ˆå¸Œå†²çª</td></tr><tr><td>æ ¡éªŒæ•°æ®çš„ä¸€è‡´æ€§</td><td>å“ˆå¸Œä¸€ä¸ªç‰¹å®šæ–‡æ¡£çš„ç»“æœæ€»æ˜¯ä¸€æ ·çš„ï¼Œä½†æ‰¾åˆ°å…·æœ‰ç›¸åŒå“ˆå¸Œå€¼çš„ä¸¤ä¸ªæ–‡ä»¶åœ¨è®¡ç®—ä¸Šä¸å¯è¡Œçš„</td></tr></tbody></table><h3 id="3-4-3-å“ˆå¸Œç®—æ³•ä¸åŒºå—é“¾"><a href="#3-4-3-å“ˆå¸Œç®—æ³•ä¸åŒºå—é“¾" class="headerlink" title="3.4.3 å“ˆå¸Œç®—æ³•ä¸åŒºå—é“¾"></a>3.4.3 å“ˆå¸Œç®—æ³•ä¸åŒºå—é“¾</h3><p><code>åŒºå—é“¾æœ¬è´¨ä¸Šå°±æ˜¯ä¸€æ¡å“ˆå¸Œé“¾</code></p><p>å¯¹äº<code>å…¬æœ‰é“¾</code>:  </p><pre><code>          * äº¤æ˜“çš„ä¸€è‡´æ€§ï¼šé“¾ä¸­é€šè¿‡éªŒè¯æ¯æ¡äº¤æ˜“çš„å“ˆå¸Œå€¼ä¿è¯äº¤æ˜“ä¿¡æ¯çš„å”¯ä¸€æ€§ã€‚          * äº¤æ˜“çš„æœ‰åºæ€§: åŒºå—ä¸­çš„è®°å½•è¿­ä»£å“ˆå¸Œä¿è¯äº¤æ˜“æœ‰åº          * äº¤æ˜“éš¾ç¯¡æ”¹: å‰ååŒºå—é€šè¿‡å“ˆå¸ŒæŒ‡é’ˆè¿æ¥æˆä¸ºå‰å‘é“¾ä¿è¯äº¤æ˜“éš¾è¢«ç¯¡æ”¹ç­‰</code></pre><p>å¯¹äº<code>è”ç›Ÿé“¾</code>:</p><ul><li>ä¸€è‡´æ€§ï¼šå¸¸å¸¸éœ€è¦å°†ä¸€äº›<code>ä¸šåŠ¡æ•°æ®</code>ä½œä¸ºâ€œäº¤æ˜“â€ä¸Šé“¾ï¼Œè¿™æ—¶ä¹Ÿéœ€è¦å€ŸåŠ©<code>å“ˆå¸Œç®—æ³•ä¿è¯å”¯ä¸€æ€§</code>ã€‚ä¾‹å¦‚, ä¸€ä»½åˆåŒç»è¿‡å“ˆå¸Œè¿ç®—ç”Ÿæˆå“ˆå¸Œå€¼æ˜¯å¦ä¸è„¸ä¸Šçš„ä¸€è‡´å°±å¯ä»¥ä¿è¯åˆåŒ<code>çœŸå®</code>ã€<code>å”¯ä¸€</code>ã€‚</li></ul><h3 id="3-4-4-å“ˆå¸Œç®—æ³•çš„åº”ç”¨åœºæ™¯"><a href="#3-4-4-å“ˆå¸Œç®—æ³•çš„åº”ç”¨åœºæ™¯" class="headerlink" title="3.4.4 å“ˆå¸Œç®—æ³•çš„åº”ç”¨åœºæ™¯"></a>3.4.4 å“ˆå¸Œç®—æ³•çš„åº”ç”¨åœºæ™¯</h3><blockquote><ol><li><p>æ•°å­—ç­¾å: å…ˆè®¡ç®—å‡ºæ¶ˆæ¯çš„å“ˆå¸Œå€¼ï¼Œç„¶åå†å¯¹è¿™ä¸ªå€¼å†è¿›è¡Œç­¾åï¼Œä»è€Œæé«˜æ•ˆç‡</p></li><li><p>ä¿å­˜ç”¨æˆ·å¯†ç : å°±æ˜¯ç™»é™†çš„å¯†ç éœ€è¦è¿›è¡Œå“ˆå¸Œè¿ç®—ä¹‹åå†å­˜å…¥æ•°æ®åº“ã€‚ç™»é™†æ—¶<code>æ¯”å¯¹è¾“å…¥å†…å®¹å“ˆå¸Œå€¼å’Œæ•°æ®åº“ä¸­è®°å½•çš„å“ˆå¸Œå€¼å³å¯</code>ã€‚è¿™æ ·å°±å¯ä»¥é¿å…è´¦æˆ·æ•°æ®ä»¥æ˜æ–‡å½¢å¼æ³„æ¼åè¢«ä¸æ³•åˆ†å­åˆ©ç”¨.</p></li><li><p>å”¯ä¸€æ ‡è¯†ã€é˜²ç¯¡æ”¹: æä¾›ä¸‹è½½æœåŠ¡çš„ç½‘ç«™å¤§å¤šä¹Ÿå›æä¾›æ–‡ä»¶çš„å“ˆå¸Œå€¼ï¼Œè‹¥ä¸‹è½½åˆ°çš„æ–‡ä»¶å“ˆå¸Œåä¸æä¾›çš„å“ˆå¸Œå€¼ä¸ç¬¦ï¼Œè¯´æ˜æ–‡ä»¶å·²è¢«ç¯¡æ”¹</p></li></ol></blockquote><h3 id="3-4-5-å“ˆå¸Œç®—æ³•çš„å®æ“è¯´æ˜"><a href="#3-4-5-å“ˆå¸Œç®—æ³•çš„å®æ“è¯´æ˜" class="headerlink" title="3.4.5 å“ˆå¸Œç®—æ³•çš„å®æ“è¯´æ˜"></a>3.4.5 å“ˆå¸Œç®—æ³•çš„å®æ“è¯´æ˜</h3><img src="/posts/48583/7.png"><h2 id="3-4-å¯¹ç§°åŠ å¯†"><a href="#3-4-å¯¹ç§°åŠ å¯†" class="headerlink" title="3.4 å¯¹ç§°åŠ å¯†"></a>3.4 å¯¹ç§°åŠ å¯†</h2><h3 id="3-4-1-ä»€ä¹ˆæ˜¯å¯¹ç§°åŠ å¯†"><a href="#3-4-1-ä»€ä¹ˆæ˜¯å¯¹ç§°åŠ å¯†" class="headerlink" title="3.4.1 ä»€ä¹ˆæ˜¯å¯¹ç§°åŠ å¯†"></a>3.4.1 ä»€ä¹ˆæ˜¯å¯¹ç§°åŠ å¯†</h3><p>å¯¹ç§°åŠ å¯†ç®—æ³•ï¼š<code>å¯¹æ•°æ®ä¿¡æ¯è¿›è¡ŒåŠ å¯†å’Œè§£å¯†æ—¶ä½¿ç”¨ç›¸åŒå¯†é’¥çš„ç®—æ³•</code></p><p><strong>å¸¸è§å¯¹ç§°åŠ å¯†ç®—æ³•</strong>: DES,SM4,AES,3DES</p><table><thead><tr><th>ç®—æ³•</th><th>æ¦‚è¿°</th></tr></thead><tbody><tr><td>DES</td><td>æ•°æ®åŠ å¯†ç®—æ³•,IBMå…¬å¸</td></tr><tr><td>3DES</td><td>ä¸‰é‡æ•°æ®åŠ å¯†ç®—æ³•å—ã€‚ç›¸å½“äºå¯¹æ¯ä¸ªæ•°æ®å—åº”ç”¨3æ¬¡DESåŠ å¯†ã€‚é€šè¿‡å¢åŠ DESçš„å¯†é’¥é•¿åº¦æ¥é¿å…æš´åŠ›ç ´è§£</td></tr><tr><td>AES</td><td>ç¾å›½</td></tr><tr><td>SM4</td><td>ä¸­å›½</td></tr></tbody></table><h3 id="3-4-2-å¯¹ç§°åŠ å¯†è¿‡ç¨‹"><a href="#3-4-2-å¯¹ç§°åŠ å¯†è¿‡ç¨‹" class="headerlink" title="3.4.2 å¯¹ç§°åŠ å¯†è¿‡ç¨‹"></a>3.4.2 å¯¹ç§°åŠ å¯†è¿‡ç¨‹</h3><img src="/posts/48583/8.png"><ul><li>æ•°æ®å‘é€æ–¹å°†æ˜æ–‡å’ŒåŠ å¯†å¯†é’¥ä¸€èµ·ç»è¿‡ç‰¹æ®ŠåŠ å¯†ç®—æ³•å¤„ç†åï¼Œä½¿å…¶å˜æˆå¤æ‚çš„åŠ å¯†å¯†æ–‡å‘é€å‡ºå»ã€‚æ”¶ä¿¡æ–¹æ”¶åˆ°å¯†æ–‡åï¼Œéœ€è¦<code>ä½¿ç”¨åŠ å¯†ç”¨è¿‡çš„å¯†é’¥åŠç›¸åŒç®—æ³•çš„é€†ç®—æ³•å¯¹å¯†æ–‡è¿›è¡Œè§£å¯†</code>,è·å–åˆ°åŸæ–‡</li><li>ä½¿ç”¨çš„å¯†é’¥åªæœ‰ä¸€ä¸ªï¼Œå‘æ”¶ä¿¡åŒæ–¹éƒ½ä½¿ç”¨è¿™ä¸ªå¯†é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†å’Œè§£å¯†,è¿™å°±è¦æ±‚è§£å¯†æ–¹äº‹å…ˆå¿…é¡»çŸ¥é“è¿™ä¸ªåŠ å¯†å¯†é’¥</li></ul><h3 id="3-4-3-ä¼˜ç¼ºç‚¹"><a href="#3-4-3-ä¼˜ç¼ºç‚¹" class="headerlink" title="3.4.3 ä¼˜ç¼ºç‚¹"></a>3.4.3 ä¼˜ç¼ºç‚¹</h3><p>ä¼˜ç‚¹: æ•ˆç‡é«˜</p><p>ç¼ºç‚¹: å®‰å…¨æ€§å¼±</p><h2 id="3-5-éå¯¹ç§°åŠ å¯†"><a href="#3-5-éå¯¹ç§°åŠ å¯†" class="headerlink" title="3.5 éå¯¹ç§°åŠ å¯†"></a>3.5 éå¯¹ç§°åŠ å¯†</h2><h3 id="3-5-1-ä»€ä¹ˆæ˜¯éå¯¹ç§°åŠ å¯†"><a href="#3-5-1-ä»€ä¹ˆæ˜¯éå¯¹ç§°åŠ å¯†" class="headerlink" title="3.5.1 ä»€ä¹ˆæ˜¯éå¯¹ç§°åŠ å¯†"></a>3.5.1 ä»€ä¹ˆæ˜¯éå¯¹ç§°åŠ å¯†</h3><ul><li><p>éå¯¹ç§°åŠ å¯†ç®—æ³•æŒ‡å¯¹æ•°æ®ä¿¡æ¯åŠ è§£å¯†<code>ä½¿ç”¨ä¸åŒçš„å¯†é’¥</code>ç®—æ³•</p></li><li><p>å¸¸è§çš„éå¯¹ç§°åŠ å¯†ç®—æ³•æœ‰: RSA,ECC,DSA,SM2,Elgamalï¼ŒSecp256k1</p></li></ul><table><thead><tr><th>åç§°</th><th>æ¦‚è¿°</th></tr></thead><tbody><tr><td>RSA</td><td>ç¬¬ä¸€ä¸ªæ¯”è¾ƒå®Œå–„çš„å…¬å¼€å¯†é’¥ç®—æ³•ã€‚æ—¢èƒ½ ç”¨äºåŠ å¯†ï¼Œä¹Ÿèƒ½ç”¨äºæ•°å­—ç­¾å</td></tr><tr><td>ECC(æ¤­åœ†åŠ å¯†ç®—æ³•)</td><td>å…¬é’¥åŠ å¯†æœºåˆ¶ï¼Œåˆ©ç”¨<code>æ¤­åœ†æ›²çº¿ç†è®ºä¸ºåŸºç¡€</code></td></tr><tr><td>DSA(æ•°å­—ç­¾åç®—æ³•)</td><td>æŒ‡æ•°å­—ç­¾åçš„æ ‡å‡†ï¼Œç¾å›½</td></tr><tr><td>Secp256k1</td><td>æŒ‡æ¯”ç‰¹å¸ä½¿ç”¨çš„ECDSAæ›²çº¿çš„å‚æ•°ï¼Œæ˜¯æ¤­åœ†æ›²çº¿ä¸­çš„ä¸€ç§æ›²çº¿å½¢å¼ã€‚å¤§å¤šæ•°å¸¸ç”¨çš„æ›²çº¿æ˜¯å…·æœ‰éšæœºç»“æœã€‚ä½†Sepcp256k1æ˜¯ä»¥ç‰¹æ®Šçš„ééšæœºæ–¹å¼æ„å»ºï¼Œå¯ä»¥è¿›è¡Œç‰¹åˆ«æœ‰æ•ˆçš„è®¡ç®—</td></tr><tr><td>SM2</td><td>å…·å¤‡å®Œå…¨çš„è‡ªä¸»ã€å®‰å…¨ä¸å¯æ§ã€‚æˆ‘å›½ä½¿ç”¨éå¯¹ç§°åŠ è§£å¯†ç®—æ³•çš„æ ‡å‡†ç®—æ³•</td></tr></tbody></table><h3 id="3-5-2-å…¬é’¥ä¸ç§é’¥"><a href="#3-5-2-å…¬é’¥ä¸ç§é’¥" class="headerlink" title="3.5.2 å…¬é’¥ä¸ç§é’¥"></a>3.5.2 å…¬é’¥ä¸ç§é’¥</h3><p>å…¬é’¥ å’Œ ç§é’¥ æˆå¯¹ä½¿ç”¨:  ç§é’¥ç­¾åï¼Œå…¬é’¥éªŒç­¾</p><p>â€‹                                          å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†</p><table><thead><tr><th></th><th>ç›¸å…³ç†è§£</th></tr></thead><tbody><tr><td>å…¬é’¥</td><td>å…¬é’¥æ˜¯å¯†é’¥å¯¹ä¸­å…¬å¼€çš„éƒ¨åˆ†ï¼Œç§é’¥åˆ™æ˜¯éå…¬å¼€çš„éƒ¨åˆ†ã€‚é€šå¸¸ç”¨äºåŠ å¯†ä¼šè¯ã€éªŒè¯æ•°å­—ç­¾å</td></tr><tr><td>ç§é’¥</td><td>ç§é’¥æ˜¯æŒ‡åªæœ‰è‡ªå·±æ‰çŸ¥é“çš„ä¸€ä¸²å­—ç¬¦ã€‚é€šå¸¸ç”¨æ¥ç­¾åå’Œè§£å¯†å…¬é’¥åŠ å¯†çš„æ•°æ®ã€‚</td></tr></tbody></table><p><code>è¾…åŠ©ç†è§£</code>ï¼š éå¯¹ç§°åŠ å¯†ï¼Œå°±æ˜¯æŒ‡åŒä¸€æŠŠé”ï¼Œä¸Šé”å’Œå¼€é”ç”¨çš„æ˜¯ä¸¤æŠŠä¸åŒçš„é’¥åŒ™ã€‚è€Œå¯¹ç§°åŠ å¯†ä½¿ç”¨ç›¸åŒçš„é’¥åŒ™</p><h3 id="3-5-3-éå¯¹ç§°åŠ å¯†çš„åº”ç”¨â€“æ¯”ç‰¹å¸"><a href="#3-5-3-éå¯¹ç§°åŠ å¯†çš„åº”ç”¨â€“æ¯”ç‰¹å¸" class="headerlink" title="3.5.3 éå¯¹ç§°åŠ å¯†çš„åº”ç”¨â€“æ¯”ç‰¹å¸"></a>3.5.3 éå¯¹ç§°åŠ å¯†çš„åº”ç”¨â€“æ¯”ç‰¹å¸</h3><p>åœ¨æ¯”ç‰¹å¸ç³»ç»Ÿä¸­ï¼Œå¯ä»¥æŠŠåœ°å€ç†è§£ä¸ºå…¬é’¥,<code>ç­¾åï¼Œè¾“å¯†ç çš„è¿‡ç¨‹ç†è§£ä¸ºç§é’¥çš„ç­¾å</code>ã€‚æ¯ä¸€ä¸ªäººåªéœ€è¦ä¿ç®¡å¥½è‡ªå·±çš„ç§é’¥ï¼Œé‚£ä¹ˆä½ çš„æ¯”ç‰¹å¸å°±ä¸ä¼šä¸¢ï¼Œè€Œä¸éœ€è¦ä¸€ä¸ªä¸­å¿ƒåŒ–çš„æœºæ„ä»£ä¸ºä¿ç®¡å’ŒèƒŒä¹¦ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¸¸è¯´çš„æ¯”ç‰¹å¸æ˜¯å»ä¸­å¿ƒåŒ–çš„</p><h3 id="3-5-4-éå¯¹ç§°åŠ å¯†çš„åº”ç”¨â€“æ•°å­—è¯ä¹¦"><a href="#3-5-4-éå¯¹ç§°åŠ å¯†çš„åº”ç”¨â€“æ•°å­—è¯ä¹¦" class="headerlink" title="3.5.4 éå¯¹ç§°åŠ å¯†çš„åº”ç”¨â€“æ•°å­—è¯ä¹¦"></a>3.5.4 éå¯¹ç§°åŠ å¯†çš„åº”ç”¨â€“æ•°å­—è¯ä¹¦</h3><ul><li>ç”¨æ•°å­—è¯ä¹¦åŠ å¯†ä¿¡æ¯ï¼Œå¯ä»¥ç¡®ä¿ä¿¡æ¯åœ¨ä¼ é€’è¿‡ç¨‹ä¸­çš„ä¿å¯†æ€§å’Œå®Œæ•´æ€§ï¼Œåªæœ‰æ¥å—è€…æ‰èƒ½è§£å¯†ã€é˜…è¯»åŸæ–‡</li><li>è¯ä¹¦é¢å‘æœºæ„è´Ÿè´£å‘æ”¾å’Œç®¡ç†æ•°å­—è¯ä¹¦ï¼Œåœ¨çº¿äº¤æ˜“ä¸­å¯ä½¿ç”¨æ•°å­—è¯ä¹¦éªŒè¯å¯¹æ–¹èº«ä»½</li></ul><h3 id="3-5-5-éå¯¹ç§°åŠ å¯†çš„ä¼˜ç¼ºç‚¹"><a href="#3-5-5-éå¯¹ç§°åŠ å¯†çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="3.5.5 éå¯¹ç§°åŠ å¯†çš„ä¼˜ç¼ºç‚¹"></a>3.5.5 éå¯¹ç§°åŠ å¯†çš„ä¼˜ç¼ºç‚¹</h3><p>ä¼˜ç‚¹ï¼š </p><p>å®‰å…¨æ€§æ›´é«˜ã€‚å…¬é’¥æ˜¯å…¬å¼€çš„ï¼Œç§é’¥æ˜¯è‡ªå·±ä¿å­˜çš„ï¼Œä¸éœ€è¦å°†ç§é’¥ç»™åˆ«äºº</p><p>æ•ˆç‡ä½ï¼šåŠ å¯†å’Œè§£å¯†èŠ±è´¹æ—¶é—´é•¿ï¼Œé€Ÿåº¦æ…¢ï¼Œåªé€‚åˆå¯¹å°‘é‡æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œä¸€èˆ¬å’Œå¯¹ç§°åŠ å¯†é…åˆä½¿ç”¨</p><h2 id="3-6-å¯¹ç§°å’Œéå¯¹ç§°åŠ å¯†åœ¨åŒºå—é“¾çš„åº”ç”¨"><a href="#3-6-å¯¹ç§°å’Œéå¯¹ç§°åŠ å¯†åœ¨åŒºå—é“¾çš„åº”ç”¨" class="headerlink" title="3.6 å¯¹ç§°å’Œéå¯¹ç§°åŠ å¯†åœ¨åŒºå—é“¾çš„åº”ç”¨"></a>3.6 å¯¹ç§°å’Œéå¯¹ç§°åŠ å¯†åœ¨åŒºå—é“¾çš„åº”ç”¨</h2><p>å‡è®¾Aè¦ç»™Bå‘é€ä¸€ä¸ªåˆåŒï¼Œå…¶ä¸­ç”¨åˆ°çš„å¯¹ç§°å’Œéå¯¹ç§°åŠ å¯†æµç¨‹åŸºæœ¬å¦‚ä¸‹</p><ol><li>A ç”¨è‡ªå·±çš„ç§é’¥ç­¾åå°†åˆåŒä¼ å…¥åŒºå—é“¾ç½‘ç»œ</li><li>åŒºå—é“¾ç½‘ç»œä¼šé€šè¿‡å¯¹ç§°åŠ å¯†ç®—æ³•å¯¹æ–‡ä»¶éšæœºåŠ å¯†ï¼Œå¯†ç éšæœºç”Ÿæˆã€‚åŒæ—¶Aä¼šæ‹¿Bçš„å…¬é’¥å¯¹éšæœºå¯†ç åŠ å¯†</li><li>B æ”¶åˆ°æ¶ˆæ¯åï¼Œé¦–å…ˆç”¨Aå…¬é’¥éªŒç­¾ï¼›ç„¶åBç”¨è‡ªå·±çš„ç§é’¥è§£å¯†Aå½“åˆç”¨Bå…¬é’¥åŠ å¯†çš„éšæœºå¯†ç ã€‚æœ€ç»ˆå¾—åˆ°åˆåŒåŸæ–‡</li></ol><p>è¿™ä¸ªæµç¨‹<code>å¯¹ç§°åŠ å¯†</code>çš„éšæœºå¯†ç Aå’ŒBè°ä¹Ÿä¸çŸ¥é“ï¼Œè¿™æ ·å°±å®ç°äº†ç”¨éå¯¹ç§°åŠ å¯†æ»¡è¶³å®‰å…¨ï¼ŒåŒæ—¶ç”¨å¯¹ç§°å¯†é’¥æ»¡è¶³æ•ˆç‡å’Œæ–‡ä»¶å®‰å…¨çš„é—®é¢˜.</p><h2 id="3-7-æ•°å­—è¯ä¹¦"><a href="#3-7-æ•°å­—è¯ä¹¦" class="headerlink" title="3.7 æ•°å­—è¯ä¹¦"></a>3.7 æ•°å­—è¯ä¹¦</h2><h3 id="3-7-1-ä»€ä¹ˆæ˜¯æ•°å­—è¯ä¹¦"><a href="#3-7-1-ä»€ä¹ˆæ˜¯æ•°å­—è¯ä¹¦" class="headerlink" title="3.7.1 ä»€ä¹ˆæ˜¯æ•°å­—è¯ä¹¦"></a>3.7.1 ä»€ä¹ˆæ˜¯æ•°å­—è¯ä¹¦</h3><ul><li>æ•°å­—è¯ä¹¦ æ˜¯æŒ‡ åœ¨äº’è”ç½‘é€šè®¯ä¸­æ ‡å¿—é€šè®¯å„æ–¹èº«ä»½ä¿¡æ¯çš„ã€ç”±CAæœºæ„é¢å‘çš„æ•°å­—è®¤è¯ï¼Œäººä»¬å¯ä»¥åœ¨ç½‘ä¸Šç”¨å®ƒæ¥è¯†åˆ«å¯¹æ–¹çš„èº«ä»½</li><li>æ•°å­—è¯ä¹¦ä¸»è¦ä½œç”¨æ˜¯åšæ•°å­—ç­¾åï¼›ç›®å‰æ•°å­—è¯ä¹¦çš„æ ‡å‡†æ˜¯x509ï¼ŒCAæœºæ„æ˜¯ä¸€ç³»åˆ—å…·æœ‰ç¤¾ä¼šå…¬ä¿¡åŠ›çš„æœºæ„çš„æ€»ç§°ï¼Œå¸‚é¢ä¸Šçš„CAè¯ä¹¦éƒ½æ˜¯æ”¶è´¹çš„</li></ul><h3 id="3-7-2-æ•°å­—è¯ä¹¦çš„ä½œç”¨"><a href="#3-7-2-æ•°å­—è¯ä¹¦çš„ä½œç”¨" class="headerlink" title="3.7.2 æ•°å­—è¯ä¹¦çš„ä½œç”¨"></a>3.7.2 æ•°å­—è¯ä¹¦çš„ä½œç”¨</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>å®‰å…¨æ€§</td><td>æ•°å­—è¯ä¹¦æ˜¯ç”±CAä¸­å¿ƒç­¾å‘ï¼ŒCAä¸­å¿ƒæ˜¯ä¸€ä¸ªå…·æƒå¨æ€§ã€ä¾èµ–åº¦æé«˜çš„ç¬¬ä¸‰æ–¹ï¼Œå…¶èµ„æ ¼è¯ä¹¦ç»å›½å®¶é¢å‘ï¼Œå¯æœ‰æ•ˆä¿éšœç½‘ç»œæ•°æ®ä¿¡æ¯çš„å®‰å…¨æ€§</td></tr><tr><td>å”¯ä¸€æ€§</td><td>æ•°å­—è¯ä¹¦ä¾ç”¨æˆ·èº«ä»½ä¸åŒç»™äºˆå…¶ç›¸åº”çš„è®¿é—®æƒé™ã€‚æ•°å­—è¯ä¹¦å°±å¦‚ä¸€æŠŠé’¥åŒ™ï¼Œè€Œä¸€æŠŠé’¥åŒ™åªèƒ½å¼€ä¸€æŠŠé”</td></tr><tr><td>ä¾¿åˆ©æ€§</td><td>ç”¨æˆ·å¯å³æ—¶ç”³è¯·ï¼Œå¼€é€šå¹¶ä½¿ç”¨æ•°å­—è¯ä¹¦ï¼Œç”¨æˆ·ä¸éœ€è¦æŒæ¡åŠ å¯†æŠ€æœ¯æˆ–åŸç†ï¼Œå°±èƒ½å¤Ÿç›´æ¥é€šè¿‡æ•°å­—è¯ä¹¦æ¥è¿›è¡Œå®‰å…¨é˜²æŠ¤ï¼Œååˆ†ä¾¿æ·é«˜æ•ˆ</td></tr></tbody></table><h3 id="3-7-3-è¯ä¹¦é¢å‘è¿‡ç¨‹å’ŒéªŒè¯æ•°å­—ç­¾åçš„è¿‡ç¨‹"><a href="#3-7-3-è¯ä¹¦é¢å‘è¿‡ç¨‹å’ŒéªŒè¯æ•°å­—ç­¾åçš„è¿‡ç¨‹" class="headerlink" title="3.7.3 è¯ä¹¦é¢å‘è¿‡ç¨‹å’ŒéªŒè¯æ•°å­—ç­¾åçš„è¿‡ç¨‹"></a>3.7.3 è¯ä¹¦é¢å‘è¿‡ç¨‹å’ŒéªŒè¯æ•°å­—ç­¾åçš„è¿‡ç¨‹</h3><img src="/posts/48583/10.png"><p><code>ç®€å•æ€»ç»“</code>:</p><ol><li>CAå¯¹è¯ä¹¦æ˜æ–‡åšå“ˆå¸Œè¿ç®—ï¼Œç„¶åå¾—åˆ°ç‰¹å®šé•¿å€¼åï¼›CAå†ç”¨ç§é’¥å¯¹å“ˆå¸Œå€¼åŠ å¯†ï¼›å‘ç»™ç”¨æˆ·</li><li>ç”¨æˆ·å°±ç”¨CAçš„å…¬é’¥è§£å¯†ï¼Œå¾—åˆ°ä¸€ä¸ªhashå€¼ã€‚å†å¯¹æ”¶åˆ°çš„è¯ä¹¦ä¿¡æ¯è®¡ç®—å‡ºhashï¼›å¯¹æ¯”è¿™ä¸¤ä¸ªhashæ˜¯å¦ç›¸ç­‰æ¥åˆ¤æ–­è¯¥ç”¨æˆ·æŒæœ‰CAé¢å‘è¯ä¹¦</li><li>ç”¨æˆ·è¦è¿›è¡Œä¸€æ¬¡è§£å¯†å¾—åˆ°hashï¼Œå’Œä¸€æ¬¡åŠ å¯†å¾—åˆ°hashï¼›</li></ol><h3 id="3-7-4-æ•°å­—è¯ä¹¦åœ¨åŒºå—é“¾ä¸­çš„ä½œç”¨"><a href="#3-7-4-æ•°å­—è¯ä¹¦åœ¨åŒºå—é“¾ä¸­çš„ä½œç”¨" class="headerlink" title="3.7.4 æ•°å­—è¯ä¹¦åœ¨åŒºå—é“¾ä¸­çš„ä½œç”¨"></a>3.7.4 æ•°å­—è¯ä¹¦åœ¨åŒºå—é“¾ä¸­çš„ä½œç”¨</h3><ul><li>æ•°å­—è¯ä¹¦ä¸»è¦åº”ç”¨äºè”ç›Ÿé“¾ä¸­ï¼Œè¿›è¡Œèº«ä»½çš„æˆæƒä¸æ ¡éªŒ</li><li>è”ç›Ÿé“¾å’Œå…¬é“¾æœ€å¤§çš„å·®åˆ«ä¾¿æ˜¯<code>æˆæƒå’ŒåŠ å¯†æœºåˆ¶</code>ã€‚æ‰€ä»¥ï¼Œè”ç›Ÿé“¾ä¸å…è®¸æˆå‘˜ä»»æ„åŠ å…¥é€€å‡ºï¼Œå› æ­¤ä¼šå¯¹æˆå‘˜è®¤è¯åŒ…æ‹¬èŠ‚ç‚¹è®¤è¯åšå‡ºä¸¥æ ¼çš„é™åˆ¶</li></ul><h2 id="3-8-é›¶çŸ¥è¯†è¯æ˜"><a href="#3-8-é›¶çŸ¥è¯†è¯æ˜" class="headerlink" title="3.8 é›¶çŸ¥è¯†è¯æ˜"></a>3.8 é›¶çŸ¥è¯†è¯æ˜</h2><h3 id="3-8-1-ä»€ä¹ˆæ˜¯é›¶çŸ¥è¯†è¯æ˜"><a href="#3-8-1-ä»€ä¹ˆæ˜¯é›¶çŸ¥è¯†è¯æ˜" class="headerlink" title="3.8.1 ä»€ä¹ˆæ˜¯é›¶çŸ¥è¯†è¯æ˜"></a>3.8.1 ä»€ä¹ˆæ˜¯é›¶çŸ¥è¯†è¯æ˜</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token list punctuation">*</span> æŒ‡çš„æ˜¯è¯æ˜è€…èƒ½å¤Ÿåœ¨ä¸å‘éªŒè¯è€…æä¾›ä»»ä½•æœ‰ç”¨ä¿¡æ¯çš„æƒ…å†µä¸‹ï¼Œä½¿éªŒè¯è€…ç›¸ä¿¡æŸä¸ªè®ºæ–­æ˜¯æ­£ç¡®çš„ -- ç®€å•æ¥è®²å°±æ˜¯è¯´ï¼Œè¯æ˜è€…æŒæ¡ç€æŸä¸ªç§˜å¯† -- ä»–æƒ³è®©éªŒè¯è€…ç›¸ä¿¡ä»–æŒæ¡çš„ç§˜å¯† -- ä½†æ˜¯åˆä¸æƒ³æ³„éœ²è¿™ä¸ªç§˜å¯†ç»™éªŒè¯è€…<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-8-2-é›¶çŸ¥è¯†è¯æ˜ç‰¹ç‚¹"><a href="#3-8-2-é›¶çŸ¥è¯†è¯æ˜ç‰¹ç‚¹" class="headerlink" title="3.8.2 é›¶çŸ¥è¯†è¯æ˜ç‰¹ç‚¹"></a>3.8.2 é›¶çŸ¥è¯†è¯æ˜ç‰¹ç‚¹</h3><ol><li>æ—¢èƒ½å……åˆ†è¯æ˜è‡ªå·±æ˜¯æŸç§æƒç›Šçš„åˆæ³•æ‹¥æœ‰è€…ï¼Œåˆä¸æŠŠæœ‰å…³çš„ä¿¡æ¯æ³„éœ²å‡ºå»ã€‚<code>ç»™å¤–ç•Œçš„â€œçŸ¥è¯†â€ä¸º0</code>;</li><li>é›¶çŸ¥è¯†è¯æ˜å®é™…ä¸Šæ˜¯ä¸€ç§æ¶‰åŠä¸¤æ–¹æˆ–æ›´å¤šæ–¹çš„åè®®ï¼Œæ—¢ä¸¤æ–¹æˆ–æ›´å¤šæ–¹å®Œæˆä¸€é¡¹ä»»åŠ¡æ‰€éœ€é‡‡å–çš„ä¸€ç³»åˆ—æ­¥éª¤ã€‚è¯æ˜è€…å‘éªŒè¯è€…è¯æ˜å¹¶ä½¿å…¶ç›¸ä¿¡è‡ªå·±çŸ¥é“æˆ–æ‹¥æœ‰æŸä¸€æ¶ˆæ¯ï¼›ä½†<code>è¯æ˜è¿‡ç¨‹ä¸­ä¸èƒ½å‘éªŒè¯è€…æ³„éœ²ä»»ä½•å…³äºè¢«è¯æ˜æ¶ˆæ¯çš„ä¿¡æ¯</code>;</li></ol><h3 id="3-8-3-é›¶çŸ¥è¯†è¯æ˜ç¤ºä¾‹"><a href="#3-8-3-é›¶çŸ¥è¯†è¯æ˜ç¤ºä¾‹" class="headerlink" title="3.8.3 é›¶çŸ¥è¯†è¯æ˜ç¤ºä¾‹"></a>3.8.3 é›¶çŸ¥è¯†è¯æ˜ç¤ºä¾‹</h3><img src="/posts/48583/11.png"><p><code>é›¶çŸ¥è¯†çš„åº”ç”¨åœ¨ä¸æ³„éœ²åŸå§‹æ•°æ®çš„å‰æä¸‹ï¼Œå®ç°æ•°æ®ä»·å€¼çš„äº¤æ¢ï¼Œå³å®ç°æ•°æ®çš„æ‰€æœ‰æƒå’Œä½¿ç”¨æƒåˆ†ç¦»</code></p><h3 id="3-8-4-é›¶çŸ¥è¯†è¯æ˜çš„æ„ä¹‰"><a href="#3-8-4-é›¶çŸ¥è¯†è¯æ˜çš„æ„ä¹‰" class="headerlink" title="3.8.4 é›¶çŸ¥è¯†è¯æ˜çš„æ„ä¹‰"></a>3.8.4 é›¶çŸ¥è¯†è¯æ˜çš„æ„ä¹‰</h3><p>é›¶çŸ¥è¯†è¯æ˜å¹¶ä¸æ˜¯æ•°å­¦æ„ä¹‰ä¸Šçš„è¯æ˜ï¼Œå› ä¸ºå®ƒå­˜åœ¨å°æ¦‚ç‡çš„è¯¯å·®ï¼Œæ¬ºéª—è€…å¯èƒ½é€šè¿‡è™šå‡é™ˆè¿°éª—è¿‡è¯æ˜è€…ã€‚æ¢å¥è¯è¯´ï¼Œ<code>é›¶çŸ¥è¯†è¯æ˜æ˜¯æ¦‚ç‡è¯æ˜è€Œä¸æ˜¯ç¡®å®šæ€§è¯æ˜</code></p><h3 id="3-8-5-é›¶çŸ¥è¯†è¯æ˜åœ¨åŒºå—é“¾ä¸­çš„åº”ç”¨"><a href="#3-8-5-é›¶çŸ¥è¯†è¯æ˜åœ¨åŒºå—é“¾ä¸­çš„åº”ç”¨" class="headerlink" title="3.8.5 é›¶çŸ¥è¯†è¯æ˜åœ¨åŒºå—é“¾ä¸­çš„åº”ç”¨"></a>3.8.5 é›¶çŸ¥è¯†è¯æ˜åœ¨åŒºå—é“¾ä¸­çš„åº”ç”¨</h3><img src="/posts/48583/12.png"><h1 id="4-åŒºå—ä¸åŒºå—é“¾"><a href="#4-åŒºå—ä¸åŒºå—é“¾" class="headerlink" title="4. åŒºå—ä¸åŒºå—é“¾"></a>4. åŒºå—ä¸åŒºå—é“¾</h1><h2 id="4-1-åŒºå—"><a href="#4-1-åŒºå—" class="headerlink" title="4.1 åŒºå—"></a>4.1 åŒºå—</h2><p><code>ç»„æˆ</code></p><img src="/posts/48583/13.png"><img src="/posts/48583/14.png"><img src="/posts/48583/15.png"><p><code>å·®å¼‚ä¸»è¦æ˜¯ï¼šåŒºå—å¤´å’ŒåŒºå—ä½“å­˜å‚¨çš„æ•°æ®ä¸åŒ</code></p><h2 id="4-2-åŒºå—å¤´å’ŒåŒºå—ä½“"><a href="#4-2-åŒºå—å¤´å’ŒåŒºå—ä½“" class="headerlink" title="4.2 åŒºå—å¤´å’ŒåŒºå—ä½“"></a>4.2 åŒºå—å¤´å’ŒåŒºå—ä½“</h2><h3 id="4-2-1-ä»€ä¹ˆæ˜¯åŒºå—å¤´å’ŒåŒºå—ä½“"><a href="#4-2-1-ä»€ä¹ˆæ˜¯åŒºå—å¤´å’ŒåŒºå—ä½“" class="headerlink" title="4.2.1 ä»€ä¹ˆæ˜¯åŒºå—å¤´å’ŒåŒºå—ä½“"></a>4.2.1 ä»€ä¹ˆæ˜¯åŒºå—å¤´å’ŒåŒºå—ä½“</h3><p>åŒºå—å¤´è®°å½•å½“å‰åŒºå—çš„å…ƒä¿¡æ¯, ä»¥æ¯”ç‰¹å¸æ¥è®²ï¼Œ<code>å½“å‰ç‰ˆæœ¬å·ã€ä¸Šä¸€åŒºå—çš„å“ˆå¸Œå€¼ã€æ—¶é—´æˆ³ã€éšæœºæ•°ã€éš¾åº¦å€¼ç­‰éƒ½å±äºå…ƒä¿¡æ¯</code>;</p><p>åŒºå—ä½“ï¼šç”¨æ¥å­˜å‚¨äº¤æ˜“æ•°æ®</p><h3 id="4-2-2-æ¯”ç‰¹å¸åŒºå—ä¸¾ä¾‹"><a href="#4-2-2-æ¯”ç‰¹å¸åŒºå—ä¸¾ä¾‹" class="headerlink" title="4.2.2 æ¯”ç‰¹å¸åŒºå—ä¸¾ä¾‹"></a>4.2.2 æ¯”ç‰¹å¸åŒºå—ä¸¾ä¾‹</h3><img src="/posts/48583/16.png"><h3 id="4-2-3-åŒºå—å¤´-æ—¶é—´æˆ³"><a href="#4-2-3-åŒºå—å¤´-æ—¶é—´æˆ³" class="headerlink" title="4.2.3 åŒºå—å¤´-æ—¶é—´æˆ³"></a>4.2.3 åŒºå—å¤´-æ—¶é—´æˆ³</h3><p><code>å®šä¹‰</code>ï¼šåŒºå—é“¾é€šè¿‡æ—¶é—´æˆ³<code>ä¿è¯æ¯ä¸ªåŒºå—ä¾æ¬¡é¡ºåºç›¸è¿</code>.æ¯è¯ç”Ÿä¸€ä¸ªæ–°çš„åŒºå—ï¼Œå°±ä¼šè¢«ç›–ä¸Šç›¸åº”çš„æ—¶é—´æˆ³ï¼Œè¿™æ ·å°±èƒ½ä¿è¯æ•´æ¡é“¾ä¸Šçš„åŒºå—éƒ½æŒ‰ç…§æ—¶é—´é¡ºåºè¿›è¡Œæ’åˆ—</p><p><code>ä½œç”¨</code>: æ—¶é—´æˆ³è¯æ˜åŒºå—é“¾ä¸Šä»€ä¹ˆæ—¶é—´å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…ï¼Œä¸”<code>ä»»ä½•äººæ— æ³•ç¯¡æ”¹</code></p><h3 id="4-2-4-åŒºå—å¤´-é»˜å…‹å°”æ ‘"><a href="#4-2-4-åŒºå—å¤´-é»˜å…‹å°”æ ‘" class="headerlink" title="4.2.4 åŒºå—å¤´-é»˜å…‹å°”æ ‘"></a>4.2.4 åŒºå—å¤´-é»˜å…‹å°”æ ‘</h3><img src="/posts/48583/17.png"><p><code>å®šä¹‰</code>: æ¯ä¸ªåŒºå—åŒ…å«å¤šç¬”äº¤æ˜“ï¼Œ<code>äº¤æ˜“ä¸¤ä¸¤ç»„åˆè¿›è¡Œ å“ˆå¸Œè¿ç®—ï¼Œä»ä¸‹å‘ä¸Šè¿­ä»£å“ˆå¸Œï¼Œç›´åˆ°æœ€åå¾—åˆ°ä¸€ä¸ªå“ˆå¸Œå€¼ã€‚è¿™ç§è¿­ä»£å“ˆå¸Œå«åšé»˜å…‹å°”æ ‘</code>,æœ€ç»ˆç”Ÿæˆçš„å“ˆå¸Œå€¼å«åšé»˜å…‹å°”æ ‘æ ¹</p><p><code>ä½œç”¨</code>: <code>é»˜å…‹å°”æ ‘èƒ½å¤Ÿå¿«é€Ÿæ ¡éªŒäº¤æ˜“æ•°æ®çš„å®Œæ•´æ€§ï¼Œå³æ•°æ®æ˜¯å¦è¢«ç¯¡æ”¹è¿‡</code>ã€‚æ ¹æ®å¯†ç å­¦ä¸­å“ˆå¸Œå‡½æ•°çš„ç‰¹ç‚¹ï¼Œå¦‚æœæœ‰äººå¯¹æ•°æ®åšè¿‡æ‰‹è„šï¼Œè®¡ç®—å‡ºçš„å“ˆå¸Œå€¼ä¹Ÿä¼šå˜å¾—å®Œå…¨ä¸ä¸€æ ·ã€‚å“ªæ€•åªç§»åŠ¨çœ‹ä¸€ä¸ªå°æ•°ç‚¹ï¼Œä¹Ÿèƒ½ä»é»˜å…‹å°”æ ‘æ ¹çš„å“ˆå¸Œå€¼å‘ç°é—®é¢˜</p><h3 id="4-2-5-åŒºå—å¤´-çˆ¶åŒºå—å“ˆå¸Œ"><a href="#4-2-5-åŒºå—å¤´-çˆ¶åŒºå—å“ˆå¸Œ" class="headerlink" title="4.2.5 åŒºå—å¤´-çˆ¶åŒºå—å“ˆå¸Œ"></a>4.2.5 åŒºå—å¤´-çˆ¶åŒºå—å“ˆå¸Œ</h3><ul><li>çˆ¶åŒºå—å“ˆå¸ŒæŒ‡çš„æ˜¯<code>å‰ä¸€åŒºå—</code>çš„å“ˆå¸Œå€¼ï¼Œé€šè¿‡<code>å¯¹å‰ä¸€åŒºå—çš„åŒºå—å¤´æ•°æ®è¿›è¡Œå“ˆå¸Œè®¡ç®—</code>å¾—å‡º</li><li>çˆ¶åŒºå—å“ˆå¸Œçš„ä½œç”¨æ˜¯å°†åŒºå—å‰åè¿æ¥ï¼Œå½¢æˆé“¾å¼ç»“æ„çš„åŒºå—é“¾ã€‚å¦‚ä»»ä½•ä¸€ä¸ªåŒºå—æ”¹åŠ¨ï¼Œåˆ™åç»­çš„éƒ½æœ‰å˜åŒ–ï¼Œæ•´ä¸ªåŒºå—é“¾æ¡éƒ½ä¼šéšä¹‹æ”¹å˜ï¼Œè¿›è€Œä¿è¯å…¨ç½‘ç»´æŠ¤ç€ç»Ÿä¸€çš„è´¦æœ¬ã€å…¨ç½‘çš„æ•°æ®è®°å½•ä¿æŒä¸€è‡´æ€§</li></ul><h3 id="4-2-6-åŒºå—å¤´-éš¾åº¦å€¼"><a href="#4-2-6-åŒºå—å¤´-éš¾åº¦å€¼" class="headerlink" title="4.2.6 åŒºå—å¤´-éš¾åº¦å€¼"></a>4.2.6 åŒºå—å¤´-éš¾åº¦å€¼</h3><img src="/posts/48583/18.png"><h3 id="4-2-7-åŒºå—å¤´-éšæœºæ•°"><a href="#4-2-7-åŒºå—å¤´-éšæœºæ•°" class="headerlink" title="4.2.7 åŒºå—å¤´-éšæœºæ•°"></a>4.2.7 åŒºå—å¤´-éšæœºæ•°</h3><img src="/posts/48583/19.png"><h2 id="4-3-åŒºå—é“¾"><a href="#4-3-åŒºå—é“¾" class="headerlink" title="4.3 åŒºå—é“¾"></a>4.3 åŒºå—é“¾</h2><h3 id="4-3-1-ä»€ä¹ˆæ˜¯åŒºå—é“¾"><a href="#4-3-1-ä»€ä¹ˆæ˜¯åŒºå—é“¾" class="headerlink" title="4.3.1 ä»€ä¹ˆæ˜¯åŒºå—é“¾"></a>4.3.1 ä»€ä¹ˆæ˜¯åŒºå—é“¾</h3><ul><li>åŒºå—é“¾æ˜¯ä»¥<code>åˆ†å¸ƒå¼ç½‘ç»œ</code>ä¸ºåŸºç¡€ï¼Œå°†é“¾å¼ç»“æ„çš„åŒºå—ä½œä¸ºå­˜å‚¨å•å…ƒï¼Œé‡‡ç”¨å…±è¯†ç®—æ³•è¾¾åˆ°ä¸€è‡´æ€§çš„<code>åˆ†å¸ƒå¼è´¦æœ¬æŠ€æœ¯</code></li><li>åŒºå—é“¾ä¸æ˜¯ä¸€é¡¹æ–°æŠ€æœ¯ï¼Œè€Œæ˜¯æ–°çš„æŠ€æœ¯ç»„åˆã€‚å…¶å…³é”®æŠ€æœ¯,åŒ…æ‹¬:<code>P2Pç½‘ç»œã€å¯†ç å­¦ã€å…±äº«è´¦æœ¬ã€å…±è¯†æœºåˆ¶ã€æ™ºèƒ½åˆçº¦ç­‰ï¼Œå†è¾…ä»¥æ¿€åŠ±æœºåˆ¶ï¼Œè§£å†³å¤šæ–¹åˆä½œä¸­çš„ä¿¡ä»»é—®é¢˜</code>ã€‚</li></ul><h3 id="4-3-2-æ·±å…¥äº†è§£åŒºå—é“¾"><a href="#4-3-2-æ·±å…¥äº†è§£åŒºå—é“¾" class="headerlink" title="4.3.2 æ·±å…¥äº†è§£åŒºå—é“¾"></a>4.3.2 æ·±å…¥äº†è§£åŒºå—é“¾</h3><img src="/posts/48583/20.png"><h3 id="4-3-3-åŒºå—é“¾çš„ç‰¹ç‚¹"><a href="#4-3-3-åŒºå—é“¾çš„ç‰¹ç‚¹" class="headerlink" title="4.3.3 åŒºå—é“¾çš„ç‰¹ç‚¹"></a>4.3.3 åŒºå—é“¾çš„ç‰¹ç‚¹</h3><img src="/posts/48583/21.png"><h3 id="4-3-4-åŒºå—é“¾çš„ä¼˜ç‚¹"><a href="#4-3-4-åŒºå—é“¾çš„ä¼˜ç‚¹" class="headerlink" title="4.3.4 åŒºå—é“¾çš„ä¼˜ç‚¹"></a>4.3.4 åŒºå—é“¾çš„ä¼˜ç‚¹</h3><img src="/posts/48583/22.png"><h2 id="4-4-é»˜å…‹å°”æ ‘"><a href="#4-4-é»˜å…‹å°”æ ‘" class="headerlink" title="4.4 é»˜å…‹å°”æ ‘"></a>4.4 é»˜å…‹å°”æ ‘</h2><img src="/posts/48583/23.png"><h3 id="4-4-1-ä»€ä¹ˆæ˜¯é»˜å…‹å°”æ ‘"><a href="#4-4-1-ä»€ä¹ˆæ˜¯é»˜å…‹å°”æ ‘" class="headerlink" title="4.4.1 ä»€ä¹ˆæ˜¯é»˜å…‹å°”æ ‘"></a>4.4.1 ä»€ä¹ˆæ˜¯é»˜å…‹å°”æ ‘</h3><blockquote><p>é»˜å…‹å°”æ ‘æ˜¯å°†æ•°æ®å­˜å‚¨åœ¨æ ‘çŠ¶ç»“æ„çš„å¶å­èŠ‚ç‚¹ä¸­ï¼Œå¹¶é€šè¿‡å¯¹æ•°æ®çš„é€çº§å“ˆå¸Œæ“ä½œç¡®ä¿æ•°æ®çš„ä¸å¯ç¯¡æ”¹æ€§ã€‚<code>å¶å­èŠ‚ç‚¹æ•°æ®çš„ä»»ä½•å˜åŠ¨ï¼Œéƒ½ä¼šä¼ é€’åˆ°ä¸Šä¸€çº§èŠ‚ç‚¹å¹¶æœ€ç»ˆååº”åˆ°æ ‘æ ¹çš„å˜åŒ–</code>ã€‚åŒºå—é“¾ä¸­çš„æ•°æ®è®°å½•ä¸¤ä¸¤è¿­ä»£å“ˆå¸Œè¿ç®—ï¼Œæœ€ç»ˆçš„æ ¹å“ˆå¸Œå°±å«åšé»˜å…‹å°”æ ‘æ ¹</p></blockquote><img src="/posts/48583/25.png"><img src="/posts/48583/24.png"><p>4.4.2 é»˜å…‹å°”æ ‘ä¸åŒºå—é“¾çš„å…³ç³»</p><ul><li>é»˜å…‹å°”æ ‘æ ¹å¯ä»¥ä»£è¡¨æ•´ä¸ªåŒºå—çš„äº¤æ˜“æ•°æ®çš„æŒ‡çº¹ï¼Œå­˜å‚¨åœ¨åŒºå—å¤´</li><li>åŒºå—ä½“å­˜å‚¨äº¤æ˜“ä¿¡æ¯</li></ul><h3 id="4-4-2-ä»¥å¤ªåŠä¸­çš„é»˜å…‹å°”æ ‘"><a href="#4-4-2-ä»¥å¤ªåŠä¸­çš„é»˜å…‹å°”æ ‘" class="headerlink" title="4.4.2 ä»¥å¤ªåŠä¸­çš„é»˜å…‹å°”æ ‘"></a>4.4.2 ä»¥å¤ªåŠä¸­çš„é»˜å…‹å°”æ ‘</h3><p>é»˜å…‹å°”æ ‘è¢«å¹¿æ³›åº”ç”¨åœ¨åŒºå—é“¾æŠ€æœ¯ä¸­ï¼Œä¸‹å›¾æ˜¯ä»¥å¤ªåŠåŒºå—æ•°æ®ç»“æ„ï¼ŒåŒºå—å¤´ä¸­å­˜æœ‰â€œ ä¸–ç•ŒçŠ¶æ€æ ‘â€å’Œâ€˜â€™äº¤æ˜“æ ‘â€</p><img src="/posts/48583/26.png"><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>ä»¥å¤ªåŠ-äº¤æ˜“æ ‘</td><td><code>ä¸€æ¡ä¸€æ¡çš„äº¤æ˜“ä¿¡æ¯è¿­ä»£å“ˆå¸Œï¼Œæˆ‘ä»¬ç§°ä¸ºäº¤æ˜“æ ‘</code>;æœ€ç»ˆå¾—åˆ°äº¤æ˜“ä¿¡æ¯çš„é»˜å…‹å°”æ ‘æ ¹ï¼Œæˆ‘ä»¬ç§°ä¸ºäº¤æ˜“æ ‘æ ¹ã€‚äº¤æ˜“æ ‘æ ¹ä½œä¸ºè¯¥åŒºå—æ‰€æœ‰äº¤æ˜“æ¡ç›®çš„ä»£è¡¨ï¼Œè®°å½•åœ¨åŒºå—å¤´ä¸­ã€‚</td></tr><tr><td>ä¸–ç•ŒçŠ¶æ€</td><td>ä¸–ç•ŒçŠ¶æ€å¯ä»¥ç†è§£ä¸º<code>éšç€äº¤æ˜“çš„æ‰§è¡Œè€ŒæŒç»­æ›´æ–°çš„å…¨å±€çŠ¶æ€</code></td></tr><tr><td>ä¸–ç•ŒçŠ¶æ€æ ‘-ä»¥å¤ª åŠ</td><td>1.<code>ä»¥å¤ªåŠä¸­æ‰€æœ‰çš„è´¦æˆ·ä¿¡æ¯éƒ½ä½“ç°åœ¨ä¸–ç•ŒçŠ¶æ€ä¹‹ä¸­ï¼Œå¹¶ç”±ä¸–ç•ŒçŠ¶æ€æ ‘ä¿å­˜</code>ã€‚å¦‚æœæƒ³çŸ¥é“æŸä¸€è´¦æˆ·çš„ä½™é¢æˆ–è€…æŸæ™ºèƒ½åˆçº¦å½“å‰çš„çŠ¶æ€ï¼Œ<code>å°±éœ€è¦é€šè¿‡æŸ¥è¯¢ä¸–ç•ŒçŠ¶æ€æ ‘</code>æ¥è·å–è¯¥è´¦æˆ·çš„å…·ä½“çŠ¶æ€ä¿¡æ¯ã€‚2.ä¸â€œäº¤æ˜“æ ‘â€ç±»ä¼¼ï¼Œå„è´¦æˆ·çŠ¶æ€è¿­ä»£å“ˆå¸Œï¼Œå½¢æˆâ€œçŠ¶æ€æ ‘â€ï¼ŒçŠ¶æ€æ ‘æ ¹åŒæ ·è®°å½•åœ¨åŒºå—å¤´ä¸­ã€‚</td></tr></tbody></table><h1 id="5-åŒºå—é“¾çš„å…±è¯†æœºåˆ¶"><a href="#5-åŒºå—é“¾çš„å…±è¯†æœºåˆ¶" class="headerlink" title="5. åŒºå—é“¾çš„å…±è¯†æœºåˆ¶"></a>5. åŒºå—é“¾çš„å…±è¯†æœºåˆ¶</h1><h2 id="5-1-æ‹œå åº­ä¸å…±è¯†"><a href="#5-1-æ‹œå åº­ä¸å…±è¯†" class="headerlink" title="5.1 æ‹œå åº­ä¸å…±è¯†"></a>5.1 æ‹œå åº­ä¸å…±è¯†</h2><blockquote><p>å…±è¯†ï¼Œå°±æ˜¯ä¸€ä¸ªç¾¤ä½“çš„æˆå‘˜åœ¨<code>æŸä¸€æ–¹é¢è¾¾æˆä¸€è‡´æ„è§</code></p></blockquote><ul><li><p><code>åŒºå—é“¾éœ€è¦å…±è¯†</code>ï¼›å…±è¯†æœºåˆ¶è§£å†³ä¿è¯æ¯ä¸€ç¬”äº¤æ˜“åœ¨æ‰€æœ‰è®°è´¦èŠ‚ç‚¹ä¸Šçš„ä¸€è‡´æ€§å’Œæ­£ç¡®æ€§</p></li><li><p><code>å…±è¯†æœºåˆ¶æ˜¯è¡¡é‡åŒºå—é“¾ç½‘ç»œå®‰å…¨å¯é çš„ åŸºç¡€</code>ï¼›å…±è¯†æ˜¯åŒºå—é“¾ç½‘ç»œä¸­æœ€é‡è¦çš„ç¯èŠ‚ï¼Œå¾€å¾€å†³å®šäº†åŒºå—é“¾ç½‘ç»œçš„æ€§èƒ½ä»¥åŠæŠ—æ”»å‡»æ€§</p></li></ul><p>æ‹œå åº­å°†å†›çš„é—®é¢˜ï¼š</p><img src="/posts/48583/27.png"><h2 id="5-2-åŒºå—é“¾å…±è¯†æœºåˆ¶"><a href="#5-2-åŒºå—é“¾å…±è¯†æœºåˆ¶" class="headerlink" title="5.2 åŒºå—é“¾å…±è¯†æœºåˆ¶"></a>5.2 åŒºå—é“¾å…±è¯†æœºåˆ¶</h2><h3 id="5-2-1-ä»€ä¹ˆæ˜¯å…±è¯†æœºåˆ¶"><a href="#5-2-1-ä»€ä¹ˆæ˜¯å…±è¯†æœºåˆ¶" class="headerlink" title="5.2.1 ä»€ä¹ˆæ˜¯å…±è¯†æœºåˆ¶"></a>5.2.1 ä»€ä¹ˆæ˜¯å…±è¯†æœºåˆ¶</h3><blockquote><p>å…±è¯†æœºåˆ¶å°±æ˜¯åŒºå—é“¾ä¸­çš„èŠ‚ç‚¹åŒ…æ‹¬è¯šå®èŠ‚ç‚¹å’Œæ¶æ„èŠ‚ç‚¹ï¼Œå°±å¦‚ä½•å†™å…¥ä¸€ä¸ªåŒºå—è¾¾åˆ°å…±è¯†çš„æœºåˆ¶</p></blockquote><h3 id="5-2-2-åŒºå—é“¾ä¸­çš„å…±è¯†æœºåˆ¶"><a href="#5-2-2-åŒºå—é“¾ä¸­çš„å…±è¯†æœºåˆ¶" class="headerlink" title="5.2.2 åŒºå—é“¾ä¸­çš„å…±è¯†æœºåˆ¶"></a>5.2.2 åŒºå—é“¾ä¸­çš„å…±è¯†æœºåˆ¶</h3><p>åŒºå—é“¾çš„å¿ƒè„ï¼šå…±è¯†æœºåˆ¶          åŒºå—é“¾çš„éª¨éª¼ï¼šå¯†ç ç®—æ³•</p><p>åŒºå—é“¾ä½œä¸ºä¸€ç§æŒ‰<code>æ—¶é—´é¡ºåºå­˜å‚¨</code>çš„æ•°æ®ç»“æ„ï¼Œå¯æ”¯æŒä¸åŒçš„å…±è¯†æœºåˆ¶</p><blockquote><p>åŒºå—é“¾å…±è¯†æœºåˆ¶çš„ç›®æ ‡æ˜¯ä½¿æ‰€æœ‰è¯šå®èŠ‚ç‚¹<code>ä¿å­˜ä¸€è‡´</code>çš„åŒºå—é“¾è§†å›¾</p></blockquote><img src="/posts/48583/28.png"><h3 id="5-2-3-è¯„ä»·æŒ‡æ ‡"><a href="#5-2-3-è¯„ä»·æŒ‡æ ‡" class="headerlink" title="5.2.3 è¯„ä»·æŒ‡æ ‡"></a>5.2.3 è¯„ä»·æŒ‡æ ‡</h3><p>æœ‰å››ä¸ªç»´åº¦è¯„ä»·å„å…±è¯†æœºåˆ¶çš„æŠ€æœ¯æ°´å¹³</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>å®‰å…¨æ€§</td><td>æ˜¯å¦æœ‰è‰¯å¥½çš„å®¹é”™èƒ½åŠ›ï¼Œæ˜¯å¦å¯ä»¥é˜²æ­¢åŒèŠ±ç­‰æ”»å‡»</td></tr><tr><td>æ€§èƒ½æ•ˆç‡</td><td>ç³»ç»Ÿæ¯ç§’å¯å¤„ç†ç¡®è®¤çš„äº¤æ˜“æ•°é‡</td></tr><tr><td>æ‰©å±•æ€§</td><td>æ˜¯å¦æ”¯æŒç½‘ç»œèŠ‚ç‚¹æ‰©å±•</td></tr><tr><td>èµ„æºæ¶ˆè€—</td><td>è¾¾åˆ°å…±è¯†çš„è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿæ‰€è€—è´¹çš„è®¡ç®—èµ„æºå¤§å°ï¼Œä¾‹å¦‚CPUï¼Œå†…å­˜ç­‰</td></tr></tbody></table><h3 id="5-2-4-å…±è¯†æœºåˆ¶çš„å¹³è¡¡å†³ç­–"><a href="#5-2-4-å…±è¯†æœºåˆ¶çš„å¹³è¡¡å†³ç­–" class="headerlink" title="5.2.4 å…±è¯†æœºåˆ¶çš„å¹³è¡¡å†³ç­–"></a>5.2.4 å…±è¯†æœºåˆ¶çš„å¹³è¡¡å†³ç­–</h3><img src="/posts/48583/29.png"><h2 id="5-3-å…±è¯†æœºåˆ¶-POW"><a href="#5-3-å…±è¯†æœºåˆ¶-POW" class="headerlink" title="5.3 å…±è¯†æœºåˆ¶-POW"></a>5.3 å…±è¯†æœºåˆ¶-POW</h2><h3 id="5-3-1-æ¦‚å¿µ"><a href="#5-3-1-æ¦‚å¿µ" class="headerlink" title="5.3.1 æ¦‚å¿µ"></a>5.3.1 æ¦‚å¿µ</h3><ul><li>å·¥ä½œé‡è¯æ˜æœºåˆ¶POWç®€å•çš„è¯´å°±æ˜¯<code>å¯ä»¥è¯æ˜ä½ ä»˜å‡ºäº†å¤šå°‘å·¥ä½œé‡</code>çš„è¯æ˜</li></ul><p>æ¯”ç‰¹å¸ç½‘ç»œçš„POWæœºåˆ¶ï¼š</p><img src="/posts/48583/30.png"><p><strong>ä½¿ç”¨POWæœºåˆ¶çš„é¡¹ç›®</strong>: æ¯”ç‰¹å¸ï¼Œå’Œä»¥å¤ªåŠçš„å‰ä¸‰ä¸ªé˜¶æ®µ<code>Frontierå‰æ²¿ã€Homesteadå®¶å›­ã€Metropoliså¤§éƒ½ä¼š</code>ï¼Œ<code>Serenity</code>å®é™é˜¶æ®µé‡‡ç”¨Posæœºåˆ¶</p><h3 id="5-3-2-å·¥ä½œé‡è¯æ˜æœºåˆ¶"><a href="#5-3-2-å·¥ä½œé‡è¯æ˜æœºåˆ¶" class="headerlink" title="5.3.2 å·¥ä½œé‡è¯æ˜æœºåˆ¶"></a>5.3.2 å·¥ä½œé‡è¯æ˜æœºåˆ¶</h3><img src="/posts/48583/31.png"><h3 id="5-3-3-ä¼˜ç¼ºç‚¹"><a href="#5-3-3-ä¼˜ç¼ºç‚¹" class="headerlink" title="5.3.3 ä¼˜ç¼ºç‚¹"></a>5.3.3 ä¼˜ç¼ºç‚¹</h3><img src="/posts/48583/32.png"><h2 id="5-4-å…±è¯†æœºåˆ¶-POS"><a href="#5-4-å…±è¯†æœºåˆ¶-POS" class="headerlink" title="5.4 å…±è¯†æœºåˆ¶-POS"></a>5.4 å…±è¯†æœºåˆ¶-POS</h2><p><code>æŒæœ‰è¶Šå¤šï¼Œè·å¾—è¶Šå¤š</code>:</p><ul><li><p>æƒç›Šè¯æ˜æœºåˆ¶POSï¼›è¦æ±‚è¯æ˜äººæä¾›ä¸€å®šæ•°é‡åŠ å¯†è´§å¸çš„æ‰€æœ‰æƒå³å¯ã€‚å®ƒå°†POWä¸­çš„ç®—ä¾‹æ”¹ä¸ºç³»ç»Ÿæƒç›Š,<code>æ‹¥æœ‰æƒç›Šè¶Šå¤§åˆ™æˆä¸ºä¸‹ä¸€ä¸ªè®°è´¦äººçš„æ¦‚ç‡è¶Šå¤§</code></p><p><strong>ä»¥å¤ªåŠç¬¬å››é˜¶æ®µ</strong>:Serenityé‡‡ç”¨Posæœºåˆ¶</p></li></ul><h3 id="5-4-1-POSæƒç›Šè¯æ˜æœºåˆ¶"><a href="#5-4-1-POSæƒç›Šè¯æ˜æœºåˆ¶" class="headerlink" title="5.4.1 POSæƒç›Šè¯æ˜æœºåˆ¶"></a>5.4.1 POSæƒç›Šè¯æ˜æœºåˆ¶</h3><img src="/posts/48583/33.png"><h3 id="5-4-2-ä¼˜ç¼ºç‚¹"><a href="#5-4-2-ä¼˜ç¼ºç‚¹" class="headerlink" title="5.4.2 ä¼˜ç¼ºç‚¹"></a>5.4.2 ä¼˜ç¼ºç‚¹</h3><img src="/posts/48583/34.png"><h2 id="5-5-å…±è¯†æœºåˆ¶-DPOS"><a href="#5-5-å…±è¯†æœºåˆ¶-DPOS" class="headerlink" title="5.5 å…±è¯†æœºåˆ¶-DPOS"></a>5.5 å…±è¯†æœºåˆ¶-DPOS</h2><h3 id="5-5-1-æ¦‚å¿µ"><a href="#5-5-1-æ¦‚å¿µ" class="headerlink" title="5.5.1 æ¦‚å¿µ"></a>5.5.1 æ¦‚å¿µ</h3><ul><li>è‚¡ä»½æˆæƒè¯æ˜æœºåˆ¶DPOSï¼›åœ¨POSåŸºç¡€ä¸Šï¼Œ<code>å°†è®°è´¦äººçš„è§’è‰²ä¸“ä¸šåŒ–ï¼Œå…ˆé€šè¿‡æƒç›Šæ¥é€‰å‡ºè®°è´¦äººï¼Œç„¶åè®°è´¦äººä¹‹é—´å†è½®æµè®°è´¦</code>ã€‚</li></ul><p>ç±»ä¼¼äºè‘£äº‹ä¼šæŠ•ç¥¨ï¼ŒæŒå¸è€…æŠ•å‡ºä¸€å®šæ•°é‡çš„èŠ‚ç‚¹ï¼Œä»£ç†ä»–ä»¬è¿›è¡ŒéªŒè¯å’Œè®°è´¦</p><h3 id="5-5-2-DPOSç‰¹ç‚¹åŸåˆ™"><a href="#5-5-2-DPOSç‰¹ç‚¹åŸåˆ™" class="headerlink" title="5.5.2 DPOSç‰¹ç‚¹åŸåˆ™"></a>5.5.2 DPOSç‰¹ç‚¹åŸåˆ™</h3><img src="/posts/48583/35.png"><h3 id="5-5-3-ä¼˜ç¼ºç‚¹"><a href="#5-5-3-ä¼˜ç¼ºç‚¹" class="headerlink" title="5.5.3 ä¼˜ç¼ºç‚¹"></a>5.5.3 ä¼˜ç¼ºç‚¹</h3><img src="/posts/48583/36.png"><h2 id="5-6-å…±è¯†æœºåˆ¶-PBFT"><a href="#5-6-å…±è¯†æœºåˆ¶-PBFT" class="headerlink" title="5.6 å…±è¯†æœºåˆ¶-PBFT"></a>5.6 å…±è¯†æœºåˆ¶-PBFT</h2><ul><li><code>æ‹œå åº­å®¹é”™å…±è¯†æœºåˆ¶</code>PBFTï¼›å°±æ˜¯è¯´ç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¼šè¢«å½“åšä¸»èŠ‚ç‚¹ï¼Œè€Œå…¶ä»–èŠ‚ç‚¹éƒ½æ˜¯å­èŠ‚ç‚¹ã€‚ç³»ç»Ÿå†…çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šäº’ç›¸é€šä¿¡ï¼Œæœ€ç»ˆç›®æ ‡æ˜¯å¤§å®¶èƒ½ä»¥<code>å°‘æ•°æœä»å¤šæ•°çš„åŸåˆ™</code>è¾¾æˆæ•°æ®å…±è¯†</li></ul><p><strong>å…¸å‹</strong>:Fabricè”ç›Ÿé“¾</p><h3 id="5-6-1-æµç¨‹"><a href="#5-6-1-æµç¨‹" class="headerlink" title="5.6.1 æµç¨‹"></a>5.6.1 æµç¨‹</h3><img src="/posts/48583/37.png"><h3 id="5-6-2-é‡ç‚¹ä»‹ç»"><a href="#5-6-2-é‡ç‚¹ä»‹ç»" class="headerlink" title="5.6.2 é‡ç‚¹ä»‹ç»"></a>5.6.2 é‡ç‚¹ä»‹ç»</h3><img src="/posts/48583/38.png"><h3 id="5-6-3-ä¼˜ç¼ºç‚¹"><a href="#5-6-3-ä¼˜ç¼ºç‚¹" class="headerlink" title="5.6.3 ä¼˜ç¼ºç‚¹"></a>5.6.3 ä¼˜ç¼ºç‚¹</h3><img src="/posts/48583/39.png"><h1 id="6-æ™ºèƒ½åˆçº¦"><a href="#6-æ™ºèƒ½åˆçº¦" class="headerlink" title="6. æ™ºèƒ½åˆçº¦"></a>6. æ™ºèƒ½åˆçº¦</h1><h2 id="6-1-ä»€ä¹ˆæ˜¯æ™ºèƒ½åˆçº¦"><a href="#6-1-ä»€ä¹ˆæ˜¯æ™ºèƒ½åˆçº¦" class="headerlink" title="6.1 ä»€ä¹ˆæ˜¯æ™ºèƒ½åˆçº¦"></a>6.1 ä»€ä¹ˆæ˜¯æ™ºèƒ½åˆçº¦</h2><ul><li>æ™ºèƒ½åˆçº¦æ˜¯ä¸€ç§æ—¨åœ¨ä»¥ä¿¡æ¯åŒ–æ–¹å¼ä¼ æ’­ã€éªŒè¯æˆ–æ‰§è¡ŒåˆåŒçš„<code>è®¡ç®—æœºåè®®</code>ï¼Œå…¶åœ¨åˆ†å¸ƒå¼è´¦æœ¬ä¸Šä½“ç°ä¸º<code>å¯è‡ªåŠ¨æ‰§è¡Œçš„è®¡ç®—æœºç¨‹åº</code>.</li><li>ä¸€ä¸ªæ™ºèƒ½åˆçº¦æ˜¯ä¸€å¥—ä»¥<code>æ•°å­—å½¢å¼å®šä¹‰</code>çš„æ‰¿è¯ºï¼ŒåŒ…æ‹¬åˆçº¦å‚ä¸æ–¹å¯ä»¥åœ¨ä¸Šé¢æ‰§è¡Œè¿™äº›æ‰¿è¯ºçš„åè®®</li></ul><h3 id="6-2-æ™ºèƒ½åˆçº¦çš„æå‡º"><a href="#6-2-æ™ºèƒ½åˆçº¦çš„æå‡º" class="headerlink" title="6.2 æ™ºèƒ½åˆçº¦çš„æå‡º"></a>6.2 æ™ºèƒ½åˆçº¦çš„æå‡º</h3><p>1995å¹´ï¼Œæ—©äºåŒºå—é“¾çš„æ¦‚å¿µæå‡ºæ™ºèƒ½åˆçº¦</p><p>2008å¹´ï¼Œæ¯”ç‰¹å¸å‡ºç°ä½œä¸ºåŒºå—é“¾1.0çš„æ ‡å¿—ï¼Œä½†æ— æ³•å®ç°æ™ºèƒ½åˆçº¦çš„ ä½œç”¨</p><p>2013å¹´ï¼Œä½œä¸ºä»¥å¤ªåŠåŒºå—é“¾ç½‘ç»œç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œæ™ºèƒ½åˆçº¦é¦–æ¬¡è½åœ°å®ç°ã€‚å¸¦æœ‰æ™ºèƒ½åˆçº¦çš„ä»¥å¤ªåŠå‡ºç°æ˜¯åŒºå—é“¾2.0å¼€å§‹çš„æ ‡å¿—</p><h3 id="6-3-æ™ºèƒ½åˆçº¦å’ŒåŒºå—é“¾çš„å…³ç³»"><a href="#6-3-æ™ºèƒ½åˆçº¦å’ŒåŒºå—é“¾çš„å…³ç³»" class="headerlink" title="6.3 æ™ºèƒ½åˆçº¦å’ŒåŒºå—é“¾çš„å…³ç³»"></a>6.3 æ™ºèƒ½åˆçº¦å’ŒåŒºå—é“¾çš„å…³ç³»</h3><ul><li><p>å°†æ™ºèƒ½åˆçº¦ä»¥æ•°å­—åŒ–çš„å½¢å¼å†™å…¥åŒºå—é“¾ä¸­ï¼Œç”±åŒºå—é“¾æŠ€æœ¯çš„ç‰¹æ€§ä¿éšœå­˜å‚¨ã€è¯»å–ã€æ‰§è¡Œæ•´ä¸ªè¿‡ç¨‹é€æ˜å¯è¿½è¸ªï¼Œä¸å¯ç¯¡æ”¹</p></li><li><p>å¦‚æœè¯´å…±è¯†æœºåˆ¶å°±ç›¸å½“äºåŒºå—é“¾çš„è¿è¥è§„åˆ™ï¼Œåƒæ³•å¾‹ä¸€æ ·çº¦æŸæ•´ä¸ªåŒºå—é“¾ç³»ç»Ÿçš„è¿è¡Œï¼Œé‚£æ™ºèƒ½åˆçº¦å°±åƒåŒºå—é“¾çš„åˆåŒï¼Œç”±ç¨‹åºåŒ–æ§åˆ¶ï¼Œ<code>ç¬¦åˆæ¡ä»¶å¼ºåˆ¶æ‰§è¡Œ</code></p></li></ul><h3 id="6-4-æ™ºèƒ½åˆçº¦ä¸ä¼ ç»Ÿåˆçº¦çš„æ¯”è¾ƒ"><a href="#6-4-æ™ºèƒ½åˆçº¦ä¸ä¼ ç»Ÿåˆçº¦çš„æ¯”è¾ƒ" class="headerlink" title="6.4 æ™ºèƒ½åˆçº¦ä¸ä¼ ç»Ÿåˆçº¦çš„æ¯”è¾ƒ"></a>6.4 æ™ºèƒ½åˆçº¦ä¸ä¼ ç»Ÿåˆçº¦çš„æ¯”è¾ƒ</h3><img src="/posts/48583/40.png"><h2 id="6-2-ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦è¿è¡Œç¯å¢ƒEVM"><a href="#6-2-ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦è¿è¡Œç¯å¢ƒEVM" class="headerlink" title="6.2 ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦è¿è¡Œç¯å¢ƒEVM"></a>6.2 ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦è¿è¡Œç¯å¢ƒEVM</h2><h3 id="6-2-1-ä»€ä¹ˆæ˜¯ä»¥å¤ªåŠ"><a href="#6-2-1-ä»€ä¹ˆæ˜¯ä»¥å¤ªåŠ" class="headerlink" title="6.2.1 ä»€ä¹ˆæ˜¯ä»¥å¤ªåŠ"></a>6.2.1 ä»€ä¹ˆæ˜¯ä»¥å¤ªåŠ</h3><ul><li><p>ä»¥å¤ªåŠæ˜¯ä¸€ä¸ªæœ‰æ™ºèƒ½åˆçº¦åŠŸèƒ½çš„å…¬å…±<code>åŒºå—é“¾å¹³å°</code>ã€‚é€šè¿‡å…¶ä¸“ç”¨åŠ å¯†è´§å¸<code>ä»¥å¤ªå¸</code>ETH æä¾› <code>å»ä¸­å¿ƒåŒ–çš„ä»¥å¤ªè™šæ‹Ÿæœº</code>EVMæ¥å¤„ç†ç‚¹å¯¹ç‚¹åˆçº¦</p></li><li><p>ä»¥å¤ªåŠä¹Ÿæ˜¯ä¸€ä¸ª<code>ä¸ºå»ä¸­å¿ƒåŒ–åº”ç”¨è€Œç”Ÿ</code>çš„å…¨çƒå¼€æºå¹³å°</p></li><li><p>ä»¥å¤ªåŠä¸Šæ™ºèƒ½åˆçº¦çš„ç¼–å†™éœ€è¦ä¸“é—¨çš„ç¼–ç¨‹è¯­è¨€Solidityï¼ŒSolidityä¸“é—¨ä¸ºå®ç°æ™ºèƒ½åˆçº¦åˆ›å»ºçš„é«˜çº§ç¼–ç¨‹è¯­è¨€ï¼Œè¿è¡Œåœ¨EVMä¸Š</p></li></ul><h3 id="6-2-2-EVM"><a href="#6-2-2-EVM" class="headerlink" title="6.2.2 EVM"></a>6.2.2 EVM</h3><blockquote><p>EVMå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªâ€åŸºäºä»¥å¤ªåŠçš„æ™ºèƒ½åˆçº¦çš„è¿è¡Œç¯å¢ƒâ€œ</p></blockquote><h4 id="6-2-3-ç‰¹ç‚¹"><a href="#6-2-3-ç‰¹ç‚¹" class="headerlink" title="6.2.3 ç‰¹ç‚¹"></a>6.2.3 ç‰¹ç‚¹</h4><ol><li>EVMè¿è¡Œåœ¨ä»¥å¤ªåŠèŠ‚ç‚¹ä¸Š</li><li>åœ¨æ™ºèƒ½åˆçº¦æ‰§è¡Œè¿‡ç¨‹ä¸­é‡‡å–çš„æ¯ä¸ªè®¡ç®—æ­¥éª¤<code>éƒ½å¿…é¡»æå‰å‘EVMæ”¯ä»˜è´¹ç”¨ï¼ˆGasï¼‰</code>ï¼Œä»è€Œé˜²æ­¢DoSæ”»å‡»</li><li>EVMä½¿ç”¨256æ¯”ç‰¹é•¿åº¦çš„æœºå™¨ç ï¼Œæ˜¯ä¸€ç§<code>è™šæ‹Ÿæœº</code>ï¼Œç”¨äº<code>æ‰§è¡Œæ™ºèƒ½åˆçº¦</code>ï¼Œä¼šæ¥å—å¹¶æ‰§è¡Œä»¥å¤ªåŠç¼–ç¨‹è¯­è¨€</li><li>EVMæ˜¯ä¸€ä¸ª<code>æ²™ç›’</code>ç¨‹åºï¼Œå®ƒåªèƒ½æ‰§è¡Œåˆçº¦æ›´æ”¹è‡ªèº«è´¦æˆ·çŠ¶æ€</li></ol><h3 id="6-2-4-ä»¥å¤ªåŠè´¦æˆ·"><a href="#6-2-4-ä»¥å¤ªåŠè´¦æˆ·" class="headerlink" title="6.2.4 ä»¥å¤ªåŠè´¦æˆ·"></a>6.2.4 ä»¥å¤ªåŠè´¦æˆ·</h3><p>ä»¥å¤ªåŠå­˜åœ¨ä¸¤ç§è´¦æˆ·:</p><ul><li>å¤–éƒ¨è´¦æˆ·EOAï¼šä¸€èˆ¬è‡ªç„¶äººåˆ†é…çš„è´¦æˆ·ï¼Œè¢«<code>ç§é’¥æ§åˆ¶</code>ä¸”æ²¡æœ‰ä»»ä½•ä»£ç ä¸ä¹‹å…³è”</li><li>åˆçº¦è´¦æˆ·CA: ç»™æ™ºèƒ½åˆçº¦åˆ†é…çš„è´¦æˆ·ï¼Œè¢«<code>åˆçº¦ä»£ç æ§åˆ¶</code>ä¸”æœ‰ä»£ç ä¸ä¹‹å…³è”</li></ul><h3 id="6-2-5-æ™ºèƒ½åˆçº¦ä¸EVM"><a href="#6-2-5-æ™ºèƒ½åˆçº¦ä¸EVM" class="headerlink" title="6.2.5 æ™ºèƒ½åˆçº¦ä¸EVM"></a>6.2.5 æ™ºèƒ½åˆçº¦ä¸EVM</h3><p>æ™ºèƒ½åˆçº¦å­˜åœ¨EVMä¸Šï¼Œæ˜¯å¯ä»¥è¢«è§¦å‘æ‰§è¡Œçš„ä¸€æ®µç¨‹åºä»£ç ï¼Œè¿™äº›ä»£ç å®ç°äº†æŸç§é¢„å®šçš„è§„åˆ™ã€‚</p><blockquote><ol><li>åˆçº¦çš„ä»£ç å­˜åœ¨åˆçº¦è´¦æˆ·å’Œå¤–éƒ¨è´¦æˆ·ä¸­</li><li>åˆçº¦ä»£ç åœ¨EVMä¸Šæ‰§è¡Œ</li><li>åˆçº¦çš„åœ°å€ç”Ÿæˆçš„åŒæ—¶éœ€åˆ¤æ–­è´¦æˆ·gasä½™é¢æ˜¯å¦å……è¶³</li><li>è‹¥å……è¶³åˆ™è¿›è¡Œåˆçº¦çš„åˆå§‹åŒ–ï¼Œæ–°å»ºåˆçº¦è´¦æˆ·å’Œåˆçº¦</li><li>åˆçº¦æ‰§è¡Œï¼Œä¼šåŒæ—¶è¿”å›åˆçº¦ä»£ç ã€åœ°å€ã€gasä½™é¢ä¿¡æ¯ï¼›æ— é”™è¯¯è¿”å›å€¼åˆ™è¿”å›æˆåŠŸ</li></ol></blockquote><h3 id="6-2-6-æ™ºèƒ½åˆçº¦çš„è¿è¡Œç¯å¢ƒEVM"><a href="#6-2-6-æ™ºèƒ½åˆçº¦çš„è¿è¡Œç¯å¢ƒEVM" class="headerlink" title="6.2.6 æ™ºèƒ½åˆçº¦çš„è¿è¡Œç¯å¢ƒEVM"></a>6.2.6 æ™ºèƒ½åˆçº¦çš„è¿è¡Œç¯å¢ƒEVM</h3><img src="/posts/48583/41.png"><h2 id="6-3-ä»¥å¤ªåŠEVMçš„è¿è¡ŒåŸç†"><a href="#6-3-ä»¥å¤ªåŠEVMçš„è¿è¡ŒåŸç†" class="headerlink" title="6.3 ä»¥å¤ªåŠEVMçš„è¿è¡ŒåŸç†"></a>6.3 ä»¥å¤ªåŠEVMçš„è¿è¡ŒåŸç†</h2><p>åˆçº¦ä»£ç åœ¨EVMå†…éƒ¨è¿è¡Œï¼Œå¯¹å¤–å®Œå…¨éš”ç¦»ä¸åŒåˆçº¦ä¹‹é—´ä¹Ÿåªæœ‰æœ‰é™çš„è®¿é—®æƒé™</p><p><strong>è¿è¡ŒåŸç†</strong>:æ™ºèƒ½åˆçº¦ä»£ç å‘å¸ƒåˆ°åŒºå—é“¾ä¸Šï¼Œé€šè¿‡äº¤æ˜“è§¦å‘æ™ºèƒ½åˆçº¦åï¼Œå®ƒçš„ä»£ç å°±ä¼šåœ¨EVMä¸Šæ‰§è¡Œã€‚</p><p>å› ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯éƒ½è‡ªå¸¦äº†ä¸€ä¸ªEVMï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼å°±ç›¸å½“äºæŠŠç¨‹åºéƒ¨ç½²åˆ°äº†å¾ˆå¤šç”µè„‘ä¸Šï¼Œéšæ—¶éƒ½å¯ä»¥é€šè¿‡äº¤æ˜“æ¥è§¦å‘ï¼Œä»è€Œä¹Ÿå®Œæˆäº†å»ä¸­å¿ƒåŒ–éƒ¨ç½²å’Œè°ƒç”¨</p><h3 id="6-3-1-æ™ºèƒ½åˆçº¦åœ¨EVMä¸­æ‰§è¡Œçš„æ­¥éª¤"><a href="#6-3-1-æ™ºèƒ½åˆçº¦åœ¨EVMä¸­æ‰§è¡Œçš„æ­¥éª¤" class="headerlink" title="6.3.1 æ™ºèƒ½åˆçº¦åœ¨EVMä¸­æ‰§è¡Œçš„æ­¥éª¤"></a>6.3.1 æ™ºèƒ½åˆçº¦åœ¨EVMä¸­æ‰§è¡Œçš„æ­¥éª¤</h3><ol><li><code>æ™ºèƒ½åˆçº¦çš„æ„å»º</code>: æ™ºèƒ½åˆçº¦ç”±å¤šä¸ªåŒºå—é“¾ç”¨æˆ·å…±åŒå‚ä¸åˆ¶å®šä¸€ä»½æ™ºèƒ½åˆçº¦</li><li><code>æ™ºèƒ½åˆçº¦çš„å­˜å‚¨</code>: æ™ºèƒ½åˆçº¦é€šè¿‡P2Pç½‘ç»œæ‰©æ•£åˆ°æ¯ä¸ªèŠ‚ç‚¹ï¼Œå¹¶å­˜å…¥åŒºå—é“¾</li><li><code>æ™ºèƒ½åˆçº¦çš„æ‰§è¡Œ</code>ï¼šæ™ºèƒ½åˆçº¦å®šæœŸè¿›è¡ŒçŠ¶æ€æ£€æŸ¥ï¼Œå°†æ»¡è¶³æ¡ä»¶çš„äº‹ç‰©è¿›è¡ŒéªŒè¯ï¼Œè¾¾æˆå…±è¯†åè‡ªåŠ¨æ‰§è¡Œå¹¶é€šçŸ¥ç”¨æˆ·</li></ol><h3 id="6-3-2-ä»¥å¤ªåŠå¸¸è§åº”ç”¨-å‘è¡Œä»£å¸"><a href="#6-3-2-ä»¥å¤ªåŠå¸¸è§åº”ç”¨-å‘è¡Œä»£å¸" class="headerlink" title="6.3.2 ä»¥å¤ªåŠå¸¸è§åº”ç”¨-å‘è¡Œä»£å¸"></a>6.3.2 ä»¥å¤ªåŠå¸¸è§åº”ç”¨-å‘è¡Œä»£å¸</h3><p><code>ä»¥å¤ªåŠERC20åè®®</code>æ˜¯ä»¥å¤ªåŠå®šä¹‰çš„ä¸€ä¸ªä»£å¸æ ‡å‡†</p><ol><li><code>ç¼–å†™ä»£å¸åˆçº¦</code>: æŒ‰ç…§ERC20åè®®æ ‡å‡†ï¼Œç¼–å†™åŸºäºERC20åè®®çš„ä»£å¸åˆçº¦ä»£ç </li><li><code>éƒ¨ç½²ä»£å¸åˆçº¦</code>: ä½¿ç”¨ä»¥å¤ªåŠçš„åˆçº¦éƒ¨ç½²å·¥å…·æˆ–æ”¯æŒéƒ¨ç½²ä»£å¸åˆçº¦çš„é’±åŒ…éƒ¨ç½²åˆçº¦</li></ol><p>â€‹    3. <code>æµ‹è¯•äº¤æ˜“</code>: ä½¿ç”¨ æ”¯æŒæ·»åŠ ä»¥å¤ªåŠ çš„ é’±åŒ…ï¼›æ·»åŠ åˆ›å»ºçš„ä»£å¸ï¼Œå¹¶è¿›è¡Œè½¬è´¦æµ‹è¯•ã€‚è½¬è´¦æˆåŠŸåˆ™éƒ¨ç½²æˆåŠŸ</p><h1 id="7-åŒºå—é“¾é’±åŒ…"><a href="#7-åŒºå—é“¾é’±åŒ…" class="headerlink" title="7. åŒºå—é“¾é’±åŒ…"></a>7. åŒºå—é“¾é’±åŒ…</h1><p>åŒºå—é“¾é’±åŒ…æ˜¯<code>å­˜å‚¨ç§é’¥çš„å®¹å™¨</code>ï¼Œå¸¸è§çš„åŒºå—é“¾é’±åŒ…åˆ†ç±»æœ‰:</p><ul><li>æŒ‰<code>æ˜¯å¦è”ç½‘</code>å¯åˆ†ä¸ºå†·é’±åŒ…ã€çƒ­é’±åŒ…</li><li>æŒ‰<code>èŠ‚ç‚¹æ•°æ®æ˜¯å¦å­˜å‚¨å®Œæ•´</code>ï¼Œå¯åˆ†ä¸ºå…¨èŠ‚ç‚¹é’±åŒ…ã€è½»èŠ‚ç‚¹é’±åŒ…</li></ul><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>å†·é’±åŒ…</td><td>æ²¡æœ‰è”ç½‘ä¸‹ä½¿ç”¨è¿‡çš„é’±åŒ…ï¼›å¦‚ï¼šä¸“ä¸šçš„ç¡¬ä»¶é’±åŒ…ã€çº¸é’±åŒ…ï¼›ç›¸å¯¹<code>å®‰å…¨</code>ä½†åˆ›å»ºé’±åŒ…<code>ä¸æ–¹ä¾¿</code>ï¼Œäº¤æ˜“ä¹Ÿå¾ˆ<code>éº»çƒ¦</code></td></tr><tr><td>çƒ­é’±åŒ…</td><td>å¤„äºä¸€ç›´è”ç½‘çŠ¶æ€ä¸‹çš„é’±åŒ…ï¼›å¦‚ï¼šæ‰‹æœºAPPé’±åŒ…ï¼Œç½‘é¡µé’±åŒ…ï¼Œç”µè„‘å®¢æˆ·ç«¯é’±åŒ…ï¼›ä½¿ç”¨<code>æ–¹ä¾¿äº¤æ˜“è½¬è´¦æ•ˆç‡é«˜</code>ä½†å°±æ˜¯<code>å®¹æ˜“å—é»‘å®¢æ”»å‡»æˆ–æ˜¯è¢«é’“é±¼ç½‘ç«™çªƒå–ç§é’¥</code></td></tr><tr><td>å…¨èŠ‚ç‚¹é’±åŒ…</td><td>å°±æ˜¯<code>åŒæ­¥äº†äº†åŒºå—é“¾ä¸Šæ‰€æœ‰èŠ‚ç‚¹æ•°æ®</code>;å¯ä»¥å‚ä¸åˆ°ç½‘ç»œæ•°æ®çš„ç»´æŠ¤ä¸­ï¼Œ<code>æ›´éšç§˜ã€éªŒè¯æ›´å¿«</code>;ä½†éœ€è¦å æ®æ›´å¤§çš„ç¡¬ç›˜ç©ºé—´</td></tr><tr><td>è½»èŠ‚ç‚¹é’±åŒ…</td><td>ä¸å­˜å‚¨å®Œæ•´çš„åŒºå—é“¾æ•°æ®ï¼Œå°±æ˜¯ä¹Ÿä¼šä¸‹è½½æ–°åŒºå—çš„æ‰€æœ‰æ•°æ®ä½†æ˜¯ä¼šå¯¹æ•°æ®è¿›è¡Œåˆ†æåï¼Œ<code>ä»…è·å–å¹¶åœ¨æœ¬åœ°å­˜å‚¨ä¸è‡ªèº«ç›¸å…³çš„äº¤æ˜“æ•°æ®</code>,è¿è¡Œæ—¶ä¾èµ–æ¯”ç‰¹å¸ç½‘ç»œä¸Šå…¶ä»–å…¨èŠ‚ç‚¹ï¼Œå¯åœ¨æ‰‹æœºç«¯ç½‘é¡µç«¯ç­‰è¿è¡Œ</td></tr></tbody></table><h2 id="7-1-å·¥ä½œæ­¥éª¤"><a href="#7-1-å·¥ä½œæ­¥éª¤" class="headerlink" title="7.1 å·¥ä½œæ­¥éª¤"></a>7.1 å·¥ä½œæ­¥éª¤</h2><ol><li><p><code>è´¦æˆ·ç”Ÿæˆ</code>: å¡«å†™è´¦æˆ·åç§°ç”Ÿæˆ ç§é’¥å’Œè´¦æˆ·åœ°å€</p></li><li><p><code>è´¦æˆ·è¯´æ˜</code>: ç”Ÿæˆè´¦æˆ·åï¼Œå¯ä»¥çœ‹åˆ°è´¦æˆ·åœ°å€åŠç§é’¥</p></li><li><p><code>äº¤æ˜“çš„å‘èµ·</code>: å‘èµ·è½¬è´¦ï¼Œå³å¯ç”Ÿæˆä¸€ç¬”äº¤æ˜“</p></li><li><p><code>äº¤æ˜“çš„è¿‡ç¨‹</code>: è¾“å…¥æ‰€è½¬è´¦çš„ç”¨æˆ·åœ°å€åŠè½¬è´¦æ•°é‡ï¼Œä¼šæœ‰æ‰‹ç»­è´¹10</p></li><li><p><code>äº¤æ˜“çš„å®Œæˆ</code>ï¼š è¾“å…¥å½“å‰è´¦æˆ·ç§é’¥ï¼Œç‚¹å‡»æäº¤å³å®Œæˆäº†ä¸€ç¬”äº¤æ˜“çš„ç”Ÿæˆ</p></li><li><p><code>äº¤æ˜“çš„å¹¿æ’­</code>ï¼š ä¸€ç¬”äº¤æ˜“ç”Ÿæˆåï¼Œåœ¨äº¤æ˜“è®°å½•ä¸­çš„çŠ¶æ€ä¸ºâ€œå¾…ç¡®è®¤â€ï¼Œè¿™æ˜¯è¯¥èŠ‚ç‚¹ä¼šç«‹å³å‘é™„è¿‘çš„èŠ‚ç‚¹è¿›è¡Œå¹¿æ’­ï¼Œé™„è¿‘çš„èŠ‚ç‚¹ä¼šéªŒè¯äº¤æ˜“æ˜¯å¦æœ‰æ•ˆï¼Œå¦‚æœæœ‰æ•ˆè¡¨ç¤ºä»–ä»¬åŒæ„è¿™æ¬¡äº¤æ˜“</p></li><li><p><code>äº¤æ˜“çš„éªŒè¯ä¸è®°å½•</code>: éªŒè¯é€šè¿‡åï¼Œä¼šè¢«è®°å½•åœ¨åŒºå—é“¾ä¸Šï¼Œæ­¤æ—¶çŠ¶æ€ä¸ºæˆåŠŸ</p></li></ol><h1 id="8-åŒºå—é“¾æµè§ˆå™¨"><a href="#8-åŒºå—é“¾æµè§ˆå™¨" class="headerlink" title="8. åŒºå—é“¾æµè§ˆå™¨"></a>8. åŒºå—é“¾æµè§ˆå™¨</h1><img src="/posts/48583/42.png"><ul><li><p>åŒºå—é“¾æµè§ˆå™¨ï¼Œå°±æ˜¯åŒºå—é“¾æŠ€æœ¯çš„å¯è§†åŒ–ï¼Œæ˜¯ä¸€ä¸ªæœç´¢å·¥å…·ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç½‘ç«™ï¼Œä¸“é—¨ä¸ºç”¨æˆ·<code>æä¾›æµè§ˆå’ŒæŸ¥è¯¢åŒºå—é“¾ä¸Šçš„ä¿¡æ¯0</code></p></li><li><p>åŸºäºåŒºå—é“¾å…¬å¼€é€æ˜çš„ç‰¹è´¨ï¼Œå®ƒéœ€è¦é€šè¿‡åŒºå—é“¾æµè§ˆå™¨è®©ç”¨æˆ·çœ‹åˆ°é“¾ä¸Šçš„æƒ…å†µï¼Œæ¯”å¦‚æŸç¬”äº¤æ˜“ï¼ŒæŸå—åŒºå—ï¼Œå½“å‰é“¾é«˜ï¼Œåªéœ€è¦è¾“å…¥æŸé’±åŒ…åœ°å€æˆ–è€…æŸç¬”äº¤æ˜“IDï¼Œå³å¯æŸ¥è¯¢å®ƒä»¬è¯¦ç»†ä¿¡æ¯</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> åŒºå—é“¾å­¦ä¹ ä¹‹è·¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åŒºå—é“¾æ¦‚å¿µè®¤çŸ¥--åˆæ­¥è®¤è¯†åŒºå—é“¾</title>
      <link href="/posts/45753.html"/>
      <url>/posts/45753.html</url>
      
        <content type="html"><![CDATA[<p>ä»è¿™ç¯‡è¿›å…¥åŒºå—é“¾ä¸–ç•Œï¼Œåˆæ­¥è®¤è¯†åŒºå—é“¾â€¦â€¦</p><p>åŒºå—é“¾çš„æ¦‚å¿µè®¤çŸ¥ï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº†</p><h1 id="1-åˆæ­¥è®¤è¯†åŒºå—é“¾"><a href="#1-åˆæ­¥è®¤è¯†åŒºå—é“¾" class="headerlink" title="1. åˆæ­¥è®¤è¯†åŒºå—é“¾"></a>1. åˆæ­¥è®¤è¯†åŒºå—é“¾</h1><h2 id="1-ä»æŠ€æœ¯è§†è§’çœ‹åŒºå—é“¾"><a href="#1-ä»æŠ€æœ¯è§†è§’çœ‹åŒºå—é“¾" class="headerlink" title="1. ä»æŠ€æœ¯è§†è§’çœ‹åŒºå—é“¾"></a>1. ä»æŠ€æœ¯è§†è§’çœ‹åŒºå—é“¾</h2><p>â–  åŒºå—é“¾æ˜¯ä½¿ç”¨<code>å¯†ç æŠ€æœ¯</code>é“¾æ¥å°†<code>å…±è¯†ç¡®è®¤</code>è¿‡çš„åŒºå—<code>æŒ‰é¡ºåºè¿½åŠ </code>è€Œå½¢æˆçš„åˆ†å¸ƒå¼è´¦æœ¬ã€‚</p><p>â–  åŒºå—é“¾æ˜¯ä¸€ç§<code>å¤šæ–¹å…±åŒç»´æŠ¤</code>ï¼Œä½¿ç”¨<code>å¯†ç å­¦</code>ä¿è¯ä¼ è¾“å’Œè®¿é—®å®‰å…¨ï¼Œèƒ½å¤Ÿå®ç°æ•°æ®<code>ä¸€è‡´ä¼ è¾“</code>ã€<code>éš¾ä»¥ç¯¡æ”¹</code>ã€<code>é˜²æ­¢æŠµèµ–</code>çš„<code>è®°è´¦æŠ€æœ¯</code>ï¼Œä¹Ÿç§°ä¸º<code>åˆ†å¸ƒå¼è´¦æœ¬æŠ€æœ¯</code></p><blockquote><p><em>ä¸ªäººç†è§£</em>ï¼šåŒºå—é“¾å°±æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼è´¦æœ¬ç³»ç»Ÿã€‚é‡‡ç”¨å¯†ç å­¦ï¼Œå…±è¯†ç®—æ³•ç­‰æŠ€æœ¯æ¥å®ç°è¿™ä¸ªè´¦æœ¬çš„å®‰å…¨ä¸çœŸå®æ€§,ç»´æŠ¤è¿™ä¸ªè´¦æœ¬æ­£å¸¸è¿è¡Œ</p></blockquote><p>æ„ä¹‰ï¼šè¿™ä¸ªè®°è´¦æ–¹å¼ï¼Œè®©ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…ï¼ŒæŠ•èµ„è€…ï¼Œå‚ä¸è€…åˆä¸ºä¸€ä½“ï¼Œå»æ‰ä¸­é—´çš„ä¼ å¯¼ç¯èŠ‚ï¼Œæ”¹å˜äº†ç¤¾ä¼šç”Ÿäº§å…³ç³»å’Œä»·å€¼çš„åˆ†é…æ¨¡å¼.</p><h2 id="2-åŒºå—é“¾çš„äº”ç±»åŸºç¡€æŠ€æœ¯"><a href="#2-åŒºå—é“¾çš„äº”ç±»åŸºç¡€æŠ€æœ¯" class="headerlink" title="2. åŒºå—é“¾çš„äº”ç±»åŸºç¡€æŠ€æœ¯"></a>2. åŒºå—é“¾çš„äº”ç±»åŸºç¡€æŠ€æœ¯</h2><ul><li>å¯†ç æŠ€æœ¯ï¼šè§£å†³æ•°æ®å®‰å…¨</li><li>ç‚¹å¯¹ç‚¹äº¤æ˜“(p2p)æŠ€æœ¯: è§£å†³äº¤æ˜“å¯ä¿¡</li><li>åˆ†å¸ƒå¼å­˜å‚¨æŠ€æœ¯: è§£å†³æ•°æ®å¤šç‚¹å­˜å‚¨</li><li>å…±è¯†æŠ€æœ¯: è§£å†³æ•°æ®å†™å…¥çš„ä¸€è‡´æ€§</li><li>æ™ºèƒ½åˆçº¦æŠ€æœ¯: è§£å†³æ•°æ®è¯»å†™è§„åˆ™å›ºåŒ–</li></ul><blockquote><p><em>è¡¥å……ç†è§£</em>  : </p><ol><li><p>åŒºå—é“¾æŠ€æœ¯å®ç°æ•°æ®çš„ç‚¹å¯¹ç‚¹ä¼ è¾“,åŒæ–¹ç›´æ¥å»ºç«‹ä¿¡ä»»,ç›‘ç®¡ï¼Œæ²¡æœ‰å±‚å±‚å®¡è®¡ï¼Œå¹¶ä¸”æ•´ä¸ªè¿‡ç¨‹çš„ä¿¡æ¯ä¸å¯è¢«ç¯¡æ”¹ï¼Œä¹Ÿæ˜¯åŒ¿åäº¤æ˜“ã€‚</p></li><li><p>åœ¨ä½¿ç”¨æ¯”ç‰¹å¸è¿›è¡Œæç°ã€è½¬è´¦çš„æ—¶å€™ï¼Œåªéœ€è¦çŸ¥é“å¯¹æ–¹çš„åœ°å€ï¼Œå°±å¯ä»¥ç›´æ¥è¿›è¡Œæ”¯ä»˜ã€‚è€Œä¸éœ€è¦ç»è¿‡ä¸€ä¸ªä¸­å¿ƒåŒ–çš„æœºæ„çš„å®¡æ ¸æˆ–æ§åˆ¶ã€‚</p></li><li><p>æ¯”ç‰¹å¸ç»æµä½¿ç”¨æ•´ä¸ªP2Pç½‘ç»œæ¥ç¡®è®¤å¹¶è®°å½•æ‰€æœ‰çš„äº¤æ˜“è¡Œä¸ºï¼Œå¹¶ä½¿ç”¨å¯†ç å­¦çš„è®¾è®¡æ¥ç¡®ä¿è´§å¸æµé€šå„ä¸ªç¯èŠ‚å®‰å…¨æ€§ã€‚</p></li><li><p>åˆ†å¸ƒå¼å­˜å‚¨æ˜¯ä¸€ç§æ•°æ®å­˜å‚¨æŠ€æœ¯ï¼Œå®ƒé€šè¿‡ç½‘ç»œä½¿ç”¨ä¼ä¸šä¸­æ¯å°æœºå™¨ä¸Šçš„ç£ç›˜ç©ºé—´ï¼Œè¿™äº›åˆ†æ•£çš„å­˜å‚¨èµ„æºæ„æˆäº†è™šæ‹Ÿå­˜å‚¨è®¾å¤‡ï¼Œæ•°æ®åˆ†å¸ƒå­˜å‚¨åœ¨ä¼ä¸šçš„å„ä¸ªè§’è½ã€‚</p></li><li><p>å…±è¯†æœºåˆ¶ä¸æ˜¯è§£å†³å¯¹ç½‘ç»œé‡Œé¢çš„æ˜¯éçš„åˆ¤æ–­ï¼Œè€Œæ˜¯è¯´å½“æˆ‘åœ¨ç½‘ç»œä¸­å‘ç”Ÿäº†ä¸¤ä¸ªå¯èƒ½ä¼šäº§ç”Ÿå†²çªçš„äº¤æ˜“æ—¶å€™ï¼Œæˆ‘å»é€‰æ‹©å“ªä¸€ä¸ªï¼Œæˆ–è€…å†æ¢ä¸€å¥è¯è¯´ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªäº‹å®éƒ½æ˜¯å¯ä»¥æˆç«‹çš„æ—¶å€™ï¼Œå»é€‰æ‹©å“ªä¸€ä¸ªï¼Œè¿™æ˜¯ä¸€ä¸ªå†³ç­–çš„æœºåˆ¶ï¼Œè€Œä¸æ˜¯åˆ¤æ–­æ˜¯éçš„æœºåˆ¶ã€‚</p></li></ol></blockquote><p><code>ä¸ªäººæ€»ç»“</code>:</p><ol><li><p>åŒºå—é“¾çš„ç‚¹å¯¹ç‚¹æŠ€æœ¯ï¼Œç®€å•æ¥è®²ï¼Œå°±æ˜¯ç”¨æˆ·ä¹‹é—´å¯ä»¥ç›´æ¥è¿›è¡Œè½¬è´¦å’Œäº¤æ˜“ï¼Œä¸éœ€è¦ç»è¿‡ä¸­é—´æœºæ„çš„ç¡®è®¤å’Œæˆæƒã€‚</p></li><li><p>åˆ†å¸ƒå¼å­˜å‚¨å°±æ˜¯å®ç°å»ä¸­å¿ƒçš„å­˜å‚¨ï¼Œè¿™æ ·å°±è§£å†³äº†ä¼ä¸šå’Œç”¨æˆ·å¯¹æ•°æ®çš„ä¸å¯¹ç­‰æƒåŠ›ã€‚</p></li><li><p>å…±è¯†ç®—æ³•çš„ä½œç”¨å°±æ˜¯è§£å†³åŒºå—é“¾è®°è´¦é—®é¢˜çš„æ‰€æœ‰èŠ‚ç‚¹å¯¹è´¦ç›®è¾¾æˆä¸€è‡´ã€‚</p></li><li><p>ä½†è¾¾åˆ°ä¸€è‡´å¾ˆéš¾ï¼Œå¯èƒ½ä¼šæœ‰æŸäº›æ¶æ„èŠ‚ç‚¹ï¼Œå‘é€è™šå‡é”™è¯¯ä¿¡æ¯ï¼Œè¿˜å¯èƒ½æ˜¯æœåŠ¡å™¨ï¼Œæ¶ˆæ¯å»¶è¿Ÿç­‰åŸå› </p></li></ol><p>===================================================</p><p><code>é—®é¢˜è§è§£</code>:</p><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token code keyword">    1. åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿçš„è®¾è®¡ä¸»è¦è§£å†³ä¸‰ä¸ªé—®é¢˜ï¼šæ–‡ä»¶å¦‚ä½•å®‰å…¨æ”¾å…¥ï¼›æ–‡ä»¶å¦‚ä½•å®‰å…¨å­˜å‚¨ï¼›æ–‡ä»¶å¦‚ä½•ä¸è¢«å­˜å‚¨æä¾›æ–¹ã€‚     </span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li><p>æ ¹æ®ä¸åŒåœºæ™¯é€‰æ‹©ä¸åŒçš„å…±è¯†ç®—æ³•:</p><p>â€‹      a.  <strong>ç§æœ‰é“¾</strong>: ç”±äºæ˜¯ä¼ä¸šå†…éƒ¨éƒ¨ç½²çš„åŒºå—é“¾åº”ç”¨ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯å¯ä»¥è§†ä¸ºä¿¡ä»»çš„ä¸”æ— éœ€ä»£å¸æ¿€åŠ±æœºåˆ¶ï¼Œæ‰€ä»¥é€šå¸¸é€‰æ‹©<code>å®¹é”™æ€§ä½ã€æ€§èƒ½æ•ˆç‡é«˜ã€æ— éœ€ä»£å¸</code>çš„ç®—æ³•,å¦‚Paxosï¼ŒRaft</p><p>â€‹       b.  <strong>è”ç›Ÿé“¾</strong>ï¼š ç”±ä¸åŒçš„æœºæ„èŠ‚ç‚¹ç»„æˆï¼Œç½‘ç»œèŠ‚ç‚¹è§„æ¨¡å¯æ§ï¼Œå†…éƒ¨å­˜åœ¨ä¸å¯¹ç­‰ä¿¡ä»»çš„èŠ‚ç‚¹ä¸”æ— éœ€æ¿€åŠ±æœºåˆ¶ï¼Œæ‰€ä»¥é€šå¸¸é€‰æ‹©å®¹ç®—æ€§ä¸æ€§èƒ½æ•ˆç‡é€‚ä¸­ã€æ— éœ€ä»£å¸çš„ç®—æ³•ï¼Œå¦‚å®ç”¨æ‹œå åº­å®¹é”™ç®—æ³•ç­‰</p><p>â€‹       c. <strong>å…¬æœ‰é“¾</strong>: ä»»æ„èŠ‚ç‚¹å¯ä»¥éšä¾¿åŠ å…¥æˆ–è€…é€€å‡ºï¼Œå„ç§æ•…éšœé€šå¸¸éƒ½è¦è€ƒè™‘ï¼Œå¸Œæœ›æ‰€æœ‰èŠ‚ç‚¹å°½é‡æ‹¥æœ‰å¹³ç­‰çš„æƒåŠ›å¹¶ä¸”éœ€è¦å¼•å…¥ä»£å¸æ¿€åŠ±æœºåˆ¶ï¼Œæ‰€ä»¥é€šå¸¸é€‰æ‹©å®¹é”™æ€§è¾ƒé«˜ã€æ—¶é—´æ•ˆç‡è¾ƒä½ä¸”å…·æœ‰ä»£å¸æ¿€åŠ±æœºåˆ¶çš„ç®—æ³•ï¼Œå¦‚å·¥ä½œé‡è¯æ˜ã€æƒç›Šè¯æ˜ä¸è‚¡ä»½æˆæƒè¯æ˜ç­‰ã€‚</p></li></ol><h2 id="3-åŒºå—é“¾è®°è´¦çš„ä¸»è¦ç‰¹å¾"><a href="#3-åŒºå—é“¾è®°è´¦çš„ä¸»è¦ç‰¹å¾" class="headerlink" title="3. åŒºå—é“¾è®°è´¦çš„ä¸»è¦ç‰¹å¾"></a>3. åŒºå—é“¾è®°è´¦çš„ä¸»è¦ç‰¹å¾</h2><img src="/posts/45753/01.png"><ul><li><strong>å¤šæ–¹è®°è´¦</strong>: ä¸æ˜¯é›†ä¸­å¼è®°è´¦ï¼Œæ˜¯åˆ†å¸ƒå¼å¤šæ–¹å…±è¯†å…±äº«è®°è´¦</li><li><strong>åŠ å¯†å­˜å‚¨</strong>ï¼šä½¿ç”¨å¯†ç å­¦æŠ€æœ¯ï¼ŒåŠ å¯†çš„ä¼ è¾“ä¸å­˜å‚¨</li><li><strong>éš¾ä»¥ç¯¡æ”¹</strong>: æœ‰åŠ å¯†/æ—¶é—´æˆ³ï¼Œå†…éƒ¨è®°è´¦äººä¸èƒ½æ”¹ï¼Œå¤–éƒ¨ç½‘ç»œæ”»å‡»éš¾å¥æ•ˆ</li><li><strong>ä¸å¯æŠµèµ–</strong>ï¼šæœ‰åŠ å¯†/æ—¶é—´æˆ³ï¼Œè¯ä¹¦/ç§é’¥å”¯ä¸€ï¼Œæ•°æ®æ“ä½œæƒå”¯ä¸€</li><li><strong>å¯ä¿¡æº¯æº</strong>: è¿ç»­æ•°æ®ç›¸äº’å°è¯ï¼Œæä¾›å¯ä¿¡æ•°æ®æœåŠ¡ï¼Œé™Œç”Ÿäººå¯ä¿¡</li><li><strong>å»ä¸­ä»‹</strong>: å®ç°ç”Ÿæ€ç³»ç»Ÿä¸­å»ä¸­ä»‹ï¼Œæ”¹å˜ã€ç»„ç»‡+å²—ä½ã€‘</li><li><strong>å¼ºåˆ¶æ‰§è¡Œ</strong>ï¼šä¸šåŠ¡è§„åˆ™å›ºåŒ–åœ¨æ™ºèƒ½åˆçº¦ä¸­ï¼ŒæƒåŠ›å…³è¿›åˆ¶åº¦ç¬¼å­ï¼Œä¿æŠ¤éšç§</li></ul><p><code>åŠ å¼ºç†è§£</code>: </p><ol><li><p>åŒºå—é“¾è´¦æœ¬ï¼Œå°±æ˜¯åœ¨æ¯æ¡è®°å½•ä¸­æ·»åŠ äº†ä¸€ä¸ªç­¾åï¼Œè¿™ä¸ªç­¾åå°±å¯ä»¥å®ç°<strong>é˜²ä¼ªé€ </strong>ï¼Œ<strong>é˜²ç¯¡æ”¹</strong>ï¼Œ<strong>ä¿å¯†æ€§é«˜</strong>ï¼Œ<strong>èº«ä»½ç¡®è®¤</strong>ç‰¹ç‚¹</p><ol start="2"><li><p>åŒºå—é“¾ç½‘ç»œä¸­çš„æ¯ä¸ªè®¾å¤‡éƒ½ç»´æŠ¤äº†ä¸€ä¸ªå®Œæ•´ä¸”ç›¸åŒçš„è´¦æœ¬ã€‚<br>å°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ€»å¸æœ¬åœ¨æ¯ä¸ªè®¡ç®—æœºéƒ½ä¿ç•™äº†ä¸€ä»½ï¼ŒåŒæ—¶æ¯ä¸€ä»½éƒ½          æ˜¯ä¸€æ‘¸ä¸€æ ·çš„ï¼Œè¿™å°±å¯ä»¥ä¿è¯ä¸€ä»½è´¦æœ¬è¢«ç ´åäº†ï¼ˆç£ç›˜æŸåæˆ–<br>è¢«äººç¯¡æ”¹å¯¼è‡´ä¸å¯ç”¨ï¼‰ï¼Œå…¶ä»–æœºå™¨ä¸Šçš„è´¦æœ¬è¿˜æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œç¡®          ä¿äº†æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚</p></li><li><p>è¿™äº›ç‰¹ç‚¹ï¼Œå°±æ˜¯åŒºå—é“¾èƒ½å¤Ÿå»ºç«‹ä¿¡ä»»å…³ç³»çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œå®ƒä¿è¯äº†æ•°æ®æ˜¯å¯é çš„ä¸å¯ç¯¡æ”¹çš„ï¼Œå°±å®ç°äº†ä¸¤ä¸ªé™Œç”Ÿäººä¹‹é—´çš„ä¿¡ä»»ä¼ é€’ä¸éœ€è¦ä¸­é—´æœºæ„çš„å‚ä¸ï¼Œ</p></li></ol></li></ol><h2 id="4-ä¸‰ä¸ªæ–¹é¢ç†è§£åŒºå—é“¾æ•°æ®çš„éš¾ä»¥ç¯¡æ”¹"><a href="#4-ä¸‰ä¸ªæ–¹é¢ç†è§£åŒºå—é“¾æ•°æ®çš„éš¾ä»¥ç¯¡æ”¹" class="headerlink" title="4. ä¸‰ä¸ªæ–¹é¢ç†è§£åŒºå—é“¾æ•°æ®çš„éš¾ä»¥ç¯¡æ”¹"></a>4. ä¸‰ä¸ªæ–¹é¢ç†è§£åŒºå—é“¾æ•°æ®çš„éš¾ä»¥ç¯¡æ”¹</h2><img src="/posts/45753/02.png"><h3 id="4-1-éš¾ä»¥ç¯¡æ”¹çš„ä¿¡ä»»å®ç°"><a href="#4-1-éš¾ä»¥ç¯¡æ”¹çš„ä¿¡ä»»å®ç°" class="headerlink" title="4.1 éš¾ä»¥ç¯¡æ”¹çš„ä¿¡ä»»å®ç°"></a>4.1 éš¾ä»¥ç¯¡æ”¹çš„ä¿¡ä»»å®ç°</h3><img src="/posts/45753/03.png"><p>å¦‚æœè¦è®©åˆ«äººç›¸ä¿¡ä½ çš„åŒºå—é“¾æ•°æ®éš¾ä»¥ç¯¡æ”¹ï¼Œåˆ™åŒºå—è¦æœ‰æ•°æ®èŠ‚ç‚¹ï¼Œå’Œè®¸å¯é“¾ï¼Œå…¬æœ‰é“¾ç­‰ã€‚</p><h2 id="5-åŒºå—é“¾è®°è´¦ä¸ä¼ ç»Ÿè®°è´¦å·®å¼‚"><a href="#5-åŒºå—é“¾è®°è´¦ä¸ä¼ ç»Ÿè®°è´¦å·®å¼‚" class="headerlink" title="5. åŒºå—é“¾è®°è´¦ä¸ä¼ ç»Ÿè®°è´¦å·®å¼‚"></a>5. åŒºå—é“¾è®°è´¦ä¸ä¼ ç»Ÿè®°è´¦å·®å¼‚</h2><img src="/posts/45753/04.png"><h3 id="5-1-åŒºå—é“¾è®°è´¦æ˜¯åœ¨ç¤¾åŒºç½‘ç»œä¹‹ä¸Š"><a href="#5-1-åŒºå—é“¾è®°è´¦æ˜¯åœ¨ç¤¾åŒºç½‘ç»œä¹‹ä¸Š" class="headerlink" title="5.1 åŒºå—é“¾è®°è´¦æ˜¯åœ¨ç¤¾åŒºç½‘ç»œä¹‹ä¸Š"></a>5.1 åŒºå—é“¾è®°è´¦æ˜¯åœ¨ç¤¾åŒºç½‘ç»œä¹‹ä¸Š</h3><img src="/posts/45753/05.png"><h2 id="6-â€œä¸­å¿ƒåŒ–â€-gt-â€œå»ä¸­å¿ƒåŒ–â€-gt-â€œå¤šä¸­å¿ƒ-â€œ"><a href="#6-â€œä¸­å¿ƒåŒ–â€-gt-â€œå»ä¸­å¿ƒåŒ–â€-gt-â€œå¤šä¸­å¿ƒ-â€œ" class="headerlink" title="6. â€œä¸­å¿ƒåŒ–â€ -&gt; â€œå»ä¸­å¿ƒåŒ–â€ -&gt; â€œå¤šä¸­å¿ƒ â€œ"></a>6. â€œä¸­å¿ƒåŒ–â€ -&gt; â€œå»ä¸­å¿ƒåŒ–â€ -&gt; â€œå¤šä¸­å¿ƒ â€œ</h2><img src="/posts/45753/06.png"><h1 id="2-åŒºå—é“¾å‘å±•å†ç¨‹ä¸è¶‹åŠ¿"><a href="#2-åŒºå—é“¾å‘å±•å†ç¨‹ä¸è¶‹åŠ¿" class="headerlink" title="2. åŒºå—é“¾å‘å±•å†ç¨‹ä¸è¶‹åŠ¿"></a>2. åŒºå—é“¾å‘å±•å†ç¨‹ä¸è¶‹åŠ¿</h1><h2 id="2-1-åŒºå—é“¾çš„èµ·æº"><a href="#2-1-åŒºå—é“¾çš„èµ·æº" class="headerlink" title="2.1 åŒºå—é“¾çš„èµ·æº"></a>2.1 åŒºå—é“¾çš„èµ·æº</h2><p>â€‹     åŒºå—é“¾æŠ€æœ¯èµ·æºäºåŒ–åä¸º<code>ä¸­æœ¬èª</code>,åœ¨<code>2008</code>å¹´å‘è¡¨çš„å¥ åŸºæ€§è®ºæ–‡<code>ã€Šæ¯”ç‰¹å¸ä¸€ç§ç‚¹å¯¹ç‚¹ç”µå­ç°é‡‘ç³»ç»Ÿã€‹</code>;</p><p>â€‹     åŒºå—é“¾æœ¬è´¨æ˜¯æ•´åˆäº† é“¾å¼æ•°æ®ç»“æ„ã€åˆ†å¸ƒå¼å­˜å‚¨ã€åŠ å¯†ç®—æ³•ã€å…±è¯†æœºåˆ¶ç­‰å¤šé¡¹æŠ€æœ¯.</p><p><code>å…·ä½“ç†è§£</code>:</p><table><thead><tr><th>æŠ€æœ¯</th><th align="left">ç”¨å¤„</th></tr></thead><tbody><tr><td>å—é“¾å¼æ•°æ®ç»“æ„</td><td align="left">éªŒè¯ä¸å­˜å‚¨æ•°æ®</td></tr><tr><td>åˆ†å¸ƒå¼èŠ‚ç‚¹+å…±è¯†ç®—æ³•</td><td align="left">ç”Ÿæˆå’Œæ›´æ–°æ•°æ®</td></tr><tr><td>å¯†ç å­¦</td><td align="left">ä¿è¯æ•°æ®ä¼ è¾“å’Œè®¿é—®å®‰å…¨</td></tr><tr><td></td><td align="left"></td></tr></tbody></table><p><code>è¿™å¥è¯æœ‰ç‚¹éš¾ç†è§£</code>:</p><p>  åˆ©ç”¨ç”± è‡ªåŠ¨åŒ–è„šæœ¬ä»£ç ç»„æˆçš„æ™ºèƒ½åˆçº¦ æ¥æ“ä½œæ•°æ®çš„ä¸€ç§å…¨æ–°çš„åˆ†å¸ƒå¼åŸºç¡€ç»“æ„å’Œè®¡ç®—èŒƒå¼</p><h2 id="2-1åŒºå—é“¾çš„å‘å±•å†ç¨‹"><a href="#2-1åŒºå—é“¾çš„å‘å±•å†ç¨‹" class="headerlink" title="2.1åŒºå—é“¾çš„å‘å±•å†ç¨‹"></a>2.1åŒºå—é“¾çš„å‘å±•å†ç¨‹</h2><img src="/posts/45753/07.png"><h2 id="2-2-åŒºå—é“¾å¯åº”ç”¨äºâ€œè™šæ‹Ÿå¸â€ä¹‹å¤–çš„è¡Œä¸šåˆ›æ–°"><a href="#2-2-åŒºå—é“¾å¯åº”ç”¨äºâ€œè™šæ‹Ÿå¸â€ä¹‹å¤–çš„è¡Œä¸šåˆ›æ–°" class="headerlink" title="2.2 åŒºå—é“¾å¯åº”ç”¨äºâ€œè™šæ‹Ÿå¸â€ä¹‹å¤–çš„è¡Œä¸šåˆ›æ–°"></a>2.2 åŒºå—é“¾å¯åº”ç”¨äºâ€œè™šæ‹Ÿå¸â€ä¹‹å¤–çš„è¡Œä¸šåˆ›æ–°</h2><img src="/posts/45753/08.png"><h2 id="2-3-é¢å‘äº§ä¸šä¼ä¸šçš„è¶…çº§è´¦æœ¬"><a href="#2-3-é¢å‘äº§ä¸šä¼ä¸šçš„è¶…çº§è´¦æœ¬" class="headerlink" title="2.3 é¢å‘äº§ä¸šä¼ä¸šçš„è¶…çº§è´¦æœ¬"></a>2.3 é¢å‘äº§ä¸šä¼ä¸šçš„è¶…çº§è´¦æœ¬</h2><img src="/posts/45753/09.png"><h1 id="3-è®¤è¯†åŒºå—é“¾æŠ€æœ¯"><a href="#3-è®¤è¯†åŒºå—é“¾æŠ€æœ¯" class="headerlink" title="3. è®¤è¯†åŒºå—é“¾æŠ€æœ¯"></a>3. è®¤è¯†åŒºå—é“¾æŠ€æœ¯</h1><h2 id="3-1-ä»ä¹ è¿‘å¹³è®²è¯è®¤è¯†åŒºå—é“¾"><a href="#3-1-ä»ä¹ è¿‘å¹³è®²è¯è®¤è¯†åŒºå—é“¾" class="headerlink" title="3.1 ä»ä¹ è¿‘å¹³è®²è¯è®¤è¯†åŒºå—é“¾"></a>3.1 ä»ä¹ è¿‘å¹³è®²è¯è®¤è¯†åŒºå—é“¾</h2><img src="/posts/45753/10.png"><h2 id="3-2-åŒºå—é“¾çš„åº”ç”¨"><a href="#3-2-åŒºå—é“¾çš„åº”ç”¨" class="headerlink" title="3.2 åŒºå—é“¾çš„åº”ç”¨"></a>3.2 åŒºå—é“¾çš„åº”ç”¨</h2><img src="/posts/45753/11.png"><h2 id="3-3-åŒºå—é“¾æŠ€æœ¯æ˜¯é›†æˆæ–¹æ¡ˆæŠ€æœ¯"><a href="#3-3-åŒºå—é“¾æŠ€æœ¯æ˜¯é›†æˆæ–¹æ¡ˆæŠ€æœ¯" class="headerlink" title="3.3 åŒºå—é“¾æŠ€æœ¯æ˜¯é›†æˆæ–¹æ¡ˆæŠ€æœ¯"></a>3.3 åŒºå—é“¾æŠ€æœ¯æ˜¯é›†æˆæ–¹æ¡ˆæŠ€æœ¯</h2><p>åŒºå—é“¾æŠ€æœ¯æœ¬èº«ä¸æ˜¯å…¨æ–°çš„æŠ€æœ¯ï¼Œè€Œæ˜¯ä½œä¸ºä¸€ç³»åˆ—<code>å„ç±»æŠ€æœ¯é›†æˆèåˆåº”ç”¨</code>çš„<code>æ¨¡å¼åˆ›æ–°</code>.</p><img src="/posts/45753/12.png"><h2 id="3-4-åŒºå—é“¾è®°è´¦ï¼Œåœ¨å‰å°æ— æ³•æ„ŸçŸ¥"><a href="#3-4-åŒºå—é“¾è®°è´¦ï¼Œåœ¨å‰å°æ— æ³•æ„ŸçŸ¥" class="headerlink" title="3.4 åŒºå—é“¾è®°è´¦ï¼Œåœ¨å‰å°æ— æ³•æ„ŸçŸ¥"></a>3.4 åŒºå—é“¾è®°è´¦ï¼Œåœ¨å‰å°æ— æ³•æ„ŸçŸ¥</h2><p>åŒºå—é“¾è®°è´¦æ˜¯åå°æ•°æ®åº“çš„äº‹ï¼Œä»å‰å°çš„ä¸šåŠ¡æ“ä½œä¸Šæ— æ³•æ„ŸçŸ¥</p><h2 id="3-5-æœªæ¥ä¼ä¸šçš„æ•°æ®å­˜å‚¨æ¨¡å¼"><a href="#3-5-æœªæ¥ä¼ä¸šçš„æ•°æ®å­˜å‚¨æ¨¡å¼" class="headerlink" title="3.5 æœªæ¥ä¼ä¸šçš„æ•°æ®å­˜å‚¨æ¨¡å¼"></a>3.5 æœªæ¥ä¼ä¸šçš„æ•°æ®å­˜å‚¨æ¨¡å¼</h2><p><code>ä¸­å¿ƒåŒ–å­˜å‚¨</code>+<code>åˆ†å¸ƒå¼å­˜å‚¨</code></p><p>ä¸­å¿ƒåŒ–å­˜å‚¨ï¼šåœ¨ä¸­å¿ƒæ•°æ®åº“ä¸Š å­˜å‚¨éšç§æ•°æ®</p><p>åˆ†å¸ƒå¼å­˜å‚¨ï¼šåŒºå—é“¾å­˜å‚¨å…±äº«æ•°æ®</p><h1 id="4-å…¬æœ‰é“¾ã€è”ç›Ÿé“¾ã€ç§æœ‰é“¾"><a href="#4-å…¬æœ‰é“¾ã€è”ç›Ÿé“¾ã€ç§æœ‰é“¾" class="headerlink" title="4. å…¬æœ‰é“¾ã€è”ç›Ÿé“¾ã€ç§æœ‰é“¾"></a>4. å…¬æœ‰é“¾ã€è”ç›Ÿé“¾ã€ç§æœ‰é“¾</h1><img src="/posts/45753/13.png"><p><code>åŠ å¼ºç†è§£</code>:</p><ul><li>æ ¹æ®<code>å¼€æ”¾ç¨‹åº¦</code>ï¼ˆèŠ‚ç‚¹è¿›å…¥/é€€å‡ºåŸåˆ™ï¼‰,åˆ†ä¸ºäº†3ç±»é“¾</li><li>å…ˆæœ‰å…¬æœ‰é“¾ï¼Œåè€ƒè™‘åˆ°äº§ä¸šåº”ç”¨çš„è¦æ±‚æ‰å‡ºç°äº†è”ç›Ÿé“¾ï¼Œè”ç›Ÿé“¾å‚è€ƒäº†å…¬æœ‰é“¾çš„æŠ€æœ¯</li><li><code>ç§æœ‰é“¾</code>æ˜¯<code>è”ç›Ÿé“¾</code>çš„ä¸€ç§ç‰¹æ®Šç±»å‹ï¼Œéƒ½æ˜¯<code>è®¸å¯é“¾</code>,ä¹Ÿå¯ä»¥çœ‹åšåŒä¸€ç±»å‹</li></ul><h2 id="4-1-åˆ†ç±»æ–¹å¼è¯´æ˜"><a href="#4-1-åˆ†ç±»æ–¹å¼è¯´æ˜" class="headerlink" title="4.1 åˆ†ç±»æ–¹å¼è¯´æ˜"></a>4.1 åˆ†ç±»æ–¹å¼è¯´æ˜</h2><img src="/posts/45753/14.png"><h2 id="4-2-è¿è¡Œé€Ÿåº¦"><a href="#4-2-è¿è¡Œé€Ÿåº¦" class="headerlink" title="4.2 è¿è¡Œé€Ÿåº¦"></a>4.2 è¿è¡Œé€Ÿåº¦</h2><p>æ¯”ç‰¹å¸ã€ä»¥å¤ªåŠç­‰å…¬æœ‰é“¾åº”ç”¨ï¼Œæœ€è®©äººè¯Ÿç—…çš„å°±æ˜¯æ…¢å’Œæ‹¥å µï¼Œä¸»è¦æ˜¯å› ä¸ºèŠ‚ç‚¹ä¼—å¤š</p><p>è€Œç§æœ‰é“¾ã€è”ç›Ÿé“¾å› èŠ‚ç‚¹æ•°é‡å°‘ï¼Œè¿è¡Œé€Ÿåº¦å¾ˆå¿«</p><h2 id="4-3-æ­£ç¡®è®¤è¯†å…¬æœ‰é“¾"><a href="#4-3-æ­£ç¡®è®¤è¯†å…¬æœ‰é“¾" class="headerlink" title="4.3 æ­£ç¡®è®¤è¯†å…¬æœ‰é“¾"></a>4.3 æ­£ç¡®è®¤è¯†å…¬æœ‰é“¾</h2><p><strong>å…¬æœ‰é“¾å¿…é¡»å…·å¤‡ä»¥ä¸‹ç‰¹å¾æ‰èƒ½è¢«ç§°ä¸ºå…¬æœ‰é“¾ï¼š</strong></p><ol><li>è¶…ä¸»æƒæ— å›½ç•Œï¼š å…¨çƒè·¨å¢ƒåº”ç”¨</li><li>æ— æƒé™æ§åˆ¶ï¼šè‡ªç”±è¿›å‡ºè¯»å†™</li><li>å®Œå…¨ä¸­å¿ƒåŒ–ï¼šå‘ä¿¡æ¯ä¸è´Ÿè´£</li><li>åŒ¿åæ€§ï¼šä¸çŸ¥ç°å®èº«ä»½</li><li>é€æ˜æ€§ï¼šå°±æ˜¯ä»»ä½•äººå•¥éƒ½å¯ä»¥çœ‹åˆ°</li></ol><p><code>æ³¨æ„</code>: </p><ul><li>å¦‚æœåŒºå—é“¾è¦è¿›å…¥â€å•†ç”¨â€ï¼Œå¿…é¡»è§£å†³â€œå®åâ€ä¸â€œåˆè§„â€é—®é¢˜ï¼Œä¸èƒ½åŒ¿åï¼ˆå„å›½ä¸€æ ·ï¼Œéƒ½å®åäº¤ç¨ï¼‰</li><li>å›½å†…ï¼šã€BSNå‘å±•è”ç›Ÿã€‘ï¼Œè”ç›Ÿé“¾å…¬æœ‰åŒ–</li><li>å›½å¤–ï¼šã€ä¼ä¸šä»¥å¤ªåŠè”ç›Ÿã€‘ï¼Œå…¬æœ‰é“¾è”ç›ŸåŒ–</li></ul><blockquote><p>å…¬æœ‰é“¾ä¸Šçš„ä¿¡æ¯å‘å¸ƒä¸å¯åˆ é™¤ã€ä¿®æ”¹ï¼›ä»»ä½•äººéƒ½å¯åœ¨å…¬æœ‰é“¾å‘å¸ƒä¿¡æ¯ã€ä¸å¯ç¯¡æ”¹ã€æ°¸ä¹…ä¿å­˜</p></blockquote><p>â€‹    <code>å»¶ä¼¸é—®é¢˜</code>:</p><p>â— è¿™äº›ä¿¡æ¯å¦‚æœè¿åå›½å®¶æ”¿ç­–æ³•å¾‹,æ‰€è¨€ä¸å®ï¼Œæ€ä¹ˆåŠ</p><p>â— è¿™äº›ä¿¡æ¯å¦‚æœä¾µçŠ¯ä»–äºº(ä¸ªäºº/ä¼ä¸š)éšç§ï¼Œæ€ä¹ˆåŠ?</p><p>â— åŒºå—é“¾æ˜¯å¦éœ€è¦ç›‘ç®¡?è°æ¥ç›‘ç®¡ï¼Œæ€ä¹ˆç›‘ç®¡?</p><h2 id="4-4-äº§ä¸šåˆ›æ–°é€‚åˆç”¨è”ç›Ÿé“¾"><a href="#4-4-äº§ä¸šåˆ›æ–°é€‚åˆç”¨è”ç›Ÿé“¾" class="headerlink" title="4.4 äº§ä¸šåˆ›æ–°é€‚åˆç”¨è”ç›Ÿé“¾"></a>4.4 äº§ä¸šåˆ›æ–°é€‚åˆç”¨è”ç›Ÿé“¾</h2><img src="/posts/45753/15.png"><h1 id="5-åŒºå—é“¾ä¸äº’è”ç½‘"><a href="#5-åŒºå—é“¾ä¸äº’è”ç½‘" class="headerlink" title="5. åŒºå—é“¾ä¸äº’è”ç½‘"></a>5. åŒºå—é“¾ä¸äº’è”ç½‘</h1><h2 id="5-1-ç¼˜èµ·å·®å¼‚"><a href="#5-1-ç¼˜èµ·å·®å¼‚" class="headerlink" title="5.1 ç¼˜èµ·å·®å¼‚"></a>5.1 ç¼˜èµ·å·®å¼‚</h2><img src="/posts/45753/16.png"><h2 id="5-2-ç›¸äº’å…³ç³»"><a href="#5-2-ç›¸äº’å…³ç³»" class="headerlink" title="5.2 ç›¸äº’å…³ç³»"></a>5.2 ç›¸äº’å…³ç³»</h2><ul><li><p>åŒºå—é“¾ æ˜¯åŸºäº äº’è”ç½‘ æ„å»ºï¼ŒåŒºå—é“¾ä¸èƒ½ç‹¬ç«‹äºäº’è”ç½‘è€Œå­˜åœ¨ï¼Œæ²¡æœ‰äº’è”ç½‘å°±æ²¡åŒºå—é“¾</p></li><li><p>åŒºå—é“¾äº’è”ç½‘ æ˜¯ äº’è”ç½‘ çš„ä¸€ä¸ªå­é›†ï¼Œæ˜¯äº’è”ç½‘ä¸Šçš„ä¸€ç§ç‰¹æ®Šç»„ç»‡å½¢å¼</p></li></ul><h2 id="5-3-æ€ç»´è¦ç‚¹"><a href="#5-3-æ€ç»´è¦ç‚¹" class="headerlink" title="5.3 æ€ç»´è¦ç‚¹"></a>5.3 æ€ç»´è¦ç‚¹</h2><p>åŒºå—é“¾äº’è”ç½‘ï¼šåŒºå—é“¾æ€ç»´ï¼›å®‰å…¨ã€ä¿¡ä»»ã€ä»·å€¼</p><p>å…¨çƒäº’è”ç½‘ï¼š äº’è”ç½‘æ€ç»´ï¼›è¿æ¥ã€å¿«æ·ã€æ–¹ä¾¿</p>]]></content>
      
      
      <categories>
          
          <category> åŒºå—é“¾å­¦ä¹ ä¹‹è·¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŒºå—é“¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¯¦è§£äºŒå‰å †--å®ç°ä¼˜å…ˆé˜Ÿåˆ—</title>
      <link href="/posts/47223.html"/>
      <url>/posts/47223.html</url>
      
        <content type="html"><![CDATA[<p>äºŒå‰å †ï¼ˆBinary Heapï¼‰æ²¡ä»€ä¹ˆç¥ç§˜ï¼Œæ€§è´¨æ¯”äºŒå‰æœç´¢æ ‘ BST è¿˜ç®€å•ã€‚å…¶ä¸»è¦æ“ä½œå°±ä¸¤ä¸ªï¼Œ<code>sink</code>ï¼ˆä¸‹æ²‰ï¼‰å’Œ<code>swim</code>ï¼ˆä¸Šæµ®ï¼‰ï¼Œç”¨ä»¥ç»´æŠ¤äºŒå‰å †çš„æ€§è´¨ã€‚</p><p>å…¶ä¸»è¦åº”ç”¨æœ‰ä¸¤ä¸ªï¼Œé¦–å…ˆæ˜¯ä¸€ç§æ’åºæ–¹æ³•ã€Œå †æ’åºã€ï¼Œç¬¬äºŒæ˜¯ä¸€ç§å¾ˆæœ‰ç”¨çš„æ•°æ®ç»“æ„ã€Œä¼˜å…ˆçº§é˜Ÿåˆ—ã€ã€‚</p><p>ä¸‹é¢ä»¥å®ç°ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ˆPriority Queueï¼‰ä¸ºä¾‹ï¼Œé€šè¿‡å›¾ç‰‡å’Œäººç±»çš„è¯­è¨€æ¥æè¿°ä¸€ä¸‹äºŒå‰å †æ€ä¹ˆè¿ä½œçš„ã€‚</p><h2 id="1-äºŒå‰å †æ¦‚è¿°"><a href="#1-äºŒå‰å †æ¦‚è¿°" class="headerlink" title="1. äºŒå‰å †æ¦‚è¿°"></a>1. äºŒå‰å †æ¦‚è¿°</h2><p>é¦–å…ˆï¼ŒäºŒå‰å †å’ŒäºŒå‰æ ‘æœ‰å•¥å…³ç³»å‘¢ï¼Œä¸ºä»€ä¹ˆäººä»¬æ€»æ•°æŠŠäºŒå‰å †ç”»æˆä¸€æ£µäºŒå‰æ ‘ï¼Ÿ</p><p>å› ä¸ºï¼ŒäºŒå‰å †å…¶å®å°±æ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒå‰æ ‘ï¼ˆå®Œå…¨äºŒå‰æ ‘ï¼‰ï¼Œåªä¸è¿‡å­˜å‚¨åœ¨æ•°ç»„é‡Œã€‚ä¸€èˆ¬çš„é“¾è¡¨äºŒå‰æ ‘ï¼Œæˆ‘ä»¬æ“ä½œèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œè€Œåœ¨æ•°ç»„é‡Œï¼Œæˆ‘ä»¬æŠŠæ•°ç»„ç´¢å¼•ä½œä¸ºæŒ‡é’ˆï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// çˆ¶èŠ‚ç‚¹çš„ç´¢å¼•</span><span class="token keyword">int</span> <span class="token function">parent</span><span class="token punctuation">(</span><span class="token keyword">int</span> root<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> root <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// å·¦å­©å­çš„ç´¢å¼•</span><span class="token keyword">int</span> <span class="token function">left</span><span class="token punctuation">(</span><span class="token keyword">int</span> root<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> root <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// å³å­©å­çš„ç´¢å¼•</span><span class="token keyword">int</span> <span class="token function">right</span><span class="token punctuation">(</span><span class="token keyword">int</span> root<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> root <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”»ä¸ªå›¾ä½ ç«‹å³å°±èƒ½ç†è§£äº†ï¼Œæ³¨æ„æ•°ç»„çš„ç¬¬ä¸€ä¸ªç´¢å¼• 0 ç©ºç€ä¸ç”¨ï¼š</p><img src="/posts/47223/1.png"><p>PSï¼šå› ä¸ºæ•°ç»„ç´¢å¼•æ˜¯æ•°å­—ï¼Œä¸ºäº†æ–¹ä¾¿åŒºåˆ†ï¼Œå°†å­—ç¬¦ä½œä¸ºæ•°ç»„å…ƒç´ ã€‚</p><p>ä½ çœ‹åˆ°äº†ï¼ŒæŠŠ arr[1] ä½œä¸ºæ•´æ£µæ ‘çš„æ ¹çš„è¯ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹å’Œå·¦å³å­©å­çš„ç´¢å¼•éƒ½å¯ä»¥é€šè¿‡ç®€å•çš„è¿ç®—å¾—åˆ°ï¼Œè¿™å°±æ˜¯äºŒå‰å †è®¾è®¡çš„ä¸€ä¸ªå·§å¦™ä¹‹å¤„ã€‚ä¸ºäº†æ–¹ä¾¿è®²è§£ï¼Œä¸‹é¢éƒ½ä¼šç”»çš„å›¾éƒ½æ˜¯äºŒå‰æ ‘ç»“æ„ï¼Œç›¸ä¿¡ä½ èƒ½æŠŠæ ‘å’Œæ•°ç»„å¯¹åº”èµ·æ¥ã€‚</p><p>äºŒå‰å †è¿˜åˆ†ä¸ºæœ€å¤§å †å’Œæœ€å°å †ã€‚<strong>æœ€å¤§å †çš„æ€§è´¨æ˜¯ï¼šæ¯ä¸ªèŠ‚ç‚¹éƒ½å¤§äºç­‰äºå®ƒçš„ä¸¤ä¸ªå­èŠ‚ç‚¹ã€‚</strong>ç±»ä¼¼çš„ï¼Œæœ€å°å †çš„æ€§è´¨æ˜¯ï¼šæ¯ä¸ªèŠ‚ç‚¹éƒ½å°äºç­‰äºå®ƒçš„å­èŠ‚ç‚¹ã€‚</p><p>ä¸¤ç§å †æ ¸å¿ƒæ€è·¯éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæœ¬æ–‡ä»¥æœ€å¤§å †ä¸ºä¾‹è®²è§£ã€‚</p><p>å¯¹äºä¸€ä¸ªæœ€å¤§å †ï¼Œæ ¹æ®å…¶æ€§è´¨ï¼Œæ˜¾ç„¶å †é¡¶ï¼Œä¹Ÿå°±æ˜¯ arr[1] ä¸€å®šæ˜¯æ‰€æœ‰å…ƒç´ ä¸­æœ€å¤§çš„å…ƒç´ ã€‚</p><h2 id="2-ä¼˜å…ˆçº§é˜Ÿåˆ—æ¦‚è§ˆ"><a href="#2-ä¼˜å…ˆçº§é˜Ÿåˆ—æ¦‚è§ˆ" class="headerlink" title="2. ä¼˜å…ˆçº§é˜Ÿåˆ—æ¦‚è§ˆ"></a>2. ä¼˜å…ˆçº§é˜Ÿåˆ—æ¦‚è§ˆ</h2><p>ä¼˜å…ˆçº§é˜Ÿåˆ—è¿™ç§æ•°æ®ç»“æ„æœ‰ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„åŠŸèƒ½ï¼Œä½ æ’å…¥æˆ–è€…åˆ é™¤å…ƒç´ çš„æ—¶å€™ï¼Œå…ƒç´ ä¼šè‡ªåŠ¨æ’åºï¼Œè¿™åº•å±‚çš„åŸç†å°±æ˜¯äºŒå‰å †çš„æ“ä½œã€‚</p><p>æ•°æ®ç»“æ„çš„åŠŸèƒ½æ— éå¢åˆ æŸ¥è¯¥ï¼Œä¼˜å…ˆçº§é˜Ÿåˆ—æœ‰ä¸¤ä¸ªä¸»è¦ APIï¼Œåˆ†åˆ«æ˜¯<code>insert</code>æ’å…¥ä¸€ä¸ªå…ƒç´ å’Œ<code>delMax</code>åˆ é™¤æœ€å¤§å…ƒç´ ï¼ˆå¦‚æœåº•å±‚ç”¨æœ€å°å †ï¼Œé‚£ä¹ˆå°±æ˜¯<code>delMin</code>ï¼‰ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å®ç°ä¸€ä¸ªç®€åŒ–çš„ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå…ˆçœ‹ä¸‹ä»£ç æ¡†æ¶ï¼š</p><p>PSï¼šä¸ºäº†æ¸…æ™°èµ·è§ï¼Œè¿™é‡Œç”¨åˆ° Java çš„æ³›å‹ï¼Œ<code>Key</code>å¯ä»¥æ˜¯ä»»ä½•ä¸€ç§å¯æ¯”è¾ƒå¤§å°çš„æ•°æ®ç±»å‹ï¼Œä½ å¯ä»¥è®¤ä¸ºå®ƒæ˜¯ intã€char ç­‰ã€‚</p><img src="/posts/47223/2.png"><h2 id="3-å®ç°swim-å’Œ-sink"><a href="#3-å®ç°swim-å’Œ-sink" class="headerlink" title="3. å®ç°swim å’Œ sink"></a>3. å®ç°swim å’Œ sink</h2><p>ä¸ºä»€ä¹ˆè¦æœ‰ä¸Šæµ® swim å’Œä¸‹æ²‰ sink çš„æ“ä½œå‘¢ï¼Ÿä¸ºäº†ç»´æŠ¤å †ç»“æ„ã€‚</p><p>æˆ‘ä»¬è¦è®²çš„æ˜¯æœ€å¤§å †ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ¯”å®ƒçš„ä¸¤ä¸ªå­èŠ‚ç‚¹å¤§ï¼Œä½†æ˜¯åœ¨æ’å…¥å…ƒç´ å’Œåˆ é™¤å…ƒç´ æ—¶ï¼Œéš¾å…ç ´åå †çš„æ€§è´¨ï¼Œè¿™å°±éœ€è¦é€šè¿‡è¿™ä¸¤ä¸ªæ“ä½œæ¥æ¢å¤å †çš„æ€§è´¨äº†ã€‚</p><p>å¯¹äºæœ€å¤§å †ï¼Œä¼šç ´åå †æ€§è´¨çš„æœ‰æœ‰ä¸¤ç§æƒ…å†µï¼š</p><ol><li>å¦‚æœæŸä¸ªèŠ‚ç‚¹ A æ¯”å®ƒçš„å­èŠ‚ç‚¹ï¼ˆä¸­çš„ä¸€ä¸ªï¼‰å°ï¼Œé‚£ä¹ˆ A å°±ä¸é…åšçˆ¶èŠ‚ç‚¹ï¼Œåº”è¯¥ä¸‹å»ï¼Œä¸‹é¢é‚£ä¸ªæ›´å¤§çš„èŠ‚ç‚¹ä¸Šæ¥åšçˆ¶èŠ‚ç‚¹ï¼Œè¿™å°±æ˜¯å¯¹ A è¿›è¡Œ<strong>ä¸‹æ²‰</strong>ã€‚</li><li>å¦‚æœæŸä¸ªèŠ‚ç‚¹ A æ¯”å®ƒçš„çˆ¶èŠ‚ç‚¹å¤§ï¼Œé‚£ä¹ˆ A ä¸åº”è¯¥åšå­èŠ‚ç‚¹ï¼Œåº”è¯¥æŠŠçˆ¶èŠ‚ç‚¹æ¢ä¸‹æ¥ï¼Œè‡ªå·±å»åšçˆ¶èŠ‚ç‚¹ï¼Œè¿™å°±æ˜¯å¯¹ A çš„<strong>ä¸Šæµ®</strong>ã€‚</li></ol><p>å½“ç„¶ï¼Œé”™ä½çš„èŠ‚ç‚¹ A å¯èƒ½è¦ä¸Šæµ®ï¼ˆæˆ–ä¸‹æ²‰ï¼‰å¾ˆå¤šæ¬¡ï¼Œæ‰èƒ½åˆ°è¾¾æ­£ç¡®çš„ä½ç½®ï¼Œæ¢å¤å †çš„æ€§è´¨ã€‚æ‰€ä»¥ä»£ç ä¸­è‚¯å®šæœ‰ä¸€ä¸ª<code>while</code>å¾ªç¯ã€‚</p><p><strong>ä¸Šæµ®çš„ä»£ç å®ç°ï¼š</strong></p><img src="/posts/47223/3.png"><p>ç”»ä¸ªå›¾çœ‹ä¸€çœ¼å°±æ˜ç™½äº†ï¼š</p><img src="/posts/47223/4.png"><img src="/posts/47223/5.png"><img src="/posts/47223/10.png"><img src="/posts/47223/9.png"><img src="/posts/47223/7.png"><img src="/posts/47223/6.png"><img src="/posts/47223/8.png"><img src="/posts/47223/11.png"><p><strong>ä¸‹æ²‰çš„ä»£ç å®ç°ï¼š</strong></p><p>ä¸‹æ²‰æ¯”ä¸Šæµ®ç•¥å¾®å¤æ‚ä¸€ç‚¹ï¼Œå› ä¸ºä¸Šæµ®æŸä¸ªèŠ‚ç‚¹ Aï¼Œåªéœ€è¦ A å’Œå…¶çˆ¶èŠ‚ç‚¹æ¯”è¾ƒå¤§å°å³å¯ï¼›ä½†æ˜¯ä¸‹æ²‰æŸä¸ªèŠ‚ç‚¹ Aï¼Œéœ€è¦ A å’Œå…¶<strong>ä¸¤ä¸ªå­èŠ‚ç‚¹</strong>æ¯”è¾ƒå¤§å°ï¼Œå¦‚æœ A ä¸æ˜¯æœ€å¤§çš„å°±éœ€è¦è°ƒæ•´ä½ç½®ï¼Œè¦æŠŠè¾ƒå¤§çš„é‚£ä¸ªå­èŠ‚ç‚¹å’Œ A äº¤æ¢ã€‚</p><img src="/posts/47223/12.png"><p>äºŒå‰å †çš„ä¸»è¦æ“ä½œå°±è®²å®Œäº†ï¼Œä¸€ç‚¹éƒ½ä¸éš¾å§ï¼Œä»£ç åŠ èµ·æ¥ä¹Ÿå°±åè¡Œã€‚æ˜ç™½äº†<code>sink</code>å’Œ<code>swim</code>çš„è¡Œä¸ºï¼Œä¸‹é¢å°±å¯ä»¥å®ç°ä¼˜å…ˆçº§é˜Ÿåˆ—äº†ã€‚</p><h2 id="4-å®ç°delMax-å’Œ-insert"><a href="#4-å®ç°delMax-å’Œ-insert" class="headerlink" title="4. å®ç°delMax å’Œ insert"></a>4. å®ç°delMax å’Œ insert</h2><p>è¿™ä¸¤ä¸ªæ–¹æ³•å°±æ˜¯å»ºç«‹åœ¨<code>swim</code>å’Œ<code>sink</code>ä¸Šçš„ã€‚</p><p><strong><code>insert</code>æ–¹æ³•å…ˆæŠŠè¦æ’å…¥çš„å…ƒç´ æ·»åŠ åˆ°å †åº•çš„æœ€åï¼Œç„¶åè®©å…¶ä¸Šæµ®åˆ°æ­£ç¡®ä½ç½®ã€‚</strong></p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span>Key e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    N<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// å…ˆæŠŠæ–°å…ƒç´ åŠ åˆ°æœ€å</span>    pq<span class="token punctuation">[</span>N<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// ç„¶åè®©å®ƒä¸Šæµ®åˆ°æ­£ç¡®çš„ä½ç½®</span>    <span class="token function">swim</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong><code>delMax</code>æ–¹æ³•å…ˆæŠŠå †é¡¶å…ƒç´  A å’Œå †åº•æœ€åçš„å…ƒç´  B å¯¹è°ƒï¼Œç„¶ååˆ é™¤ Aï¼Œæœ€åè®© B ä¸‹æ²‰åˆ°æ­£ç¡®ä½ç½®ã€‚</strong></p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> Key <span class="token function">delMax</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// æœ€å¤§å †çš„å †é¡¶å°±æ˜¯æœ€å¤§å…ƒç´ </span>    Key max <span class="token operator">=</span> pq<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// æŠŠè¿™ä¸ªæœ€å¤§å…ƒç´ æ¢åˆ°æœ€åï¼Œåˆ é™¤ä¹‹</span>    <span class="token function">exch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span>    pq<span class="token punctuation">[</span>N<span class="token punctuation">]</span> <span class="token operator">=</span> null<span class="token punctuation">;</span>    N<span class="token operator">--</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// è®© pq[1] ä¸‹æ²‰åˆ°æ­£ç¡®ä½ç½®</span>    <span class="token function">sink</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> max<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è‡³æ­¤ï¼Œä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—å°±å®ç°äº†ï¼Œæ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ä¸º <em>O</em>(<em>l<strong>o</strong>g**K</em>)ï¼Œ<em>K</em>ä¸ºå½“å‰äºŒå‰å †ï¼ˆä¼˜å…ˆçº§é˜Ÿåˆ—ï¼‰ä¸­çš„å…ƒç´ æ€»æ•°ã€‚å› ä¸ºæˆ‘ä»¬æ—¶é—´å¤æ‚åº¦ä¸»è¦èŠ±è´¹åœ¨<code>sink</code>æˆ–è€…<code>swim</code>ä¸Šï¼Œè€Œä¸ç®¡ä¸Šæµ®è¿˜æ˜¯ä¸‹æ²‰ï¼Œæœ€å¤šä¹Ÿå°±æ ‘ï¼ˆå †ï¼‰çš„é«˜åº¦ï¼Œä¹Ÿå°±æ˜¯ log çº§åˆ«</p><h2 id="5-æ€»ç»“"><a href="#5-æ€»ç»“" class="headerlink" title="5. æ€»ç»“"></a>5. æ€»ç»“</h2><p>äºŒå‰å †å°±æ˜¯ä¸€ç§å®Œå…¨äºŒå‰æ ‘ï¼Œæ‰€ä»¥é€‚åˆå­˜å‚¨åœ¨æ•°ç»„ä¸­ï¼Œè€Œä¸”äºŒå‰å †æ‹¥æœ‰ä¸€äº›ç‰¹æ®Šæ€§è´¨ã€‚</p><p>äºŒå‰å †çš„æ“ä½œå¾ˆç®€å•ï¼Œä¸»è¦å°±æ˜¯ä¸Šæµ®å’Œä¸‹æ²‰ï¼Œæ¥ç»´æŠ¤å †çš„æ€§è´¨ï¼ˆå †æœ‰åºï¼‰ï¼Œæ ¸å¿ƒä»£ç ä¹Ÿå°±åè¡Œã€‚</p><p>ä¼˜å…ˆçº§é˜Ÿåˆ—æ˜¯åŸºäºäºŒå‰å †å®ç°çš„ï¼Œä¸»è¦æ“ä½œæ˜¯æ’å…¥å’Œåˆ é™¤ã€‚æ’å…¥æ˜¯å…ˆæ’åˆ°æœ€åï¼Œç„¶åä¸Šæµ®åˆ°æ­£ç¡®ä½ç½®ï¼›åˆ é™¤æ˜¯æŠŠç¬¬ä¸€ä¸ªå…ƒç´  pq[1]ï¼ˆæœ€å€¼ï¼‰è°ƒæ¢åˆ°æœ€åå†åˆ é™¤ï¼Œç„¶åæŠŠæ–°çš„ pq[1] ä¸‹æ²‰åˆ°æ­£ç¡®ä½ç½®ã€‚æ ¸å¿ƒä»£ç ä¹Ÿå°±åè¡Œã€‚</p><p>ä¹Ÿè®¸è¿™å°±æ˜¯æ•°æ®ç»“æ„çš„å¨åŠ›ï¼Œç®€å•çš„æ“ä½œå°±èƒ½å®ç°å·§å¦™çš„åŠŸèƒ½ï¼ŒçœŸå¿ƒä½©æœå‘æ˜äºŒå‰å †ç®—æ³•çš„äººï¼</p>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³•å­¦ä¹ ä¹‹è·¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é˜Ÿåˆ— </tag>
            
            <tag> äºŒå‰å † </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŒæŒ‡é’ˆåº”ç”¨åœºæ™¯æ€»ç»“</title>
      <link href="/posts/22462.html"/>
      <url>/posts/22462.html</url>
      
        <content type="html"><![CDATA[<p>åŒæŒ‡é’ˆæŠ€å·§åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ã€Œå¿«æ…¢æŒ‡é’ˆã€ï¼Œä¸€ç±»æ˜¯ã€Œå·¦å³æŒ‡é’ˆã€ã€‚</p><p>å‰è€…è§£å†³ä¸»è¦è§£å†³<strong>é“¾è¡¨</strong>ä¸­çš„é—®é¢˜ï¼Œæ¯”å¦‚å…¸å‹çš„åˆ¤å®šé“¾è¡¨ä¸­æ˜¯å¦åŒ…å«ç¯ï¼›</p><p>åè€…ä¸»è¦è§£å†³<strong>æ•°ç»„</strong>ï¼ˆæˆ–è€…å­—ç¬¦ä¸²ï¼‰ä¸­çš„é—®é¢˜ï¼Œæ¯”å¦‚äºŒåˆ†æŸ¥æ‰¾ã€‚</p><h2 id="1-å¿«æ…¢æŒ‡é’ˆçš„å¸¸è§ç®—æ³•"><a href="#1-å¿«æ…¢æŒ‡é’ˆçš„å¸¸è§ç®—æ³•" class="headerlink" title="1. å¿«æ…¢æŒ‡é’ˆçš„å¸¸è§ç®—æ³•"></a>1. å¿«æ…¢æŒ‡é’ˆçš„å¸¸è§ç®—æ³•</h2><p>å¿«æ…¢æŒ‡é’ˆä¸€èˆ¬éƒ½åˆå§‹åŒ–æŒ‡å‘é“¾è¡¨çš„å¤´ç»“ç‚¹<code>head</code>ï¼Œå‰è¿›æ—¶å¿«æŒ‡é’ˆ<code>fast</code>åœ¨å‰ï¼Œæ…¢æŒ‡é’ˆ<code>slow</code>åœ¨åï¼Œå·§å¦™è§£å†³ä¸€äº›é“¾è¡¨ä¸­çš„é—®é¢˜ã€‚</p><h3 id="1-1-åˆ¤å®šé“¾è¡¨ä¸­æ˜¯å¦å«æœ‰ç¯"><a href="#1-1-åˆ¤å®šé“¾è¡¨ä¸­æ˜¯å¦å«æœ‰ç¯" class="headerlink" title="1.1 åˆ¤å®šé“¾è¡¨ä¸­æ˜¯å¦å«æœ‰ç¯"></a>1.1 <strong>åˆ¤å®šé“¾è¡¨ä¸­æ˜¯å¦å«æœ‰ç¯</strong></h3><p>å•é“¾è¡¨çš„ç‰¹ç‚¹æ˜¯æ¯ä¸ªèŠ‚ç‚¹åªçŸ¥é“ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¸€ä¸ªæŒ‡é’ˆçš„è¯æ— æ³•åˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦å«æœ‰ç¯çš„ã€‚</p><p>å¦‚æœé“¾è¡¨ä¸­ä¸å«ç¯ï¼Œé‚£ä¹ˆè¿™ä¸ªæŒ‡é’ˆæœ€ç»ˆä¼šé‡åˆ°ç©ºæŒ‡é’ˆ<code>null</code>è¡¨ç¤ºé“¾è¡¨åˆ°å¤´äº†ï¼Œè¿™è¿˜å¥½è¯´ï¼Œå¯ä»¥åˆ¤æ–­è¯¥é“¾è¡¨ä¸å«ç¯ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">boolean</span> <span class="token function">hasCycle</span><span class="token punctuation">(</span>ListNode head<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>head <span class="token operator">!=</span> null<span class="token punctuation">)</span>        head <span class="token operator">=</span> head<span class="token punctuation">.</span>next<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯å¦‚æœé“¾è¡¨ä¸­å«æœ‰ç¯ï¼Œé‚£ä¹ˆè¿™ä¸ªæŒ‡é’ˆå°±ä¼šé™·å…¥æ­»å¾ªç¯ï¼Œå› ä¸ºç¯å½¢æ•°ç»„ä¸­æ²¡æœ‰<code>null</code>æŒ‡é’ˆä½œä¸ºå°¾éƒ¨èŠ‚ç‚¹ã€‚</p><p>ç»å…¸è§£æ³•å°±æ˜¯ç”¨ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªè·‘å¾—å¿«ï¼Œä¸€ä¸ªè·‘å¾—æ…¢ã€‚å¦‚æœä¸å«æœ‰ç¯ï¼Œè·‘å¾—å¿«çš„é‚£ä¸ªæŒ‡é’ˆæœ€ç»ˆä¼šé‡åˆ°<code>null</code>ï¼Œè¯´æ˜é“¾è¡¨ä¸å«ç¯ï¼›å¦‚æœå«æœ‰ç¯ï¼Œå¿«æŒ‡é’ˆæœ€ç»ˆä¼šè¶…æ…¢æŒ‡é’ˆä¸€åœˆï¼Œå’Œæ…¢æŒ‡é’ˆç›¸é‡ï¼Œè¯´æ˜é“¾è¡¨å«æœ‰ç¯ã€‚</p><p>åŠ›æ‰£ç¬¬ 141 é¢˜å°±æ˜¯è¿™ä¸ªé—®é¢˜ï¼Œè§£æ³•ä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">boolean</span> <span class="token function">hasCycle</span><span class="token punctuation">(</span>ListNode head<span class="token punctuation">)</span> <span class="token punctuation">{</span>    ListNode fast<span class="token punctuation">,</span> slow<span class="token punctuation">;</span>    fast <span class="token operator">=</span> slow <span class="token operator">=</span> head<span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>fast <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> fast<span class="token punctuation">.</span>next <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>        fast <span class="token operator">=</span> fast<span class="token punctuation">.</span>next<span class="token punctuation">.</span>next<span class="token punctuation">;</span>        slow <span class="token operator">=</span> slow<span class="token punctuation">.</span>next<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>fast <span class="token operator">==</span> slow<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-2-å·²çŸ¥é“¾è¡¨ä¸­å«æœ‰ç¯ï¼Œè¿”å›è¿™ä¸ªç¯çš„èµ·å§‹ä½ç½®"><a href="#1-2-å·²çŸ¥é“¾è¡¨ä¸­å«æœ‰ç¯ï¼Œè¿”å›è¿™ä¸ªç¯çš„èµ·å§‹ä½ç½®" class="headerlink" title="1.2 å·²çŸ¥é“¾è¡¨ä¸­å«æœ‰ç¯ï¼Œè¿”å›è¿™ä¸ªç¯çš„èµ·å§‹ä½ç½®"></a>1.2 <strong>å·²çŸ¥é“¾è¡¨ä¸­å«æœ‰ç¯ï¼Œè¿”å›è¿™ä¸ªç¯çš„èµ·å§‹ä½ç½®</strong></h3><img src="/posts/22462/1.png"><p>è¿™ä¸ªé—®é¢˜ä¸€ç‚¹éƒ½ä¸å›°éš¾ï¼Œæœ‰ç‚¹ç±»ä¼¼è„‘ç­‹æ€¥è½¬å¼¯ï¼Œå…ˆç›´æ¥çœ‹ä»£ç ï¼š</p><pre class="line-numbers language-java"><code class="language-java">ListNode <span class="token function">detectCycle</span><span class="token punctuation">(</span>ListNode head<span class="token punctuation">)</span> <span class="token punctuation">{</span>    ListNode fast<span class="token punctuation">,</span> slow<span class="token punctuation">;</span>    fast <span class="token operator">=</span> slow <span class="token operator">=</span> head<span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>fast <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> fast<span class="token punctuation">.</span>next <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>        fast <span class="token operator">=</span> fast<span class="token punctuation">.</span>next<span class="token punctuation">.</span>next<span class="token punctuation">;</span>        slow <span class="token operator">=</span> slow<span class="token punctuation">.</span>next<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>fast <span class="token operator">==</span> slow<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// ä¸Šé¢çš„ä»£ç ç±»ä¼¼ hasCycle å‡½æ•°</span>    slow <span class="token operator">=</span> head<span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>slow <span class="token operator">!=</span> fast<span class="token punctuation">)</span> <span class="token punctuation">{</span>        fast <span class="token operator">=</span> fast<span class="token punctuation">.</span>next<span class="token punctuation">;</span>        slow <span class="token operator">=</span> slow<span class="token punctuation">.</span>next<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> slow<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“å¿«æ…¢æŒ‡é’ˆç›¸é‡æ—¶ï¼Œè®©å…¶ä¸­ä»»ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å¤´èŠ‚ç‚¹ï¼Œç„¶åè®©å®ƒä¿©ä»¥ç›¸åŒé€Ÿåº¦å‰è¿›ï¼Œå†æ¬¡ç›¸é‡æ—¶æ‰€åœ¨çš„èŠ‚ç‚¹ä½ç½®å°±æ˜¯ç¯å¼€å§‹çš„ä½ç½®ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ç¬¬ä¸€æ¬¡ç›¸é‡æ—¶ï¼Œå‡è®¾æ…¢æŒ‡é’ˆ<code>slow</code>èµ°äº†<code>k</code>æ­¥ï¼Œé‚£ä¹ˆå¿«æŒ‡é’ˆ<code>fast</code>ä¸€å®šèµ°äº†<code>2k</code>æ­¥ï¼š</p><img src="/posts/22462/2.png"><p><strong><code>fast</code>ä¸€å®šæ¯”<code>slow</code>å¤šèµ°äº†<code>k</code>æ­¥ï¼Œè¿™å¤šèµ°çš„<code>k</code>æ­¥å…¶å®å°±æ˜¯<code>fast</code>æŒ‡é’ˆåœ¨ç¯é‡Œè½¬åœˆåœˆï¼Œæ‰€ä»¥<code>k</code>çš„å€¼å°±æ˜¯ç¯é•¿åº¦çš„ã€Œæ•´æ•°å€ã€</strong>ã€‚</p><p>è¯´å¥é¢˜å¤–è¯ï¼Œä¹‹å‰è¿˜æœ‰è¯»è€…äº‰è®ºä¸ºä»€ä¹ˆæ˜¯ç¯é•¿åº¦æ•´æ•°å€ï¼Œæˆ‘ä¸¾ä¸ªç®€å•çš„ä¾‹å­ä½ å°±æ˜ç™½äº†ï¼Œæˆ‘ä»¬æƒ³ä¸€æƒ³æç«¯æƒ…å†µï¼Œå‡è®¾ç¯é•¿åº¦å°±æ˜¯ 1ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img src="/posts/22462/4.png"><p>é‚£ä¹ˆ<code>fast</code>è‚¯å®šæ—©æ—©å°±è¿›ç¯é‡Œè½¬åœˆåœˆäº†ï¼Œè€Œä¸”è‚¯å®šä¼šè½¬å¥½å¤šåœˆï¼Œè¿™ä¸å°±æ˜¯ç¯é•¿åº¦çš„æ•´æ•°å€å˜›ã€‚</p><p>è¨€å½’æ­£ä¼ ï¼Œè®¾ç›¸é‡ç‚¹è·ç¯çš„èµ·ç‚¹çš„è·ç¦»ä¸º<code>m</code>ï¼Œé‚£ä¹ˆç¯çš„èµ·ç‚¹è·å¤´ç»“ç‚¹<code>head</code>çš„è·ç¦»ä¸º<code>k - m</code>ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä»<code>head</code>å‰è¿›<code>k - m</code>æ­¥å°±èƒ½åˆ°è¾¾ç¯èµ·ç‚¹ã€‚</p><p>å·§çš„æ˜¯ï¼Œå¦‚æœä»ç›¸é‡ç‚¹ç»§ç»­å‰è¿›<code>k - m</code>æ­¥ï¼Œä¹Ÿæ°å¥½åˆ°è¾¾ç¯èµ·ç‚¹ã€‚ä½ ç”­ç®¡<code>fast</code>åœ¨ç¯é‡Œåˆ°åº•è½¬äº†å‡ åœˆï¼Œåæ­£èµ°<code>k</code>æ­¥å¯ä»¥åˆ°ç›¸é‡ç‚¹ï¼Œé‚£èµ°<code>k - m</code>æ­¥ä¸€å®šå°±æ˜¯èµ°åˆ°ç¯èµ·ç‚¹äº†ï¼š</p><img src="/posts/22462/5.png"><p>æ‰€ä»¥ï¼Œåªè¦æˆ‘ä»¬æŠŠå¿«æ…¢æŒ‡é’ˆä¸­çš„ä»»ä¸€ä¸ªé‡æ–°æŒ‡å‘<code>head</code>ï¼Œç„¶åä¸¤ä¸ªæŒ‡é’ˆåŒé€Ÿå‰è¿›ï¼Œ<code>k - m</code>æ­¥åå°±ä¼šç›¸é‡ï¼Œç›¸é‡ä¹‹å¤„å°±æ˜¯ç¯çš„èµ·ç‚¹äº†ã€‚</p><h3 id="1-2ã€å¯»æ‰¾é“¾è¡¨çš„ä¸­ç‚¹"><a href="#1-2ã€å¯»æ‰¾é“¾è¡¨çš„ä¸­ç‚¹" class="headerlink" title="1.2ã€å¯»æ‰¾é“¾è¡¨çš„ä¸­ç‚¹"></a><strong>1.2ã€å¯»æ‰¾é“¾è¡¨çš„ä¸­ç‚¹</strong></h3><p>ç±»ä¼¼ä¸Šé¢çš„æ€è·¯ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®©å¿«æŒ‡é’ˆä¸€æ¬¡å‰è¿›ä¸¤æ­¥ï¼Œæ…¢æŒ‡é’ˆä¸€æ¬¡å‰è¿›ä¸€æ­¥ï¼Œå½“å¿«æŒ‡é’ˆåˆ°è¾¾é“¾è¡¨å°½å¤´æ—¶ï¼Œæ…¢æŒ‡é’ˆå°±å¤„äºé“¾è¡¨çš„ä¸­é—´ä½ç½®ã€‚</p><p>åŠ›æ‰£ç¬¬ 876 é¢˜å°±æ˜¯æ‰¾é“¾è¡¨ä¸­ç‚¹çš„é¢˜ç›®ï¼Œè§£æ³•ä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java"><code class="language-java">ListNode <span class="token function">middleNode</span><span class="token punctuation">(</span>ListNode head<span class="token punctuation">)</span> <span class="token punctuation">{</span>    ListNode fast<span class="token punctuation">,</span> slow<span class="token punctuation">;</span>    fast <span class="token operator">=</span> slow <span class="token operator">=</span> head<span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>fast <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> fast<span class="token punctuation">.</span>next <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>        fast <span class="token operator">=</span> fast<span class="token punctuation">.</span>next<span class="token punctuation">.</span>next<span class="token punctuation">;</span>        slow <span class="token operator">=</span> slow<span class="token punctuation">.</span>next<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// slow å°±åœ¨ä¸­é—´ä½ç½®</span>    <span class="token keyword">return</span> slow<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“é“¾è¡¨çš„é•¿åº¦æ˜¯å¥‡æ•°æ—¶ï¼Œ<code>slow</code>æ°å·§åœåœ¨ä¸­ç‚¹ä½ç½®ï¼›å¦‚æœé•¿åº¦æ˜¯å¶æ•°ï¼Œ<code>slow</code>æœ€ç»ˆçš„ä½ç½®æ˜¯ä¸­é—´åå³:</p><img src="/posts/22462/6.png"><p>å¯»æ‰¾é“¾è¡¨ä¸­ç‚¹çš„ä¸€ä¸ªé‡è¦ä½œç”¨æ˜¯å¯¹é“¾è¡¨è¿›è¡Œå½’å¹¶æ’åºã€‚</p><p>å›æƒ³æ•°ç»„çš„å½’å¹¶æ’åºï¼šæ±‚ä¸­ç‚¹ç´¢å¼•é€’å½’åœ°æŠŠæ•°ç»„äºŒåˆ†ï¼Œæœ€ååˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„ã€‚å¯¹äºé“¾è¡¨ï¼Œåˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨æ˜¯å¾ˆç®€å•çš„ï¼Œéš¾ç‚¹å°±åœ¨äºäºŒåˆ†ã€‚</p><p>ä½†æ˜¯ç°åœ¨ä½ å­¦ä¼šäº†æ‰¾åˆ°é“¾è¡¨çš„ä¸­ç‚¹ï¼Œå°±èƒ½å®ç°é“¾è¡¨çš„äºŒåˆ†äº†ã€‚å…³äºå½’å¹¶æ’åºçš„å…·ä½“å†…å®¹æœ¬æ–‡å°±ä¸å…·ä½“å±•å¼€äº†ã€‚</p><h3 id="1-3ã€å¯»æ‰¾é“¾è¡¨çš„å€’æ•°ç¬¬nä¸ªå…ƒç´ "><a href="#1-3ã€å¯»æ‰¾é“¾è¡¨çš„å€’æ•°ç¬¬nä¸ªå…ƒç´ " class="headerlink" title="1.3ã€å¯»æ‰¾é“¾è¡¨çš„å€’æ•°ç¬¬nä¸ªå…ƒç´ "></a><strong>1.3ã€å¯»æ‰¾é“¾è¡¨çš„å€’æ•°ç¬¬<code>n</code>ä¸ªå…ƒç´ </strong></h3><p>è¿™æ˜¯åŠ›æ‰£ç¬¬ 19 é¢˜ã€Œåˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬<code>n</code>ä¸ªå…ƒç´ ã€ï¼Œå…ˆçœ‹ä¸‹é¢˜ç›®ï¼š</p><img src="/posts/22462/7.png"><p>æˆ‘ä»¬çš„æ€è·¯è¿˜æ˜¯ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆï¼Œè®©å¿«æŒ‡é’ˆå…ˆèµ°<code>n</code>æ­¥ï¼Œç„¶åå¿«æ…¢æŒ‡é’ˆå¼€å§‹åŒé€Ÿå‰è¿›ã€‚è¿™æ ·å½“å¿«æŒ‡é’ˆèµ°åˆ°é“¾è¡¨æœ«å°¾<code>null</code>æ—¶ï¼Œæ…¢æŒ‡é’ˆæ‰€åœ¨çš„ä½ç½®å°±æ˜¯å€’æ•°ç¬¬<code>n</code>ä¸ªé“¾è¡¨èŠ‚ç‚¹ï¼ˆ<code>n</code>ä¸ä¼šè¶…è¿‡é“¾è¡¨é•¿åº¦ï¼‰ã€‚</p><p>è§£æ³•æ¯”è¾ƒç®€å•ï¼Œç›´æ¥çœ‹ä»£ç å§ï¼š</p><pre class="line-numbers language-java"><code class="language-java">ListNode <span class="token function">removeNthFromEnd</span><span class="token punctuation">(</span>ListNode head<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>    ListNode fast<span class="token punctuation">,</span> slow<span class="token punctuation">;</span>    fast <span class="token operator">=</span> slow <span class="token operator">=</span> head<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// å¿«æŒ‡é’ˆå…ˆå‰è¿› n æ­¥</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>n<span class="token operator">--</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        fast <span class="token operator">=</span> fast<span class="token punctuation">.</span>next<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>fast <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// å¦‚æœæ­¤æ—¶å¿«æŒ‡é’ˆèµ°åˆ°å¤´äº†ï¼Œ</span>        <span class="token comment" spellcheck="true">// è¯´æ˜å€’æ•°ç¬¬ n ä¸ªèŠ‚ç‚¹å°±æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span>        <span class="token keyword">return</span> head<span class="token punctuation">.</span>next<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// è®©æ…¢æŒ‡é’ˆå’Œå¿«æŒ‡é’ˆåŒæ­¥å‘å‰</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>fast <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> fast<span class="token punctuation">.</span>next <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>        fast <span class="token operator">=</span> fast<span class="token punctuation">.</span>next<span class="token punctuation">;</span>        slow <span class="token operator">=</span> slow<span class="token punctuation">.</span>next<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// slow.next å°±æ˜¯å€’æ•°ç¬¬ n ä¸ªèŠ‚ç‚¹ï¼Œåˆ é™¤å®ƒ</span>    slow<span class="token punctuation">.</span>next <span class="token operator">=</span> slow<span class="token punctuation">.</span>next<span class="token punctuation">.</span>next<span class="token punctuation">;</span>    <span class="token keyword">return</span> head<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-å·¦å³æŒ‡é’ˆ"><a href="#2-å·¦å³æŒ‡é’ˆ" class="headerlink" title="2. å·¦å³æŒ‡é’ˆ"></a>2. å·¦å³æŒ‡é’ˆ</h2><p>å·¦å³æŒ‡é’ˆåœ¨æ•°ç»„ä¸­å®é™…æ˜¯æŒ‡ä¸¤ä¸ªç´¢å¼•å€¼ï¼Œä¸€èˆ¬åˆå§‹åŒ–ä¸º<code>left = 0, right = nums.length - 1</code>ã€‚</p><h3 id="2-1-äºŒåˆ†æŸ¥æ‰¾"><a href="#2-1-äºŒåˆ†æŸ¥æ‰¾" class="headerlink" title="2.1 äºŒåˆ†æŸ¥æ‰¾"></a>2.1 <strong>äºŒåˆ†æŸ¥æ‰¾</strong></h3><p>åªå†™æœ€ç®€å•çš„äºŒåˆ†ç®—æ³•ï¼Œæ—¨åœ¨çªå‡ºå®ƒçš„åŒæŒ‡é’ˆç‰¹æ€§</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">int</span> <span class="token function">binarySearch</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums<span class="token punctuation">,</span> <span class="token keyword">int</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>     <span class="token keyword">int</span> right <span class="token operator">=</span> nums<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>left <span class="token operator">&lt;=</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>right <span class="token operator">+</span> left<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">==</span> target<span class="token punctuation">)</span>            <span class="token keyword">return</span> mid<span class="token punctuation">;</span>         <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">&lt;</span> target<span class="token punctuation">)</span>            left <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>         <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">></span> target<span class="token punctuation">)</span>            right <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-2-ä¸¤æ•°ä¹‹å’Œ"><a href="#2-2-ä¸¤æ•°ä¹‹å’Œ" class="headerlink" title="2.2 ä¸¤æ•°ä¹‹å’Œ"></a>2.2 ä¸¤æ•°ä¹‹å’Œ</h3><img src="/posts/22462/8.png"><p>åªè¦æ•°ç»„æœ‰åºï¼Œå°±åº”è¯¥æƒ³åˆ°åŒæŒ‡é’ˆæŠ€å·§ã€‚è¿™é“é¢˜çš„è§£æ³•æœ‰ç‚¹ç±»ä¼¼äºŒåˆ†æŸ¥æ‰¾ï¼Œé€šè¿‡è°ƒèŠ‚<code>left</code>å’Œ<code>right</code>å¯ä»¥è°ƒæ•´<code>sum</code>çš„å¤§å°ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">twoSum</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums<span class="token punctuation">,</span> <span class="token keyword">int</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> right <span class="token operator">=</span> nums<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>left <span class="token operator">&lt;</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> sum <span class="token operator">=</span> nums<span class="token punctuation">[</span>left<span class="token punctuation">]</span> <span class="token operator">+</span> nums<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">==</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// é¢˜ç›®è¦æ±‚çš„ç´¢å¼•æ˜¯ä» 1 å¼€å§‹çš„</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>left <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> right <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">&lt;</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>            left<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// è®© sum å¤§ä¸€ç‚¹</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">></span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>            right<span class="token operator">--</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// è®© sum å°ä¸€ç‚¹</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-3-åè½¬æ•°ç»„"><a href="#2-3-åè½¬æ•°ç»„" class="headerlink" title="2.3 åè½¬æ•°ç»„"></a>2.3 <strong>åè½¬æ•°ç»„</strong></h3><p>ä¸€èˆ¬ç¼–ç¨‹è¯­è¨€éƒ½ä¼šæä¾›<code>reverse</code>å‡½æ•°ï¼Œå…¶å®éå¸¸ç®€å•ï¼ŒåŠ›æ‰£ç¬¬ 344 é¢˜æ˜¯ç±»ä¼¼çš„éœ€æ±‚ï¼Œè®©ä½ åè½¬ä¸€ä¸ª<code>char[]</code>ç±»å‹çš„å­—ç¬¦æ•°ç»„ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹ä»£ç å§ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">void</span> <span class="token function">reverseString</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> right <span class="token operator">=</span> arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>left <span class="token operator">&lt;</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// äº¤æ¢ arr[left] å’Œ arr[right]</span>        <span class="token keyword">char</span> temp <span class="token operator">=</span> arr<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">;</span>        arr<span class="token punctuation">[</span>left<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">;</span>        arr<span class="token punctuation">[</span>right<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>        left<span class="token operator">++</span><span class="token punctuation">;</span> right<span class="token operator">--</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-4-æ»‘åŠ¨çª—å£"><a href="#2-4-æ»‘åŠ¨çª—å£" class="headerlink" title="2.4 æ»‘åŠ¨çª—å£"></a>2.4 æ»‘åŠ¨çª—å£</h3>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³•å­¦ä¹ ä¹‹è·¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŒæŒ‡é’ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ€é•¿å›æ–‡å­ä¸²--å›æ–‡ä¸²</title>
      <link href="/posts/38712.html"/>
      <url>/posts/38712.html</url>
      
        <content type="html"><![CDATA[<p>è™½ç„¶å›æ–‡ä¸²é—®é¢˜æœ¬èº«æ²¡å•¥æ„ä¹‰ï¼Œä½†ä¸»è¦å­¦ä¹ å›æ–‡ä¸²é—®é¢˜çš„æ ¸å¿ƒæ€æƒ³æ˜¯ä»€ä¹ˆã€‚</p><p>é¦–å…ˆï¼Œæ˜ç¡®ä¸€ä¸‹ä»€ï¼š<strong>å›æ–‡ä¸²å°±æ˜¯æ­£ç€è¯»å’Œåç€è¯»éƒ½ä¸€æ ·çš„å­—ç¬¦ä¸²</strong>ã€‚</p><p>æ¯”å¦‚è¯´å­—ç¬¦ä¸²<code>aba</code>å’Œ<code>abba</code>éƒ½æ˜¯å›æ–‡ä¸²ï¼Œå› ä¸ºå®ƒä»¬å¯¹ç§°ï¼Œåè¿‡æ¥è¿˜æ˜¯å’Œæœ¬èº«ä¸€æ ·ã€‚åä¹‹ï¼Œå­—ç¬¦ä¸²<code>abac</code>å°±ä¸æ˜¯å›æ–‡ä¸²ã€‚</p><p>å¯ä»¥çœ‹åˆ°å›æ–‡ä¸²çš„çš„é•¿åº¦å¯èƒ½æ˜¯å¥‡æ•°ï¼Œä¹Ÿå¯èƒ½æ˜¯å¶æ•°ï¼Œè¿™å°±æ·»åŠ äº†å›æ–‡ä¸²é—®é¢˜çš„éš¾åº¦ï¼Œè§£å†³è¯¥ç±»é—®é¢˜çš„æ ¸å¿ƒæ˜¯<strong>åŒæŒ‡é’ˆ</strong>ã€‚ä¸‹é¢å°±é€šè¿‡ä¸€é“æœ€é•¿å›æ–‡å­ä¸²çš„é—®é¢˜æ¥å…·ä½“ç†è§£ä¸€ä¸‹å›æ–‡ä¸²é—®é¢˜ï¼š</p><img src="/posts/38712/1.png"><pre class="line-numbers language-java"><code class="language-java">string <span class="token function">longestPalindrome</span><span class="token punctuation">(</span>string s<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="1-æ€è€ƒ"><a href="#1-æ€è€ƒ" class="headerlink" title="1. æ€è€ƒ"></a>1. æ€è€ƒ</h2><p>å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é¦–å…ˆåº”è¯¥æ€è€ƒçš„æ˜¯ï¼Œç»™ä¸€ä¸ªå­—ç¬¦ä¸²<code>s</code>ï¼Œå¦‚ä½•åœ¨<code>s</code>ä¸­æ‰¾åˆ°ä¸€ä¸ªå›æ–‡å­ä¸²ï¼Ÿ</p><p>æœ‰ä¸€ä¸ªå¾ˆæœ‰è¶£çš„æ€è·¯ï¼šæ—¢ç„¶å›æ–‡ä¸²æ˜¯ä¸€ä¸ªæ­£ç€åç€è¯»éƒ½ä¸€æ ·çš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬æŠŠ<code>s</code>åè½¬ï¼Œç§°ä¸º<code>s&#39;</code>ï¼Œç„¶ååœ¨<code>s</code>å’Œ<code>s&#39;</code>ä¸­å¯»æ‰¾<strong>æœ€é•¿å…¬å…±å­ä¸²</strong>ï¼Œè¿™æ ·åº”è¯¥å°±èƒ½æ‰¾åˆ°æœ€é•¿å›æ–‡å­ä¸²ã€‚</p><p>æ¯”å¦‚è¯´å­—ç¬¦ä¸²<code>abacd</code>ï¼Œåè¿‡æ¥æ˜¯<code>dcaba</code>ï¼Œå®ƒä¿©çš„æœ€é•¿å…¬å…±å­ä¸²æ˜¯<code>aba</code>ï¼Œä¹Ÿå°±æ˜¯æœ€é•¿å›æ–‡å­ä¸²ã€‚</p><p>ä½†æ˜¯è¿™ä¸ªæ€è·¯æ˜¯é”™è¯¯çš„ï¼Œæ¯”å¦‚è¯´å­—ç¬¦ä¸²<code>aacxycaa</code>ï¼Œåè½¬ä¹‹åæ˜¯<code>aacyxcaa</code>ï¼Œæœ€é•¿å…¬å…±å­ä¸²æ˜¯<code>aac</code>ï¼Œä½†æ˜¯æœ€é•¿å›æ–‡å­ä¸²åº”è¯¥æ˜¯<code>aa</code>ã€‚</p><p>è™½ç„¶è¿™ä¸ªæ€è·¯ä¸æ­£ç¡®ï¼Œä½†æ˜¯<strong>è¿™ç§æŠŠé—®é¢˜è½¬åŒ–ä¸ºå…¶ä»–å½¢å¼çš„æ€è€ƒæ–¹å¼æ˜¯éå¸¸å€¼å¾—æå€¡çš„</strong>ã€‚</p><p>ä¸‹é¢ï¼Œå°±æ¥è¯´ä¸€ä¸‹æ­£ç¡®çš„æ€è·¯ï¼Œå¦‚ä½•ä½¿ç”¨åŒæŒ‡é’ˆã€‚</p><p><strong>å¯»æ‰¾å›æ–‡ä¸²çš„é—®é¢˜æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šä»ä¸­é—´å¼€å§‹å‘ä¸¤è¾¹æ‰©æ•£æ¥åˆ¤æ–­å›æ–‡ä¸²</strong>ã€‚å¯¹äºæœ€é•¿å›æ–‡å­ä¸²ï¼Œå°±æ˜¯è¿™ä¸ªæ„æ€ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">for</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> i <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">:</span>    æ‰¾åˆ°ä»¥ s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> ä¸ºä¸­å¿ƒçš„å›æ–‡ä¸²    æ›´æ–°ç­”æ¡ˆ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯å‘¢ï¼Œæˆ‘ä»¬åˆšæ‰ä¹Ÿè¯´äº†ï¼Œå›æ–‡ä¸²çš„é•¿åº¦å¯èƒ½æ˜¯å¥‡æ•°ä¹Ÿå¯èƒ½æ˜¯å¶æ•°ï¼Œå¦‚æœæ˜¯<code>abba</code>è¿™ç§æƒ…å†µï¼Œæ²¡æœ‰ä¸€ä¸ªä¸­å¿ƒå­—ç¬¦ï¼Œä¸Šé¢çš„ç®—æ³•å°±æ²¡è¾™äº†ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸€ä¸‹ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">for</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> i <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">:</span>    æ‰¾åˆ°ä»¥ s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> ä¸ºä¸­å¿ƒçš„å›æ–‡ä¸²    æ‰¾åˆ°ä»¥ s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> å’Œ s<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> ä¸ºä¸­å¿ƒçš„å›æ–‡ä¸²    æ›´æ–°ç­”æ¡ˆ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-ä»£ç å®ç°"><a href="#2-ä»£ç å®ç°" class="headerlink" title="2. ä»£ç å®ç°"></a>2. ä»£ç å®ç°</h2><p>æŒ‰ç…§ä¸Šé¢çš„æ€è·¯ï¼Œå…ˆè¦å®ç°ä¸€ä¸ªå‡½æ•°æ¥å¯»æ‰¾æœ€é•¿å›æ–‡ä¸²ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯æœ‰ç‚¹æŠ€å·§çš„ï¼š</p><img src="/posts/38712/2.png"><p>ä¸ºä»€ä¹ˆè¦ä¼ å…¥ä¸¤ä¸ªæŒ‡é’ˆ<code>l</code>å’Œ<code>r</code>å‘¢ï¼Ÿ<strong>å› ä¸ºè¿™æ ·å®ç°å¯ä»¥åŒæ—¶å¤„ç†å›æ–‡ä¸²é•¿åº¦ä¸ºå¥‡æ•°å’Œå¶æ•°çš„æƒ…å†µ</strong>ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">for</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> i <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">:</span>    # æ‰¾åˆ°ä»¥ s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> ä¸ºä¸­å¿ƒçš„å›æ–‡ä¸²    <span class="token function">palindrome</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> i<span class="token punctuation">,</span> i<span class="token punctuation">)</span>    # æ‰¾åˆ°ä»¥ s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> å’Œ s<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> ä¸ºä¸­å¿ƒçš„å›æ–‡ä¸²    <span class="token function">palindrome</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> i<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>    æ›´æ–°ç­”æ¡ˆ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸‹é¢çœ‹ä¸‹<code>longestPalindrome</code>çš„å®Œæ•´ä»£ç ï¼š</p><img src="/posts/38712/3.png"><h2 id="3-æ€»ç»“"><a href="#3-æ€»ç»“" class="headerlink" title="3. æ€»ç»“"></a>3. æ€»ç»“</h2><p>è‡³æ­¤ï¼Œè¿™é“æœ€é•¿å›æ–‡å­ä¸²çš„é—®é¢˜å°±è§£å†³äº†ï¼Œæ—¶é—´å¤æ‚åº¦ O(N^2)ï¼Œç©ºé—´å¤æ‚åº¦ O(1)ã€‚</p><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¿™ä¸ªé—®é¢˜å¯ä»¥ç”¨åŠ¨æ€è§„åˆ’æ–¹æ³•è§£å†³ï¼Œæ—¶é—´å¤æ‚åº¦ä¸€æ ·ï¼Œä½†æ˜¯ç©ºé—´å¤æ‚åº¦è‡³å°‘è¦ O(N^2) æ¥å­˜å‚¨ DP tableã€‚è¿™é“é¢˜æ˜¯å°‘æœ‰çš„åŠ¨æ€è§„åˆ’éæœ€ä¼˜è§£æ³•çš„é—®é¢˜ã€‚</p><p>å¦å¤–ï¼Œè¿™ä¸ªé—®é¢˜è¿˜æœ‰ä¸€ä¸ªå·§å¦™çš„è§£æ³•ï¼Œæ—¶é—´å¤æ‚åº¦åªéœ€è¦ O(N)ï¼Œä¸è¿‡è¯¥è§£æ³•æ¯”è¾ƒå¤æ‚</p><p>Manacherâ€™s Algorithmï¼ˆé©¬æ‹‰è½¦ç®—æ³•ï¼‰â€”ä»…ä¾›å‚è€ƒ</p>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³•å­¦ä¹ ä¹‹è·¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å›æ–‡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†ç»„åè½¬é“¾è¡¨ï¼ˆè¿­ä»£å®ç°ï¼‰</title>
      <link href="/posts/43987.html"/>
      <url>/posts/43987.html</url>
      
        <content type="html"><![CDATA[<p>åè½¬æ•´ä¸ªé“¾è¡¨ä¸æ˜¯éš¾äº‹ï¼Œåˆ†åŒºé—´åè½¬ä¹Ÿä¸åœ¨è¯ä¸‹</p><p>é‚£å¦‚æœæ˜¯å°†é“¾è¡¨åˆ†ç»„åè½¬ï¼Œæ€ä¹ˆå®ç°å‘¢ï¼Ÿ</p><h2 id="1-é¢˜ç›®"><a href="#1-é¢˜ç›®" class="headerlink" title="1. é¢˜ç›®"></a>1. é¢˜ç›®</h2><p>ç»™ä½ ä¸€ä¸€ä¸ªé“¾è¡¨ï¼Œæ¯kä¸ªèŠ‚ç‚¹ä¸€ç»„è¿›è¡Œç¿»è½¬,è¯·ä½ è¿”å›ç¿»è½¬åçš„é“¾è¡¨ã€‚</p><p>kæ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œå®ƒçš„å€¼å°äºæˆ–ç­‰äºé“¾è¡¨çš„é•¿åº¦ã€‚</p><p>å¦‚æœèŠ‚ç‚¹æ€»æ•°ä¸æ˜¯kçš„æ•´æ•°å€ï¼Œé‚£ä¹ˆè¯·å°†æœ€åå‰©ä½™çš„èŠ‚ç‚¹ä¿æŒåŸæœ‰é¡ºåºã€‚</p><p><strong>ç¤ºä¾‹</strong> :</p><p>   ç»™å®šè¿™ä¸ªé“¾è¡¨: 1-&gt;2-&gt;3-&gt;4-&gt;5</p><p>   å½“k=2æ—¶ï¼Œåº”å½“è¿”å›: 2-&gt;1-&gt;4-&gt;3-&gt;5</p><p>â€‹    å½“k=3æ—¶ï¼Œåº”å½“è¿”å›: 3-&gt;2-&gt;1-&gt;4-&gt;5 </p><p>è¿™ä¸ªé—®é¢˜ç»å¸¸åœ¨é¢ç»ä¸­çœ‹åˆ°ï¼Œè€Œä¸” LeetCode ä¸Šéš¾åº¦æ˜¯ Hardï¼Œå®ƒçœŸçš„æœ‰é‚£ä¹ˆéš¾å—ï¼Ÿ</p><p>å¯¹äºåŸºæœ¬æ•°æ®ç»“æ„çš„ç®—æ³•é—®é¢˜å…¶å®éƒ½ä¸éš¾ï¼Œåªè¦ç»“åˆç‰¹ç‚¹ä¸€ç‚¹ç‚¹æ‹†è§£åˆ†æï¼Œä¸€èˆ¬éƒ½æ²¡å•¥éš¾ç‚¹ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥æ‹†è§£ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚</p><h2 id="2-åˆ†æé—®é¢˜"><a href="#2-åˆ†æé—®é¢˜" class="headerlink" title="2. åˆ†æé—®é¢˜"></a>2. åˆ†æé—®é¢˜</h2><p>é¦–å…ˆï¼Œé“¾è¡¨æ˜¯ä¸€ç§å…¼å…·é€’å½’å’Œè¿­ä»£æ€§è´¨çš„æ•°æ®ç»“æ„ï¼Œè®¤çœŸæ€è€ƒä¸€ä¸‹å¯ä»¥å‘ç°<strong>è¿™ä¸ªé—®é¢˜å…·æœ‰é€’å½’æ€§è´¨</strong>ã€‚</p><p>ä»€ä¹ˆå«é€’å½’æ€§è´¨ï¼Ÿç›´æ¥ä¸Šå›¾ç†è§£ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬å¯¹è¿™ä¸ªé“¾è¡¨è°ƒç”¨</p><p><code>reverseKGroup(head, 2)</code>ï¼Œå³ä»¥ 2 ä¸ªèŠ‚ç‚¹ä¸ºä¸€ç»„åè½¬é“¾è¡¨ï¼š</p><img src="/posts/43987/1.png"><p>å¦‚æœæˆ‘è®¾æ³•æŠŠå‰ 2 ä¸ªèŠ‚ç‚¹åè½¬ï¼Œé‚£ä¹ˆåé¢çš„é‚£äº›èŠ‚ç‚¹æ€ä¹ˆå¤„ç†ï¼Ÿåé¢çš„è¿™äº›èŠ‚ç‚¹ä¹Ÿæ˜¯ä¸€æ¡é“¾è¡¨ï¼Œè€Œä¸”è§„æ¨¡ï¼ˆé•¿åº¦ï¼‰æ¯”åŸæ¥è¿™æ¡é“¾è¡¨å°ï¼Œè¿™å°±å«<strong>å­é—®é¢˜</strong>ã€‚</p><img src="/posts/43987/2.png"><p>æˆ‘ä»¬å¯ä»¥ç›´æ¥é€’å½’è°ƒç”¨ <code>reverseKGroup(head, 2)</code>ï¼Œå› ä¸ºå­é—®é¢˜å’ŒåŸé—®é¢˜çš„ç»“æ„å®Œå…¨ç›¸åŒï¼Œè¿™å°±æ˜¯æ‰€è°“çš„<strong>é€’å½’æ€§è´¨</strong>ã€‚</p><p>å‘ç°äº†é€’å½’æ€§è´¨ï¼Œå°±å¯ä»¥å¾—åˆ°å¤§è‡´çš„ç®—æ³•æµç¨‹ï¼š</p><p><strong>1ã€å…ˆåè½¬ä»¥ <code>head</code> å¼€å¤´çš„ <code>k</code> ä¸ªå…ƒç´ </strong>ã€‚</p><img src="/posts/43987/3.png"><p><strong>2ã€å°†ç¬¬ <code>k + 1</code> ä¸ªå…ƒç´ ä½œä¸º <code>head</code> é€’å½’è°ƒç”¨ <code>reverseKGroup</code> å‡½æ•°</strong>ã€‚</p><img src="/posts/43987/4.png"><p><strong>3ã€å°†ä¸Šè¿°ä¸¤ä¸ªè¿‡ç¨‹çš„ç»“æœè¿æ¥èµ·æ¥</strong>ã€‚</p><img src="/posts/43987/5.png"><p>æ•´ä½“æ€è·¯å°±æ˜¯è¿™æ ·äº†ï¼Œæœ€åä¸€ç‚¹å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œé€’å½’å‡½æ•°éƒ½æœ‰ä¸ª base caseï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>é¢˜ç›®è¯´äº†ï¼Œ<strong>å¦‚æœæœ€åçš„å…ƒç´ ä¸è¶³ <code>k</code> ä¸ªï¼Œå°±ä¿æŒä¸å˜ã€‚**</strong>è¿™å°±æ˜¯ base case**ï¼Œå¾…ä¼šä¼šåœ¨ä»£ç é‡Œä½“ç°ã€‚</p><h2 id="3-ä»£ç å®ç°"><a href="#3-ä»£ç å®ç°" class="headerlink" title="3. ä»£ç å®ç°"></a>3. ä»£ç å®ç°</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦å®ç°ä¸€ä¸ª <code>reverse</code> å‡½æ•°åè½¬ä¸€ä¸ªåŒºé—´ä¹‹å†…çš„å…ƒç´ ã€‚åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬å†ç®€åŒ–ä¸€ä¸‹ï¼Œç»™å®šé“¾è¡¨å¤´ç»“ç‚¹ï¼Œå¦‚ä½•åè½¬æ•´ä¸ªé“¾è¡¨ï¼Ÿ</p><p>è¿­ä»£å®ç°</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// åè½¬ä»¥ a ä¸ºå¤´ç»“ç‚¹çš„é“¾è¡¨</span>ListNode <span class="token function">reverse</span><span class="token punctuation">(</span>ListNode a<span class="token punctuation">)</span> <span class="token punctuation">{</span>    ListNode pre<span class="token punctuation">,</span> cur<span class="token punctuation">,</span> nxt<span class="token punctuation">;</span>    pre <span class="token operator">=</span> null<span class="token punctuation">;</span> cur <span class="token operator">=</span> a<span class="token punctuation">;</span> nxt <span class="token operator">=</span> a<span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>        nxt <span class="token operator">=</span> cur<span class="token punctuation">.</span>next<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// é€ä¸ªç»“ç‚¹åè½¬</span>        cur<span class="token punctuation">.</span>next <span class="token operator">=</span> pre<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// æ›´æ–°æŒ‡é’ˆä½ç½®</span>        pre <span class="token operator">=</span> cur<span class="token punctuation">;</span>        cur <span class="token operator">=</span> nxt<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// è¿”å›åè½¬åçš„å¤´ç»“ç‚¹</span>    <span class="token keyword">return</span> pre<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ã€Œåè½¬ä»¥ <code>a</code> ä¸ºå¤´ç»“ç‚¹çš„é“¾è¡¨ã€å…¶å®å°±æ˜¯ã€Œåè½¬ <code>a</code> åˆ° null ä¹‹é—´çš„ç»“ç‚¹ã€ï¼Œé‚£ä¹ˆå¦‚æœè®©ä½ ã€Œåè½¬ <code>a</code> åˆ° <code>b</code> ä¹‹é—´çš„ç»“ç‚¹ã€ï¼Œä½ ä¼šä¸ä¼šï¼Ÿ</p><p>åªè¦æ›´æ”¹å‡½æ•°ç­¾åï¼Œå¹¶æŠŠä¸Šé¢çš„ä»£ç ä¸­ <code>null</code> æ”¹æˆ <code>b</code> å³å¯ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** åè½¬åŒºé—´ [a, b) çš„å…ƒç´ ï¼Œæ³¨æ„æ˜¯å·¦é—­å³å¼€ */</span>ListNode <span class="token function">reverse</span><span class="token punctuation">(</span>ListNode a<span class="token punctuation">,</span> ListNode b<span class="token punctuation">)</span> <span class="token punctuation">{</span>    ListNode pre<span class="token punctuation">,</span> cur<span class="token punctuation">,</span> nxt<span class="token punctuation">;</span>    pre <span class="token operator">=</span> null<span class="token punctuation">;</span> cur <span class="token operator">=</span> a<span class="token punctuation">;</span> nxt <span class="token operator">=</span> a<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// while ç»ˆæ­¢çš„æ¡ä»¶æ”¹ä¸€ä¸‹å°±è¡Œäº†</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">!=</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>        nxt <span class="token operator">=</span> cur<span class="token punctuation">.</span>next<span class="token punctuation">;</span>        cur<span class="token punctuation">.</span>next <span class="token operator">=</span> pre<span class="token punctuation">;</span>        pre <span class="token operator">=</span> cur<span class="token punctuation">;</span>        cur <span class="token operator">=</span> nxt<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// è¿”å›åè½¬åçš„å¤´ç»“ç‚¹</span>    <span class="token keyword">return</span> pre<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç°åœ¨æˆ‘ä»¬è¿­ä»£å®ç°äº†åè½¬éƒ¨åˆ†é“¾è¡¨çš„åŠŸèƒ½ï¼Œæ¥ä¸‹æ¥å°±æŒ‰ç…§ä¹‹å‰çš„é€»è¾‘ç¼–å†™<code>reverseKGroup</code> å‡½æ•°å³å¯ï¼š</p><pre class="line-numbers language-java"><code class="language-java">ListNode <span class="token function">reverseKGroup</span><span class="token punctuation">(</span>ListNode head<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>head <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token keyword">return</span> null<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// åŒºé—´ [a, b) åŒ…å« k ä¸ªå¾…åè½¬å…ƒç´ </span>    ListNode a<span class="token punctuation">,</span> b<span class="token punctuation">;</span>    a <span class="token operator">=</span> b <span class="token operator">=</span> head<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> k<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// ä¸è¶³ k ä¸ªï¼Œä¸éœ€è¦åè½¬ï¼Œbase case</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token keyword">return</span> head<span class="token punctuation">;</span>        b <span class="token operator">=</span> b<span class="token punctuation">.</span>next<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// åè½¬å‰ k ä¸ªå…ƒç´ </span>    ListNode newHead <span class="token operator">=</span> <span class="token function">reverse</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// é€’å½’åè½¬åç»­é“¾è¡¨å¹¶è¿æ¥èµ·æ¥</span>    a<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token function">reverseKGroup</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> newHead<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è§£é‡Šä¸€ä¸‹ <code>for</code> å¾ªç¯ä¹‹åçš„å‡ å¥ä»£ç ï¼Œæ³¨æ„ <code>reverse</code> å‡½æ•°æ˜¯åè½¬åŒºé—´ <code>[a, b)</code>ï¼Œæ‰€ä»¥æƒ…å½¢æ˜¯è¿™æ ·çš„ï¼š</p><img src="/posts/43987/6.png"><p>é€’å½’éƒ¨åˆ†å°±ä¸å±•å¼€äº†ï¼Œæ•´ä¸ªå‡½æ•°é€’å½’å®Œæˆä¹‹åå°±æ˜¯è¿™ä¸ªç»“æœï¼Œå®Œå…¨ç¬¦åˆé¢˜æ„ï¼š</p><img src="/posts/43987/7.png">]]></content>
      
      
      <categories>
          
          <category> ç®—æ³•å­¦ä¹ ä¹‹è·¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é“¾è¡¨ </tag>
            
            <tag> è¿­ä»£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åè½¬é“¾è¡¨--ä¸€çœ‹å°±æ‡‚ï¼ˆé€’å½’ï¼‰</title>
      <link href="/posts/4493.html"/>
      <url>/posts/4493.html</url>
      
        <content type="html"><![CDATA[<p>åè½¬å•é“¾è¡¨çš„è¿­ä»£å®ç°ä¸æ˜¯ä¸€ä¸ªå›°éš¾çš„äº‹æƒ…ï¼Œä½†æ˜¯é€’å½’å®ç°å°±æœ‰ç‚¹éš¾åº¦äº†ï¼Œå¦‚æœå†åŠ ä¸€ç‚¹éš¾åº¦ï¼Œä»…ä»…åè½¬å•é“¾è¡¨ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯å…¨éƒ¨åè½¬ï¼Œåº”è¯¥æ€ä¹ˆå®ç°å‘¢??</p><h2 id="1-åè½¬æ•´ä¸ªå•é“¾è¡¨"><a href="#1-åè½¬æ•´ä¸ªå•é“¾è¡¨" class="headerlink" title="1. åè½¬æ•´ä¸ªå•é“¾è¡¨"></a>1. åè½¬æ•´ä¸ªå•é“¾è¡¨</h2><p>å¼€å§‹äº†</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// å•é“¾è¡¨çš„ç»“æ„</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ListNode</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> val<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//å½“å‰å€¼</span>    ListNode next<span class="token punctuation">;</span>     <span class="token function">ListNode</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> val <span class="token operator">=</span> x<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¼€å§‹ä¸Šé€’å½’ä»£ç </p><pre class="line-numbers language-java"><code class="language-java">ListNode <span class="token function">reverse</span><span class="token punctuation">(</span>ListNode head<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>head<span class="token punctuation">.</span>next <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token keyword">return</span> head<span class="token punctuation">;</span>    ListNode last <span class="token operator">=</span> <span class="token function">reverse</span><span class="token punctuation">(</span>head<span class="token punctuation">.</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>    head<span class="token punctuation">.</span>next<span class="token punctuation">.</span>next <span class="token operator">=</span> head<span class="token punctuation">;</span>    head<span class="token punctuation">.</span>next <span class="token operator">=</span> null<span class="token punctuation">;</span>    <span class="token keyword">return</span> last<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹èµ·æ¥æ˜¯ä¸æ˜¯æ„Ÿè§‰ä¸çŸ¥æ‰€äº‘ï¼Œå®Œå…¨ä¸èƒ½ç†è§£è¿™æ ·ä¸ºä»€ä¹ˆèƒ½å¤Ÿåè½¬é“¾è¡¨ï¼Ÿ</p><p>è¿™å°±å¯¹äº†ï¼Œè¿™ä¸ªç®—æ³•å¸¸å¸¸æ‹¿æ¥æ˜¾ç¤ºé€’å½’çš„å·§å¦™å’Œä¼˜ç¾ï¼Œæˆ‘ä»¬ä¸‹é¢æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹è¿™æ®µä»£ç ã€‚</p><p><strong>å¯¹äºé€’å½’ç®—æ³•ï¼Œæœ€é‡è¦çš„å°±æ˜¯æ˜ç¡®é€’å½’å‡½æ•°çš„å®šä¹‰</strong>ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬çš„<code>reverse</code>å‡½æ•°å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š</p><p><strong>è¾“å…¥ä¸€ä¸ªèŠ‚ç‚¹<code>head</code>ï¼Œå°†ã€Œä»¥<code>head</code>ä¸ºèµ·ç‚¹ã€çš„é“¾è¡¨åè½¬ï¼Œå¹¶è¿”å›åè½¬ä¹‹åçš„å¤´ç»“ç‚¹</strong>ã€‚</p><p>æ˜ç™½äº†å‡½æ•°çš„å®šä¹‰ï¼Œå†æ¥çœ‹è¿™ä¸ªé—®é¢˜ã€‚æ¯”å¦‚è¯´æˆ‘ä»¬æƒ³åè½¬è¿™ä¸ªé“¾è¡¨ï¼š</p><img src="/posts/4493/1.png"><p>é‚£ä¹ˆè¾“å…¥<code>reverse(head)</code>åï¼Œä¼šåœ¨è¿™é‡Œè¿›è¡Œé€’å½’ï¼š</p><pre class="line-numbers language-java"><code class="language-java">ListNode last <span class="token operator">=</span> <span class="token function">reverse</span><span class="token punctuation">(</span>head<span class="token punctuation">.</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸è¦è·³è¿›é€’å½’ï¼ˆä½ çš„è„‘è¢‹èƒ½å‹å‡ ä¸ªæ ˆå‘€ï¼Ÿï¼‰ï¼Œè€Œæ˜¯è¦æ ¹æ®åˆšæ‰çš„å‡½æ•°å®šä¹‰ï¼Œæ¥å¼„æ¸…æ¥šè¿™æ®µä»£ç ä¼šäº§ç”Ÿä»€ä¹ˆç»“æœï¼š</p>{% asset_img 2.png %}<p>æŒ‰ç…§å®šä¹‰ï¼Œè¿™ä¸ª<code>reverse(head.next)</code>æ‰§è¡Œå®Œæˆåï¼Œæ•´ä¸ªé“¾è¡¨åº”è¯¥å˜æˆäº†è¿™æ ·ï¼š</p>{% asset_img 3.png %}<p>å¹¶ä¸”æ ¹æ®å‡½æ•°å®šä¹‰ï¼Œ<code>reverse</code>å‡½æ•°ä¼šè¿”å›åè½¬ä¹‹åçš„å¤´ç»“ç‚¹ï¼Œæˆ‘ä»¬ç”¨å˜é‡<code>last</code>æ¥æ”¶äº†ã€‚</p><p>ç°åœ¨å†æ¥çœ‹ä¸‹é¢çš„ä»£ç ï¼š</p><pre class="line-numbers language-java"><code class="language-java">head<span class="token punctuation">.</span>next<span class="token punctuation">.</span>next <span class="token operator">=</span> head<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="/posts/4493/4.png"><p>æ¥ä¸‹æ¥è¿›è¡Œçš„æ“ä½œï¼š</p><pre class="line-numbers language-java"><code class="language-java">head<span class="token punctuation">.</span>next <span class="token operator">=</span> null<span class="token punctuation">;</span><span class="token keyword">return</span> last<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><img src="/posts/4493/5.png"><p>ç¥ä¸ç¥å¥‡ï¼Œè¿™æ ·æ•´ä¸ªé“¾è¡¨å°±åè½¬è¿‡æ¥äº†ï¼é€’å½’ä»£ç å°±æ˜¯è¿™ä¹ˆç®€æ´ä¼˜é›…ï¼Œä¸è¿‡å…¶ä¸­æœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼š</p><p><strong>1ã€é€’å½’å‡½æ•°è¦æœ‰ base case</strong>ï¼Œä¹Ÿå°±æ˜¯è¿™å¥ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>head<span class="token punctuation">.</span>next <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token keyword">return</span> head<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ„æ€æ˜¯å¦‚æœé“¾è¡¨åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™åè½¬ä¹Ÿæ˜¯å®ƒè‡ªå·±ï¼Œç›´æ¥è¿”å›å³å¯ã€‚</p><p><strong>2ã€å½“é“¾è¡¨é€’å½’åè½¬ä¹‹åï¼Œæ–°çš„å¤´èŠ‚ç‚¹æ˜¯<code>last</code>ï¼Œè€Œä¹‹å‰çš„<code>head</code>å˜æˆäº†æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ«å¿˜äº†é“¾è¡¨çš„æœ«å°¾è¦æŒ‡å‘ nullï¼š</strong></p><pre><code>head.next = null;</code></pre><p>ç†è§£äº†è¿™ä¸¤ç‚¹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›ä¸€æ­¥æ·±å…¥äº†ï¼Œæ¥ä¸‹æ¥çš„é—®é¢˜å…¶å®éƒ½æ˜¯åœ¨è¿™ä¸ªç®—æ³•ä¸Šçš„æ‰©å±•ã€‚</p><h2 id="2-åè½¬é“¾è¡¨å‰Nä¸ªèŠ‚ç‚¹"><a href="#2-åè½¬é“¾è¡¨å‰Nä¸ªèŠ‚ç‚¹" class="headerlink" title="2. åè½¬é“¾è¡¨å‰Nä¸ªèŠ‚ç‚¹"></a>2. åè½¬é“¾è¡¨å‰Nä¸ªèŠ‚ç‚¹</h2><p>è¿™æ¬¡æˆ‘ä»¬å®ç°ä¸€ä¸ªè¿™æ ·çš„å‡½æ•°ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// å°†é“¾è¡¨çš„å‰ n ä¸ªèŠ‚ç‚¹åè½¬ï¼ˆn &lt;= é“¾è¡¨é•¿åº¦ï¼‰</span>ListNode <span class="token function">reverseN</span><span class="token punctuation">(</span>ListNode head<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ¯”å¦‚è¯´å¯¹äºä¸‹å›¾é“¾è¡¨ï¼Œæ‰§è¡Œ<code>reverseN(head, 3)</code>ï¼š</p><img src="/posts/4493/6.png"><p>è§£å†³æ€è·¯å’Œåè½¬æ•´ä¸ªé“¾è¡¨å·®ä¸å¤šï¼Œåªè¦ç¨åŠ ä¿®æ”¹å³å¯ï¼š</p><pre class="line-numbers language-java"><code class="language-java">ListNode successor <span class="token operator">=</span> null<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// åé©±èŠ‚ç‚¹ï¼Œä½œç”¨å…·ä½“çœ‹åé¢çš„åŒºåˆ«</span><span class="token comment" spellcheck="true">// åè½¬ä»¥ head ä¸ºèµ·ç‚¹çš„ n ä¸ªèŠ‚ç‚¹ï¼Œè¿”å›æ–°çš„å¤´ç»“ç‚¹</span>ListNode <span class="token function">reverseN</span><span class="token punctuation">(</span>ListNode head<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token comment" spellcheck="true">// è®°å½•ç¬¬ n + 1 ä¸ªèŠ‚ç‚¹</span>        successor <span class="token operator">=</span> head<span class="token punctuation">.</span>next<span class="token punctuation">;</span>        <span class="token keyword">return</span> head<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// ä»¥ head.next ä¸ºèµ·ç‚¹ï¼Œéœ€è¦åè½¬å‰ n - 1 ä¸ªèŠ‚ç‚¹,å› ä¸ºheadä¸åè½¬</span>    ListNode last <span class="token operator">=</span> <span class="token function">reverseN</span><span class="token punctuation">(</span>head<span class="token punctuation">.</span>next<span class="token punctuation">,</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    head<span class="token punctuation">.</span>next<span class="token punctuation">.</span>next <span class="token operator">=</span> head<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// è®©åè½¬ä¹‹åçš„ head èŠ‚ç‚¹å’Œåé¢çš„èŠ‚ç‚¹è¿èµ·æ¥</span>    head<span class="token punctuation">.</span>next <span class="token operator">=</span> successor<span class="token punctuation">;</span>    <span class="token keyword">return</span> last<span class="token punctuation">;</span><span class="token punctuation">}</span>    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…·ä½“çš„åŒºåˆ«ï¼š</p><p>1ã€base case å˜ä¸º<code>n == 1</code>ï¼Œåè½¬ä¸€ä¸ªå…ƒç´ ï¼Œå°±æ˜¯å®ƒæœ¬èº«ï¼ŒåŒæ—¶<strong>è¦è®°å½•åé©±èŠ‚ç‚¹</strong>ã€‚</p><p>2ã€åˆšæ‰æˆ‘ä»¬ç›´æ¥æŠŠ<code>head.next</code>è®¾ç½®ä¸º nullï¼Œå› ä¸ºæ•´ä¸ªé“¾è¡¨åè½¬ååŸæ¥çš„<code>head</code>å˜æˆäº†æ•´ä¸ªé“¾è¡¨çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ã€‚ä½†ç°åœ¨<code>head</code>èŠ‚ç‚¹åœ¨é€’å½’åè½¬ä¹‹åä¸ä¸€å®šæ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹äº†ï¼Œæ‰€ä»¥è¦è®°å½•åé©±<code>successor</code>ï¼ˆç¬¬ n + 1 ä¸ªèŠ‚ç‚¹ï¼‰ï¼Œåè½¬ä¹‹åå°†<code>head</code>è¿æ¥ä¸Šã€‚</p><img src="/posts/4493/7.png"><p>OKï¼Œå¦‚æœè¿™ä¸ªå‡½æ•°ä½ ä¹Ÿèƒ½çœ‹æ‡‚ï¼Œå°±ç¦»å®ç°ã€Œåè½¬ä¸€éƒ¨åˆ†é“¾è¡¨ã€ä¸è¿œäº†ã€‚</p><h2 id="3-åè½¬é“¾è¡¨çš„ä¸€éƒ¨åˆ†"><a href="#3-åè½¬é“¾è¡¨çš„ä¸€éƒ¨åˆ†" class="headerlink" title="3. åè½¬é“¾è¡¨çš„ä¸€éƒ¨åˆ†"></a>3. åè½¬é“¾è¡¨çš„ä¸€éƒ¨åˆ†</h2><p>ç°åœ¨è§£å†³æˆ‘ä»¬æœ€å¼€å§‹æå‡ºçš„é—®é¢˜ï¼Œç»™ä¸€ä¸ªç´¢å¼•åŒºé—´<code>[m,n]</code>ï¼ˆç´¢å¼•ä» 1 å¼€å§‹ï¼‰ï¼Œä»…ä»…åè½¬åŒºé—´ä¸­çš„é“¾è¡¨å…ƒç´ ã€‚</p><pre class="line-numbers language-java"><code class="language-java">ListNode <span class="token function">reverseBetween</span><span class="token punctuation">(</span>ListNode head<span class="token punctuation">,</span> <span class="token keyword">int</span> m<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é¦–å…ˆï¼Œå¦‚æœ<code>m == 1</code>ï¼Œå°±ç›¸å½“äºåè½¬é“¾è¡¨å¼€å¤´çš„<code>n</code>ä¸ªå…ƒç´ å˜›ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åˆšæ‰å®ç°çš„åŠŸèƒ½ï¼š</p><pre class="line-numbers language-java"><code class="language-java">ListNode <span class="token function">reverseBetween</span><span class="token punctuation">(</span>ListNode head<span class="token punctuation">,</span> <span class="token keyword">int</span> m<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// base case</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>m <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// ç›¸å½“äºåè½¬å‰ n ä¸ªå…ƒç´ </span>        <span class="token keyword">return</span> <span class="token function">reverseN</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ<code>m != 1</code>æ€ä¹ˆåŠï¼Ÿå¦‚æœæˆ‘ä»¬æŠŠ<code>head</code>çš„ç´¢å¼•è§†ä¸º 1ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯æƒ³ä»ç¬¬<code>m</code>ä¸ªå…ƒç´ å¼€å§‹åè½¬å¯¹å§ï¼›å¦‚æœæŠŠ<code>head.next</code>çš„ç´¢å¼•è§†ä¸º 1 å‘¢ï¼Ÿé‚£ä¹ˆç›¸å¯¹äº<code>head.next</code>ï¼Œåè½¬çš„åŒºé—´åº”è¯¥æ˜¯ä»ç¬¬<code>m - 1</code>ä¸ªå…ƒç´ å¼€å§‹çš„ï¼›é‚£ä¹ˆå¯¹äº<code>head.next.next</code>å‘¢â€¦â€¦</p><p>åŒºåˆ«äºè¿­ä»£æ€æƒ³ï¼Œè¿™å°±æ˜¯é€’å½’æ€æƒ³ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å®Œæˆä»£ç ï¼š</p><pre class="line-numbers language-java"><code class="language-java">ListNode <span class="token function">reverseBetween</span><span class="token punctuation">(</span>ListNode head<span class="token punctuation">,</span> <span class="token keyword">int</span> m<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// base case</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>m <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">reverseN</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// å‰è¿›åˆ°åè½¬çš„èµ·ç‚¹è§¦å‘ base case</span>    head<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token function">reverseBetween</span><span class="token punctuation">(</span>head<span class="token punctuation">.</span>next<span class="token punctuation">,</span> m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> head<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„æœ€ç»ˆå¤§ BOSS å°±è¢«è§£å†³äº†ã€‚</p><h2 id="4-æœ€åæ€»ç»“"><a href="#4-æœ€åæ€»ç»“" class="headerlink" title="4. æœ€åæ€»ç»“"></a>4. æœ€åæ€»ç»“</h2><p>é€’å½’çš„æ€æƒ³ç›¸å¯¹è¿­ä»£æ€æƒ³ï¼Œç¨å¾®æœ‰ç‚¹éš¾ä»¥ç†è§£ï¼Œå¤„ç†çš„æŠ€å·§æ˜¯ï¼šä¸è¦è·³è¿›é€’å½’ï¼Œè€Œæ˜¯åˆ©ç”¨æ˜ç¡®çš„å®šä¹‰æ¥å®ç°ç®—æ³•é€»è¾‘ã€‚</p><p>å¤„ç†çœ‹èµ·æ¥æ¯”è¾ƒå›°éš¾çš„é—®é¢˜ï¼Œå¯ä»¥å°è¯•åŒ–æ•´ä¸ºé›¶ï¼ŒæŠŠä¸€äº›ç®€å•çš„è§£æ³•è¿›è¡Œä¿®æ”¹ï¼Œè§£å†³å›°éš¾çš„é—®é¢˜ã€‚</p><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ<strong>é€’å½’æ“ä½œé“¾è¡¨å¹¶ä¸é«˜æ•ˆã€‚</strong>å’Œè¿­ä»£è§£æ³•ç›¸æ¯”ï¼Œè™½ç„¶æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(N)ï¼Œä½†æ˜¯è¿­ä»£è§£æ³•çš„ç©ºé—´å¤æ‚åº¦æ˜¯ O(1)ï¼Œè€Œé€’å½’è§£æ³•éœ€è¦å †æ ˆï¼Œç©ºé—´å¤æ‚åº¦æ˜¯ O(N)ã€‚æ‰€ä»¥é€’å½’æ“ä½œé“¾è¡¨å¯ä»¥ä½œä¸ºå¯¹é€’å½’ç®—æ³•çš„ç»ƒä¹ æˆ–è€…æ‹¿å»å’Œå°ä¼™ä¼´è£…é€¼ï¼Œä½†æ˜¯è€ƒè™‘æ•ˆç‡çš„è¯è¿˜æ˜¯ä½¿ç”¨è¿­ä»£ç®—æ³•æ›´å¥½ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³•å­¦ä¹ ä¹‹è·¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é“¾è¡¨ </tag>
            
            <tag> é€’å½’ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerå…¥é—¨åˆ°ç²¾é€š--çº¯äº«ç‰ˆ</title>
      <link href="/posts/7608.html"/>
      <url>/posts/7608.html</url>
      
        <content type="html"><![CDATA[<p> dockerä»å…¥é—¨åˆ°ç²¾é€šå°±çœ‹è¿™ä¸ªå°±å¤Ÿäº†ã€‚dockeræ˜¯å¹²ä»€ä¹ˆçš„å‘¢ï¼Œä¸»è¦å°±æ˜¯å®¹å™¨æŠ€æœ¯</p><p>dockerå°±å¾ˆå¥½è§£å†³äº†ç¯å¢ƒéš”ç¦»çš„é—®é¢˜ï¼Œåˆ«äººç¨‹åºä¸ä¼šå½±å“åˆ°è‡ªå·±çš„ç¨‹åº</p><h1 id="docker-pull-redisDocker"><a href="#docker-pull-redisDocker" class="headerlink" title="docker pull redisDocker"></a>docker pull redisDocker</h1><ul><li><p>å®˜æ–¹æ–‡æ¡£åœ°å€:<a href="https://www.docker.com/get-started" target="_blank" rel="noopener">https://www.docker.com/get-started</a></p></li><li><p>ä¸­æ–‡å‚è€ƒæ‰‹å†Œ:<a href="https://docker_practice.gitee.io/zh-cn/" target="_blank" rel="noopener">https://docker_practice.gitee.io/zh-cn/</a></p></li></ul><h2 id="1-ä»€ä¹ˆæ˜¯-Docker"><a href="#1-ä»€ä¹ˆæ˜¯-Docker" class="headerlink" title="1.ä»€ä¹ˆæ˜¯ Docker"></a>1.ä»€ä¹ˆæ˜¯ Docker</h2><h3 id="1-1-å®˜æ–¹å®šä¹‰"><a href="#1-1-å®˜æ–¹å®šä¹‰" class="headerlink" title="1.1 å®˜æ–¹å®šä¹‰"></a>1.1 å®˜æ–¹å®šä¹‰</h3><p>æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„å®¹å™¨è§£å†³æ–¹æ¡ˆ,ä¸ç®¡ä½ æ˜¯è°,ä¸ç®¡ä½ åœ¨å“ª,ä½ éƒ½å¯ä»¥å¼€å§‹å®¹å™¨çš„çš„æ—…ç¨‹ã€‚</p><ul><li>å®˜æ–¹å®šä¹‰: dockeræ˜¯ä¸€ä¸ªå®¹å™¨æŠ€æœ¯ã€‚</li></ul><h3 id="1-2-Dockerçš„èµ·æº"><a href="#1-2-Dockerçš„èµ·æº" class="headerlink" title="1.2 Dockerçš„èµ·æº"></a>1.2 Dockerçš„èµ·æº</h3><p>Docker æœ€åˆæ˜¯ dotCloud å…¬å¸åˆ›å§‹äºº Solomon Hykes åœ¨æ³•å›½æœŸé—´å‘èµ·çš„ä¸€ä¸ªå…¬å¸å†…éƒ¨é¡¹ç›®ï¼Œå®ƒæ˜¯åŸºäº dotCloud å…¬å¸å¤šå¹´äº‘æœåŠ¡æŠ€æœ¯çš„ä¸€æ¬¡é©æ–°ï¼Œå¹¶äº 2013 å¹´ 3 æœˆä»¥ Apache 2.0 æˆæƒåè®®å¼€æºï¼Œä¸»è¦é¡¹ç›®ä»£ç åœ¨ GitHub ä¸Šè¿›è¡Œç»´æŠ¤ã€‚Docker é¡¹ç›®åæ¥è¿˜åŠ å…¥äº† Linux åŸºé‡‘ä¼šï¼Œå¹¶æˆç«‹æ¨åŠ¨ å¼€æ”¾å®¹å™¨è”ç›Ÿï¼ˆOCIï¼‰ã€‚</p><p>Docker è‡ªå¼€æºåå—åˆ°å¹¿æ³›çš„å…³æ³¨å’Œè®¨è®ºï¼Œè‡³ä»Šå…¶ GitHub é¡¹ç›® å·²ç»è¶…è¿‡ 5 ä¸‡ 7 åƒä¸ªæ˜Ÿæ ‡å’Œä¸€ä¸‡å¤šä¸ª forkã€‚ç”šè‡³ç”±äº Docker é¡¹ç›®çš„ç«çˆ†ï¼Œåœ¨ 2013 å¹´åº•ï¼ŒdotCloud å…¬å¸å†³å®šæ”¹åä¸º Dockerã€‚Docker æœ€åˆæ˜¯åœ¨ Ubuntu 12.04 ä¸Šå¼€å‘å®ç°çš„ï¼›Red Hat åˆ™ä» RHEL 6.5 å¼€å§‹å¯¹ Docker è¿›è¡Œæ”¯æŒï¼›Google ä¹Ÿåœ¨å…¶ PaaS äº§å“ä¸­å¹¿æ³›åº”ç”¨ Dockerã€‚</p><p>Docker ä½¿ç”¨ Google å…¬å¸æ¨å‡ºçš„ Go è¯­è¨€ è¿›è¡Œå¼€å‘å®ç°ï¼ŒåŸºäº Linux å†…æ ¸çš„ cgroupï¼Œnamespaceï¼Œä»¥åŠ OverlayFS ç±»çš„ Union FS ç­‰æŠ€æœ¯ï¼Œå¯¹è¿›ç¨‹è¿›è¡Œå°è£…éš”ç¦»ï¼Œå±äºæ“ä½œç³»ç»Ÿå±‚é¢çš„è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚ç”±äºéš”ç¦»çš„è¿›ç¨‹ç‹¬ç«‹äºå®¿ä¸»å’Œå…¶å®ƒçš„éš”ç¦»çš„è¿›ç¨‹ï¼Œå› æ­¤ä¹Ÿç§°å…¶ä¸ºå®¹å™¨ã€‚</p><h2 id="2-ä¸ºä»€ä¹ˆæ˜¯Docker"><a href="#2-ä¸ºä»€ä¹ˆæ˜¯Docker" class="headerlink" title="2.ä¸ºä»€ä¹ˆæ˜¯Docker"></a>2.ä¸ºä»€ä¹ˆæ˜¯Docker</h2><ul><li><p><code>åœ¨å¼€å‘çš„æ—¶å€™ï¼Œåœ¨æœ¬æœºæµ‹è¯•ç¯å¢ƒå¯ä»¥è·‘ï¼Œç”Ÿäº§ç¯å¢ƒè·‘ä¸èµ·æ¥</code></p><p>è¿™é‡Œæˆ‘ä»¬æ‹¿java Webåº”ç”¨ç¨‹åºä¸¾ä¾‹ï¼Œæˆ‘ä»¬ä¸€ä¸ªjava Webåº”ç”¨ç¨‹åºæ¶‰åŠå¾ˆå¤šä¸œè¥¿ï¼Œæ¯”å¦‚jdkã€tomcatã€mysqlç­‰è½¯ä»¶ç¯å¢ƒã€‚å½“è¿™äº›å…¶ä¸­æŸä¸€é¡¹ç‰ˆæœ¬ä¸ä¸€è‡´çš„æ—¶å€™ï¼Œå¯èƒ½å°±ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºè·‘ä¸èµ·æ¥è¿™ç§æƒ…å†µã€‚Dockeråˆ™å°†ç¨‹åºä»¥åŠä½¿ç”¨è½¯ä»¶ç¯å¢ƒç›´æ¥æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œæ— è®ºåœ¨é‚£ä¸ªæœºå™¨ä¸Šä¿è¯äº†ç¯å¢ƒä¸€è‡´ã€‚</p><p><strong>ä¼˜åŠ¿1:  ä¸€è‡´çš„è¿è¡Œç¯å¢ƒ,æ›´è½»æ¾çš„è¿ç§»</strong></p></li></ul><ul><li><p><code>æœåŠ¡å™¨è‡ªå·±çš„ç¨‹åºæŒ‚äº†ï¼Œç»“æœå‘ç°æ˜¯åˆ«äººç¨‹åºå‡ºäº†é—®é¢˜æŠŠå†…å­˜åƒå®Œäº†ï¼Œè‡ªå·±ç¨‹åºå› ä¸ºå†…å­˜ä¸å¤Ÿå°±æŒ‚äº†</code></p><p>è¿™ç§ä¹Ÿæ˜¯ä¸€ç§æ¯”è¾ƒå¸¸è§çš„æƒ…å†µï¼Œå¦‚æœä½ çš„ç¨‹åºé‡è¦æ€§ä¸æ˜¯ç‰¹åˆ«é«˜çš„è¯ï¼Œå…¬å¸åŸºæœ¬ä¸Šä¸å¯èƒ½è®©ä½ çš„ç¨‹åºç‹¬äº«ä¸€å°æœåŠ¡å™¨çš„ï¼Œè¿™æ—¶å€™ä½ çš„æœåŠ¡å™¨å°±ä¼šè·Ÿå…¬å¸å…¶ä»–äººçš„ç¨‹åºå…±äº«ä¸€å°æœåŠ¡å™¨ï¼Œæ‰€ä»¥ä¸å¯é¿å…åœ°å°±ä¼šå—åˆ°å…¶ä»–ç¨‹åºçš„å¹²æ‰°ï¼Œå¯¼è‡´è‡ªå·±çš„ç¨‹åºå‡ºç°é—®é¢˜ã€‚Dockerå°±å¾ˆå¥½è§£å†³äº†ç¯å¢ƒéš”ç¦»çš„é—®é¢˜ï¼Œåˆ«äººç¨‹åºä¸ä¼šå½±å“åˆ°è‡ªå·±çš„ç¨‹åºã€‚</p><p><strong>ä¼˜åŠ¿2ï¼šå¯¹è¿›ç¨‹è¿›è¡Œå°è£…éš”ç¦»,å®¹å™¨ä¸å®¹å™¨ä¹‹é—´äº’ä¸å½±å“,æ›´é«˜æ•ˆçš„åˆ©ç”¨ç³»ç»Ÿèµ„æº</strong></p></li></ul><ul><li><p><code>å…¬å¸è¦å¼„ä¸€ä¸ªæ´»åŠ¨ï¼Œå¯èƒ½ä¼šæœ‰å¤§é‡çš„æµé‡è¿›æ¥ï¼Œå…¬å¸éœ€è¦å†å¤šéƒ¨ç½²å‡ åå°æœåŠ¡å™¨</code></p><p>åœ¨æ²¡æœ‰Dockerçš„æƒ…å†µä¸‹ï¼Œè¦åœ¨å‡ å¤©å†…éƒ¨ç½²å‡ åå°æœåŠ¡å™¨ï¼Œè¿™å¯¹è¿ç»´æ¥è¯´æ˜¯ä¸€ä»¶éå¸¸æŠ˜ç£¨äººçš„äº‹ï¼Œè€Œä¸”æ¯å°æœåŠ¡å™¨çš„ç¯å¢ƒè¿˜ä¸ä¸€å®šä¸€æ ·ï¼Œå°±ä¼šå‡ºç°å„ç§é—®é¢˜ï¼Œæœ€åéƒ¨ç½²åœ°å¤´çš®å‘éº»ã€‚ç”¨Dockerçš„è¯ï¼Œæˆ‘åªéœ€è¦å°†ç¨‹åºæ‰“åŒ…åˆ°é•œåƒï¼Œä½ è¦å¤šå°‘å°æœåŠ¡ï¼Œæˆ‘å°±ç»™åŠ›è·‘å¤šå°‘å®¹å™¨ï¼Œæå¤§åœ°æé«˜äº†éƒ¨ç½²æ•ˆç‡ã€‚</p><p><strong>ä¼˜åŠ¿3: é€šè¿‡é•œåƒå¤åˆ¶Nå¤šä¸ªç¯å¢ƒä¸€è‡´å®¹å™¨</strong></p></li></ul><hr><h2 id="3-Dockerå’Œè™šæ‹ŸæœºåŒºåˆ«"><a href="#3-Dockerå’Œè™šæ‹ŸæœºåŒºåˆ«" class="headerlink" title="3.Dockerå’Œè™šæ‹ŸæœºåŒºåˆ«"></a>3.Dockerå’Œè™šæ‹ŸæœºåŒºåˆ«</h2><blockquote><p>å…³äºDockerä¸è™šæ‹Ÿæœºçš„åŒºåˆ«ï¼Œæˆ‘åœ¨ç½‘ä¸Šæ‰¾åˆ°çš„ä¸€å¼ å›¾ï¼Œéå¸¸ç›´è§‚å½¢è±¡åœ°å±•ç¤ºå‡ºæ¥ï¼Œè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šå›¾ã€‚</p><img src="/posts/7608/image-20201220222456675.png"></blockquote><p><code>æ¯”è¾ƒä¸Šé¢ä¸¤å¼ å›¾ï¼Œæˆ‘ä»¬å‘ç°è™šæ‹Ÿæœºæ˜¯æºå¸¦æ“ä½œç³»ç»Ÿï¼Œæœ¬èº«å¾ˆå°çš„åº”ç”¨ç¨‹åºå´å› ä¸ºæºå¸¦äº†æ“ä½œç³»ç»Ÿè€Œå˜å¾—éå¸¸å¤§ï¼Œå¾ˆç¬¨é‡</code>ã€‚Dockeræ˜¯ä¸æºå¸¦æ“ä½œç³»ç»Ÿçš„ï¼Œæ‰€ä»¥Dockerçš„åº”ç”¨å°±éå¸¸çš„è½»å·§ã€‚å¦å¤–åœ¨è°ƒç”¨å®¿ä¸»æœºçš„CPUã€ç£ç›˜ç­‰ç­‰è¿™äº›èµ„æºçš„æ—¶å€™ï¼Œæ‹¿å†…å­˜ä¸¾ä¾‹ï¼Œè™šæ‹Ÿæœºæ˜¯åˆ©ç”¨Hypervisorå»è™šæ‹ŸåŒ–å†…å­˜ï¼Œæ•´ä¸ªè°ƒç”¨è¿‡ç¨‹æ˜¯è™šæ‹Ÿå†…å­˜-&gt;è™šæ‹Ÿç‰©ç†å†…å­˜-&gt;çœŸæ­£ç‰©ç†å†…å­˜ï¼Œä½†æ˜¯Dockeræ˜¯åˆ©ç”¨Docker Engineå»è°ƒç”¨å®¿ä¸»çš„çš„èµ„æºï¼Œè¿™æ—¶å€™è¿‡ç¨‹æ˜¯è™šæ‹Ÿå†…å­˜-&gt;çœŸæ­£ç‰©ç†å†…å­˜ã€‚</p><table><thead><tr><th></th><th>ä¼ ç»Ÿè™šæ‹Ÿæœº</th><th>Dockerå®¹å™¨</th></tr></thead><tbody><tr><td>ç£ç›˜å ç”¨</td><td>å‡ ä¸ªGBåˆ°å‡ åä¸ªGBå·¦å³</td><td>å‡ åMBåˆ°å‡ ç™¾MBå·¦å³</td></tr><tr><td>CPUå†…å­˜å ç”¨</td><td>è™šæ‹Ÿæ“ä½œç³»ç»Ÿéå¸¸å ç”¨CPUå’Œå†…å­˜</td><td>Dockerå¼•æ“å ç”¨æä½</td></tr><tr><td>å¯åŠ¨é€Ÿåº¦</td><td>ï¼ˆä»å¼€æœºåˆ°è¿è¡Œé¡¹ç›®ï¼‰å‡ åˆ†é’Ÿ</td><td>ï¼ˆä»å¼€å¯å®¹å™¨åˆ°è¿è¡Œé¡¹ç›®ï¼‰å‡ ç§’</td></tr><tr><td>å®‰è£…ç®¡ç†</td><td>éœ€è¦ä¸“é—¨çš„è¿ç»´æŠ€æœ¯</td><td>å®‰è£…ã€ç®¡ç†æ–¹ä¾¿</td></tr><tr><td>åº”ç”¨éƒ¨ç½²</td><td>æ¯æ¬¡éƒ¨ç½²éƒ½è´¹æ—¶è´¹åŠ›</td><td>ä»ç¬¬äºŒæ¬¡éƒ¨ç½²å¼€å§‹è½»æ¾ç®€æ·</td></tr><tr><td>è€¦åˆæ€§</td><td>å¤šä¸ªåº”ç”¨æœåŠ¡å®‰è£…åˆ°ä¸€èµ·ï¼Œå®¹æ˜“äº’ç›¸å½±å“</td><td>æ¯ä¸ªåº”ç”¨æœåŠ¡ä¸€ä¸ªå®¹å™¨ï¼Œè¾¾æˆéš”ç¦»</td></tr><tr><td>ç³»ç»Ÿä¾èµ–</td><td>æ— </td><td>éœ€æ±‚ç›¸åŒæˆ–ç›¸ä¼¼çš„å†…æ ¸ï¼Œç›®å‰æ¨èæ˜¯Linux</td></tr></tbody></table><hr><h2 id="4-Dockerçš„å®‰è£…"><a href="#4-Dockerçš„å®‰è£…" class="headerlink" title="4.Dockerçš„å®‰è£…"></a>4.Dockerçš„å®‰è£…</h2><h3 id="4-1-å®‰è£…docker-centos7-x"><a href="#4-1-å®‰è£…docker-centos7-x" class="headerlink" title="4.1 å®‰è£…docker(centos7.x)"></a>4.1 å®‰è£…docker(centos7.x)</h3><ul><li><p>å¸è½½åŸå§‹docker</p><pre class="line-numbers language-sh"><code class="language-sh">$ sudo yum remove docker \                  docker-client \                  docker-client-latest \                  docker-common \                  docker-latest \                  docker-latest-logrotate \                  docker-logrotate \                  docker-engine<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å®‰è£…dockerä¾èµ–</p><pre class="line-numbers language-shell"><code class="language-shell">$ sudo yum install -y yum-utils \  device-mapper-persistent-data \  lvm2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>è®¾ç½®dockerçš„yumæº</p><pre class="line-numbers language-bash"><code class="language-bash">$ <span class="token function">sudo</span> yum-config-manager \    --add-repo \    https://download.docker.com/linux/centos/docker-ce.repo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>å®‰è£…æœ€æ–°ç‰ˆçš„docker</p><pre class="line-numbers language-bash"><code class="language-bash">$ <span class="token function">sudo</span> yum <span class="token function">install</span> docker-ce docker-ce-cli containerd.io<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>æŒ‡å®šç‰ˆæœ¬å®‰è£…docker</p><pre class="line-numbers language-bash"><code class="language-bash">$ yum list docker-ce --showduplicates <span class="token operator">|</span> <span class="token function">sort</span> -r$ <span class="token function">sudo</span> yum <span class="token function">install</span> docker-ce-<span class="token operator">&lt;</span>VERSION_STRING<span class="token operator">></span> docker-ce-cli-<span class="token operator">&lt;</span>VERSION_STRING<span class="token operator">></span> containerd.io$ <span class="token function">sudo</span> yum <span class="token function">install</span> docker-ce-18.09.5-3.el7 docker-ce-cli-18.09.5-3.el7 containerd.io<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>å¯åŠ¨docker</p><pre class="line-numbers language-bash"><code class="language-bash">$ <span class="token function">sudo</span> systemctl <span class="token function">enable</span> docker$ <span class="token function">sudo</span> systemctl start docker<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>å…³é—­docker</p><pre class="line-numbers language-bash"><code class="language-bash">$ <span class="token function">sudo</span> systemctl stop docker<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>æµ‹è¯•dockerå®‰è£…</p><pre class="line-numbers language-bash"><code class="language-bash">$ <span class="token function">sudo</span> docker run hello-world<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><h3 id="4-2-bashå®‰è£…-é€šç”¨æ‰€æœ‰å¹³å°"><a href="#4-2-bashå®‰è£…-é€šç”¨æ‰€æœ‰å¹³å°" class="headerlink" title="4.2 bashå®‰è£…(é€šç”¨æ‰€æœ‰å¹³å°)"></a>4.2 bashå®‰è£…(é€šç”¨æ‰€æœ‰å¹³å°)</h3><ul><li><p>åœ¨æµ‹è¯•æˆ–å¼€å‘ç¯å¢ƒä¸­ Docker å®˜æ–¹ä¸ºäº†ç®€åŒ–å®‰è£…æµç¨‹ï¼Œæä¾›äº†ä¸€å¥—ä¾¿æ·çš„å®‰è£…è„šæœ¬ï¼ŒCentOS ç³»ç»Ÿä¸Šå¯ä»¥ä½¿ç”¨è¿™å¥—è„šæœ¬å®‰è£…ï¼Œå¦å¤–å¯ä»¥é€šè¿‡ <code>--mirror</code> é€‰é¡¹ä½¿ç”¨å›½å†…æºè¿›è¡Œå®‰è£…ï¼šæ‰§è¡Œè¿™ä¸ªå‘½ä»¤åï¼Œè„šæœ¬å°±ä¼šè‡ªåŠ¨çš„å°†ä¸€åˆ‡å‡†å¤‡å·¥ä½œåšå¥½ï¼Œå¹¶ä¸”æŠŠ Docker çš„ç¨³å®š(stable)ç‰ˆæœ¬å®‰è£…åœ¨ç³»ç»Ÿä¸­ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">$ curl -fsSL get.docker.com -o get-docker.sh$ <span class="token function">sudo</span> sh get-docker.sh --mirror Aliyun<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>å¯åŠ¨docker</p><pre class="line-numbers language-bash"><code class="language-bash">$ <span class="token function">sudo</span> systemctl <span class="token function">enable</span> docker <span class="token comment" spellcheck="true"># å¼€æœºè‡ªå¯åŠ¨</span>$ <span class="token function">sudo</span> systemctl start docker<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>åˆ›å»ºdockerç”¨æˆ·ç»„</p><pre class="line-numbers language-bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">groupadd</span> docker<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>å°†å½“å‰ç”¨æˆ·åŠ å…¥dockerç»„</p><pre class="line-numbers language-bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">usermod</span> -aG docker <span class="token variable">$USER</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>æµ‹è¯•dockerå®‰è£…æ˜¯å¦æ­£ç¡®</p><pre class="line-numbers language-bash"><code class="language-bash">$ docker run hello-world<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><h2 id="5-Docker-çš„æ ¸å¿ƒæ¶æ„"><a href="#5-Docker-çš„æ ¸å¿ƒæ¶æ„" class="headerlink" title="5.Docker çš„æ ¸å¿ƒæ¶æ„"></a>5.Docker çš„æ ¸å¿ƒæ¶æ„</h2>{% asset_img image-20200404111908085-0291323.png %}<ul><li><code>é•œåƒ:</code> ä¸€ä¸ªé•œåƒä»£è¡¨ä¸€ä¸ªåº”ç”¨ç¯å¢ƒ,ä»–æ˜¯ä¸€ä¸ªåªè¯»çš„æ–‡ä»¶,å¦‚ mysqlé•œåƒ,tomcaté•œåƒ,nginxé•œåƒç­‰</li><li><code>å®¹å™¨:</code> é•œåƒæ¯æ¬¡è¿è¡Œä¹‹åå°±æ˜¯äº§ç”Ÿä¸€ä¸ªå®¹å™¨,å°±æ˜¯æ­£åœ¨è¿è¡Œçš„é•œåƒ,ç‰¹ç‚¹å°±æ˜¯å¯è¯»å¯å†™</li><li><code>ä»“åº“:</code>ç”¨æ¥å­˜æ”¾é•œåƒçš„ä½ç½®,ç±»ä¼¼äºmavenä»“åº“,ä¹Ÿæ˜¯é•œåƒä¸‹è½½å’Œä¸Šä¼ çš„ä½ç½®</li><li><code>dockerFile:</code>dockerç”Ÿæˆé•œåƒé…ç½®æ–‡ä»¶,ç”¨æ¥ä¹¦å†™è‡ªå®šä¹‰é•œåƒçš„ä¸€äº›é…ç½®</li><li><code>tar:</code>ä¸€ä¸ªå¯¹é•œåƒæ‰“åŒ…çš„æ–‡ä»¶,æ—¥åå¯ä»¥è¿˜åŸæˆé•œåƒ</li></ul><h2 id="6-Docker-é…ç½®é˜¿é‡Œé•œåƒåŠ é€ŸæœåŠ¡"><a href="#6-Docker-é…ç½®é˜¿é‡Œé•œåƒåŠ é€ŸæœåŠ¡" class="headerlink" title="6. Docker é…ç½®é˜¿é‡Œé•œåƒåŠ é€ŸæœåŠ¡"></a>6. Docker é…ç½®é˜¿é‡Œé•œåƒåŠ é€ŸæœåŠ¡</h2><h3 id="6-1-docker-è¿è¡Œæµç¨‹"><a href="#6-1-docker-è¿è¡Œæµç¨‹" class="headerlink" title="6.1 docker è¿è¡Œæµç¨‹"></a>6.1 docker è¿è¡Œæµç¨‹</h3>{% asset_img image-20200404120356784.png %}<h3 id="6-2-dockeré…ç½®é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ"><a href="#6-2-dockeré…ç½®é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ" class="headerlink" title="6.2 dockeré…ç½®é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ"></a>6.2 dockeré…ç½®é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ</h3><ul><li><code>è®¿é—®é˜¿é‡Œäº‘ç™»å½•è‡ªå·±è´¦å·æŸ¥çœ‹dockeré•œåƒåŠ é€ŸæœåŠ¡</code></li></ul><pre class="line-numbers language-shell"><code class="language-shell">sudo mkdir -p /etc/dockersudo tee /etc/docker/daemon.json <<-'EOF'{  "registry-mirrors": ["https://1zjacg5r.mirror.aliyuncs.com"] # é˜¿é‡Œäº‘æŸ¥çœ‹åœ°å€}EOFsudo systemctl daemon-reloadsudo systemctl restart docker<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>éªŒè¯dockerçš„é•œåƒåŠ é€Ÿæ˜¯å¦ç”Ÿæ•ˆ</code></li></ul><pre class="line-numbers language-shell"><code class="language-shell">[root@localhost ~]# docker info        ..........    127.0.0.0/8   Registry Mirrors:    'https://1zjacg5r.mirror.aliyuncs.com/'   Live Restore Enabled: false   Product License: Community Engine<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="7-Dockerçš„å…¥é—¨åº”ç”¨"><a href="#7-Dockerçš„å…¥é—¨åº”ç”¨" class="headerlink" title="7.Dockerçš„å…¥é—¨åº”ç”¨"></a>7.Dockerçš„å…¥é—¨åº”ç”¨</h2><h3 id="7-1-docker-çš„ç¬¬ä¸€ä¸ªç¨‹åº"><a href="#7-1-docker-çš„ç¬¬ä¸€ä¸ªç¨‹åº" class="headerlink" title="7.1 docker çš„ç¬¬ä¸€ä¸ªç¨‹åº"></a>7.1 docker çš„ç¬¬ä¸€ä¸ªç¨‹åº</h3><blockquote><p>docker  run hello-world</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">[root@localhost ~]# docker run hello-worldHello from Docker!This message shows that your installation appears to be working correctly.To generate this message, Docker took the following steps: 1. The Docker client contacted the Docker daemon. 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.    (amd64) 3. The Docker daemon created a new container from that image which runs the    executable that produces the output you are currently reading. 4. The Docker daemon streamed that output to the Docker client, which sent it    to your terminal.To try something more ambitious, you can run an Ubuntu container with: $ docker run -it ubuntu bashShare images, automate workflows, and more with a free Docker ID: https://hub.docker.com/For more examples and ideas, visit: https://docs.docker.com/get-started/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="8-å¸¸ç”¨å‘½ä»¤"><a href="#8-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="8.å¸¸ç”¨å‘½ä»¤"></a>8.å¸¸ç”¨å‘½ä»¤</h2><h3 id="6-1-è¾…åŠ©å‘½ä»¤"><a href="#6-1-è¾…åŠ©å‘½ä»¤" class="headerlink" title="6.1 è¾…åŠ©å‘½ä»¤"></a>6.1 è¾…åŠ©å‘½ä»¤</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.å®‰è£…å®Œæˆè¾…åŠ©å‘½ä»¤</span><span class="token code keyword">        docker version    ------------------    æŸ¥çœ‹dockerçš„ä¿¡æ¯</span><span class="token code keyword">        docker info        ------------------    æŸ¥çœ‹æ›´è¯¦ç»†çš„ä¿¡æ¯</span><span class="token code keyword">        docker --help    ------------------    å¸®åŠ©å‘½ä»¤</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-2-Images-é•œåƒå‘½ä»¤"><a href="#6-2-Images-é•œåƒå‘½ä»¤" class="headerlink" title="6.2 Images é•œåƒå‘½ä»¤"></a>6.2 Images é•œåƒå‘½ä»¤</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.æŸ¥çœ‹æœ¬æœºä¸­æ‰€æœ‰é•œåƒ</span><span class="token code keyword">    docker images    --------------    åˆ—å‡ºæœ¬åœ°æ‰€æœ‰é•œåƒ</span><span class="token code keyword">        -a            åˆ—å‡ºæ‰€æœ‰é•œåƒï¼ˆåŒ…å«ä¸­é—´æ˜ åƒå±‚ï¼‰</span><span class="token code keyword">          -q            åªæ˜¾ç¤ºé•œåƒid</span><span class="token title important"><span class="token punctuation">#</span> 2.æœç´¢é•œåƒ</span><span class="token code keyword">    docker search [options] é•œåƒå    --------- å»dockerhubä¸ŠæŸ¥è¯¢å½“å‰é•œåƒ</span><span class="token code keyword">        -s æŒ‡å®šå€¼        åˆ—å‡ºæ”¶è—æ•°ä¸å°‘äºæŒ‡å®šå€¼çš„é•œåƒ</span><span class="token code keyword">          --no-trunc      æ˜¾ç¤ºå®Œæ•´çš„é•œåƒä¿¡æ¯</span><span class="token title important"><span class="token punctuation">#</span> 3.ä»ä»“åº“ä¸‹è½½é•œåƒ</span><span class="token code keyword">    docker pull é•œåƒå[:TAG]    ----------------- ä¸‹è½½é•œåƒ</span><span class="token title important"><span class="token punctuation">#</span> 4.åˆ é™¤é•œåƒ</span><span class="token code keyword">    docker rmi é•œåƒå:ç‰ˆæœ¬å· / é•œåƒid    -----------------  åˆ é™¤é•œåƒ</span><span class="token code keyword">             -f        å¼ºåˆ¶åˆ é™¤</span><span class="token code keyword">    docker rmi -f $(docker images -q) //åˆ é™¤å…¨éƒ¨é•œåƒ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-3-Contrainer-å®¹å™¨å‘½ä»¤"><a href="#6-3-Contrainer-å®¹å™¨å‘½ä»¤" class="headerlink" title="6.3 Contrainer å®¹å™¨å‘½ä»¤"></a>6.3 Contrainer å®¹å™¨å‘½ä»¤</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.è¿è¡Œå®¹å™¨</span><span class="token code keyword">    docker run é•œåƒå    ------------------    é•œåƒåæ–°å»ºå¹¶å¯åŠ¨å®¹å™¨</span><span class="token code keyword">    --name                     åˆ«åä¸ºå®¹å™¨èµ·ä¸€ä¸ªåå­—</span><span class="token code keyword">    -d                            å¯åŠ¨å®ˆæŠ¤å¼å®¹å™¨ï¼ˆåœ¨åå°å¯åŠ¨å®¹å™¨ï¼‰</span><span class="token code keyword">    -p                             æ˜ å°„ç«¯å£å·ï¼šåŸå§‹ç«¯å£å·         æŒ‡å®šç«¯å£å·å¯åŠ¨</span><span class="token code keyword">    ä¾‹ï¼šdocker run -it --name myTomcat -p 8888:8080 tomcat</span><span class="token code keyword">        docker run -d --name myTomcat -P tomcat</span>å°†é•œåƒåŒ…å¯¼å…¥dockerï¼š docker load -i redis-5.0.10.tar<span class="token title important"><span class="token punctuation">#</span> 2.æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨</span><span class="token code keyword">    docker ps    -------------------    åˆ—å‡ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span><span class="token code keyword">    -a            æ­£åœ¨è¿è¡Œçš„å’Œå†å²è¿è¡Œè¿‡çš„å®¹å™¨</span><span class="token code keyword">    -q            é™é»˜æ¨¡å¼ï¼Œåªæ˜¾ç¤ºå®¹å™¨ç¼–å·</span><span class="token title important"><span class="token punctuation">#</span> 3.åœæ­¢|å…³é—­|é‡å¯å®¹å™¨</span><span class="token code keyword">    docker start   å®¹å™¨åå­—æˆ–è€…å®¹å™¨id  --------------- å¼€å¯å®¹å™¨</span><span class="token code keyword">    docker restart å®¹å™¨åæˆ–è€…å®¹å™¨id    --------------- é‡å¯å®¹å™¨</span><span class="token code keyword">    docker stop  å®¹å™¨åæˆ–è€…å®¹å™¨id         ------------------ æ­£å¸¸åœæ­¢å®¹å™¨è¿è¡Œ</span><span class="token code keyword">    docker kill  å®¹å™¨åæˆ–è€…å®¹å™¨id      ------------------ ç«‹å³åœæ­¢å®¹å™¨è¿è¡Œ</span><span class="token title important"><span class="token punctuation">#</span> 4.åˆ é™¤å®¹å™¨</span><span class="token code keyword">    docker rm -f å®¹å™¨idå’Œå®¹å™¨å     </span><span class="token code keyword">    docker rm -f $(docker ps -aq)        --------------------------    åˆ é™¤æ‰€æœ‰å®¹å™¨</span><span class="token title important"><span class="token punctuation">#</span> 5.æŸ¥çœ‹å®¹å™¨å†…è¿›ç¨‹</span><span class="token code keyword">    docker top å®¹å™¨idæˆ–è€…å®¹å™¨å ------------------ æŸ¥çœ‹å®¹å™¨å†…çš„è¿›ç¨‹</span><span class="token title important"><span class="token punctuation">#</span> 6.æŸ¥çœ‹æŸ¥çœ‹å®¹å™¨å†…éƒ¨ç»†èŠ‚</span><span class="token code keyword">    docker inspect å®¹å™¨id         ------------------ æŸ¥çœ‹å®¹å™¨å†…éƒ¨ç»†èŠ‚</span><span class="token title important"><span class="token punctuation">#</span> 7.æŸ¥çœ‹å®¹å™¨çš„è¿è¡Œæ—¥å¿—</span><span class="token code keyword">    docker logs [OPTIONS] å®¹å™¨idæˆ–å®¹å™¨å    ------------------ æŸ¥çœ‹å®¹å™¨æ—¥å¿—</span><span class="token code keyword">    -t             åŠ å…¥æ—¶é—´æˆ³</span><span class="token code keyword">    -f             è·Ÿéšæœ€æ–°çš„æ—¥å¿—æ‰“å°</span><span class="token code keyword">    --tail      æ•°å­—    æ˜¾ç¤ºæœ€åå¤šå°‘æ¡</span><span class="token title important"><span class="token punctuation">#</span> 8.è¿›å…¥å®¹å™¨å†…éƒ¨</span><span class="token code keyword">    docker exec [options] å®¹å™¨id å®¹å™¨å†…å‘½ä»¤ ------------------ è¿›å…¥å®¹å™¨æ‰§è¡Œå‘½ä»¤</span><span class="token code keyword">        -i        ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œé€šå¸¸ä¸-tä¸€èµ·ä½¿ç”¨</span><span class="token code keyword">        -t        åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯    shellçª—å£   bash </span><span class="token title important"><span class="token punctuation">#</span> 9.å®¹å™¨å’Œå®¿ä¸»æœºä¹‹é—´å¤åˆ¶æ–‡ä»¶</span><span class="token code keyword">    docker cp æ–‡ä»¶|ç›®å½• å®¹å™¨id:å®¹å™¨è·¯å¾„           -----------------   å°†å®¿ä¸»æœºå¤åˆ¶åˆ°å®¹å™¨å†…éƒ¨</span><span class="token code keyword">    docker cp å®¹å™¨id:å®¹å™¨å†…èµ„æºè·¯å¾„ å®¿ä¸»æœºç›®å½•è·¯å¾„  -----------------   å°†å®¹å™¨å†…èµ„æºæ‹·è´åˆ°ä¸»æœºä¸Š</span><span class="token title important"><span class="token punctuation">#</span> 10.æ•°æ®å·(volum)å®ç°ä¸å®¿ä¸»æœºå…±äº«ç›®å½•</span><span class="token code keyword">    docker run -v å®¿ä¸»æœºçš„è·¯å¾„|ä»»æ„åˆ«å:/å®¹å™¨å†…çš„è·¯å¾„ é•œåƒå</span><span class="token code keyword">        æ³¨æ„: </span><span class="token code keyword">                1.å¦‚æœæ˜¯å®¿ä¸»æœºè·¯å¾„å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„,å®¿ä¸»æœºç›®å½•ä¼šè¦†ç›–å®¹å™¨å†…ç›®å½•å†…å®¹</span><span class="token code keyword">                2.å¦‚æœæ˜¯åˆ«ååˆ™ä¼šåœ¨dockerè¿è¡Œå®¹å™¨æ—¶è‡ªåŠ¨åœ¨å®¿ä¸»æœºä¸­åˆ›å»ºä¸€ä¸ªç›®å½•,å¹¶å°†å®¹å™¨ç›®å½•æ–‡ä»¶å¤åˆ¶åˆ°å®¿ä¸»æœºä¸­</span><span class="token title important"><span class="token punctuation">#</span> 11.æ‰“åŒ…é•œåƒ</span><span class="token code keyword">        docker save é•œåƒå -o  åç§°.tar</span><span class="token title important"><span class="token punctuation">#</span> 12.è½½å…¥é•œåƒ</span><span class="token code keyword">        docker load -i   åç§°.tar</span><span class="token title important"><span class="token punctuation">#</span> 13.å®¹å™¨æ‰“åŒ…æˆæ–°çš„é•œåƒ</span><span class="token code keyword">      docker commit -m "æè¿°ä¿¡æ¯" -a "ä½œè€…ä¿¡æ¯"   ï¼ˆå®¹å™¨idæˆ–è€…åç§°ï¼‰æ‰“åŒ…çš„é•œåƒåç§°:æ ‡ç­¾</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="7-dockerçš„é•œåƒåŸç†"><a href="#7-dockerçš„é•œåƒåŸç†" class="headerlink" title="7.dockerçš„é•œåƒåŸç†"></a>7.dockerçš„é•œåƒåŸç†</h2><h3 id="7-1-é•œåƒæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#7-1-é•œåƒæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="7.1 é•œåƒæ˜¯ä»€ä¹ˆï¼Ÿ"></a>7.1 é•œåƒæ˜¯ä»€ä¹ˆï¼Ÿ</h3><blockquote><p>é•œåƒæ˜¯ä¸€ç§è½»é‡çº§çš„ï¼Œå¯æ‰§è¡Œçš„ç‹¬ç«‹è½¯ä»¶åŒ…ï¼Œç”¨æ¥æ‰“åŒ…è½¯ä»¶è¿è¡Œç¯å¢ƒå’ŒåŸºäºè¿è¡Œç¯å¢ƒå¼€å‘çš„è½¯ä»¶ï¼Œå®ƒåŒ…å«è¿è¡ŒæŸä¸ªè½¯ä»¶æ‰€éœ€çš„æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬ä»£ç ã€è¿è¡Œæ—¶æ‰€éœ€çš„åº“ã€ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶ã€‚</p></blockquote><h3 id="7-2-ä¸ºä»€ä¹ˆä¸€ä¸ªé•œåƒä¼šé‚£ä¹ˆå¤§ï¼Ÿ"><a href="#7-2-ä¸ºä»€ä¹ˆä¸€ä¸ªé•œåƒä¼šé‚£ä¹ˆå¤§ï¼Ÿ" class="headerlink" title="7.2 ä¸ºä»€ä¹ˆä¸€ä¸ªé•œåƒä¼šé‚£ä¹ˆå¤§ï¼Ÿ"></a>7.2 ä¸ºä»€ä¹ˆä¸€ä¸ªé•œåƒä¼šé‚£ä¹ˆå¤§ï¼Ÿ</h3><img src="/posts/7608/image-20200404142950068.png"><p><code>é•œåƒå°±æ˜¯èŠ±å·</code></p><ul><li><p>UnionFSï¼ˆè”åˆæ–‡ä»¶ç³»ç»Ÿï¼‰:</p><p>Unionæ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ç§åˆ†å±‚ï¼Œè½»é‡çº§å¹¶ä¸”é«˜æ€§èƒ½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ”¯æŒå¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹ä½œä¸ºä¸€æ¬¡æäº¤æ¥ä¸€å±‚å±‚çš„å åŠ ï¼ŒåŒæ—¶å¯ä»¥å°†ä¸åŒç›®å½•æŒ‚è½½åˆ°åŒä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸‹ã€‚Unionæ–‡ä»¶ç³»ç»Ÿæ˜¯Dockeré•œåƒçš„åŸºç¡€ã€‚è¿™ç§æ–‡ä»¶ç³»ç»Ÿç‰¹æ€§:å°±æ˜¯ä¸€æ¬¡åŒæ—¶åŠ è½½å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä½†ä»å¤–é¢çœ‹èµ·æ¥ï¼Œåªèƒ½çœ‹åˆ°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œè”åˆåŠ è½½ä¼šæŠŠå„å±‚æ–‡ä»¶ç³»ç»Ÿå åŠ èµ·æ¥ï¼Œè¿™æ ·æœ€ç»ˆçš„æ–‡ä»¶ç³»ç»Ÿä¼šåŒ…å«æ‰€æœ‰åº•å±‚çš„æ–‡ä»¶å’Œç›®å½• ã€‚    </p></li></ul><h3 id="7-3-Dockeré•œåƒåŸç†"><a href="#7-3-Dockeré•œåƒåŸç†" class="headerlink" title="7.3 Dockeré•œåƒåŸç†"></a>7.3 Dockeré•œåƒåŸç†</h3><blockquote><p><code>dockerçš„é•œåƒå®é™…æ˜¯ç”±ä¸€å±‚ä¸€å±‚çš„æ–‡ä»¶ç³»ç»Ÿç»„æˆã€‚</code></p></blockquote><ul><li><p>bootfsï¼ˆboot file systemï¼‰ä¸»è¦åŒ…å«bootloaderå’Œkernelï¼Œbootloaderä¸»è¦æ˜¯å¼•å¯¼åŠ è½½kernelï¼ŒLinuxåˆšå¯åŠ¨æ—¶ä¼šåŠ è½½bootfsæ–‡ä»¶ç³»ç»Ÿã€‚åœ¨dockeré•œåƒçš„æœ€åº•å±‚å°±æ˜¯bootfsã€‚è¿™ä¸€å±‚ä¸Linux/Unix ç³»ç»Ÿæ˜¯ä¸€æ ·çš„ï¼ŒåŒ…å«bootåŠ è½½å™¨ï¼ˆbootloaderï¼‰å’Œå†…æ ¸ï¼ˆkernelï¼‰ã€‚å½“bootåŠ è½½å®Œ,åæ•´ä¸ªå†…æ ¸å°±éƒ½åœ¨å†…å­˜ä¸­äº†ï¼Œæ­¤æ—¶å†…å­˜çš„ä½¿ç”¨æƒå·²ç”±bootfsè½¬äº¤ç»™å†…æ ¸ï¼Œæ­¤æ—¶ä¼šå¸è½½bootfsã€‚</p></li><li><p>rootfsï¼ˆroot file systemï¼‰ï¼Œåœ¨bootfsä¹‹ä¸Šï¼ŒåŒ…å«çš„å°±æ˜¯å…¸å‹çš„linuxç³»ç»Ÿä¸­çš„/devï¼Œ/procï¼Œ/binï¼Œ/etcç­‰æ ‡å‡†çš„ç›®å½•å’Œæ–‡ä»¶ã€‚rootfså°±æ˜¯å„ç§ä¸åŒçš„æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆï¼Œæ¯”å¦‚Ubuntu/CentOSç­‰ç­‰ã€‚</p></li><li><p>æˆ‘ä»¬å¹³æ—¶å®‰è£…è¿›è™šæ‹Ÿæœºçš„centoséƒ½æœ‰1åˆ°å‡ ä¸ªGBï¼Œä¸ºä»€ä¹ˆdockerè¿™é‡Œæ‰200MBï¼Ÿå¯¹äºä¸€ä¸ªç²¾ç®€çš„OSï¼Œrootfså¯ä»¥å¾ˆå°ï¼Œåªéœ€è¦åŒ…æ‹¬æœ€åŸºæœ¬çš„å‘½ä»¤ï¼Œå·¥å…·ï¼Œå’Œç¨‹åºåº“å°±å¯ä»¥äº†ï¼Œå› ä¸ºåº•å±‚ç›´æ¥ä½¿ç”¨Hostçš„Kernalï¼Œè‡ªå·±åªéœ€è¦æä¾›rootfså°±è¡Œäº†ã€‚ç”±æ­¤å¯è§ä¸åŒçš„linuxå‘è¡Œç‰ˆï¼Œä»–ä»¬çš„bootfsæ˜¯ä¸€è‡´çš„ï¼Œrootfsä¼šæœ‰å·®åˆ«ã€‚å› æ­¤ä¸åŒçš„å‘è¡Œç‰ˆå¯ä»¥å…±ç”¨bootfsã€‚</p></li></ul><img src="/posts/7608/1567585172(1).jpg"><h3 id="7-4-ä¸ºä»€ä¹ˆdockeré•œåƒè¦é‡‡ç”¨è¿™ç§åˆ†å±‚ç»“æ„å‘¢"><a href="#7-4-ä¸ºä»€ä¹ˆdockeré•œåƒè¦é‡‡ç”¨è¿™ç§åˆ†å±‚ç»“æ„å‘¢" class="headerlink" title="7.4 ä¸ºä»€ä¹ˆdockeré•œåƒè¦é‡‡ç”¨è¿™ç§åˆ†å±‚ç»“æ„å‘¢?"></a>7.4 ä¸ºä»€ä¹ˆdockeré•œåƒè¦é‡‡ç”¨è¿™ç§åˆ†å±‚ç»“æ„å‘¢?</h3><blockquote><p><code>æœ€å¤§çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯èµ„æºå…±äº«</code></p></blockquote><ul><li>æ¯”å¦‚ï¼šæœ‰å¤šä¸ªé•œåƒéƒ½æ˜¯ä»ç›¸åŒçš„baseé•œåƒæ„å»ºè€Œæ¥çš„ï¼Œé‚£ä¹ˆå®¿ä¸»æœºåªéœ€åœ¨ç£ç›˜ä¸­ä¿å­˜ä¸€ä»½baseé•œåƒã€‚åŒæ—¶å†…å­˜ä¸­ä¹Ÿåªéœ€è¦åŠ è½½ä¸€ä»½baseé•œåƒï¼Œå°±å¯ä»¥ä¸ºæ‰€æœ‰å®¹å™¨æœåŠ¡äº†ã€‚è€Œä¸”é•œåƒçš„æ¯ä¸€å±‚éƒ½å¯ä»¥è¢«å…±äº«ã€‚Dockeré•œåƒéƒ½æ˜¯åªè¯»çš„ã€‚å½“å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¸€ä¸ªæ–°çš„å¯å†™å±‚è¢«åŠ è½½åˆ°é•œåƒçš„é¡¶éƒ¨ã€‚è¿™ä¸€å±‚é€šå¸¸è¢«ç§°ä¸ºå®¹å™¨å±‚ï¼Œå®¹å™¨å±‚ä¹‹ä¸‹éƒ½å«é•œåƒå±‚ã€‚</li></ul><hr><h2 id="8-Dockerå®‰è£…å¸¸ç”¨æœåŠ¡"><a href="#8-Dockerå®‰è£…å¸¸ç”¨æœåŠ¡" class="headerlink" title="8.Dockerå®‰è£…å¸¸ç”¨æœåŠ¡"></a>8.Dockerå®‰è£…å¸¸ç”¨æœåŠ¡</h2><h3 id="8-1-å®‰è£…mysql"><a href="#8-1-å®‰è£…mysql" class="headerlink" title="8.1 å®‰è£…mysql"></a>8.1 å®‰è£…mysql</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.æ‹‰å–mysqlé•œåƒåˆ°æœ¬åœ°</span><span class="token code keyword">    docker pull mysql:tag (tagä¸åŠ é»˜è®¤æœ€æ–°ç‰ˆæœ¬)</span><span class="token title important"><span class="token punctuation">#</span> 2.è¿è¡ŒmysqlæœåŠ¡</span><span class="token code keyword">    docker run --name mysql -e MYSQL_ROOT_PASSWORD=root -d mysql:tag                            --æ²¡æœ‰æš´éœ²å¤–éƒ¨ç«¯å£å¤–éƒ¨ä¸èƒ½è¿æ¥</span><span class="token code keyword">    docker run --name mysql -e MYSQL_ROOT_PASSWORD=root -p 3306:3306 -d  mysql:tag  --æ²¡æœ‰æš´éœ²å¤–éƒ¨ç«¯å£</span><span class="token title important"><span class="token punctuation">#</span> 3.è¿›å…¥mysqlå®¹å™¨</span><span class="token code keyword">    docker exec -it å®¹å™¨åç§°|å®¹å™¨id bash</span><span class="token title important"><span class="token punctuation">#</span> 4.å¤–éƒ¨æŸ¥çœ‹mysqlæ—¥å¿—</span><span class="token code keyword">    docker logs å®¹å™¨åç§°|å®¹å™¨id</span><span class="token title important"><span class="token punctuation">#</span> 5.ä½¿ç”¨è‡ªå®šä¹‰é…ç½®å‚æ•°</span><span class="token code keyword">    docker run --name mysql -v /root/mysql/conf.d:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=root -d mysql:tag</span><span class="token title important"><span class="token punctuation">#</span> 6.å°†å®¹å™¨æ•°æ®ä½ç½®ä¸å®¿ä¸»æœºä½ç½®æŒ‚è½½ä¿è¯æ•°æ®å®‰å…¨</span><span class="token code keyword">    docker run --name mysql -v /root/mysql/data:/var/lib/mysql -v /root/mysql/conf.d:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=root -p 3306:3306 -d mysql:tag</span><span class="token title important"><span class="token punctuation">#</span> 7.é€šè¿‡å…¶ä»–å®¢æˆ·ç«¯è®¿é—® å¦‚åœ¨windowç³»ç»Ÿ|macosç³»ç»Ÿä½¿ç”¨å®¢æˆ·ç«¯å·¥å…·è®¿é—®</span><span class="token title important"><span class="token punctuation">#</span> 8.å°†mysqlæ•°æ®åº“å¤‡ä»½ä¸ºsqlæ–‡ä»¶</span><span class="token code keyword">    docker exec mysql|å®¹å™¨id sh -c 'exec mysqldump --all-databases -uroot -p"$MYSQL_ROOT_PASSWORD"' > /root/all-databases.sql  --å¯¼å‡ºå…¨éƒ¨æ•°æ®</span><span class="token code keyword">    docker exec mysql sh -c 'exec mysqldump --databases åº“è¡¨ -uroot -p"$MYSQL_ROOT_PASSWORD"' > /root/all-databases.sql  --å¯¼å‡ºæŒ‡å®šåº“æ•°æ®</span><span class="token code keyword">    docker exec mysql sh -c 'exec mysqldump --no-data --databases åº“è¡¨ -uroot -p"$MYSQL_ROOT_PASSWORD"' > /root/all-databases.sql  --å¯¼å‡ºæŒ‡å®šåº“æ•°æ®ä¸è¦æ•°æ®</span><span class="token title important"><span class="token punctuation">#</span> 9.æ‰§è¡Œsqlæ–‡ä»¶åˆ°mysqlä¸­</span><span class="token code keyword">    docker exec -i mysql sh -c 'exec mysql -uroot -p"$MYSQL_ROOT_PASSWORD"' &lt; /root/xxx.sql</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="8-2-å®‰è£…RedisæœåŠ¡"><a href="#8-2-å®‰è£…RedisæœåŠ¡" class="headerlink" title="8.2 å®‰è£…RedisæœåŠ¡"></a>8.2 å®‰è£…RedisæœåŠ¡</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.åœ¨docker hubæœç´¢redisé•œåƒ</span><span class="token code keyword">    docker search redis</span><span class="token title important"><span class="token punctuation">#</span> 2.æ‹‰å–redisé•œåƒåˆ°æœ¬åœ°</span><span class="token code keyword">    docker pull redis</span><span class="token title important"><span class="token punctuation">#</span> 3.å¯åŠ¨redisæœåŠ¡è¿è¡Œå®¹å™¨</span><span class="token code keyword">    docker run --name redis -d redis:tag (æ²¡æœ‰æš´éœ²å¤–éƒ¨ç«¯å£)</span><span class="token code keyword">    docker run --name redis -p 6379:6379 -d redis:tag (æš´éœ²å¤–éƒ¨å®¿ä¸»æœºç«¯å£ä¸º6379è¿›è¡Œè¿æ¥) </span><span class="token title important"><span class="token punctuation">#</span> 4.æŸ¥çœ‹å¯åŠ¨æ—¥å¿—</span><span class="token code keyword">    docker logs -t -f å®¹å™¨id|å®¹å™¨åç§°</span><span class="token title important"><span class="token punctuation">#</span> 5.è¿›å…¥å®¹å™¨å†…éƒ¨æŸ¥çœ‹</span><span class="token code keyword">    docker exec -it å®¹å™¨id|åç§° bash  </span><span class="token title important"><span class="token punctuation">#</span> 6.åŠ è½½å¤–éƒ¨è‡ªå®šä¹‰é…ç½®å¯åŠ¨rediså®¹å™¨</span><span class="token code keyword">    é»˜è®¤æƒ…å†µä¸‹rediså®˜æ–¹é•œåƒä¸­æ²¡æœ‰redis.confé…ç½®æ–‡ä»¶ éœ€è¦å»å®˜ç½‘ä¸‹è½½æŒ‡å®šç‰ˆæœ¬çš„é…ç½®æ–‡ä»¶</span><span class="token code keyword">    1. wget http://download.redis.io/releases/redis-5.0.8.tar.gz  ä¸‹è½½å®˜æ–¹å®‰è£…åŒ…</span><span class="token code keyword">    2. å°†å®˜æ–¹å®‰è£…åŒ…ä¸­é…ç½®æ–‡ä»¶è¿›è¡Œå¤åˆ¶åˆ°å®¿ä¸»æœºæŒ‡å®šç›®å½•ä¸­å¦‚ /root/redis/redis.confæ–‡ä»¶</span><span class="token code keyword">    3. ä¿®æ”¹éœ€è¦è‡ªå®šä¹‰çš„é…ç½®</span><span class="token code keyword">         bind 0.0.0.0 å¼€å¯è¿œç¨‹æƒé™</span><span class="token code keyword">         appenonly yes å¼€å¯aofæŒä¹…åŒ–</span><span class="token code keyword">    4. åŠ è½½é…ç½®å¯åŠ¨</span><span class="token code keyword">    docker run --name redis -v /root/redis:/usr/local/etc/redis -p 6379:6379 -d redis redis-server /usr/local/etc/redis/redis.conf  </span><span class="token title important"><span class="token punctuation">#</span> 7.å°†æ•°æ®ç›®å½•æŒ‚åœ¨åˆ°æœ¬åœ°ä¿è¯æ•°æ®å®‰å…¨</span><span class="token code keyword">    docker run --name redis -v /root/redis/data:/data -v /root/redis/redis.conf:/usr/local/etc/redis/redis.conf -p 6379:6379 -d redis redis-server                     /usr/local/etc/redis/redis.conf  </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="8-3-å®‰è£…Nginx"><a href="#8-3-å®‰è£…Nginx" class="headerlink" title="8.3 å®‰è£…Nginx"></a>8.3 å®‰è£…Nginx</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.åœ¨docker hubæœç´¢nginx</span><span class="token code keyword">    docker search nginx</span><span class="token title important"><span class="token punctuation">#</span> 2.æ‹‰å–nginxé•œåƒåˆ°æœ¬åœ°</span><span class="token code keyword">    [root@localhost ~]# docker pull nginx</span><span class="token code keyword">    Using default tag: latest</span><span class="token code keyword">    latest: Pulling from library/nginx</span><span class="token code keyword">    afb6ec6fdc1c: Pull complete </span><span class="token code keyword">    b90c53a0b692: Pull complete </span><span class="token code keyword">    11fa52a0fdc0: Pull complete </span><span class="token code keyword">    Digest: sha256:30dfa439718a17baafefadf16c5e7c9d0a1cde97b4fd84f63b69e13513be7097</span><span class="token code keyword">    Status: Downloaded newer image for nginx:latest</span><span class="token code keyword">    docker.io/library/nginx:latest</span><span class="token title important"><span class="token punctuation">#</span> 3.å¯åŠ¨nginxå®¹å™¨</span><span class="token code keyword">        docker run -p 80:80 --name nginx01 -d nginx</span><span class="token title important"><span class="token punctuation">#</span> 4.è¿›å…¥å®¹å™¨</span><span class="token code keyword">        docker exec -it nginx01 /bin/bash</span><span class="token code keyword">        æŸ¥æ‰¾ç›®å½•:  whereis nginx</span><span class="token code keyword">        é…ç½®æ–‡ä»¶:  /etc/nginx/nginx.conf</span><span class="token title important"><span class="token punctuation">#</span> 5.å¤åˆ¶é…ç½®æ–‡ä»¶åˆ°å®¿ä¸»æœº</span><span class="token code keyword">        docker cp nginx01(å®¹å™¨id|å®¹å™¨åç§°):/etc/nginx/nginx.conf å®¿ä¸»æœºåå½•</span><span class="token title important"><span class="token punctuation">#</span> 6.æŒ‚åœ¨nginxé…ç½®ä»¥åŠhtmlåˆ°å®¿ä¸»æœºå¤–éƒ¨</span><span class="token code keyword">        docker run --name nginx02 -v /root/nginx/nginx.conf:/etc/nginx/nginx.conf -v /root/nginx/html:/usr/share/nginx/html -p 80:80 -d nginx        </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="8-4-å®‰è£…Tomcat"><a href="#8-4-å®‰è£…Tomcat" class="headerlink" title="8.4 å®‰è£…Tomcat"></a>8.4 å®‰è£…Tomcat</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.åœ¨docker hubæœç´¢tomcat</span><span class="token code keyword">    docker search tomcat</span><span class="token title important"><span class="token punctuation">#</span> 2.ä¸‹è½½tomcaté•œåƒ</span><span class="token code keyword">    docker pull tomcat</span><span class="token title important"><span class="token punctuation">#</span> 3.è¿è¡Œtomcaté•œåƒ</span><span class="token code keyword">    docker run -p 8080:8080 -d --name mytomcat tomcat</span><span class="token title important"><span class="token punctuation">#</span> 4.è¿›å…¥tomcatå®¹å™¨</span><span class="token code keyword">    docker exec -it mytomcat /bin/bash</span><span class="token title important"><span class="token punctuation">#</span> 5.å°†webappsç›®å½•æŒ‚è½½åœ¨å¤–éƒ¨</span><span class="token code keyword">    docker run -p 8080:8080 -v /root/webapps:/usr/local/tomcat/webapps -d --name mytomcat tomcat</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="8-5-å®‰è£…MongoDBæ•°æ®åº“"><a href="#8-5-å®‰è£…MongoDBæ•°æ®åº“" class="headerlink" title="8.5 å®‰è£…MongoDBæ•°æ®åº“"></a>8.5 å®‰è£…MongoDBæ•°æ®åº“</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.è¿è¡ŒmongDB</span><span class="token code keyword">    docker run -d -p 27017:27017 --name mymongo mongo  ---æ— é¡»æƒé™</span><span class="token code keyword">    docker logs -f mymongo --æŸ¥çœ‹mongoè¿è¡Œæ—¥å¿—</span><span class="token title important"><span class="token punctuation">#</span> 2.è¿›å…¥mongodbå®¹å™¨</span><span class="token code keyword">    docker exec -it mymongo /bin/bash</span><span class="token code keyword">        ç›´æ¥æ‰§è¡Œmongoå‘½ä»¤è¿›è¡Œæ“ä½œ</span><span class="token title important"><span class="token punctuation">#</span> 3.å¸¸è§å…·æœ‰æƒé™çš„å®¹å™¨</span><span class="token code keyword">    docker run --name  mymongo  -p 27017:27017  -d mongo --auth</span><span class="token title important"><span class="token punctuation">#</span> 4.è¿›å…¥å®¹å™¨é…ç½®ç”¨æˆ·åå¯†ç </span><span class="token code keyword">    mongo</span><span class="token code keyword">    use admin é€‰æ‹©adminåº“</span><span class="token code keyword">    db.createUser({user:"root",pwd:"root",roles:[{role:'root',db:'admin'}]})   //åˆ›å»ºç”¨æˆ·,æ­¤ç”¨æˆ·åˆ›å»ºæˆåŠŸ,åˆ™åç»­æ“ä½œéƒ½éœ€è¦ç”¨æˆ·è®¤è¯</span><span class="token code keyword">    exit</span><span class="token title important"><span class="token punctuation">#</span> 5.å°†mongoDBä¸­æ•°æ®ç›®å½•æ˜ å°„åˆ°å®¿ä¸»æœºä¸­</span><span class="token code keyword">    docker run -d -p 27017:27017 -v /root/mongo/data:/data/db --name mymongo mongo </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="8-6-å®‰è£…ElasticSearch"><a href="#8-6-å®‰è£…ElasticSearch" class="headerlink" title="8.6 å®‰è£…ElasticSearch"></a>8.6 å®‰è£…ElasticSearch</h3><ul><li><code>æ³¨æ„:</code><strong>è°ƒé«˜JVMçº¿ç¨‹æ•°é™åˆ¶æ•°é‡</strong></li></ul><h4 id="0-æ‹‰å–é•œåƒè¿è¡Œelasticsearch"><a href="#0-æ‹‰å–é•œåƒè¿è¡Œelasticsearch" class="headerlink" title="0.æ‹‰å–é•œåƒè¿è¡Œelasticsearch"></a>0.æ‹‰å–é•œåƒè¿è¡Œelasticsearch</h4><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.dockerhub æ‹‰å–é•œåƒ</span><span class="token code keyword">    docker pull elasticsearch:6.4.2</span><span class="token title important"><span class="token punctuation">#</span> 2.æŸ¥çœ‹dockeré•œåƒ</span><span class="token code keyword">    docker images</span><span class="token title important"><span class="token punctuation">#</span> 3.è¿è¡Œdockeré•œåƒ</span><span class="token code keyword">    docker run -p 9200:9200 -p 9300:9300 elasticsearch:6.4.2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å¯åŠ¨å‡ºç°å¦‚ä¸‹é”™è¯¯</li><li><img src="/posts/7608/image-20200602184321790.png"></li></ul><h4 id="1-é¢„å…ˆé…ç½®"><a href="#1-é¢„å…ˆé…ç½®" class="headerlink" title="1. é¢„å…ˆé…ç½®"></a>1. é¢„å…ˆé…ç½®</h4><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.åœ¨centosè™šæ‹Ÿæœºä¸­ï¼Œä¿®æ”¹é…ç½®sysctl.conf</span><span class="token code keyword">    vim /etc/sysctl.conf</span><span class="token title important"><span class="token punctuation">#</span> 2.åŠ å…¥å¦‚ä¸‹é…ç½®</span><span class="token code keyword">    vm.max_map_count=262144 </span><span class="token title important"><span class="token punctuation">#</span> 3.å¯ç”¨é…ç½®</span><span class="token code keyword">    sysctl -p</span><span class="token code keyword">    æ³¨ï¼šè¿™ä¸€æ­¥æ˜¯ä¸ºäº†é˜²æ­¢å¯åŠ¨å®¹å™¨æ—¶ï¼ŒæŠ¥å‡ºå¦‚ä¸‹é”™è¯¯ï¼š</span><span class="token code keyword">    bootstrap checks failed max virtual memory areas vm.max_map_count [65530] likely too low, increase to at least [262144]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-å¯åŠ¨EleasticSearchå®¹å™¨"><a href="#2-å¯åŠ¨EleasticSearchå®¹å™¨" class="headerlink" title="2.å¯åŠ¨EleasticSearchå®¹å™¨"></a>2.å¯åŠ¨EleasticSearchå®¹å™¨</h4><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 0.å¤åˆ¶å®¹å™¨ä¸­dataç›®å½•åˆ°å®¿ä¸»æœºä¸­</span><span class="token code keyword">    docker cp å®¹å™¨id:/usr/share/share/elasticsearch/data /root/es</span><span class="token title important"><span class="token punctuation">#</span> 1.è¿è¡ŒESå®¹å™¨ æŒ‡å®šjvmå†…å­˜å¤§å°å¹¶æŒ‡å®šikåˆ†è¯å™¨ä½ç½®</span><span class="token code keyword">    docker run -d --name es -p 9200:9200 -p 9300:9300 -e ES_JAVA_OPTS="-Xms128m -Xmx128m" -v elasplugins:/usr/share/elasticsearch/plugins -v elasdata:/usr/share/elasticsearch/data elasticsearch:6.8.0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-å®‰è£…IKåˆ†è¯å™¨"><a href="#3-å®‰è£…IKåˆ†è¯å™¨" class="headerlink" title="3.å®‰è£…IKåˆ†è¯å™¨"></a>3.å®‰è£…IKåˆ†è¯å™¨</h4><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„IKåˆ†è¯å™¨</span><span class="token code keyword">    wget https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.4.2/elasticsearch-analysis-ik-6.4.2.zip</span><span class="token title important"><span class="token punctuation">#</span> 2.è§£å‹åˆ°pluginsæ–‡ä»¶å¤¹ä¸­</span><span class="token code keyword">    yum install -y unzip</span><span class="token code keyword">    unzip -d ik elasticsearch-analysis-ik-6.4.2.zip</span><span class="token title important"><span class="token punctuation">#</span> 3.æ·»åŠ è‡ªå®šä¹‰æ‰©å±•è¯å’Œåœç”¨è¯</span><span class="token code keyword">    cd plugins/elasticsearch/config</span><span class="token code keyword">    vim IKAnalyzer.cfg.xml</span><span class="token code keyword">    &lt;properties></span><span class="token code keyword">        &lt;comment>IK Analyzer æ‰©å±•é…ç½®&lt;/comment></span><span class="token code keyword">        </span><span class="token comment" spellcheck="true">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸ --></span><span class="token code keyword">        &lt;entry key="ext_dict">ext_dict.dic&lt;/entry></span><span class="token code keyword">        </span><span class="token comment" spellcheck="true">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•åœæ­¢è¯å­—å…¸--></span><span class="token code keyword">        &lt;entry key="ext_stopwords">ext_stopwords.dic&lt;/entry></span><span class="token code keyword">    &lt;/properties></span><span class="token title important"><span class="token punctuation">#</span> 4.åœ¨ikåˆ†è¯å™¨ç›®å½•ä¸‹configç›®å½•ä¸­åˆ›å»ºext_dict.dicæ–‡ä»¶   ç¼–ç ä¸€å®šè¦ä¸ºUTF-8æ‰èƒ½ç”Ÿæ•ˆ</span><span class="token code keyword">    vim ext_dict.dic åŠ å…¥æ‰©å±•è¯å³å¯</span><span class="token title important"><span class="token punctuation">#</span> 5. åœ¨ikåˆ†è¯å™¨ç›®å½•ä¸‹configç›®å½•ä¸­åˆ›å»ºext_stopword.dicæ–‡ä»¶ </span><span class="token code keyword">    vim ext_stopwords.dic åŠ å…¥åœç”¨è¯å³å¯</span><span class="token title important"><span class="token punctuation">#</span> 6.é‡å¯å®¹å™¨ç”Ÿæ•ˆ</span><span class="token code keyword">    docker restart å®¹å™¨id</span><span class="token title important"><span class="token punctuation">#</span> 7.å°†æ­¤å®¹å™¨æäº¤æˆä¸ºä¸€ä¸ªæ–°çš„é•œåƒ</span><span class="token code keyword">    docker commit -a="xiaochen" -m="es with IKAnalyzer" å®¹å™¨id xiaochen/elasticsearch:6.4.2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-å®‰è£…Kibana"><a href="#4-å®‰è£…Kibana" class="headerlink" title="4. å®‰è£…Kibana"></a>4. å®‰è£…Kibana</h4><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.ä¸‹è½½kibanaé•œåƒåˆ°æœ¬åœ°</span><span class="token code keyword">    docker pull kibana:6.4.2</span><span class="token title important"><span class="token punctuation">#</span> 2.å¯åŠ¨kibanaå®¹å™¨</span><span class="token code keyword">    docker run -d --name kibana -e ELASTICSEARCH_URL=http://10.15.0.3:9200 -p 5601:5601 kibana:6.4.2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="10-Dockerä¸­å‡ºç°å¦‚ä¸‹é”™è¯¯è§£å†³æ–¹æ¡ˆ"><a href="#10-Dockerä¸­å‡ºç°å¦‚ä¸‹é”™è¯¯è§£å†³æ–¹æ¡ˆ" class="headerlink" title="10.Dockerä¸­å‡ºç°å¦‚ä¸‹é”™è¯¯è§£å†³æ–¹æ¡ˆ"></a>10.Dockerä¸­å‡ºç°å¦‚ä¸‹é”™è¯¯è§£å†³æ–¹æ¡ˆ</h2><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token namespace">[root@localhost ~]</span><span class="token comment" spellcheck="true"># docker search mysql æˆ–è€… docker pull è¿™äº›å‘½ä»¤æ— æ³•ä½¿ç”¨</span>Error response <span class="token keyword">from</span> daemon: Get https:<span class="token operator">/</span><span class="token operator">/</span>index<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>io<span class="token operator">/</span>v1<span class="token operator">/</span>search?q=mysql&amp;n=25: x509: certificate has expired or is not yet valid<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><img src="/posts/7608/image-20200602183429286.png"><ul><li>æ³¨æ„:<strong>è¿™ä¸ªé”™è¯¯çš„åŸå› åœ¨äºæ˜¯ç³»ç»Ÿçš„æ—¶é—´å’Œdocker hubæ—¶é—´ä¸ä¸€è‡´,éœ€è¦åšç³»ç»Ÿæ—¶é—´ä¸ç½‘ç»œæ—¶é—´åŒæ­¥</strong></li></ul><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.å®‰è£…æ—¶é—´åŒæ­¥</span><span class="token code keyword">    sudo yum -y install ntp ntpdate</span><span class="token title important"><span class="token punctuation">#</span> 2.åŒæ­¥æ—¶é—´</span><span class="token code keyword">    sudo ntpdate cn.pool.ntp.org</span><span class="token title important"><span class="token punctuation">#</span> 3.æŸ¥çœ‹æœ¬æœºæ—¶é—´</span><span class="token code keyword">    date</span><span class="token title important"><span class="token punctuation">#</span> 4.ä»æ–°æµ‹è¯•</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="/posts/7608/image-20200602183718623.png"><h2 id="9-Dockerfile"><a href="#9-Dockerfile" class="headerlink" title="9.Dockerfile"></a>9.Dockerfile</h2><h3 id="9-1-ä»€ä¹ˆæ˜¯Dockerfile"><a href="#9-1-ä»€ä¹ˆæ˜¯Dockerfile" class="headerlink" title="9.1 ä»€ä¹ˆæ˜¯Dockerfile"></a>9.1 ä»€ä¹ˆæ˜¯Dockerfile</h3><p>Dockerfileå¯ä»¥è®¤ä¸ºæ˜¯<strong>Dockeré•œåƒçš„æè¿°æ–‡ä»¶ï¼Œæ˜¯ç”±ä¸€ç³»åˆ—å‘½ä»¤å’Œå‚æ•°æ„æˆçš„è„šæœ¬</strong>ã€‚ä¸»è¦ä½œç”¨æ˜¯<strong>ç”¨æ¥æ„å»ºdockeré•œåƒçš„æ„å»ºæ–‡ä»¶</strong>ã€‚</p><img src="/posts/7608/image-20200404111908085.png"><ul><li><strong>é€šè¿‡æ¶æ„å›¾å¯ä»¥çœ‹å‡ºé€šè¿‡DockerFileå¯ä»¥ç›´æ¥æ„å»ºé•œåƒ</strong></li></ul><h3 id="9-2-Dockerfileè§£æè¿‡ç¨‹"><a href="#9-2-Dockerfileè§£æè¿‡ç¨‹" class="headerlink" title="9.2 Dockerfileè§£æè¿‡ç¨‹"></a>9.2 Dockerfileè§£æè¿‡ç¨‹</h3><img src="/posts/7608/image-20200603181253804.png"><h3 id="9-3-Dockerfileçš„ä¿ç•™å‘½ä»¤"><a href="#9-3-Dockerfileçš„ä¿ç•™å‘½ä»¤" class="headerlink" title="9.3 Dockerfileçš„ä¿ç•™å‘½ä»¤"></a>9.3 Dockerfileçš„ä¿ç•™å‘½ä»¤</h3><p>å®˜æ–¹è¯´æ˜:<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/builder/</a></p><table><thead><tr><th>ä¿ç•™å­—</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><strong>FROM</strong></td><td><strong>å½“å‰é•œåƒæ˜¯åŸºäºå“ªä¸ªé•œåƒçš„</strong> <code>ç¬¬ä¸€ä¸ªæŒ‡ä»¤å¿…é¡»æ˜¯FROM</code></td></tr><tr><td>MAINTAINER</td><td>é•œåƒç»´æŠ¤è€…çš„å§“åå’Œé‚®ç®±åœ°å€</td></tr><tr><td><strong>RUN</strong></td><td><strong>æ„å»ºé•œåƒæ—¶éœ€è¦è¿è¡Œçš„æŒ‡ä»¤</strong></td></tr><tr><td><strong>EXPOSE</strong></td><td><strong>å½“å‰å®¹å™¨å¯¹å¤–æš´éœ²å‡ºçš„ç«¯å£å·</strong></td></tr><tr><td><strong>WORKDIR</strong></td><td><strong>æŒ‡å®šåœ¨åˆ›å»ºå®¹å™¨åï¼Œç»ˆç«¯é»˜è®¤ç™»å½•è¿›æ¥çš„å·¥ä½œç›®å½•ï¼Œä¸€ä¸ªè½è„šç‚¹</strong></td></tr><tr><td><strong>ENV</strong></td><td><strong>ç”¨æ¥åœ¨æ„å»ºé•œåƒè¿‡ç¨‹ä¸­è®¾ç½®ç¯å¢ƒå˜é‡</strong></td></tr><tr><td><strong>ADD</strong></td><td><strong>å°†å®¿ä¸»æœºç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·è´è¿›é•œåƒä¸”ADDå‘½ä»¤ä¼šè‡ªåŠ¨å¤„ç†URLå’Œè§£å‹taråŒ…</strong></td></tr><tr><td><strong>COPY</strong></td><td><strong>ç±»ä¼¼äºADDï¼Œæ‹·è´æ–‡ä»¶å’Œç›®å½•åˆ°é•œåƒä¸­<br>å°†ä»æ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­&lt;åŸè·¯å¾„&gt;çš„æ–‡ä»¶/ç›®å½•å¤åˆ¶åˆ°æ–°çš„ä¸€å±‚çš„é•œåƒå†…çš„&lt;ç›®æ ‡è·¯å¾„&gt;ä½ç½®</strong></td></tr><tr><td><strong>VOLUME</strong></td><td><strong>å®¹å™¨æ•°æ®å·ï¼Œç”¨äºæ•°æ®ä¿å­˜å’ŒæŒä¹…åŒ–å·¥ä½œ</strong></td></tr><tr><td><strong>CMD</strong></td><td><strong>æŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤<br>Dockerfileä¸­å¯ä»¥æœ‰å¤šä¸ªCMDæŒ‡ä»¤ï¼Œä½†åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆï¼ŒCMDä¼šè¢«docker runä¹‹åçš„å‚æ•°æ›¿æ¢</strong></td></tr><tr><td><strong>ENTRYPOINT</strong></td><td><strong>æŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤<br>ENTRYPOINTçš„ç›®çš„å’ŒCMDä¸€æ ·ï¼Œéƒ½æ˜¯åœ¨æŒ‡å®šå®¹å™¨å¯åŠ¨ç¨‹åºåŠå…¶å‚æ•°</strong></td></tr></tbody></table><h4 id="9-3-1-FROM-å‘½ä»¤"><a href="#9-3-1-FROM-å‘½ä»¤" class="headerlink" title="9.3.1 FROM å‘½ä»¤"></a>9.3.1 FROM å‘½ä»¤</h4><ul><li><p>åŸºäºé‚£ä¸ªé•œåƒè¿›è¡Œæ„å»ºæ–°çš„é•œåƒ,åœ¨æ„å»ºæ—¶ä¼šè‡ªåŠ¨ä»docker hubæ‹‰å–baseé•œåƒ å¿…é¡»ä½œä¸ºDockerfileçš„ç¬¬ä¸€ä¸ªæŒ‡ä»¤å‡ºç°</p></li><li><p>è¯­æ³•:</p><pre class="line-numbers language-dockerfile"><code class="language-dockerfile">FROM  <image>FROM  <image>[:<tag>]     ä½¿ç”¨ç‰ˆæœ¬ä¸å†™ä¸ºlatestFROM  <image>[@<digest>]  ä½¿ç”¨æ‘˜è¦<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><h4 id="9-3-2-MAINTAINER-å‘½ä»¤"><a href="#9-3-2-MAINTAINER-å‘½ä»¤" class="headerlink" title="9.3.2 MAINTAINER  å‘½ä»¤"></a>9.3.2 MAINTAINER  å‘½ä»¤</h4><ul><li><p>é•œåƒç»´æŠ¤è€…çš„å§“åå’Œé‚®ç®±åœ°å€[åºŸå¼ƒ]</p></li><li><p>è¯­æ³•:</p><pre class="line-numbers language-dockerfile"><code class="language-dockerfile">MAINTAINER <name><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><h4 id="9-3-3-RUN-å‘½ä»¤"><a href="#9-3-3-RUN-å‘½ä»¤" class="headerlink" title="9.3.3 RUN å‘½ä»¤"></a>9.3.3 RUN å‘½ä»¤</h4><ul><li><p>RUNæŒ‡ä»¤å°†åœ¨å½“å‰æ˜ åƒä¹‹ä¸Šçš„æ–°å±‚ä¸­æ‰§è¡Œä»»ä½•å‘½ä»¤å¹¶æäº¤ç»“æœã€‚ç”Ÿæˆçš„æäº¤æ˜ åƒå°†ç”¨äºDockerfileä¸­çš„ä¸‹ä¸€æ­¥</p></li><li><p>è¯­æ³•:</p><pre class="line-numbers language-dockerfile"><code class="language-dockerfile">RUN <command> (shell form, the command is run in a shell, which by default is /bin/sh -c on Linux or cmd /S /C on Windows)RUN echo helloRUN ["executable", "param1", "param2"] (exec form)RUN ["/bin/bash", "-c", "echo hello"]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="9-3-4-EXPOSE-å‘½ä»¤"><a href="#9-3-4-EXPOSE-å‘½ä»¤" class="headerlink" title="9.3.4 EXPOSE å‘½ä»¤"></a>9.3.4 EXPOSE å‘½ä»¤</h4><ul><li><p>ç”¨æ¥æŒ‡å®šæ„å»ºçš„é•œåƒåœ¨è¿è¡Œä¸ºå®¹å™¨æ—¶å¯¹å¤–æš´éœ²çš„ç«¯å£</p></li><li><p>è¯­æ³•:</p><pre class="line-numbers language-dockerfile"><code class="language-dockerfile">EXPOSE 80/tcp  å¦‚æœæ²¡æœ‰æ˜¾ç¤ºæŒ‡å®šåˆ™é»˜è®¤æš´éœ²éƒ½æ˜¯tcpEXPOSE 80/udp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul><h4 id="9-3-5-CMD-å‘½ä»¤"><a href="#9-3-5-CMD-å‘½ä»¤" class="headerlink" title="9.3.5 CMD å‘½ä»¤"></a>9.3.5 CMD å‘½ä»¤</h4><ul><li><p>ç”¨æ¥ä¸ºå¯åŠ¨çš„å®¹å™¨æŒ‡å®šæ‰§è¡Œçš„å‘½ä»¤,åœ¨Dockerfileä¸­åªèƒ½æœ‰ä¸€æ¡CMDæŒ‡ä»¤ã€‚å¦‚æœåˆ—å‡ºå¤šä¸ªå‘½ä»¤ï¼Œåˆ™åªæœ‰æœ€åä¸€ä¸ªå‘½ä»¤æ‰ä¼šç”Ÿæ•ˆã€‚</p></li><li><p>æ³¨æ„: <strong>Dockerfileä¸­åªèƒ½æœ‰ä¸€æ¡CMDæŒ‡ä»¤ã€‚å¦‚æœåˆ—å‡ºå¤šä¸ªå‘½ä»¤ï¼Œåˆ™åªæœ‰æœ€åä¸€ä¸ªå‘½ä»¤æ‰ä¼šç”Ÿæ•ˆã€‚</strong></p></li><li><p>è¯­æ³•:</p><pre class="line-numbers language-dockerfile"><code class="language-dockerfile">CMD ["executable","param1","param2"] (exec form, this is the preferred form)CMD ["param1","param2"] (as default parameters to ENTRYPOINT)CMD command param1 param2 (shell form)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><h4 id="9-3-6-WORKDIR-å‘½ä»¤"><a href="#9-3-6-WORKDIR-å‘½ä»¤" class="headerlink" title="9.3.6 WORKDIR å‘½ä»¤"></a>9.3.6 WORKDIR å‘½ä»¤</h4><ul><li><p>ç”¨æ¥ä¸ºDockerfileä¸­çš„ä»»ä½•RUNã€CMDã€ENTRYPOINTã€COPYå’ŒADDæŒ‡ä»¤è®¾ç½®å·¥ä½œç›®å½•ã€‚å¦‚æœWORKDIRä¸å­˜åœ¨ï¼Œå³ä½¿å®ƒæ²¡æœ‰åœ¨ä»»ä½•åç»­DockerfileæŒ‡ä»¤ä¸­ä½¿ç”¨ï¼Œå®ƒä¹Ÿå°†è¢«åˆ›å»ºã€‚</p></li><li><p>è¯­æ³•:</p><pre class="line-numbers language-dockerfile"><code class="language-dockerfile">WORKDIR /path/to/workdirWORKDIR /aWORKDIR bWORKDIR c`æ³¨æ„:WORKDIRæŒ‡ä»¤å¯ä»¥åœ¨Dockerfileä¸­å¤šæ¬¡ä½¿ç”¨ã€‚å¦‚æœæä¾›äº†ç›¸å¯¹è·¯å¾„ï¼Œåˆ™è¯¥è·¯å¾„å°†ä¸å…ˆå‰WORKDIRæŒ‡ä»¤çš„è·¯å¾„ç›¸å¯¹`<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><h4 id="9-3-7-ENV-å‘½ä»¤"><a href="#9-3-7-ENV-å‘½ä»¤" class="headerlink" title="9.3.7 ENV å‘½ä»¤"></a>9.3.7 ENV å‘½ä»¤</h4><ul><li><p>ç”¨æ¥ä¸ºæ„å»ºé•œåƒè®¾ç½®ç¯å¢ƒå˜é‡ã€‚è¿™ä¸ªå€¼å°†å‡ºç°åœ¨æ„å»ºé˜¶æ®µä¸­æ‰€æœ‰åç»­æŒ‡ä»¤çš„ç¯å¢ƒä¸­ã€‚</p></li><li><p>è¯­æ³•ï¼š</p><pre class="line-numbers language-dockerfile"><code class="language-dockerfile">ENV <key> <value>ENV <key>=<value> ...<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><h4 id="9-3-8-ADD-å‘½ä»¤"><a href="#9-3-8-ADD-å‘½ä»¤" class="headerlink" title="9.3.8 ADD å‘½ä»¤"></a>9.3.8 ADD å‘½ä»¤</h4><ul><li><p>ç”¨æ¥ä»contextä¸Šä¸‹æ–‡å¤åˆ¶æ–°æ–‡ä»¶ã€ç›®å½•æˆ–è¿œç¨‹æ–‡ä»¶urlï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°ä½äºæŒ‡å®šè·¯å¾„çš„æ˜ åƒæ–‡ä»¶ç³»ç»Ÿä¸­ã€‚</p></li><li><p>è¯­æ³•:</p><pre class="line-numbers language-dockerfile"><code class="language-dockerfile">ADD hom* /mydir/       é€šé…ç¬¦æ·»åŠ å¤šä¸ªæ–‡ä»¶ADD hom?.txt /mydir/   é€šé…ç¬¦æ·»åŠ ADD test.txt relativeDir/  å¯ä»¥æŒ‡å®šç›¸å¯¹è·¯å¾„ADD test.txt /absoluteDir/ ä¹Ÿå¯ä»¥æŒ‡å®šç»å¯¹è·¯å¾„ADD url <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><h4 id="9-3-9-COPY-å‘½ä»¤"><a href="#9-3-9-COPY-å‘½ä»¤" class="headerlink" title="9.3.9 COPY å‘½ä»¤"></a>9.3.9 COPY å‘½ä»¤</h4><ul><li><p>ç”¨æ¥å°†contextç›®å½•ä¸­æŒ‡å®šæ–‡ä»¶å¤åˆ¶åˆ°é•œåƒçš„æŒ‡å®šç›®å½•ä¸­</p></li><li><p>è¯­æ³•:</p><pre class="line-numbers language-dockerfile"><code class="language-dockerfile">COPY src destCOPY ["<src>",... "<dest>"]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul><h4 id="9-3-10-VOLUME-å‘½ä»¤"><a href="#9-3-10-VOLUME-å‘½ä»¤" class="headerlink" title="9.3.10 VOLUME å‘½ä»¤"></a>9.3.10 VOLUME å‘½ä»¤</h4><ul><li><p>ç”¨æ¥å®šä¹‰å®¹å™¨è¿è¡Œæ—¶å¯ä»¥æŒ‚åœ¨åˆ°å®¿ä¸»æœºçš„ç›®å½•</p></li><li><p>è¯­æ³•:</p><pre class="line-numbers language-dockerfile"><code class="language-dockerfile">VOLUME ["/data"]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><h4 id="9-3-11-ENTRYPOINTå‘½ä»¤"><a href="#9-3-11-ENTRYPOINTå‘½ä»¤" class="headerlink" title="9.3.11 ENTRYPOINTå‘½ä»¤"></a>9.3.11 ENTRYPOINTå‘½ä»¤</h4><ul><li><p>ç”¨æ¥æŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œå‘½ä»¤å’ŒCMDç±»ä¼¼</p></li><li><p>è¯­æ³•:</p><pre class="line-numbers language-dockerfile"><code class="language-dockerfile">  ["executable", "param1", "param2"]ENTRYPOINT command param1 param2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ENTRYPOINTæŒ‡ä»¤ï¼Œå¾€å¾€ç”¨äºè®¾ç½®å®¹å™¨å¯åŠ¨åçš„<strong>ç¬¬ä¸€ä¸ªå‘½ä»¤</strong>ï¼Œè¿™å¯¹ä¸€ä¸ªå®¹å™¨æ¥è¯´å¾€å¾€æ˜¯å›ºå®šçš„ã€‚<br>CMDæŒ‡ä»¤ï¼Œå¾€å¾€ç”¨äºè®¾ç½®å®¹å™¨å¯åŠ¨çš„ç¬¬ä¸€ä¸ªå‘½ä»¤çš„<strong>é»˜è®¤å‚æ•°</strong>ï¼Œè¿™å¯¹ä¸€ä¸ªå®¹å™¨æ¥è¯´å¯ä»¥æ˜¯å˜åŒ–çš„ã€‚</p></li></ul><h4 id="9-3-11-ENTRYPOINTå‘½ä»¤-1"><a href="#9-3-11-ENTRYPOINTå‘½ä»¤-1" class="headerlink" title="9.3.11 ENTRYPOINTå‘½ä»¤"></a>9.3.11 ENTRYPOINTå‘½ä»¤</h4><h3 id="9-4-Dockerfileæ„å»ºspringbooté¡¹ç›®éƒ¨ç½²"><a href="#9-4-Dockerfileæ„å»ºspringbooté¡¹ç›®éƒ¨ç½²" class="headerlink" title="9.4 Dockerfileæ„å»ºspringbooté¡¹ç›®éƒ¨ç½²"></a>9.4 Dockerfileæ„å»ºspringbooté¡¹ç›®éƒ¨ç½²</h3><h5 id="1-å‡†å¤‡springbootå¯è¿è¡Œé¡¹ç›®"><a href="#1-å‡†å¤‡springbootå¯è¿è¡Œé¡¹ç›®" class="headerlink" title="1.å‡†å¤‡springbootå¯è¿è¡Œé¡¹ç›®"></a>1.å‡†å¤‡springbootå¯è¿è¡Œé¡¹ç›®</h5><img src="/posts/7608/image-20200605172151266.png"><h5 id="2-å°†å¯è¿è¡Œé¡¹ç›®æ”¾å…¥linuxè™šæ‹Ÿæœºä¸­"><a href="#2-å°†å¯è¿è¡Œé¡¹ç›®æ”¾å…¥linuxè™šæ‹Ÿæœºä¸­" class="headerlink" title="2.å°†å¯è¿è¡Œé¡¹ç›®æ”¾å…¥linuxè™šæ‹Ÿæœºä¸­"></a>2.å°†å¯è¿è¡Œé¡¹ç›®æ”¾å…¥linuxè™šæ‹Ÿæœºä¸­</h5><img src="/posts/7608/image-20200605172340380.png"><h5 id="3-ç¼–å†™Dockerfile"><a href="#3-ç¼–å†™Dockerfile" class="headerlink" title="3.ç¼–å†™Dockerfile"></a>3.ç¼–å†™Dockerfile</h5><pre class="line-numbers language-dockerfile"><code class="language-dockerfile">FROM openjdk:8WORKDIR /emsADD ems.jar /emsEXPOSE 8989ENTRYPOINT ["java","-jar"]CMD ["ems.jar"]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="4-æ„å»ºé•œåƒ"><a href="#4-æ„å»ºé•œåƒ" class="headerlink" title="4.æ„å»ºé•œåƒ"></a>4.æ„å»ºé•œåƒ</h5><pre class="line-numbers language-shell"><code class="language-shell">[root@localhost ems]# docker build -t ems .<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="5-è¿è¡Œé•œåƒ"><a href="#5-è¿è¡Œé•œåƒ" class="headerlink" title="5.è¿è¡Œé•œåƒ"></a>5.è¿è¡Œé•œåƒ</h5><pre class="line-numbers language-shell"><code class="language-shell">[root@localhost ems]# docker run -p 8989:8989 ems<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="6-è®¿é—®é¡¹ç›®"><a href="#6-è®¿é—®é¡¹ç›®" class="headerlink" title="6.è®¿é—®é¡¹ç›®"></a>6.è®¿é—®é¡¹ç›®</h5><pre class="line-numbers language-http"><code class="language-http"><span class="token header-name keyword">http:</span>//10.15.0.8:8989/ems/login.html<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="/posts/7608/image-20200605173141636.png"><hr><h2 id="10-é«˜çº§ç½‘ç»œé…ç½®"><a href="#10-é«˜çº§ç½‘ç»œé…ç½®" class="headerlink" title="10.é«˜çº§ç½‘ç»œé…ç½®"></a>10.é«˜çº§ç½‘ç»œé…ç½®</h2><h3 id="10-1-è¯´æ˜"><a href="#10-1-è¯´æ˜" class="headerlink" title="10.1 è¯´æ˜"></a>10.1 è¯´æ˜</h3><p>å½“ Docker å¯åŠ¨æ—¶ï¼Œä¼šè‡ªåŠ¨åœ¨ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ª <code>docker0</code> è™šæ‹Ÿç½‘æ¡¥ï¼Œå®é™…ä¸Šæ˜¯ Linux çš„ä¸€ä¸ª bridgeï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªè½¯ä»¶äº¤æ¢æœºã€‚å®ƒä¼šåœ¨æŒ‚è½½åˆ°å®ƒçš„ç½‘å£ä¹‹é—´è¿›è¡Œè½¬å‘ã€‚</p><p>åŒæ—¶ï¼ŒDocker éšæœºåˆ†é…ä¸€ä¸ªæœ¬åœ°æœªå ç”¨çš„ç§æœ‰ç½‘æ®µï¼ˆåœ¨ <a href="https://tools.ietf.org/html/rfc1918" target="_blank" rel="noopener">RFC1918</a> ä¸­å®šä¹‰ï¼‰ä¸­çš„ä¸€ä¸ªåœ°å€ç»™ <code>docker0</code> æ¥å£ã€‚æ¯”å¦‚å…¸å‹çš„ <code>172.17.42.1</code>ï¼Œæ©ç ä¸º <code>255.255.0.0</code>ã€‚æ­¤åå¯åŠ¨çš„å®¹å™¨å†…çš„ç½‘å£ä¹Ÿä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªåŒä¸€ç½‘æ®µï¼ˆ<code>172.17.0.0/16</code>ï¼‰çš„åœ°å€ã€‚</p><p>å½“åˆ›å»ºä¸€ä¸ª Docker å®¹å™¨çš„æ—¶å€™ï¼ŒåŒæ—¶ä¼šåˆ›å»ºäº†ä¸€å¯¹ <code>veth pair</code> æ¥å£ï¼ˆå½“æ•°æ®åŒ…å‘é€åˆ°ä¸€ä¸ªæ¥å£æ—¶ï¼Œå¦å¤–ä¸€ä¸ªæ¥å£ä¹Ÿå¯ä»¥æ”¶åˆ°ç›¸åŒçš„æ•°æ®åŒ…ï¼‰ã€‚è¿™å¯¹æ¥å£ä¸€ç«¯åœ¨å®¹å™¨å†…ï¼Œå³ <code>eth0</code>ï¼›å¦ä¸€ç«¯åœ¨æœ¬åœ°å¹¶è¢«æŒ‚è½½åˆ° <code>docker0</code> ç½‘æ¡¥ï¼Œåç§°ä»¥ <code>veth</code> å¼€å¤´ï¼ˆä¾‹å¦‚ <code>vethAQI2QT</code>ï¼‰ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä¸»æœºå¯ä»¥è·Ÿå®¹å™¨é€šä¿¡ï¼Œå®¹å™¨ä¹‹é—´ä¹Ÿå¯ä»¥ç›¸äº’é€šä¿¡ã€‚Docker å°±åˆ›å»ºäº†åœ¨ä¸»æœºå’Œæ‰€æœ‰å®¹å™¨ä¹‹é—´ä¸€ä¸ªè™šæ‹Ÿå…±äº«ç½‘ç»œã€‚</p><img src="/posts/7608/image-20201125105847896.png"><h3 id="10-2-æŸ¥çœ‹ç½‘ç»œä¿¡æ¯"><a href="#10-2-æŸ¥çœ‹ç½‘ç»œä¿¡æ¯" class="headerlink" title="10.2 æŸ¥çœ‹ç½‘ç»œä¿¡æ¯"></a>10.2 æŸ¥çœ‹ç½‘ç»œä¿¡æ¯</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> docker network ls</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="10-3-åˆ›å»ºä¸€ä¸ªç½‘æ¡¥"><a href="#10-3-åˆ›å»ºä¸€ä¸ªç½‘æ¡¥" class="headerlink" title="10.3 åˆ›å»ºä¸€ä¸ªç½‘æ¡¥"></a>10.3 åˆ›å»ºä¸€ä¸ªç½‘æ¡¥</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> docker network create -d bridge ç½‘æ¡¥åç§°</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="10-4-åˆ é™¤ä¸€ä¸ªç½‘æ¡¥"><a href="#10-4-åˆ é™¤ä¸€ä¸ªç½‘æ¡¥" class="headerlink" title="10.4 åˆ é™¤ä¸€ä¸ªç½‘æ¡¥"></a>10.4 åˆ é™¤ä¸€ä¸ªç½‘æ¡¥</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> docker network rm ç½‘æ¡¥åç§°</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="10-5-å®¹å™¨ä¹‹å‰ä½¿ç”¨ç½‘ç»œé€šä¿¡"><a href="#10-5-å®¹å™¨ä¹‹å‰ä½¿ç”¨ç½‘ç»œé€šä¿¡" class="headerlink" title="10.5 å®¹å™¨ä¹‹å‰ä½¿ç”¨ç½‘ç»œé€šä¿¡"></a>10.5 å®¹å™¨ä¹‹å‰ä½¿ç”¨ç½‘ç»œé€šä¿¡</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.æŸ¥è¯¢å½“å‰ç½‘ç»œé…ç½®</span><span class="token list punctuation">-</span> docker network ls<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-shell"><code class="language-shell">NETWORK ID          NAME                DRIVER              SCOPE8e424e5936b7        bridge              bridge              local17d974db02da        docker_gwbridge     bridge              locald6c326e433f7        host                host                local<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 2.åˆ›å»ºæ¡¥æ¥ç½‘ç»œ</span><span class="token list punctuation">-</span> docker network create -d bridge info<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-shell"><code class="language-shell">[root@centos ~]# docker network create -d bridge info6e4aaebff79b1df43a064e0e8fdab08f52d64ce34db78dd5184ce7aaaf550a2f[root@centos ~]# docker network lsNETWORK ID          NAME                DRIVER              SCOPE8e424e5936b7        bridge              bridge              local17d974db02da        docker_gwbridge     bridge              locald6c326e433f7        host                host                local6e4aaebff79b        info                bridge              local<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 3.å¯åŠ¨å®¹å™¨æŒ‡å®šä½¿ç”¨ç½‘æ¡¥- docker run -d -p 8890:80 --name nginx001 --network info nginx - docker run -d -p 8891:80 --name nginx002 --network info nginx     </span><span class="token code keyword">`æ³¨æ„:ä¸€æ—¦æŒ‡å®šç½‘æ¡¥å--nameæŒ‡å®šåå­—å°±æ˜¯ä¸»æœºå,å¤šä¸ªå®¹å™¨æŒ‡å®šåœ¨åŒä¸€ä¸ªç½‘æ¡¥æ—¶,å¯ä»¥åœ¨ä»»æ„ä¸€ä¸ªå®¹å™¨ä¸­ä½¿ç”¨ä¸»æœºåä¸å®¹å™¨è¿›è¡Œäº’é€š`</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-shell"><code class="language-shell">[root@centos ~]# docker run -d -p 8890:80 --name nginx001 --network info nginx c315bcc94e9ddaa36eb6c6f16ca51592b1ac8bf1ecfe9d8f01d892f3f10825fe[root@centos ~]# docker run -d -p 8891:80 --name nginx002 --network info nginxf8682db35dd7fb4395f90edb38df7cad71bbfaba71b6a4c6e2a3a525cb73c2a5[root@centos ~]# docker psCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMESf8682db35dd7        nginx               "/docker-entrypoint.â€¦"   3 seconds ago       Up 2 seconds        0.0.0.0:8891->80/tcp   nginx002c315bcc94e9d        nginx               "/docker-entrypoint.â€¦"   7 minutes ago       Up 7 minutes        0.0.0.0:8890->80/tcp   nginx001b63169d43792        mysql:5.7.19        "docker-entrypoint.sâ€¦"   7 minutes ago       Up 7 minutes        3306/tcp               mysql_mysql.1.s75qe5kkpwwttyf0wrjvd2cda[root@centos ~]# docker exec -it f8682db35dd7 /bin/bashroot@f8682db35dd7:/# curl http://nginx001<!DOCTYPE html><html><head><title>Welcome to nginx!</title>.....<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="11-é«˜çº§æ•°æ®å·é…ç½®"><a href="#11-é«˜çº§æ•°æ®å·é…ç½®" class="headerlink" title="11.é«˜çº§æ•°æ®å·é…ç½®"></a>11.é«˜çº§æ•°æ®å·é…ç½®</h2><h3 id="11-1-è¯´æ˜"><a href="#11-1-è¯´æ˜" class="headerlink" title="11.1 è¯´æ˜"></a>11.1 è¯´æ˜</h3><p><code>æ•°æ®å·</code> æ˜¯ä¸€ä¸ªå¯ä¾›ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ä½¿ç”¨çš„ç‰¹æ®Šç›®å½•ï¼Œå®ƒç»•è¿‡ UFSï¼Œå¯ä»¥æä¾›å¾ˆå¤šæœ‰ç”¨çš„ç‰¹æ€§ï¼š</p><ul><li><code>æ•°æ®å·</code> å¯ä»¥åœ¨å®¹å™¨ä¹‹é—´å…±äº«å’Œé‡ç”¨</li><li>å¯¹ <code>æ•°æ®å·</code> çš„ä¿®æ”¹ä¼šç«‹é©¬ç”Ÿæ•ˆ</li><li>å¯¹ <code>æ•°æ®å·</code> çš„æ›´æ–°ï¼Œä¸ä¼šå½±å“é•œåƒ</li><li><code>æ•°æ®å·</code> é»˜è®¤ä¼šä¸€ç›´å­˜åœ¨ï¼Œå³ä½¿å®¹å™¨è¢«åˆ é™¤</li></ul><blockquote><p>æ³¨æ„ï¼š<code>æ•°æ®å·</code> çš„ä½¿ç”¨ï¼Œç±»ä¼¼äº Linux ä¸‹å¯¹ç›®å½•æˆ–æ–‡ä»¶è¿›è¡Œ mountï¼Œé•œåƒä¸­çš„è¢«æŒ‡å®šä¸ºæŒ‚è½½ç‚¹çš„ç›®å½•ä¸­çš„æ–‡ä»¶ä¼šå¤åˆ¶åˆ°æ•°æ®å·ä¸­ï¼ˆä»…æ•°æ®å·ä¸ºç©ºæ—¶ä¼šå¤åˆ¶ï¼‰ã€‚</p></blockquote><h3 id="11-2-åˆ›å»ºæ•°æ®å·"><a href="#11-2-åˆ›å»ºæ•°æ®å·" class="headerlink" title="11.2 åˆ›å»ºæ•°æ®å·"></a>11.2 åˆ›å»ºæ•°æ®å·</h3><pre class="line-numbers language-shell"><code class="language-shell">[root@centos ~]# docker volume create my-volmy-vol<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="11-3-æŸ¥çœ‹æ•°æ®å·"><a href="#11-3-æŸ¥çœ‹æ•°æ®å·" class="headerlink" title="11.3 æŸ¥çœ‹æ•°æ®å·"></a>11.3 æŸ¥çœ‹æ•°æ®å·</h3><pre class="line-numbers language-shell"><code class="language-shell">[root@centos ~]# docker volume inspect my-vol       [    {        "CreatedAt": "2020-11-25T11:43:56+08:00",        "Driver": "local",        "Labels": {},        "Mountpoint": "/var/lib/docker/volumes/my-vol/_data",        "Name": "my-vol",        "Options": {},        "Scope": "local"    }]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="11-4-æŒ‚è½½æ•°æ®å·"><a href="#11-4-æŒ‚è½½æ•°æ®å·" class="headerlink" title="11.4 æŒ‚è½½æ•°æ®å·"></a>11.4 æŒ‚è½½æ•°æ®å·</h3><pre class="line-numbers language-shell"><code class="language-shell">[root@centos ~]# docker run -d -P --name web  -v my-vol:/usr/share/nginx/html  nginx[root@centos ~]# docker inspect web                "Mounts": [            {                "Type": "volume",                "Name": "my-vol",                "Source": "/var/lib/docker/volumes/my-vol/_data",                "Destination": "/usr/share/nginx/html",                "Driver": "local",                "Mode": "z",                "RW": true,                "Propagation": ""            }        ],<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="11-5-åˆ é™¤æ•°æ®å·"><a href="#11-5-åˆ é™¤æ•°æ®å·" class="headerlink" title="11.5 åˆ é™¤æ•°æ®å·"></a>11.5 åˆ é™¤æ•°æ®å·</h3><pre class="line-numbers language-shell"><code class="language-shell">docker volume rm my-vol<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="12-Docker-Compose"><a href="#12-Docker-Compose" class="headerlink" title="12.Docker Compose"></a>12.Docker Compose</h2><h3 id="12-1-ç®€ä»‹"><a href="#12-1-ç®€ä»‹" class="headerlink" title="12.1 ç®€ä»‹"></a>12.1 ç®€ä»‹</h3><p><code>Compose</code> é¡¹ç›®æ˜¯ Docker å®˜æ–¹çš„å¼€æºé¡¹ç›®ï¼Œè´Ÿè´£å®ç°å¯¹ Docker å®¹å™¨é›†ç¾¤çš„å¿«é€Ÿç¼–æ’ã€‚ä»åŠŸèƒ½ä¸Šçœ‹ï¼Œè·Ÿ <code>OpenStack</code> ä¸­çš„ <code>Heat</code> ååˆ†ç±»ä¼¼ã€‚</p><p>å…¶ä»£ç ç›®å‰åœ¨ <a href="https://github.com/docker/compose" target="_blank" rel="noopener">https://github.com/docker/compose</a> ä¸Šå¼€æºã€‚</p><p><code>Compose</code> å®šä½æ˜¯ ã€Œå®šä¹‰å’Œè¿è¡Œå¤šä¸ª Docker å®¹å™¨çš„åº”ç”¨ï¼ˆDefining and running multi-container Docker applicationsï¼‰ã€ï¼Œå…¶å‰èº«æ˜¯å¼€æºé¡¹ç›® Figã€‚</p><p>é€šè¿‡ç¬¬ä¸€éƒ¨åˆ†ä¸­çš„ä»‹ç»ï¼Œæˆ‘ä»¬çŸ¥é“ä½¿ç”¨ä¸€ä¸ª <code>Dockerfile</code> æ¨¡æ¿æ–‡ä»¶ï¼Œå¯ä»¥è®©ç”¨æˆ·å¾ˆæ–¹ä¾¿çš„å®šä¹‰ä¸€ä¸ªå•ç‹¬çš„åº”ç”¨å®¹å™¨ã€‚ç„¶è€Œï¼Œåœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œç»å¸¸ä¼šç¢°åˆ°éœ€è¦å¤šä¸ªå®¹å™¨ç›¸äº’é…åˆæ¥å®ŒæˆæŸé¡¹ä»»åŠ¡çš„æƒ…å†µã€‚ä¾‹å¦‚è¦å®ç°ä¸€ä¸ª Web é¡¹ç›®ï¼Œé™¤äº† Web æœåŠ¡å®¹å™¨æœ¬èº«ï¼Œå¾€å¾€è¿˜éœ€è¦å†åŠ ä¸Šåç«¯çš„æ•°æ®åº“æœåŠ¡å®¹å™¨ï¼Œç”šè‡³è¿˜åŒ…æ‹¬è´Ÿè½½å‡è¡¡å®¹å™¨ç­‰ã€‚</p><p><code>Compose</code> æ°å¥½æ»¡è¶³äº†è¿™æ ·çš„éœ€æ±‚ã€‚å®ƒå…è®¸ç”¨æˆ·é€šè¿‡ä¸€ä¸ªå•ç‹¬çš„ <code>docker-compose.yml</code> æ¨¡æ¿æ–‡ä»¶ï¼ˆYAML æ ¼å¼ï¼‰æ¥å®šä¹‰ä¸€ç»„ç›¸å…³è”çš„åº”ç”¨å®¹å™¨ä¸ºä¸€ä¸ªé¡¹ç›®ï¼ˆprojectï¼‰ã€‚</p><p><code>Compose</code> ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼š</p><ul><li>æœåŠ¡ (<code>service</code>)ï¼šä¸€ä¸ªåº”ç”¨çš„å®¹å™¨ï¼Œå®é™…ä¸Šå¯ä»¥åŒ…æ‹¬è‹¥å¹²è¿è¡Œç›¸åŒé•œåƒçš„å®¹å™¨å®ä¾‹ã€‚</li><li>é¡¹ç›® (<code>project</code>)ï¼šç”±ä¸€ç»„å…³è”çš„åº”ç”¨å®¹å™¨ç»„æˆçš„ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡å•å…ƒï¼Œåœ¨ <code>docker-compose.yml</code> æ–‡ä»¶ä¸­å®šä¹‰ã€‚</li></ul><p><code>Compose</code> çš„é»˜è®¤ç®¡ç†å¯¹è±¡æ˜¯é¡¹ç›®ï¼Œé€šè¿‡å­å‘½ä»¤å¯¹é¡¹ç›®ä¸­çš„ä¸€ç»„å®¹å™¨è¿›è¡Œä¾¿æ·åœ°ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</p><p><code>Compose</code> é¡¹ç›®ç”± Python ç¼–å†™ï¼Œå®ç°ä¸Šè°ƒç”¨äº† Docker æœåŠ¡æä¾›çš„ API æ¥å¯¹å®¹å™¨è¿›è¡Œç®¡ç†ã€‚å› æ­¤ï¼Œåªè¦æ‰€æ“ä½œçš„å¹³å°æ”¯æŒ Docker APIï¼Œå°±å¯ä»¥åœ¨å…¶ä¸Šåˆ©ç”¨ <code>Compose</code> æ¥è¿›è¡Œç¼–æ’ç®¡ç†ã€‚</p><h3 id="12-2-å®‰è£…ä¸å¸è½½"><a href="#12-2-å®‰è£…ä¸å¸è½½" class="headerlink" title="12.2 å®‰è£…ä¸å¸è½½"></a>12.2 å®‰è£…ä¸å¸è½½</h3><h6 id="1-linux"><a href="#1-linux" class="headerlink" title="1.linux"></a>1.linux</h6><ul><li>åœ¨ Linux ä¸Šçš„ä¹Ÿå®‰è£…ååˆ†ç®€å•ï¼Œä» å®˜æ–¹ GitHub Release å¤„ç›´æ¥ä¸‹è½½ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶å³å¯ã€‚ä¾‹å¦‚ï¼Œåœ¨ Linux 64 ä½ç³»ç»Ÿä¸Šç›´æ¥ä¸‹è½½å¯¹åº”çš„äºŒè¿›åˆ¶åŒ…ã€‚</li></ul><pre class="line-numbers language-bash"><code class="language-bash">$ <span class="token function">sudo</span> curl -L https://github.com/docker/compose/releases/download/1.25.5/docker-compose-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -s<span class="token variable">`</span></span>-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -m<span class="token variable">`</span></span> <span class="token operator">></span> /usr/local/bin/docker-compose$ <span class="token function">sudo</span> <span class="token function">chmod</span> +x /usr/local/bin/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h6 id="2-macosã€window"><a href="#2-macosã€window" class="headerlink" title="2.macosã€window"></a>2.macosã€window</h6><ul><li>Compose å¯ä»¥é€šè¿‡ Python çš„åŒ…ç®¡ç†å·¥å…· pip è¿›è¡Œå®‰è£…ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¸‹è½½ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶ä½¿ç”¨ï¼Œç”šè‡³èƒ½å¤Ÿç›´æ¥åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œã€‚<code>Docker Desktop for Mac/Windows è‡ªå¸¦ docker-compose äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®‰è£… Docker ä¹‹åå¯ä»¥ç›´æ¥ä½¿ç”¨</code>ã€‚</li></ul><h6 id="3-bashå‘½ä»¤è¡¥å…¨"><a href="#3-bashå‘½ä»¤è¡¥å…¨" class="headerlink" title="3.bashå‘½ä»¤è¡¥å…¨"></a>3.bashå‘½ä»¤è¡¥å…¨</h6><pre class="line-numbers language-shell"><code class="language-shell">$ curl -L https://raw.githubusercontent.com/docker/compose/1.25.5/contrib/completion/bash/docker-compose > /etc/bash_completion.d/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h6 id="4-å¸è½½"><a href="#4-å¸è½½" class="headerlink" title="4.å¸è½½"></a>4.å¸è½½</h6><ul><li>å¦‚æœæ˜¯äºŒè¿›åˆ¶åŒ…æ–¹å¼å®‰è£…çš„ï¼Œåˆ é™¤äºŒè¿›åˆ¶æ–‡ä»¶å³å¯ã€‚</li></ul><pre class="line-numbers language-shell"><code class="language-shell">$ sudo rm /usr/local/bin/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h6 id="5-æµ‹è¯•å®‰è£…æˆåŠŸ"><a href="#5-æµ‹è¯•å®‰è£…æˆåŠŸ" class="headerlink" title="5.æµ‹è¯•å®‰è£…æˆåŠŸ"></a>5.æµ‹è¯•å®‰è£…æˆåŠŸ</h6><pre class="line-numbers language-shell"><code class="language-shell">$ docker-compose --version docker-compose version 1.25.5, build 4667896b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="12-3-docker-composeä½¿ç”¨"><a href="#12-3-docker-composeä½¿ç”¨" class="headerlink" title="12.3 docker composeä½¿ç”¨"></a>12.3 docker composeä½¿ç”¨</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.ç›¸å…³æ¦‚å¿µ</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é¦–å…ˆä»‹ç»å‡ ä¸ªæœ¯è¯­ã€‚</p><ul><li>æœåŠ¡ (<code>service</code>)ï¼šä¸€ä¸ªåº”ç”¨å®¹å™¨ï¼Œå®é™…ä¸Šå¯ä»¥è¿è¡Œå¤šä¸ªç›¸åŒé•œåƒçš„å®ä¾‹ã€‚</li><li>é¡¹ç›® (<code>project</code>)ï¼šç”±ä¸€ç»„å…³è”çš„åº”ç”¨å®¹å™¨ç»„æˆçš„ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡å•å…ƒã€‚âˆ‚ä¸€ä¸ªé¡¹ç›®å¯ä»¥ç”±å¤šä¸ªæœåŠ¡ï¼ˆå®¹å™¨ï¼‰å…³è”è€Œæˆï¼Œ<code>Compose</code> é¢å‘é¡¹ç›®è¿›è¡Œç®¡ç†ã€‚</li></ul><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 2.åœºæ™¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æœ€å¸¸è§çš„é¡¹ç›®æ˜¯ web ç½‘ç«™ï¼Œè¯¥é¡¹ç›®åº”è¯¥åŒ…å« web åº”ç”¨å’Œç¼“å­˜ã€‚</p><ul><li>springbootåº”ç”¨</li><li>mysqlæœåŠ¡</li><li>redisæœåŠ¡</li><li>elasticsearchæœåŠ¡</li><li>â€¦â€¦.</li></ul><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 3.docker-composeæ¨¡æ¿</span><span class="token list punctuation">-</span> å‚è€ƒæ–‡æ¡£:https://docker<span class="token italic"><span class="token punctuation">_</span>practice.gitee.io/zh-cn/compose/compose<span class="token punctuation">_</span></span>file.html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-yml"><code class="language-yml">version: "3.0"services:  mysqldb:    image: mysql:5.7.19    container_name: mysql    ports:      - "3306:3306"    volumes:      - /root/mysql/conf:/etc/mysql/conf.d      - /root/mysql/logs:/logs      - /root/mysql/data:/var/lib/mysql    environment:      MYSQL_ROOT_PASSWORD: root    networks:      - ems    depends_on:      - redis  redis:    image: redis:4.0.14    container_name: redis    ports:      - "6379:6379"    networks:      - ems    volumes:      - /root/redis/data:/data    command: redis-servernetworks:  ems:<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 4.é€šè¿‡docker-composeè¿è¡Œä¸€ç»„å®¹å™¨</span><span class="token list punctuation">-</span> å‚è€ƒæ–‡æ¡£:https://docker_practice.gitee.io/zh-cn/compose/commands.html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker-compose up                                //å‰å°å¯åŠ¨ä¸€ç»„æœåŠ¡</span><span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker-compose up -d                             //åå°å¯åŠ¨ä¸€ç»„æœåŠ¡</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><hr><h3 id="12-4-docker-compose-æ¨¡æ¿æ–‡ä»¶"><a href="#12-4-docker-compose-æ¨¡æ¿æ–‡ä»¶" class="headerlink" title="12.4 docker-compose æ¨¡æ¿æ–‡ä»¶"></a>12.4 docker-compose æ¨¡æ¿æ–‡ä»¶</h3><p>æ¨¡æ¿æ–‡ä»¶æ˜¯ä½¿ç”¨ <code>Compose</code> çš„æ ¸å¿ƒï¼Œæ¶‰åŠåˆ°çš„æŒ‡ä»¤å…³é”®å­—ä¹Ÿæ¯”è¾ƒå¤šã€‚ä½†å¤§å®¶ä¸ç”¨æ‹…å¿ƒï¼Œè¿™é‡Œé¢å¤§éƒ¨åˆ†æŒ‡ä»¤è·Ÿ <code>docker run</code> ç›¸å…³å‚æ•°çš„å«ä¹‰éƒ½æ˜¯ç±»ä¼¼çš„ã€‚</p><p>é»˜è®¤çš„æ¨¡æ¿æ–‡ä»¶åç§°ä¸º <code>docker-compose.yml</code>ï¼Œæ ¼å¼ä¸º YAML æ ¼å¼ã€‚</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3"</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">webapp</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> examples/web    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"80:80"</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"/data"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„æ¯ä¸ªæœåŠ¡éƒ½å¿…é¡»é€šè¿‡ <code>image</code> æŒ‡ä»¤æŒ‡å®šé•œåƒæˆ– <code>build</code> æŒ‡ä»¤ï¼ˆéœ€è¦ Dockerfileï¼‰ç­‰æ¥è‡ªåŠ¨æ„å»ºç”Ÿæˆé•œåƒã€‚</p><p>å¦‚æœä½¿ç”¨ <code>build</code> æŒ‡ä»¤ï¼Œåœ¨ <code>Dockerfile</code> ä¸­è®¾ç½®çš„é€‰é¡¹(ä¾‹å¦‚ï¼š<code>CMD</code>, <code>EXPOSE</code>, <code>VOLUME</code>, <code>ENV</code> ç­‰) å°†ä¼šè‡ªåŠ¨è¢«è·å–ï¼Œæ— éœ€åœ¨ <code>docker-compose.yml</code> ä¸­é‡å¤è®¾ç½®ã€‚</p><p>ä¸‹é¢åˆ†åˆ«ä»‹ç»å„ä¸ªæŒ‡ä»¤çš„ç”¨æ³•ã€‚</p><h4 id="build"><a href="#build" class="headerlink" title="build"></a><code>build</code></h4><p>æŒ‡å®š <code>Dockerfile</code> æ‰€åœ¨æ–‡ä»¶å¤¹çš„è·¯å¾„ï¼ˆå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ï¼Œæˆ–è€…ç›¸å¯¹ docker-compose.yml æ–‡ä»¶çš„è·¯å¾„ï¼‰ã€‚ <code>Compose</code> å°†ä¼šåˆ©ç”¨å®ƒè‡ªåŠ¨æ„å»ºè¿™ä¸ªé•œåƒï¼Œç„¶åä½¿ç”¨è¿™ä¸ªé•œåƒã€‚</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">webapp</span><span class="token punctuation">:</span>    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./dir<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>context</code> æŒ‡ä»¤æŒ‡å®š <code>Dockerfile</code> æ‰€åœ¨æ–‡ä»¶å¤¹çš„è·¯å¾„ã€‚</p><p>ä½¿ç”¨ <code>dockerfile</code> æŒ‡ä»¤æŒ‡å®š <code>Dockerfile</code> æ–‡ä»¶åã€‚</p><p>ä½¿ç”¨ <code>arg</code> æŒ‡ä»¤æŒ‡å®šæ„å»ºé•œåƒæ—¶çš„å˜é‡ã€‚</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token key atrule">'3'services</span><span class="token punctuation">:</span>  <span class="token key atrule">webapp</span><span class="token punctuation">:</span>    <span class="token key atrule">build</span><span class="token punctuation">:</span>      <span class="token key atrule">context</span><span class="token punctuation">:</span> ./dir      dockerfile<span class="token punctuation">:</span> Dockerfile<span class="token punctuation">-</span>alternate      args<span class="token punctuation">:</span>        <span class="token key atrule">buildno</span><span class="token punctuation">:</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="command"><a href="#command" class="headerlink" title="command"></a><code>command</code></h4><p>è¦†ç›–å®¹å™¨å¯åŠ¨åé»˜è®¤æ‰§è¡Œçš„å‘½ä»¤ã€‚</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">command</span><span class="token punctuation">:</span> echo "hello world"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="container-name"><a href="#container-name" class="headerlink" title="container_name"></a><code>container_name</code></h4><p>æŒ‡å®šå®¹å™¨åç§°ã€‚é»˜è®¤å°†ä¼šä½¿ç”¨ <code>é¡¹ç›®åç§°_æœåŠ¡åç§°_åºå·</code> è¿™æ ·çš„æ ¼å¼ã€‚</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">container_name</span><span class="token punctuation">:</span> docker<span class="token punctuation">-</span>web<span class="token punctuation">-</span>container<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>æ³¨æ„: æŒ‡å®šå®¹å™¨åç§°åï¼Œè¯¥æœåŠ¡å°†æ— æ³•è¿›è¡Œæ‰©å±•ï¼ˆscaleï¼‰ï¼Œå› ä¸º Docker ä¸å…è®¸å¤šä¸ªå®¹å™¨å…·æœ‰ç›¸åŒçš„åç§°ã€‚</p></blockquote><h4 id="depends-on"><a href="#depends-on" class="headerlink" title="depends_on"></a><code>depends_on</code></h4><p>è§£å†³å®¹å™¨çš„ä¾èµ–ã€å¯åŠ¨å…ˆåçš„é—®é¢˜ã€‚ä»¥ä¸‹ä¾‹å­ä¸­ä¼šå…ˆå¯åŠ¨ <code>redis</code> <code>db</code> å†å¯åŠ¨ <code>web</code></p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token key atrule">'3'services</span><span class="token punctuation">:</span>  <span class="token key atrule">web</span><span class="token punctuation">:</span>    <span class="token key atrule">build</span><span class="token punctuation">:</span> .    depends_on<span class="token punctuation">:</span>      <span class="token punctuation">-</span> db      <span class="token punctuation">-</span> redis  redis<span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> redis  db<span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> postgres<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>æ³¨æ„ï¼š<code>web</code> æœåŠ¡ä¸ä¼šç­‰å¾… <code>redis</code> <code>db</code> ã€Œå®Œå…¨å¯åŠ¨ã€ä¹‹åæ‰å¯åŠ¨ã€‚</p></blockquote><h4 id="env-file"><a href="#env-file" class="headerlink" title="env_file"></a><code>env_file</code></h4><p>ä»æ–‡ä»¶ä¸­è·å–ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ä¸ºå•ç‹¬çš„æ–‡ä»¶è·¯å¾„æˆ–åˆ—è¡¨ã€‚</p><p>å¦‚æœé€šè¿‡ <code>docker-compose -f FILE</code> æ–¹å¼æ¥æŒ‡å®š Compose æ¨¡æ¿æ–‡ä»¶ï¼Œåˆ™ <code>env_file</code> ä¸­å˜é‡çš„è·¯å¾„ä¼šåŸºäºæ¨¡æ¿æ–‡ä»¶è·¯å¾„ã€‚</p><p>å¦‚æœæœ‰å˜é‡åç§°ä¸ <code>environment</code> æŒ‡ä»¤å†²çªï¼Œåˆ™æŒ‰ç…§æƒ¯ä¾‹ï¼Œä»¥åè€…ä¸ºå‡†ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">env_file: .envenv_file:  - ./common.env  - ./apps/web.env  - /opt/secrets.env<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¯å¢ƒå˜é‡æ–‡ä»¶ä¸­æ¯ä¸€è¡Œå¿…é¡»ç¬¦åˆæ ¼å¼ï¼Œæ”¯æŒ <code>#</code> å¼€å¤´çš„æ³¨é‡Šè¡Œã€‚</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># common.env: Set development environment</span>PROG_ENV<span class="token operator">=</span>development<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="environment"><a href="#environment" class="headerlink" title="environment"></a><code>environment</code></h4><p>è®¾ç½®ç¯å¢ƒå˜é‡ã€‚ä½ å¯ä»¥ä½¿ç”¨æ•°ç»„æˆ–å­—å…¸ä¸¤ç§æ ¼å¼ã€‚</p><p>åªç»™å®šåç§°çš„å˜é‡ä¼šè‡ªåŠ¨è·å–è¿è¡Œ Compose ä¸»æœºä¸Šå¯¹åº”å˜é‡çš„å€¼ï¼Œå¯ä»¥ç”¨æ¥é˜²æ­¢æ³„éœ²ä¸å¿…è¦çš„æ•°æ®ã€‚</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">environment</span><span class="token punctuation">:</span>  <span class="token key atrule">RACK_ENV</span><span class="token punctuation">:</span> development  <span class="token key atrule">SESSION_SECRET</span><span class="token punctuation">:</span><span class="token key atrule">environment</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> RACK_ENV=development  <span class="token punctuation">-</span> SESSION_SECRET<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœå˜é‡åç§°æˆ–è€…å€¼ä¸­ç”¨åˆ° <code>true|falseï¼Œyes|no</code> ç­‰è¡¨è¾¾ <a href="https://yaml.org/type/bool.html" target="_blank" rel="noopener">å¸ƒå°”</a> å«ä¹‰çš„è¯æ±‡ï¼Œæœ€å¥½æ”¾åˆ°å¼•å·é‡Œï¼Œé¿å… YAML è‡ªåŠ¨è§£ææŸäº›å†…å®¹ä¸ºå¯¹åº”çš„å¸ƒå°”è¯­ä¹‰ã€‚è¿™äº›ç‰¹å®šè¯æ±‡ï¼ŒåŒ…æ‹¬</p><pre class="line-numbers language-bash"><code class="language-bash">y<span class="token operator">|</span>Y<span class="token operator">|</span><span class="token function">yes</span><span class="token operator">|</span>Yes<span class="token operator">|</span>YES<span class="token operator">|</span>n<span class="token operator">|</span>N<span class="token operator">|</span>no<span class="token operator">|</span>No<span class="token operator">|</span>NO<span class="token operator">|</span><span class="token boolean">true</span><span class="token operator">|</span>True<span class="token operator">|</span>TRUE<span class="token operator">|</span><span class="token boolean">false</span><span class="token operator">|</span>False<span class="token operator">|</span>FALSE<span class="token operator">|</span>on<span class="token operator">|</span>On<span class="token operator">|</span>ON<span class="token operator">|</span>off<span class="token operator">|</span>Off<span class="token operator">|</span>OFF<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="healthcheck"><a href="#healthcheck" class="headerlink" title="healthcheck"></a><code>healthcheck</code></h4><p>é€šè¿‡å‘½ä»¤æ£€æŸ¥å®¹å™¨æ˜¯å¦å¥åº·è¿è¡Œã€‚</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">healthcheck</span><span class="token punctuation">:</span>  <span class="token key atrule">test</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"CMD"</span><span class="token punctuation">,</span> <span class="token string">"curl"</span><span class="token punctuation">,</span> <span class="token string">"-f"</span><span class="token punctuation">,</span> <span class="token string">"http://localhost"</span><span class="token punctuation">]</span>  <span class="token key atrule">interval</span><span class="token punctuation">:</span> 1m30s  <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 10s  <span class="token key atrule">retries</span><span class="token punctuation">:</span> <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="image"><a href="#image" class="headerlink" title="image"></a><code>image</code></h4><p>æŒ‡å®šä¸ºé•œåƒåç§°æˆ–é•œåƒ IDã€‚å¦‚æœé•œåƒåœ¨æœ¬åœ°ä¸å­˜åœ¨ï¼Œ<code>Compose</code> å°†ä¼šå°è¯•æ‹‰å–è¿™ä¸ªé•œåƒã€‚</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token key atrule">ubuntuimage</span><span class="token punctuation">:</span> <span class="token key atrule">orchardup/postgresqlimage</span><span class="token punctuation">:</span> a4bc65fd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="networks"><a href="#networks" class="headerlink" title="networks"></a><code>networks</code></h4><p>é…ç½®å®¹å™¨è¿æ¥çš„ç½‘ç»œã€‚</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3"</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">some-service</span><span class="token punctuation">:</span>    <span class="token key atrule">networks</span><span class="token punctuation">:</span>     <span class="token punctuation">-</span> some<span class="token punctuation">-</span>network     <span class="token punctuation">-</span> other<span class="token punctuation">-</span>network<span class="token key atrule">networks</span><span class="token punctuation">:</span>  <span class="token key atrule">some-network</span><span class="token punctuation">:</span>  other<span class="token punctuation">-</span>network<span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ports"><a href="#ports" class="headerlink" title="ports"></a><code>ports</code></h4><p>æš´éœ²ç«¯å£ä¿¡æ¯ã€‚</p><p>ä½¿ç”¨å®¿ä¸»ç«¯å£ï¼šå®¹å™¨ç«¯å£ <code>(HOST:CONTAINER)</code> æ ¼å¼ï¼Œæˆ–è€…ä»…ä»…æŒ‡å®šå®¹å™¨çš„ç«¯å£ï¼ˆå®¿ä¸»å°†ä¼šéšæœºé€‰æ‹©ç«¯å£ï¼‰éƒ½å¯ä»¥ã€‚</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">ports</span><span class="token punctuation">:</span> <span class="token punctuation">-</span> <span class="token string">"3000"</span> <span class="token punctuation">-</span> <span class="token string">"8000:8000"</span> <span class="token punctuation">-</span> <span class="token string">"49100:22"</span> <span class="token punctuation">-</span> <span class="token string">"127.0.0.1:8001:8001"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><em>æ³¨æ„ï¼šå½“ä½¿ç”¨ <code>HOST:CONTAINER</code> æ ¼å¼æ¥æ˜ å°„ç«¯å£æ—¶ï¼Œå¦‚æœä½ ä½¿ç”¨çš„å®¹å™¨ç«¯å£å°äº 60 å¹¶ä¸”æ²¡æ”¾åˆ°å¼•å·é‡Œï¼Œå¯èƒ½ä¼šå¾—åˆ°é”™è¯¯ç»“æœï¼Œå› ä¸º <code>YAML</code> ä¼šè‡ªåŠ¨è§£æ <code>xx:yy</code> è¿™ç§æ•°å­—æ ¼å¼ä¸º 60 è¿›åˆ¶ã€‚ä¸ºé¿å…å‡ºç°è¿™ç§é—®é¢˜ï¼Œå»ºè®®æ•°å­—ä¸²éƒ½é‡‡ç”¨å¼•å·åŒ…æ‹¬èµ·æ¥çš„å­—ç¬¦ä¸²æ ¼å¼ã€‚</em></p><h4 id="sysctls"><a href="#sysctls" class="headerlink" title="sysctls"></a><code>sysctls</code></h4><p>é…ç½®å®¹å™¨å†…æ ¸å‚æ•°ã€‚</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">sysctls</span><span class="token punctuation">:</span>  <span class="token key atrule">net.core.somaxconn</span><span class="token punctuation">:</span> 1024  net.ipv4.tcp_syncookies<span class="token punctuation">:</span> <span class="token key atrule">0sysctls</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> net.core.somaxconn=1024  <span class="token punctuation">-</span> net.ipv4.tcp_syncookies=0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="ulimits"><a href="#ulimits" class="headerlink" title="ulimits"></a><code>ulimits</code></h4><p>æŒ‡å®šå®¹å™¨çš„ ulimits é™åˆ¶å€¼ã€‚</p><p>ä¾‹å¦‚ï¼ŒæŒ‡å®šæœ€å¤§è¿›ç¨‹æ•°ä¸º 65535ï¼ŒæŒ‡å®šæ–‡ä»¶å¥æŸ„æ•°ä¸º 20000ï¼ˆè½¯é™åˆ¶ï¼Œåº”ç”¨å¯ä»¥éšæ—¶ä¿®æ”¹ï¼Œä¸èƒ½è¶…è¿‡ç¡¬é™åˆ¶ï¼‰ å’Œ 40000ï¼ˆç³»ç»Ÿç¡¬é™åˆ¶ï¼Œåªèƒ½ root ç”¨æˆ·æé«˜ï¼‰ã€‚</p><pre class="line-numbers language-yaml"><code class="language-yaml">  <span class="token key atrule">ulimits</span><span class="token punctuation">:</span>    <span class="token key atrule">nproc</span><span class="token punctuation">:</span> 65535    nofile<span class="token punctuation">:</span>      <span class="token key atrule">soft</span><span class="token punctuation">:</span> 20000      hard<span class="token punctuation">:</span> <span class="token number">40000</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="volumes"><a href="#volumes" class="headerlink" title="volumes"></a><code>volumes</code></h4><p>æ•°æ®å·æ‰€æŒ‚è½½è·¯å¾„è®¾ç½®ã€‚å¯ä»¥è®¾ç½®ä¸ºå®¿ä¸»æœºè·¯å¾„(<code>HOST:CONTAINER</code>)æˆ–è€…æ•°æ®å·åç§°(<code>VOLUME:CONTAINER</code>)ï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®è®¿é—®æ¨¡å¼ ï¼ˆ<code>HOST:CONTAINER:ro</code>ï¼‰ã€‚</p><p>è¯¥æŒ‡ä»¤ä¸­è·¯å¾„æ”¯æŒç›¸å¯¹è·¯å¾„ã€‚</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">volumes</span><span class="token punctuation">:</span> <span class="token punctuation">-</span> /var/lib/mysql <span class="token punctuation">-</span> cache/<span class="token punctuation">:</span>/tmp/cache <span class="token punctuation">-</span> ~/configs<span class="token punctuation">:</span>/etc/configs/<span class="token punctuation">:</span>ro<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœè·¯å¾„ä¸ºæ•°æ®å·åç§°ï¼Œå¿…é¡»åœ¨æ–‡ä»¶ä¸­é…ç½®æ•°æ®å·ã€‚</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3"</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">my_src</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">8.0</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> mysql_data<span class="token punctuation">:</span>/var/lib/mysql<span class="token key atrule">volumes</span><span class="token punctuation">:</span>  mysql_data<span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="12-5-docker-compose-å¸¸ç”¨å‘½ä»¤"><a href="#12-5-docker-compose-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="12.5 docker-compose å¸¸ç”¨å‘½ä»¤"></a>12.5 docker-compose å¸¸ç”¨å‘½ä»¤</h3><h5 id="1-å‘½ä»¤å¯¹è±¡ä¸æ ¼å¼"><a href="#1-å‘½ä»¤å¯¹è±¡ä¸æ ¼å¼" class="headerlink" title="1. å‘½ä»¤å¯¹è±¡ä¸æ ¼å¼"></a>1. å‘½ä»¤å¯¹è±¡ä¸æ ¼å¼</h5><p>å¯¹äº Compose æ¥è¯´ï¼Œå¤§éƒ¨åˆ†å‘½ä»¤çš„å¯¹è±¡æ—¢å¯ä»¥æ˜¯é¡¹ç›®æœ¬èº«ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸ºé¡¹ç›®ä¸­çš„æœåŠ¡æˆ–è€…å®¹å™¨ã€‚å¦‚æœæ²¡æœ‰ç‰¹åˆ«çš„è¯´æ˜ï¼Œå‘½ä»¤å¯¹è±¡å°†æ˜¯é¡¹ç›®ï¼Œè¿™æ„å‘³ç€é¡¹ç›®ä¸­æ‰€æœ‰çš„æœåŠ¡éƒ½ä¼šå—åˆ°å‘½ä»¤å½±å“ã€‚</p><p>æ‰§è¡Œ <code>docker-compose [COMMAND] --help</code> æˆ–è€… <code>docker-compose help [COMMAND]</code> å¯ä»¥æŸ¥çœ‹å…·ä½“æŸä¸ªå‘½ä»¤çš„ä½¿ç”¨æ ¼å¼ã€‚</p><p><code>docker-compose</code> å‘½ä»¤çš„åŸºæœ¬çš„ä½¿ç”¨æ ¼å¼æ˜¯</p><pre class="line-numbers language-bash"><code class="language-bash">docker-compose <span class="token punctuation">[</span>-f<span class="token operator">=</span><span class="token operator">&lt;</span>arg<span class="token operator">></span><span class="token punctuation">..</span>.<span class="token punctuation">]</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span> <span class="token punctuation">[</span>ARGS<span class="token punctuation">..</span>.<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="2-å‘½ä»¤é€‰é¡¹"><a href="#2-å‘½ä»¤é€‰é¡¹" class="headerlink" title="2. å‘½ä»¤é€‰é¡¹"></a>2. å‘½ä»¤é€‰é¡¹</h5><ul><li><code>-f, --file FILE</code> æŒ‡å®šä½¿ç”¨çš„ Compose æ¨¡æ¿æ–‡ä»¶ï¼Œé»˜è®¤ä¸º <code>docker-compose.yml</code>ï¼Œå¯ä»¥å¤šæ¬¡æŒ‡å®šã€‚</li><li><code>-p, --project-name NAME</code> æŒ‡å®šé¡¹ç›®åç§°ï¼Œé»˜è®¤å°†ä½¿ç”¨æ‰€åœ¨ç›®å½•åç§°ä½œä¸ºé¡¹ç›®åã€‚</li><li><code>--x-networking</code> ä½¿ç”¨ Docker çš„å¯æ‹”æ’ç½‘ç»œåç«¯ç‰¹æ€§</li><li><code>--x-network-driver DRIVER</code> æŒ‡å®šç½‘ç»œåç«¯çš„é©±åŠ¨ï¼Œé»˜è®¤ä¸º <code>bridge</code></li><li><code>--verbose</code> è¾“å‡ºæ›´å¤šè°ƒè¯•ä¿¡æ¯ã€‚</li><li><code>-v, --version</code> æ‰“å°ç‰ˆæœ¬å¹¶é€€å‡ºã€‚</li></ul><h5 id="3-å‘½ä»¤ä½¿ç”¨è¯´æ˜"><a href="#3-å‘½ä»¤ä½¿ç”¨è¯´æ˜" class="headerlink" title="3.å‘½ä»¤ä½¿ç”¨è¯´æ˜"></a>3.å‘½ä»¤ä½¿ç”¨è¯´æ˜</h5><h5 id="up"><a href="#up" class="headerlink" title="up"></a><code>up</code></h5><p>æ ¼å¼ä¸º <code>docker-compose up [options] [SERVICE...]</code>ã€‚</p><ul><li><p>è¯¥å‘½ä»¤ååˆ†å¼ºå¤§ï¼Œå®ƒå°†å°è¯•è‡ªåŠ¨å®ŒæˆåŒ…æ‹¬æ„å»ºé•œåƒï¼Œï¼ˆé‡æ–°ï¼‰åˆ›å»ºæœåŠ¡ï¼Œå¯åŠ¨æœåŠ¡ï¼Œå¹¶å…³è”æœåŠ¡ç›¸å…³å®¹å™¨çš„ä¸€ç³»åˆ—æ“ä½œã€‚</p></li><li><p>é“¾æ¥çš„æœåŠ¡éƒ½å°†ä¼šè¢«è‡ªåŠ¨å¯åŠ¨ï¼Œé™¤éå·²ç»å¤„äºè¿è¡ŒçŠ¶æ€ã€‚</p></li><li><p>å¯ä»¥è¯´ï¼Œå¤§éƒ¨åˆ†æ—¶å€™éƒ½å¯ä»¥ç›´æ¥é€šè¿‡è¯¥å‘½ä»¤æ¥å¯åŠ¨ä¸€ä¸ªé¡¹ç›®ã€‚</p></li><li><p>é»˜è®¤æƒ…å†µï¼Œ<code>docker-compose up</code> å¯åŠ¨çš„å®¹å™¨éƒ½åœ¨å‰å°ï¼Œæ§åˆ¶å°å°†ä¼šåŒæ—¶æ‰“å°æ‰€æœ‰å®¹å™¨çš„è¾“å‡ºä¿¡æ¯ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿è¿›è¡Œè°ƒè¯•ã€‚</p></li><li><p>å½“é€šè¿‡ <code>Ctrl-C</code> åœæ­¢å‘½ä»¤æ—¶ï¼Œæ‰€æœ‰å®¹å™¨å°†ä¼šåœæ­¢ã€‚</p></li><li><p>å¦‚æœä½¿ç”¨ <code>docker-compose up -d</code>ï¼Œå°†ä¼šåœ¨åå°å¯åŠ¨å¹¶è¿è¡Œæ‰€æœ‰çš„å®¹å™¨ã€‚ä¸€èˆ¬æ¨èç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨è¯¥é€‰é¡¹ã€‚</p></li><li><p>é»˜è®¤æƒ…å†µï¼Œå¦‚æœæœåŠ¡å®¹å™¨å·²ç»å­˜åœ¨ï¼Œ<code>docker-compose up</code> å°†ä¼šå°è¯•åœæ­¢å®¹å™¨ï¼Œç„¶åé‡æ–°åˆ›å»ºï¼ˆä¿æŒä½¿ç”¨ <code>volumes-from</code> æŒ‚è½½çš„å·ï¼‰ï¼Œä»¥ä¿è¯æ–°å¯åŠ¨çš„æœåŠ¡åŒ¹é… <code>docker-compose.yml</code> æ–‡ä»¶çš„æœ€æ–°å†…å®¹</p></li></ul><hr><h5 id="down"><a href="#down" class="headerlink" title="down"></a><code>down</code></h5><ul><li>æ­¤å‘½ä»¤å°†ä¼šåœæ­¢ <code>up</code> å‘½ä»¤æ‰€å¯åŠ¨çš„å®¹å™¨ï¼Œå¹¶ç§»é™¤ç½‘ç»œ</li></ul><hr><h5 id="exec"><a href="#exec" class="headerlink" title="exec"></a><code>exec</code></h5><ul><li>è¿›å…¥æŒ‡å®šçš„å®¹å™¨ã€‚</li></ul><hr><h5 id="ps"><a href="#ps" class="headerlink" title="ps"></a><code>ps</code></h5><p>æ ¼å¼ä¸º <code>docker-compose ps [options] [SERVICE...]</code>ã€‚</p><p>åˆ—å‡ºé¡¹ç›®ä¸­ç›®å‰çš„æ‰€æœ‰å®¹å™¨ã€‚</p><p>é€‰é¡¹ï¼š</p><ul><li><code>-q</code> åªæ‰“å°å®¹å™¨çš„ ID ä¿¡æ¯ã€‚</li></ul><hr><h5 id="restart"><a href="#restart" class="headerlink" title="restart"></a><code>restart</code></h5><p>æ ¼å¼ä¸º <code>docker-compose restart [options] [SERVICE...]</code>ã€‚</p><p>é‡å¯é¡¹ç›®ä¸­çš„æœåŠ¡ã€‚</p><p>é€‰é¡¹ï¼š</p><ul><li><code>-t, --timeout TIMEOUT</code> æŒ‡å®šé‡å¯å‰åœæ­¢å®¹å™¨çš„è¶…æ—¶ï¼ˆé»˜è®¤ä¸º 10 ç§’ï¼‰ã€‚</li></ul><hr><h5 id="rm"><a href="#rm" class="headerlink" title="rm"></a><code>rm</code></h5><p>æ ¼å¼ä¸º <code>docker-compose rm [options] [SERVICE...]</code>ã€‚</p><p>åˆ é™¤æ‰€æœ‰ï¼ˆåœæ­¢çŠ¶æ€çš„ï¼‰æœåŠ¡å®¹å™¨ã€‚æ¨èå…ˆæ‰§è¡Œ <code>docker-compose stop</code> å‘½ä»¤æ¥åœæ­¢å®¹å™¨ã€‚</p><p>é€‰é¡¹ï¼š</p><ul><li><code>-f, --force</code> å¼ºåˆ¶ç›´æ¥åˆ é™¤ï¼ŒåŒ…æ‹¬éåœæ­¢çŠ¶æ€çš„å®¹å™¨ã€‚ä¸€èˆ¬å°½é‡ä¸è¦ä½¿ç”¨è¯¥é€‰é¡¹ã€‚</li><li><code>-v</code> åˆ é™¤å®¹å™¨æ‰€æŒ‚è½½çš„æ•°æ®å·ã€‚</li></ul><hr><h5 id="start"><a href="#start" class="headerlink" title="start"></a><code>start</code></h5><p>æ ¼å¼ä¸º <code>docker-compose start [SERVICE...]</code>ã€‚</p><p>å¯åŠ¨å·²ç»å­˜åœ¨çš„æœåŠ¡å®¹å™¨ã€‚</p><hr><h5 id="stop"><a href="#stop" class="headerlink" title="stop"></a><code>stop</code></h5><p>æ ¼å¼ä¸º <code>docker-compose stop [options] [SERVICE...]</code>ã€‚</p><p>åœæ­¢å·²ç»å¤„äºè¿è¡ŒçŠ¶æ€çš„å®¹å™¨ï¼Œä½†ä¸åˆ é™¤å®ƒã€‚é€šè¿‡ <code>docker-compose start</code> å¯ä»¥å†æ¬¡å¯åŠ¨è¿™äº›å®¹å™¨ã€‚</p><p>é€‰é¡¹ï¼š</p><ul><li><code>-t, --timeout TIMEOUT</code> åœæ­¢å®¹å™¨æ—¶å€™çš„è¶…æ—¶ï¼ˆé»˜è®¤ä¸º 10 ç§’ï¼‰ã€‚</li></ul><hr><h5 id="top"><a href="#top" class="headerlink" title="top"></a><code>top</code></h5><p>æŸ¥çœ‹å„ä¸ªæœåŠ¡å®¹å™¨å†…è¿è¡Œçš„è¿›ç¨‹ã€‚</p><hr><h5 id="unpause"><a href="#unpause" class="headerlink" title="unpause"></a><code>unpause</code></h5><p>æ ¼å¼ä¸º <code>docker-compose unpause [SERVICE...]</code>ã€‚</p><p>æ¢å¤å¤„äºæš‚åœçŠ¶æ€ä¸­çš„æœåŠ¡ã€‚</p><hr><h2 id="13-dockerå¯è§†åŒ–å·¥å…·"><a href="#13-dockerå¯è§†åŒ–å·¥å…·" class="headerlink" title="13.dockerå¯è§†åŒ–å·¥å…·"></a>13.dockerå¯è§†åŒ–å·¥å…·</h2><h4 id="13-1-å®‰è£…Portainer"><a href="#13-1-å®‰è£…Portainer" class="headerlink" title="13.1 å®‰è£…Portainer"></a>13.1 å®‰è£…Portainer</h4><p>å®˜æ–¹å®‰è£…è¯´æ˜ï¼š<a href="http://www.yunweipai.com/go?_=8fe4813824aHR0cHM6Ly93d3cucG9ydGFpbmVyLmlvL2luc3RhbGxhdGlvbi8=" target="_blank" rel="noopener">https://www.portainer.io/installation/</a></p><pre class="line-numbers language-shell"><code class="language-shell">[root@ubuntu1804 ~]#docker pull  portainer/portainer[root@ubuntu1804 ~]#docker volume create portainer_dataportainer_data[root@ubuntu1804 ~]#docker run -d -p 8000:8000 -p 9000:9000 --name=portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer20db26b67b791648c2ef6aee444a5226a9c897ebcf0160050e722dbf4a4906e3[root@ubuntu1804 ~]#docker ps CONTAINER ID        IMAGE                 COMMAND             CREATED             STATUS              PORTS                                            NAMES20db26b67b79        portainer/portainer   "/portainer"        5 seconds ago       Up 4 seconds        0.0.0.0:8000->8000/tcp, 0.0.0.0:9000->9000/tcp   portainer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="13-2-ç™»å½•å’Œä½¿ç”¨Portainer"><a href="#13-2-ç™»å½•å’Œä½¿ç”¨Portainer" class="headerlink" title="13.2 ç™»å½•å’Œä½¿ç”¨Portainer"></a>13.2 ç™»å½•å’Œä½¿ç”¨Portainer</h4><blockquote><p>ç”¨æµè§ˆå™¨è®¿é—®ï¼š<code>http://localhost:9000</code></p><img src="/posts/7608/image-20201223231707738.png"></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RedisåŸºç¡€</title>
      <link href="/posts/26216.html"/>
      <url>/posts/26216.html</url>
      
        <content type="html"><![CDATA[<h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h2 id="1-NoSQLçš„å¼•è¨€"><a href="#1-NoSQLçš„å¼•è¨€" class="headerlink" title="1.  NoSQLçš„å¼•è¨€"></a>1.  NoSQLçš„å¼•è¨€</h2><p><strong>NoSQL</strong>(<code>Not Only SQL</code> )ï¼Œæ„å³<strong>ä¸ä»…ä»…æ˜¯SQL</strong>, æ³›æŒ‡éå…³ç³»å‹çš„æ•°æ®åº“ã€‚Nosqlè¿™ä¸ªæŠ€æœ¯é—¨ç±»,æ—©æœŸå°±æœ‰äººæå‡º,å‘å±•è‡³2009å¹´è¶‹åŠ¿è¶Šå‘é«˜æ¶¨ã€‚</p><h2 id="2-ä¸ºä»€ä¹ˆæ˜¯NoSQL"><a href="#2-ä¸ºä»€ä¹ˆæ˜¯NoSQL" class="headerlink" title="2. ä¸ºä»€ä¹ˆæ˜¯NoSQL"></a>2. ä¸ºä»€ä¹ˆæ˜¯NoSQL</h2><p>éšç€äº’è”ç½‘ç½‘ç«™çš„å…´èµ·ï¼Œä¼ ç»Ÿçš„å…³ç³»æ•°æ®åº“åœ¨åº”ä»˜åŠ¨æ€ç½‘ç«™ï¼Œç‰¹åˆ«æ˜¯è¶…å¤§è§„æ¨¡å’Œé«˜å¹¶å‘çš„çº¯åŠ¨æ€ç½‘ç«™å·²ç»æ˜¾å¾—åŠ›ä¸ä»å¿ƒï¼Œæš´éœ²äº†å¾ˆå¤šéš¾ä»¥å…‹æœçš„é—®é¢˜ã€‚å¦‚<code>å•†åŸç½‘ç«™ä¸­å¯¹å•†å“æ•°æ®é¢‘ç¹æŸ¥è¯¢</code>ã€<code>å¯¹çƒ­æœå•†å“çš„æ’è¡Œç»Ÿè®¡</code>ã€<code>è®¢å•è¶…æ—¶é—®é¢˜</code>ã€ä»¥åŠå¾®ä¿¡æœ‹å‹åœˆï¼ˆéŸ³é¢‘ï¼Œè§†é¢‘ï¼‰å­˜å‚¨ç­‰ç›¸å…³ä½¿ç”¨ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“å®ç°å°±æ˜¾å¾—éå¸¸å¤æ‚ï¼Œè™½ç„¶èƒ½å®ç°ç›¸åº”åŠŸèƒ½ä½†æ˜¯åœ¨æ€§èƒ½ä¸Šå´ä¸æ˜¯é‚£ä¹ˆä¹è§‚ã€‚nosqlè¿™ä¸ªæŠ€æœ¯é—¨ç±»çš„å‡ºç°ï¼Œæ›´å¥½çš„è§£å†³äº†è¿™äº›é—®é¢˜ï¼Œå®ƒå‘Šè¯‰äº†ä¸–ç•Œä¸ä»…ä»…æ˜¯sqlã€‚</p><h2 id="3-NoSQLçš„å››å¤§åˆ†ç±»"><a href="#3-NoSQLçš„å››å¤§åˆ†ç±»" class="headerlink" title="3. NoSQLçš„å››å¤§åˆ†ç±»"></a>3. NoSQLçš„å››å¤§åˆ†ç±»</h2><h3 id="3-1-é”®å€¼-Key-Value-å­˜å‚¨æ•°æ®åº“"><a href="#3-1-é”®å€¼-Key-Value-å­˜å‚¨æ•°æ®åº“" class="headerlink" title="3.1 é”®å€¼(Key-Value)å­˜å‚¨æ•°æ®åº“"></a>3.1 é”®å€¼(Key-Value)å­˜å‚¨æ•°æ®åº“</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.è¯´æ˜: </span><span class="token list punctuation">-</span> è¿™ä¸€ç±»æ•°æ®åº“ä¸»è¦ä¼šä½¿ç”¨åˆ°ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œè¿™ä¸ªè¡¨ä¸­æœ‰ä¸€ä¸ªç‰¹å®šçš„é”®å’Œä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ç‰¹å®šçš„æ•°æ®ã€‚<span class="token title important"><span class="token punctuation">#</span> 2.ç‰¹ç‚¹</span><span class="token list punctuation">-</span> Key/valueæ¨¡å‹å¯¹äºITç³»ç»Ÿæ¥è¯´çš„ä¼˜åŠ¿åœ¨äºç®€å•ã€æ˜“éƒ¨ç½²ã€‚  <span class="token list punctuation">-</span> ä½†æ˜¯å¦‚æœDBAåªå¯¹éƒ¨åˆ†å€¼è¿›è¡ŒæŸ¥è¯¢æˆ–æ›´æ–°çš„æ—¶å€™ï¼ŒKey/valueå°±æ˜¾å¾—æ•ˆç‡ä½ä¸‹äº†ã€‚<span class="token title important"><span class="token punctuation">#</span> 3.ç›¸å…³äº§å“</span><span class="token list punctuation">-</span> Tokyo Cabinet/Tyrant,<span class="token list punctuation">-</span> Redis<span class="token list punctuation">-</span> SSDB<span class="token list punctuation">-</span> Voldemort <span class="token list punctuation">-</span> Oracle BDB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-2-åˆ—å­˜å‚¨æ•°æ®åº“"><a href="#3-2-åˆ—å­˜å‚¨æ•°æ®åº“" class="headerlink" title="3.2 åˆ—å­˜å‚¨æ•°æ®åº“"></a>3.2 åˆ—å­˜å‚¨æ•°æ®åº“</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.è¯´æ˜</span><span class="token list punctuation">-</span> è¿™éƒ¨åˆ†æ•°æ®åº“é€šå¸¸æ˜¯ç”¨æ¥åº”å¯¹åˆ†å¸ƒå¼å­˜å‚¨çš„æµ·é‡æ•°æ®ã€‚<span class="token title important"><span class="token punctuation">#</span> 2.ç‰¹ç‚¹</span><span class="token list punctuation">-</span> é”®ä»ç„¶å­˜åœ¨ï¼Œä½†æ˜¯å®ƒä»¬çš„ç‰¹ç‚¹æ˜¯æŒ‡å‘äº†å¤šä¸ªåˆ—ã€‚è¿™äº›åˆ—æ˜¯ç”±åˆ—å®¶æ—æ¥å®‰æ’çš„ã€‚<span class="token title important"><span class="token punctuation">#</span> 3.ç›¸å…³äº§å“</span><span class="token list punctuation">-</span> Cassandraã€HBaseã€Riak.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-3-æ–‡æ¡£å‹æ•°æ®åº“"><a href="#3-3-æ–‡æ¡£å‹æ•°æ®åº“" class="headerlink" title="3.3 æ–‡æ¡£å‹æ•°æ®åº“"></a>3.3 æ–‡æ¡£å‹æ•°æ®åº“</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.è¯´æ˜</span><span class="token list punctuation">-</span> æ–‡æ¡£å‹æ•°æ®åº“çš„çµæ„Ÿæ˜¯æ¥è‡ªäºLotus NotesåŠå…¬è½¯ä»¶çš„,<span class="token list punctuation">-</span>    è€Œä¸”å®ƒåŒç¬¬ä¸€ç§é”®å€¼å­˜å‚¨ç›¸ç±»ä¼¼è¯¥ç±»å‹çš„æ•°æ®æ¨¡å‹æ˜¯ç‰ˆæœ¬åŒ–çš„æ–‡æ¡£<span class="token list punctuation">-</span> åŠç»“æ„åŒ–çš„æ–‡æ¡£ä»¥ç‰¹å®šçš„æ ¼å¼å­˜å‚¨ï¼Œæ¯”å¦‚JSONã€‚æ–‡æ¡£å‹æ•°æ®åº“å¯ä»¥çœ‹ä½œæ˜¯é”®å€¼æ•°æ®åº“çš„å‡çº§ç‰ˆ<span class="token list punctuation">-</span> å…è®¸ä¹‹é—´åµŒå¥—é”®å€¼ã€‚è€Œä¸”æ–‡æ¡£å‹æ•°æ®åº“æ¯”é”®å€¼æ•°æ®åº“çš„æŸ¥è¯¢æ•ˆç‡æ›´é«˜<span class="token title important"><span class="token punctuation">#</span> 2.ç‰¹ç‚¹</span><span class="token list punctuation">-</span> ä»¥æ–‡æ¡£å½¢å¼å­˜å‚¨<span class="token title important"><span class="token punctuation">#</span> 3.ç›¸å…³äº§å“</span><span class="token list punctuation">-</span> MongoDBã€CouchDBã€ MongoDb(4.x). å›½å†…ä¹Ÿæœ‰æ–‡æ¡£å‹æ•°æ®åº“SequoiaDBï¼Œå·²ç»å¼€æºã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-4-å›¾å½¢-Graph-æ•°æ®åº“"><a href="#3-4-å›¾å½¢-Graph-æ•°æ®åº“" class="headerlink" title="3.4 å›¾å½¢(Graph)æ•°æ®åº“"></a>3.4 å›¾å½¢(Graph)æ•°æ®åº“</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.è¯´æ˜</span><span class="token list punctuation">-</span> å›¾å½¢ç»“æ„çš„æ•°æ®åº“åŒå…¶ä»–è¡Œåˆ—ä»¥åŠåˆšæ€§ç»“æ„çš„SQLæ•°æ®åº“ä¸åŒ<span class="token list punctuation">-</span> å®ƒæ˜¯ä½¿ç”¨çµæ´»çš„å›¾å½¢æ¨¡å‹ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ‰©å±•åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šã€‚<span class="token list punctuation">-</span> NoSQLæ•°æ®åº“æ²¡æœ‰æ ‡å‡†çš„æŸ¥è¯¢è¯­è¨€(SQL)ï¼Œå› æ­¤è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢éœ€è¦åˆ¶å®šæ•°æ®æ¨¡å‹ã€‚<span class="token list punctuation">-</span> è®¸å¤šNoSQLæ•°æ®åº“éƒ½æœ‰RESTå¼çš„æ•°æ®æ¥å£æˆ–è€…æŸ¥è¯¢APIã€‚<span class="token title important"><span class="token punctuation">#</span> 2.ç‰¹ç‚¹</span><span class="token title important"><span class="token punctuation">#</span> 3.ç›¸å…³äº§å“</span><span class="token list punctuation">-</span> Neo4Jã€InfoGridã€ Infinite Graphã€<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="4-NoSQLåº”ç”¨åœºæ™¯"><a href="#4-NoSQLåº”ç”¨åœºæ™¯" class="headerlink" title="4. NoSQLåº”ç”¨åœºæ™¯"></a>4. NoSQLåº”ç”¨åœºæ™¯</h2><ul><li><p>æ•°æ®æ¨¡å‹æ¯”è¾ƒç®€å•</p></li><li><p>éœ€è¦çµæ´»æ€§æ›´å¼ºçš„ITç³»ç»Ÿ</p></li><li><p>å¯¹æ•°æ®åº“æ€§èƒ½è¦æ±‚è¾ƒé«˜</p></li><li><p>ä¸éœ€è¦é«˜åº¦çš„æ•°æ®ä¸€è‡´æ€§</p></li></ul><h2 id="5-ä»€ä¹ˆæ˜¯Redis"><a href="#5-ä»€ä¹ˆæ˜¯Redis" class="headerlink" title="5. ä»€ä¹ˆæ˜¯Redis"></a>5. ä»€ä¹ˆæ˜¯Redis</h2><img src="/posts/26216/image-20200623121234046.png"> <blockquote><p>Redis is an open source (BSD licensed), in-memory data structure store, used as a database, cache and message broker.</p></blockquote><p>Redis å¼€æº  éµå¾ªBSD  åŸºäºå†…å­˜æ•°æ®å­˜å‚¨ è¢«ç”¨äºä½œä¸º æ•°æ®åº“ ç¼“å­˜  æ¶ˆæ¯ä¸­é—´ä»¶</p><ul><li>æ€»ç»“: redisæ˜¯ä¸€ä¸ªå†…å­˜å‹çš„æ•°æ®åº“</li></ul><h2 id="6-Redisç‰¹ç‚¹"><a href="#6-Redisç‰¹ç‚¹" class="headerlink" title="6. Redisç‰¹ç‚¹"></a>6. Redisç‰¹ç‚¹</h2><ul><li><p>Redisæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½key/valueå†…å­˜å‹æ•°æ®åº“</p></li><li><p>Redisæ”¯æŒä¸°å¯Œçš„æ•°æ®ç±»å‹ </p></li><li><p>Redisæ”¯æŒæŒä¹…åŒ– </p></li><li><p>Rediså•çº¿ç¨‹,å•è¿›ç¨‹</p></li></ul><hr><h2 id="7-Rediså®‰è£…"><a href="#7-Rediså®‰è£…" class="headerlink" title="7. Rediså®‰è£…"></a>7. Rediså®‰è£…</h2><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 0.å‡†å¤‡ç¯å¢ƒ</span><span class="token list punctuation">-</span> vmware15.x+<span class="token list punctuation">-</span> centos7.x+<span class="token title important"><span class="token punctuation">#</span> 1.ä¸‹è½½redisæºç åŒ…</span><span class="token list punctuation">-</span> https://redis.io/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="/posts/26216/image-20200623121621195.png"><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 2.ä¸‹è½½å®Œæ•´æºç åŒ…</span><span class="token list punctuation">-</span> redis-4.0.10.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 3.å°†ä¸‹è½½redisèµ„æ–™åŒ…ä¸Šä¼ åˆ°Linuxä¸­</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>{% asset_img image-20200623124327319.png %} <pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 4.è§£å‹ç¼©æ–‡ä»¶</span>[root@localhost ~]# tar -zxvf redis-4.0.10.tar.gz[root@localhost ~]# ll<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><img src="/posts/26216/image-20200623124522026.png"><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 5.å®‰è£…gcc  </span><span class="token list punctuation">-</span> yum install -y gcc<span class="token title important"><span class="token punctuation">#</span> 6.è¿›å…¥è§£å‹ç¼©ç›®å½•æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</span><span class="token list punctuation">-</span> make MALLOC=libc<span class="token title important"><span class="token punctuation">#</span> 7.ç¼–è¯‘å®Œæˆåæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</span><span class="token list punctuation">-</span> make install PREFIX=/usr/redis<span class="token title important"><span class="token punctuation">#</span> 8.è¿›å…¥/usr/redisç›®å½•å¯åŠ¨redisæœåŠ¡ </span><span class="token list punctuation">-</span> ./redis-server<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="/posts/26216/image-20200623125420505.png"><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 9.RedisæœåŠ¡ç«¯å£é»˜è®¤æ˜¯ 6379</span><span class="token title important"><span class="token punctuation">#</span> 10.è¿›å…¥binç›®å½•æ‰§è¡Œå®¢æˆ·ç«¯è¿æ¥æ“ä½œ</span><span class="token list punctuation">-</span> ./redis-cli â€“p 6379<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><img src="/posts/26216/image-20200623125716013.png"><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 11.è¿æ¥æˆåŠŸå‡ºç°ä¸Šé¢ç•Œé¢è¿æ¥æˆåŠŸ</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="8-Redisæ•°æ®åº“ç›¸å…³æŒ‡ä»¤"><a href="#8-Redisæ•°æ®åº“ç›¸å…³æŒ‡ä»¤" class="headerlink" title="8. Redisæ•°æ®åº“ç›¸å…³æŒ‡ä»¤"></a>8. Redisæ•°æ®åº“ç›¸å…³æŒ‡ä»¤</h2><h3 id="8-1-æ•°æ®åº“æ“ä½œæŒ‡ä»¤"><a href="#8-1-æ•°æ®åº“æ“ä½œæŒ‡ä»¤" class="headerlink" title="8.1 æ•°æ®åº“æ“ä½œæŒ‡ä»¤"></a>8.1 æ•°æ®åº“æ“ä½œæŒ‡ä»¤</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.Redisä¸­åº“è¯´æ˜</span><span class="token list punctuation">-</span> ä½¿ç”¨redisçš„é»˜è®¤é…ç½®å™¨åŠ¨redisæœåŠ¡å,é»˜è®¤ä¼šå­˜åœ¨16ä¸ªåº“,ç¼–å·ä»0-15<span class="token list punctuation">-</span> å¯ä»¥ä½¿ç”¨select åº“çš„ç¼–å· æ¥é€‰æ‹©ä¸€ä¸ªredisçš„åº“<span class="token title important"><span class="token punctuation">#</span> 2.Redisä¸­æ“ä½œåº“çš„æŒ‡ä»¤</span><span class="token list punctuation">-</span> æ¸…ç©ºå½“å‰çš„åº“  FLUSHDB<span class="token list punctuation">-</span> æ¸…ç©ºå…¨éƒ¨çš„åº“  FLUSHALL<span class="token title important"><span class="token punctuation">#</span> 3.rediså®¢æˆ·ç«¯æ˜¾ç¤ºä¸­æ–‡</span><span class="token list punctuation">-</span>    ./redis-cli  -p 7000 --raw<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="8-2-æ“ä½œkeyç›¸å…³æŒ‡ä»¤"><a href="#8-2-æ“ä½œkeyç›¸å…³æŒ‡ä»¤" class="headerlink" title="8.2 æ“ä½œkeyç›¸å…³æŒ‡ä»¤"></a>8.2 æ“ä½œkeyç›¸å…³æŒ‡ä»¤</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.DELæŒ‡ä»¤</span><span class="token list punctuation">-</span> è¯­æ³• :  DEL key [key ...] <span class="token list punctuation">-</span> ä½œç”¨ :  åˆ é™¤ç»™å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªkey ã€‚ä¸å­˜åœ¨çš„key ä¼šè¢«å¿½ç•¥ã€‚<span class="token list punctuation">-</span> å¯ç”¨ç‰ˆæœ¬ï¼š >= 1.0.0<span class="token list punctuation">-</span> è¿”å›å€¼ï¼š è¢«åˆ é™¤key çš„æ•°é‡ã€‚ <span class="token title important"><span class="token punctuation">#</span> 2.EXISTSæŒ‡ä»¤</span><span class="token list punctuation">-</span> è¯­æ³•:  EXISTS key<span class="token list punctuation">-</span> ä½œç”¨:  æ£€æŸ¥ç»™å®škey æ˜¯å¦å­˜åœ¨ã€‚<span class="token list punctuation">-</span> å¯ç”¨ç‰ˆæœ¬ï¼š >= 1.0.0<span class="token list punctuation">-</span> è¿”å›å€¼ï¼š è‹¥key å­˜åœ¨ï¼Œè¿”å›1 ï¼Œå¦åˆ™è¿”å›0ã€‚<span class="token title important"><span class="token punctuation">#</span> 3.EXPIRE</span><span class="token list punctuation">-</span> è¯­æ³•:  EXPIRE key seconds<span class="token list punctuation">-</span> ä½œç”¨:  ä¸ºç»™å®škey è®¾ç½®ç”Ÿå­˜æ—¶é—´ï¼Œå½“key è¿‡æœŸæ—¶(ç”Ÿå­˜æ—¶é—´ä¸º0 )ï¼Œå®ƒä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚<span class="token list punctuation">-</span> å¯ç”¨ç‰ˆæœ¬ï¼š >= 1.0.0<span class="token list punctuation">-</span> æ—¶é—´å¤æ‚åº¦ï¼š O(1)<span class="token list punctuation">-</span> è¿”å›å€¼ï¼šè®¾ç½®æˆåŠŸè¿”å›1 ã€‚<span class="token title important"><span class="token punctuation">#</span> 4.KEYS</span><span class="token list punctuation">-</span> è¯­æ³• :  KEYS pattern<span class="token list punctuation">-</span> ä½œç”¨ :  æŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆç»™å®šæ¨¡å¼pattern çš„key ã€‚<span class="token list punctuation">-</span> è¯­æ³•:<span class="token code keyword">    KEYS * åŒ¹é…æ•°æ®åº“ä¸­æ‰€æœ‰key ã€‚</span><span class="token code keyword">    KEYS h?llo åŒ¹é…hello ï¼Œhallo å’Œhxllo ç­‰ã€‚</span><span class="token code keyword">    KEYS h*llo åŒ¹é…hllo å’Œheeeeello ç­‰ã€‚</span><span class="token code keyword">    KEYS h[ae]llo åŒ¹é…hello å’Œhallo ï¼Œä½†ä¸åŒ¹é…hillo ã€‚ç‰¹æ®Šç¬¦å·ç”¨ "\" éš”å¼€</span><span class="token list punctuation">-</span> å¯ç”¨ç‰ˆæœ¬ï¼š >= 1.0.0<span class="token list punctuation">-</span> è¿”å›å€¼ï¼š ç¬¦åˆç»™å®šæ¨¡å¼çš„key åˆ—è¡¨ã€‚<span class="token title important"><span class="token punctuation">#</span> 5.MOVE</span><span class="token list punctuation">-</span> è¯­æ³• :  MOVE key db<span class="token list punctuation">-</span> ä½œç”¨ :  å°†å½“å‰æ•°æ®åº“çš„key ç§»åŠ¨åˆ°ç»™å®šçš„æ•°æ®åº“db å½“ä¸­ã€‚<span class="token list punctuation">-</span> å¯ç”¨ç‰ˆæœ¬ï¼š >= 1.0.0<span class="token list punctuation">-</span> è¿”å›å€¼ï¼š ç§»åŠ¨æˆåŠŸè¿”å›1 ï¼Œå¤±è´¥åˆ™è¿”å›0 ã€‚<span class="token title important"><span class="token punctuation">#</span> 6.PEXPIRE</span><span class="token list punctuation">-</span> è¯­æ³• :  PEXPIRE key milliseconds<span class="token list punctuation">-</span> ä½œç”¨ :  è¿™ä¸ªå‘½ä»¤å’ŒEXPIRE å‘½ä»¤çš„ä½œç”¨ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒä»¥æ¯«ç§’ä¸ºå•ä½è®¾ç½®key çš„ç”Ÿå­˜æ—¶é—´<span class="token list punctuation">-</span>       è€Œä¸åƒEXPIRE å‘½ä»¤é‚£æ ·ï¼Œä»¥ç§’ä¸ºå•ä½ã€‚<span class="token list punctuation">-</span> å¯ç”¨ç‰ˆæœ¬ï¼š >= 2.6.0<span class="token list punctuation">-</span> æ—¶é—´å¤æ‚åº¦ï¼š O(1)<span class="token list punctuation">-</span> è¿”å›å€¼ï¼šè®¾ç½®æˆåŠŸï¼Œè¿”å›1  key ä¸å­˜åœ¨æˆ–è®¾ç½®å¤±è´¥ï¼Œè¿”å›0<span class="token title important"><span class="token punctuation">#</span> 7.PEXPIREAT</span><span class="token list punctuation">-</span> è¯­æ³• :  PEXPIREAT key milliseconds-timestamp<span class="token list punctuation">-</span> ä½œç”¨ :  è¿™ä¸ªå‘½ä»¤å’ŒEXPIREAT å‘½ä»¤ç±»ä¼¼ï¼Œä½†å®ƒä»¥æ¯«ç§’ä¸ºå•ä½è®¾ç½®key çš„è¿‡æœŸunix æ—¶é—´æˆ³ï¼Œ<span class="token list punctuation">-</span>       è€Œä¸æ˜¯åƒEXPIREATé‚£æ ·ï¼Œä»¥ç§’ä¸ºå•ä½ã€‚<span class="token list punctuation">-</span> å¯ç”¨ç‰ˆæœ¬ï¼š >= 2.6.0<span class="token list punctuation">-</span> è¿”å›å€¼ï¼šå¦‚æœç”Ÿå­˜æ—¶é—´è®¾ç½®æˆåŠŸï¼Œè¿”å›1 ã€‚å½“key ä¸å­˜åœ¨æˆ–æ²¡åŠæ³•è®¾ç½®ç”Ÿå­˜æ—¶é—´æ—¶ï¼Œ<span class="token list punctuation">-</span>        è¿”å›0 ã€‚(æŸ¥çœ‹EXPIRE å‘½ä»¤è·å–æ›´å¤šä¿¡æ¯)<span class="token title important"><span class="token punctuation">#</span> 8.TTL</span><span class="token list punctuation">-</span> è¯­æ³• :   TTL key<span class="token list punctuation">-</span> ä½œç”¨ :   ä»¥ç§’ä¸ºå•ä½ï¼Œè¿”å›ç»™å®škey çš„å‰©ä½™ç”Ÿå­˜æ—¶é—´(TTL, time to live)ã€‚<span class="token list punctuation">-</span> å¯ç”¨ç‰ˆæœ¬ï¼š >= 1.0.0<span class="token list punctuation">-</span> è¿”å›å€¼ï¼š<span class="token code keyword">    å½“key ä¸å­˜åœ¨æ—¶ï¼Œè¿”å›-2 ã€‚</span><span class="token code keyword">    å½“key å­˜åœ¨ä½†æ²¡æœ‰è®¾ç½®å‰©ä½™ç”Ÿå­˜æ—¶é—´æ—¶ï¼Œè¿”å›-1 ã€‚</span><span class="token code keyword">    å¦åˆ™ï¼Œä»¥ç§’ä¸ºå•ä½ï¼Œè¿”å›key çš„å‰©ä½™ç”Ÿå­˜æ—¶é—´ã€‚</span><span class="token list punctuation">-</span> Note : åœ¨Redis 2.8 ä»¥å‰ï¼Œå½“key ä¸å­˜åœ¨ï¼Œæˆ–è€…key æ²¡æœ‰è®¾ç½®å‰©ä½™ç”Ÿå­˜æ—¶é—´æ—¶ï¼Œå‘½ä»¤éƒ½è¿”å›-1 ã€‚<span class="token title important"><span class="token punctuation">#</span> 9.PTTL</span><span class="token list punctuation">-</span> è¯­æ³• :  PTTL key<span class="token list punctuation">-</span> ä½œç”¨ :  è¿™ä¸ªå‘½ä»¤ç±»ä¼¼äºTTL å‘½ä»¤ï¼Œä½†å®ƒä»¥æ¯«ç§’ä¸ºå•ä½è¿”å›key çš„å‰©ä½™ç”Ÿå­˜æ—¶é—´ï¼Œè€Œä¸æ˜¯åƒTTL å‘½ä»¤é‚£æ ·ã€<span class="token list punctuation">-</span>        ä»¥ç§’ä¸ºå•ä½ã€‚<span class="token list punctuation">-</span> å¯ç”¨ç‰ˆæœ¬ï¼š >= 2.6.0<span class="token list punctuation">-</span> è¿”å›å€¼ï¼š å½“key ä¸å­˜åœ¨æ—¶ï¼Œè¿”å›-2 ã€‚å½“key å­˜åœ¨ä½†æ²¡æœ‰è®¾ç½®å‰©ä½™ç”Ÿå­˜æ—¶é—´æ—¶ï¼Œè¿”å›-1 ã€‚<span class="token list punctuation">-</span> å¦åˆ™ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ï¼Œè¿”å›key çš„å‰©ä½™ç”Ÿå­˜æ—¶é—´ã€‚<span class="token list punctuation">-</span> æ³¨æ„ : åœ¨Redis 2.8 ä»¥å‰ï¼Œå½“key ä¸å­˜åœ¨ï¼Œæˆ–è€…key æ²¡æœ‰è®¾ç½®å‰©ä½™ç”Ÿå­˜æ—¶é—´æ—¶ï¼Œå‘½ä»¤éƒ½è¿”å›-1 ã€‚<span class="token title important"><span class="token punctuation">#</span> 10.RANDOMKEY</span><span class="token list punctuation">-</span> è¯­æ³• :  RANDOMKEY<span class="token list punctuation">-</span> ä½œç”¨ :  ä»å½“å‰æ•°æ®åº“ä¸­éšæœºè¿”å›(ä¸åˆ é™¤) ä¸€ä¸ªkey ã€‚<span class="token list punctuation">-</span> å¯ç”¨ç‰ˆæœ¬ï¼š >= 1.0.0<span class="token list punctuation">-</span> è¿”å›å€¼ï¼šå½“æ•°æ®åº“ä¸ä¸ºç©ºæ—¶ï¼Œè¿”å›ä¸€ä¸ªkey ã€‚å½“æ•°æ®åº“ä¸ºç©ºæ—¶ï¼Œè¿”å›nil ã€‚<span class="token title important"><span class="token punctuation">#</span> 11.RENAME</span><span class="token list punctuation">-</span> è¯­æ³• :  RENAME key newkey<span class="token list punctuation">-</span> ä½œç”¨ :  å°†key æ”¹åä¸ºnewkey ã€‚å½“key å’Œnewkey ç›¸åŒï¼Œæˆ–è€…key ä¸å­˜åœ¨æ—¶ï¼Œè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚<span class="token list punctuation">-</span>        å½“newkeyå·²ç»å­˜åœ¨æ—¶ï¼ŒRENAME å‘½ä»¤å°†è¦†ç›–æ—§å€¼ã€‚<span class="token list punctuation">-</span> å¯ç”¨ç‰ˆæœ¬ï¼š >= 1.0.0<span class="token list punctuation">-</span> è¿”å›å€¼ï¼š æ”¹åæˆåŠŸæ—¶æç¤ºOK ï¼Œå¤±è´¥æ—¶å€™è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚<span class="token title important"><span class="token punctuation">#</span> 12.TYPE</span><span class="token list punctuation">-</span> è¯­æ³• :  TYPE key<span class="token list punctuation">-</span> ä½œç”¨ :  è¿”å›key æ‰€å‚¨å­˜çš„å€¼çš„ç±»å‹ã€‚<span class="token list punctuation">-</span> å¯ç”¨ç‰ˆæœ¬ï¼š >= 1.0.0<span class="token list punctuation">-</span> è¿”å›å€¼ï¼š<span class="token code keyword">    none (key ä¸å­˜åœ¨)</span><span class="token code keyword">    string (å­—ç¬¦ä¸²)</span><span class="token code keyword">    list (åˆ—è¡¨)</span><span class="token code keyword">    set (é›†åˆ)</span><span class="token code keyword">    zset (æœ‰åºé›†)</span><span class="token code keyword">    hash (å“ˆå¸Œè¡¨)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="8-3-Stringç±»å‹"><a href="#8-3-Stringç±»å‹" class="headerlink" title="8.3 Stringç±»å‹"></a>8.3 Stringç±»å‹</h3><h4 id="1-å†…å­˜å­˜å‚¨æ¨¡å‹"><a href="#1-å†…å­˜å­˜å‚¨æ¨¡å‹" class="headerlink" title="1. å†…å­˜å­˜å‚¨æ¨¡å‹"></a>1. å†…å­˜å­˜å‚¨æ¨¡å‹</h4><img src="/posts/26216/image-20200623132104399.png"><h4 id="2-å¸¸ç”¨æ“ä½œå‘½ä»¤"><a href="#2-å¸¸ç”¨æ“ä½œå‘½ä»¤" class="headerlink" title="2. å¸¸ç”¨æ“ä½œå‘½ä»¤"></a>2. å¸¸ç”¨æ“ä½œå‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>set</td><td>è®¾ç½®ä¸€ä¸ªkey/value</td></tr><tr><td>get</td><td>æ ¹æ®keyè·å¾—å¯¹åº”çš„value</td></tr><tr><td>mset</td><td>ä¸€æ¬¡è®¾ç½®å¤šä¸ªkey value</td></tr><tr><td>mget</td><td>ä¸€æ¬¡è·å¾—å¤šä¸ªkeyçš„value</td></tr><tr><td>getset</td><td>è·å¾—åŸå§‹keyçš„å€¼ï¼ŒåŒæ—¶è®¾ç½®æ–°å€¼</td></tr><tr><td>strlen</td><td>è·å¾—å¯¹åº”keyå­˜å‚¨valueçš„é•¿åº¦</td></tr><tr><td>append</td><td>ä¸ºå¯¹åº”keyçš„valueè¿½åŠ å†…å®¹</td></tr><tr><td>getrange ç´¢å¼•0å¼€å§‹</td><td>æˆªå–valueçš„å†…å®¹</td></tr><tr><td>setex</td><td>è®¾ç½®ä¸€ä¸ªkeyå­˜æ´»çš„æœ‰æ•ˆæœŸï¼ˆç§’ï¼‰</td></tr><tr><td>psetex</td><td>è®¾ç½®ä¸€ä¸ªkeyå­˜æ´»çš„æœ‰æ•ˆæœŸï¼ˆæ¯«ç§’ï¼‰</td></tr><tr><td>setnx</td><td>å­˜åœ¨ä¸åšä»»ä½•æ“ä½œ,ä¸å­˜åœ¨æ·»åŠ </td></tr><tr><td>msetnxåŸå­æ“ä½œ(åªè¦æœ‰ä¸€ä¸ªå­˜åœ¨ä¸åšä»»ä½•æ“ä½œ)</td><td>å¯ä»¥åŒæ—¶è®¾ç½®å¤šä¸ªkey,åªæœ‰æœ‰ä¸€ä¸ªå­˜åœ¨éƒ½ä¸ä¿å­˜</td></tr><tr><td>decr</td><td>è¿›è¡Œæ•°å€¼ç±»å‹çš„-1æ“ä½œ</td></tr><tr><td>decrby</td><td>æ ¹æ®æä¾›çš„æ•°æ®è¿›è¡Œå‡æ³•æ“ä½œ</td></tr><tr><td>Incr</td><td>è¿›è¡Œæ•°å€¼ç±»å‹çš„+1æ“ä½œ</td></tr><tr><td>incrby</td><td>æ ¹æ®æä¾›çš„æ•°æ®è¿›è¡ŒåŠ æ³•æ“ä½œ</td></tr><tr><td>Incrbyfloat</td><td>æ ¹æ®æä¾›çš„æ•°æ®åŠ å…¥æµ®ç‚¹æ•°</td></tr></tbody></table><h5 id="2-1-ç»ƒä¹ "><a href="#2-1-ç»ƒä¹ " class="headerlink" title="2.1 ç»ƒä¹ "></a>2.1 ç»ƒä¹ </h5><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token list punctuation">-</span> 127.0.0.1:6379> keys *<span class="token title important"><span class="token punctuation">#</span> mset ä¸ mget ä¸€æ¬¡è®¾ç½®å’Œè·å¾—å¤šä¸ªkeyçš„value</span><span class="token list punctuation">-</span> 127.0.0.1:6379> mset name zhangsan age 18 bir 2012-12-12<span class="token list punctuation">-</span> OK<span class="token list punctuation">-</span> 127.0.0.1:6379> keys *<span class="token list punctuation">-</span> bir<span class="token list punctuation">-</span> age<span class="token list punctuation">-</span> name<span class="token list punctuation">-</span> 127.0.0.1:6379> mget name age bir<span class="token list punctuation">-</span> zhangsan<span class="token list punctuation">-</span> 18<span class="token list punctuation">-</span> 2012-12-12<span class="token list punctuation">-</span> 127.0.0.1:6379> <span class="token title important"><span class="token punctuation">#</span> è·å¾—åŸå§‹keyçš„å€¼ï¼ŒåŒæ—¶è®¾ç½®æ–°å€¼</span><span class="token list punctuation">-</span> 127.0.0.1:6379> getset name xiaohei<span class="token list punctuation">-</span> zhangsan<span class="token list punctuation">-</span> 127.0.0.1:6379> get name<span class="token list punctuation">-</span> xiaohei<span class="token title important"><span class="token punctuation">#</span> append , ä¸ºå¯¹åº”keyçš„valueè¿½åŠ å†…å®¹</span><span class="token list punctuation">-</span> 127.0.0.1:6379> get name<span class="token list punctuation">-</span> xiaohei<span class="token list punctuation">-</span> 127.0.0.1:6379> append name thisgoodman<span class="token list punctuation">-</span> 18<span class="token list punctuation">-</span> 127.0.0.1:6379> get name<span class="token list punctuation">-</span> xiaoheithisgoodman<span class="token list punctuation">-</span> 127.0.0.1:6379> <span class="token title important"><span class="token punctuation">#</span> getrange ä»ç´¢å¼•0å¼€å§‹æˆªå–valueçš„å†…å®¹</span><span class="token list punctuation">-</span> 127.0.0.1:6379> get name<span class="token list punctuation">-</span> xiaoheithisgoodman<span class="token list punctuation">-</span> 127.0.0.1:6379> getrange name 7 17<span class="token list punctuation">-</span> thisgoodman<span class="token title important"><span class="token punctuation">#</span> setex è®¾ç½®ä¸€ä¸ªkeyå­˜æ´»çš„æœ‰æ•ˆæœŸï¼ˆç§’ï¼‰</span><span class="token list punctuation">-</span> 127.0.0.1:6379> setex age 100 17<span class="token list punctuation">-</span> OK<span class="token list punctuation">-</span> 127.0.0.1:6379> get age<span class="token list punctuation">-</span> 17<span class="token list punctuation">-</span> 127.0.0.1:6379> ttl age<span class="token list punctuation">-</span> 92<span class="token title important"><span class="token punctuation">#</span> setnxå­˜åœ¨ä¸åšä»»ä½•æ“ä½œ,ä¸å­˜åœ¨æ·»åŠ </span><span class="token list punctuation">-</span> 127.0.0.1:6379> get name<span class="token list punctuation">-</span> zhangsan<span class="token list punctuation">-</span> 127.0.0.1:6379> setnx name xiaohei<span class="token list punctuation">-</span> 0 127.0.0.1:6379> get name zhangsan<span class="token list punctuation">-</span> 127.0.0.1:6379> setnx content xiaohei<span class="token list punctuation">-</span> 1<span class="token list punctuation">-</span> 127.0.0.1:6379> get content<span class="token list punctuation">-</span> xiaohei<span class="token title important"><span class="token punctuation">#</span> decr ä¸ decrby</span><span class="token list punctuation">-</span> 127.0.0.1:6379> set age 18<span class="token list punctuation">-</span> OK<span class="token list punctuation">-</span> 127.0.0.1:6379> get age<span class="token list punctuation">-</span> 18<span class="token list punctuation">-</span> 127.0.0.1:6379> decr age<span class="token list punctuation">-</span> 17<span class="token list punctuation">-</span> 127.0.0.1:6379> decr age<span class="token list punctuation">-</span> 16<span class="token list punctuation">-</span> 127.0.0.1:6379> decr age 10<span class="token list punctuation">-</span> ERR wrong number of arguments for 'decr' command<span class="token list punctuation">-</span> 127.0.0.1:6379> decrby age 10<span class="token list punctuation">-</span> 6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="8-4-Listç±»å‹"><a href="#8-4-Listç±»å‹" class="headerlink" title="8.4 Listç±»å‹"></a>8.4 Listç±»å‹</h3><p>list åˆ—è¡¨ ç›¸å½“äºjavaä¸­list é›†åˆ  ç‰¹ç‚¹  å…ƒç´ æœ‰åº  ä¸” å¯ä»¥é‡å¤</p><h4 id="1-å†…å­˜å­˜å‚¨æ¨¡å‹-1"><a href="#1-å†…å­˜å­˜å‚¨æ¨¡å‹-1" class="headerlink" title="1.å†…å­˜å­˜å‚¨æ¨¡å‹"></a>1.å†…å­˜å­˜å‚¨æ¨¡å‹</h4><img src="/posts/26216/image-20200623161114380.png"><h4 id="2-å¸¸ç”¨æ“ä½œæŒ‡ä»¤"><a href="#2-å¸¸ç”¨æ“ä½œæŒ‡ä»¤" class="headerlink" title="2.å¸¸ç”¨æ“ä½œæŒ‡ä»¤"></a>2.å¸¸ç”¨æ“ä½œæŒ‡ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>lpush</td><td>å°†æŸä¸ªå€¼åŠ å…¥åˆ°ä¸€ä¸ªkeyåˆ—è¡¨å¤´éƒ¨</td></tr><tr><td>lpushx</td><td>åŒlpush,ä½†æ˜¯å¿…é¡»è¦ä¿è¯è¿™ä¸ªkeyå­˜åœ¨</td></tr><tr><td>rpush</td><td>å°†æŸä¸ªå€¼åŠ å…¥åˆ°ä¸€ä¸ªkeyåˆ—è¡¨æœ«å°¾</td></tr><tr><td>rpushx</td><td>åŒrpush,ä½†æ˜¯å¿…é¡»è¦ä¿è¯è¿™ä¸ªkeyå­˜åœ¨</td></tr><tr><td>lpop</td><td>è¿”å›å’Œç§»é™¤åˆ—è¡¨å·¦è¾¹çš„ç¬¬ä¸€ä¸ªå…ƒç´ </td></tr><tr><td>rpop</td><td>è¿”å›å’Œç§»é™¤åˆ—è¡¨å³è¾¹çš„ç¬¬ä¸€ä¸ªå…ƒç´ </td></tr><tr><td>lrange</td><td>è·å–æŸä¸€ä¸ªä¸‹æ ‡åŒºé—´å†…çš„å…ƒç´ </td></tr><tr><td>llen</td><td>è·å–åˆ—è¡¨å…ƒç´ ä¸ªæ•°</td></tr><tr><td>lset</td><td>è®¾ç½®æŸä¸€ä¸ªæŒ‡å®šç´¢å¼•çš„å€¼(ç´¢å¼•å¿…é¡»å­˜åœ¨)</td></tr><tr><td>lindex</td><td>è·å–æŸä¸€ä¸ªæŒ‡å®šç´¢å¼•ä½ç½®çš„å…ƒç´ </td></tr><tr><td>lrem</td><td>åˆ é™¤é‡å¤å…ƒç´  ==&gt; <code>lrem lists 2 zhangsan åˆ é™¤2ä¸ªé‡å¤çš„å¼ ä¸‰</code></td></tr><tr><td>ltrim</td><td>ä¿ç•™åˆ—è¡¨ä¸­ç‰¹å®šåŒºé—´å†…çš„å…ƒç´  == &gt; <code>ltrim lists 1 5 //å…¶ä»–çš„åˆ é™¤äº†</code></td></tr><tr><td>linsert</td><td>|åœ¨æŸä¸€ä¸ªå…ƒç´ ä¹‹å‰ï¼Œä¹‹åæ’å…¥æ–°å…ƒç´  ==&gt; linsert  lists  before | after  åˆ—è¡¨å­˜åœ¨  æ’å…¥çš„å€¼</td></tr></tbody></table><h3 id="8-5-Setç±»å‹"><a href="#8-5-Setç±»å‹" class="headerlink" title="8.5 Setç±»å‹"></a>8.5 Setç±»å‹</h3><p>ç‰¹ç‚¹: Setç±»å‹ Seté›†åˆ å…ƒç´ æ— åº  ä¸å¯ä»¥é‡å¤</p><h4 id="1-å†…å­˜å­˜å‚¨æ¨¡å‹-2"><a href="#1-å†…å­˜å­˜å‚¨æ¨¡å‹-2" class="headerlink" title="1.å†…å­˜å­˜å‚¨æ¨¡å‹"></a>1.å†…å­˜å­˜å‚¨æ¨¡å‹</h4><img src="/posts/26216/image-20200623193634316.png"><h4 id="2-å¸¸ç”¨å‘½ä»¤"><a href="#2-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="2.å¸¸ç”¨å‘½ä»¤"></a>2.å¸¸ç”¨å‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>sadd</td><td>ä¸ºé›†åˆæ·»åŠ å…ƒç´ </td></tr><tr><td>smembers</td><td>æ˜¾ç¤ºé›†åˆä¸­æ‰€æœ‰å…ƒç´  æ— åº</td></tr><tr><td>scard</td><td>è¿”å›é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°</td></tr><tr><td>spop</td><td>éšæœºè¿”å›ä¸€ä¸ªå…ƒç´  å¹¶å°†å…ƒç´ åœ¨é›†åˆä¸­åˆ é™¤</td></tr><tr><td>smove</td><td>ä»ä¸€ä¸ªé›†åˆä¸­å‘å¦ä¸€ä¸ªé›†åˆç§»åŠ¨å…ƒç´   å¿…é¡»æ˜¯åŒä¸€ç§ç±»å‹ -&gt;smove sets ages lisi(sets-&gt;age)</td></tr><tr><td>srem</td><td>ä»é›†åˆä¸­åˆ é™¤ä¸€ä¸ªå…ƒç´  -&gt; srem ages zhangsan 18 <code>åˆ é™¤18å’Œå¼ ä¸‰</code></td></tr><tr><td>sismember</td><td>åˆ¤æ–­ä¸€ä¸ªé›†åˆä¸­æ˜¯å¦å«æœ‰è¿™ä¸ªå…ƒç´ </td></tr><tr><td>srandmember</td><td>éšæœºè¿”å›å…ƒç´ </td></tr><tr><td>sdiff</td><td>å»æ‰ç¬¬ä¸€ä¸ªé›†åˆä¸­å…¶å®ƒé›†åˆå«æœ‰çš„ç›¸åŒå…ƒç´ </td></tr><tr><td>sinter</td><td>æ±‚äº¤é›†</td></tr><tr><td>sunion</td><td>æ±‚å’Œé›†</td></tr></tbody></table><h3 id="8-6-ZSetç±»å‹"><a href="#8-6-ZSetç±»å‹" class="headerlink" title="8.6 ZSetç±»å‹"></a>8.6 ZSetç±»å‹</h3><p>ç‰¹ç‚¹: å¯æ’åºçš„seté›†åˆ  æ’åº  ä¸å¯é‡å¤ </p><p>ZSET å®˜æ–¹  å¯æ’åºSET  sortSet   </p><h4 id="1-å†…å­˜æ¨¡å‹"><a href="#1-å†…å­˜æ¨¡å‹" class="headerlink" title="1.å†…å­˜æ¨¡å‹"></a>1.å†…å­˜æ¨¡å‹</h4><img src="/posts/26216/image-20200623194903967.png"><h4 id="2-å¸¸ç”¨å‘½ä»¤-1"><a href="#2-å¸¸ç”¨å‘½ä»¤-1" class="headerlink" title="2.å¸¸ç”¨å‘½ä»¤"></a>2.å¸¸ç”¨å‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>zadd</td><td>æ·»åŠ ä¸€ä¸ªæœ‰åºé›†åˆå…ƒç´ </td></tr><tr><td>zcard</td><td>è¿”å›é›†åˆçš„å…ƒç´ ä¸ªæ•°</td></tr><tr><td>zrange å‡åº zrevrange é™åº</td><td>è¿”å›ä¸€ä¸ªèŒƒå›´å†…çš„å…ƒç´ </td></tr><tr><td>zrangebyscore</td><td>æŒ‰ç…§åˆ†æ•°æŸ¥æ‰¾ä¸€ä¸ªèŒƒå›´å†…çš„å…ƒç´ </td></tr><tr><td>zrank</td><td>è¿”å›æ’å</td></tr><tr><td>zrevrank</td><td>å€’åºæ’å</td></tr><tr><td>zscore</td><td>æ˜¾ç¤ºæŸä¸€ä¸ªå…ƒç´ çš„åˆ†æ•°</td></tr><tr><td>zrem</td><td>ç§»é™¤æŸä¸€ä¸ªå…ƒç´ </td></tr><tr><td>zincrby</td><td>ç»™æŸä¸ªç‰¹å®šå…ƒç´ åŠ åˆ†</td></tr></tbody></table><h3 id="8-7-hashç±»å‹"><a href="#8-7-hashç±»å‹" class="headerlink" title="8.7 hashç±»å‹"></a>8.7 hashç±»å‹</h3><p>ç‰¹ç‚¹: value æ˜¯ä¸€ä¸ªmapç»“æ„ å­˜åœ¨key value  key æ— åºçš„  </p><h4 id="1-å†…å­˜æ¨¡å‹-1"><a href="#1-å†…å­˜æ¨¡å‹-1" class="headerlink" title="1.å†…å­˜æ¨¡å‹"></a>1.å†…å­˜æ¨¡å‹</h4><img src="/posts/26216/image-20200623200348408.png"><h4 id="2-å¸¸ç”¨å‘½ä»¤-2"><a href="#2-å¸¸ç”¨å‘½ä»¤-2" class="headerlink" title="2.å¸¸ç”¨å‘½ä»¤"></a>2.å¸¸ç”¨å‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>hset</td><td>è®¾ç½®ä¸€ä¸ªkey/valueå¯¹</td></tr><tr><td>hget</td><td>è·å¾—ä¸€ä¸ªkeyå¯¹åº”çš„value</td></tr><tr><td>hgetall</td><td>è·å¾—æ‰€æœ‰çš„key/valueå¯¹</td></tr><tr><td>hdel</td><td>åˆ é™¤æŸä¸€ä¸ªkey/valueå¯¹</td></tr><tr><td>hexists</td><td>åˆ¤æ–­ä¸€ä¸ªkeyæ˜¯å¦å­˜åœ¨</td></tr><tr><td>hkeys</td><td>è·å¾—æ‰€æœ‰çš„key</td></tr><tr><td>hvals</td><td>è·å¾—æ‰€æœ‰çš„value</td></tr><tr><td>hmset</td><td>è®¾ç½®å¤šä¸ªkey/value</td></tr><tr><td>hmget</td><td>è·å¾—å¤šä¸ªkeyçš„value</td></tr><tr><td>hsetnx</td><td>è®¾ç½®ä¸€ä¸ªä¸å­˜åœ¨çš„keyçš„å€¼</td></tr><tr><td>hincrby</td><td>ä¸ºvalueè¿›è¡ŒåŠ æ³•è¿ç®—</td></tr><tr><td>hincrbyfloat</td><td>ä¸ºvalueåŠ å…¥æµ®ç‚¹å€¼</td></tr></tbody></table><hr><h2 id="9-æŒä¹…åŒ–æœºåˆ¶"><a href="#9-æŒä¹…åŒ–æœºåˆ¶" class="headerlink" title="9. æŒä¹…åŒ–æœºåˆ¶"></a>9. æŒä¹…åŒ–æœºåˆ¶</h2><p>client  redis[å†…å­˜] â€”â€“&gt;  å†…å­˜æ•°æ®- æ•°æ®æŒä¹…åŒ–â€“&gt;ç£ç›˜</p><p>Rediså®˜æ–¹æä¾›äº†ä¸¤ç§ä¸åŒçš„æŒä¹…åŒ–æ–¹æ³•æ¥å°†æ•°æ®å­˜å‚¨åˆ°ç¡¬ç›˜é‡Œé¢åˆ†åˆ«æ˜¯:</p><ul><li>å¿«ç…§(Snapshot)</li><li>AOF (Append Only File) åªè¿½åŠ æ—¥å¿—æ–‡ä»¶</li></ul><h3 id="9-1-å¿«ç…§-Snapshot"><a href="#9-1-å¿«ç…§-Snapshot" class="headerlink" title="9.1 å¿«ç…§(Snapshot)"></a>9.1 å¿«ç…§(Snapshot)</h3><h4 id="1-ç‰¹ç‚¹"><a href="#1-ç‰¹ç‚¹" class="headerlink" title="1. ç‰¹ç‚¹"></a>1. ç‰¹ç‚¹</h4><p>è¿™ç§æ–¹å¼å¯ä»¥å°†æŸä¸€æ—¶åˆ»çš„æ‰€æœ‰æ•°æ®éƒ½å†™å…¥ç¡¬ç›˜ä¸­,å½“ç„¶è¿™ä¹Ÿæ˜¯<strong>redisçš„é»˜è®¤å¼€å¯æŒä¹…åŒ–æ–¹å¼</strong>,ä¿å­˜çš„æ–‡ä»¶æ˜¯ä»¥.rdbå½¢å¼ç»“å°¾çš„æ–‡ä»¶å› æ­¤è¿™ç§æ–¹å¼ä¹Ÿç§°ä¹‹ä¸ºRDBæ–¹å¼ã€‚</p><img src="/posts/26216/image-20200623204303074.png"><h4 id="2-å¿«ç…§ç”Ÿæˆæ–¹å¼"><a href="#2-å¿«ç…§ç”Ÿæˆæ–¹å¼" class="headerlink" title="2.å¿«ç…§ç”Ÿæˆæ–¹å¼"></a>2.å¿«ç…§ç”Ÿæˆæ–¹å¼</h4><ul><li>å®¢æˆ·ç«¯æ–¹å¼: BGSAVE å’Œ SAVEæŒ‡ä»¤</li><li>æœåŠ¡å™¨é…ç½®è‡ªåŠ¨è§¦å‘</li></ul><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.å®¢æˆ·ç«¯æ–¹å¼ä¹‹BGSAVE</span><span class="token list punctuation">-</span> a.å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨BGSAVEå‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªå¿«ç…§,å½“æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„BGSAVEå‘½ä»¤æ—¶,redisä¼šè°ƒç”¨forkÂ¹æ¥åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹,ç„¶åå­è¿›ç¨‹è´Ÿè´£å°†å¿«ç…§å†™å…¥ç£ç›˜ä¸­,è€Œçˆ¶è¿›ç¨‹åˆ™ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ã€‚<span class="token code keyword">    `åè¯è§£é‡Š: forkå½“ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹çš„æ—¶å€™,åº•å±‚çš„æ“ä½œç³»ç»Ÿä¼šåˆ›å»ºè¯¥è¿›ç¨‹çš„ä¸€ä¸ªå‰¯æœ¬,åœ¨ç±»unixç³»ç»Ÿä¸­åˆ›å»ºå­è¿›ç¨‹çš„æ“ä½œä¼šè¿›è¡Œä¼˜åŒ–:åœ¨åˆšå¼€å§‹çš„æ—¶å€™,çˆ¶å­è¿›ç¨‹å…±äº«ç›¸åŒå†…å­˜,ç›´åˆ°çˆ¶è¿›ç¨‹æˆ–å­è¿›ç¨‹å¯¹å†…å­˜è¿›è¡Œäº†å†™ä¹‹å,å¯¹è¢«å†™å…¥çš„å†…å­˜çš„å…±äº«æ‰ä¼šç»“æŸæœåŠ¡`</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><img src="/posts/26216/image-20200623205132460.png"><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 2.å®¢æˆ·ç«¯æ–¹å¼ä¹‹SAVE</span><span class="token list punctuation">-</span> b.ï¬å®¢æˆ·ç«¯è¿˜å¯ä»¥ä½¿ç”¨SAVEå‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªå¿«ç…§,æ¥æ”¶åˆ°SAVEå‘½ä»¤çš„redisæœåŠ¡å™¨åœ¨å¿«ç…§åˆ›å»ºå®Œæ¯•ä¹‹å‰å°†ä¸å†å“åº”ä»»ä½•å…¶ä»–çš„å‘½ä»¤<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><img src="/posts/26216/image-20200623205444101.png"><ul><li><strong>æ³¨æ„: SAVEå‘½ä»¤å¹¶ä¸å¸¸ç”¨,ä½¿ç”¨SAVEå‘½ä»¤åœ¨å¿«ç…§åˆ›å»ºå®Œæ¯•ä¹‹å‰,rediså¤„äºé˜»å¡çŠ¶æ€,æ— æ³•å¯¹å¤–æœåŠ¡</strong></li></ul><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 3.æœåŠ¡å™¨é…ç½®æ–¹å¼ä¹‹æ»¡è¶³é…ç½®è‡ªåŠ¨è§¦å‘- ï¬å¦‚æœç”¨æˆ·åœ¨redis.confä¸­è®¾ç½®äº†saveé…ç½®é€‰é¡¹,redisä¼šåœ¨saveé€‰é¡¹æ¡ä»¶æ»¡è¶³ä¹‹åè‡ªåŠ¨è§¦å‘ä¸€æ¬¡BGSAVEå‘½ä»¤,å¦‚æœè®¾ç½®å¤šä¸ªsaveé…ç½®é€‰é¡¹,å½“ä»»æ„ä¸€ä¸ªsaveé…ç½®é€‰é¡¹æ¡ä»¶æ»¡è¶³,redisä¹Ÿä¼šè§¦å‘ä¸€æ¬¡BGSAVEå‘½ä»¤</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>{% asset_img image-20200623210021012.png %} <pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 4.æœåŠ¡å™¨æ¥æ”¶å®¢æˆ·ç«¯shutdownæŒ‡ä»¤</span><span class="token list punctuation">-</span> å½“redisé€šè¿‡shutdownæŒ‡ä»¤æ¥æ”¶åˆ°å…³é—­æœåŠ¡å™¨çš„è¯·æ±‚æ—¶,ä¼šæ‰§è¡Œä¸€ä¸ªsaveå‘½ä»¤,é˜»å¡æ‰€æœ‰çš„å®¢æˆ·ç«¯,ä¸å†æ‰§è¡Œå®¢æˆ·ç«¯æ‰§è¡Œå‘é€çš„ä»»ä½•å‘½ä»¤,å¹¶ä¸”åœ¨saveå‘½ä»¤æ‰§è¡Œå®Œæ¯•ä¹‹åå…³é—­æœåŠ¡å™¨<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="3-é…ç½®ç”Ÿæˆå¿«ç…§åç§°å’Œä½ç½®"><a href="#3-é…ç½®ç”Ÿæˆå¿«ç…§åç§°å’Œä½ç½®" class="headerlink" title="3.é…ç½®ç”Ÿæˆå¿«ç…§åç§°å’Œä½ç½®"></a>3.é…ç½®ç”Ÿæˆå¿«ç…§åç§°å’Œä½ç½®</h4><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span>1.ä¿®æ”¹ç”Ÿæˆå¿«ç…§åç§°</span><span class="token list punctuation">-</span> dbfilename dump.rdb<span class="token title important"><span class="token punctuation">#</span> 2.ä¿®æ”¹ç”Ÿæˆä½ç½®</span><span class="token list punctuation">-</span> dir ./<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="/posts/26216/image-20200623210352448.png"> <hr><h3 id="9-2-AOF-åªè¿½åŠ æ—¥å¿—æ–‡ä»¶"><a href="#9-2-AOF-åªè¿½åŠ æ—¥å¿—æ–‡ä»¶" class="headerlink" title="9.2 AOF åªè¿½åŠ æ—¥å¿—æ–‡ä»¶"></a>9.2 AOF åªè¿½åŠ æ—¥å¿—æ–‡ä»¶</h3><h4 id="1-ç‰¹ç‚¹-1"><a href="#1-ç‰¹ç‚¹-1" class="headerlink" title="1.ç‰¹ç‚¹"></a>1.ç‰¹ç‚¹</h4><p>è¿™ç§æ–¹å¼å¯ä»¥å°†æ‰€æœ‰å®¢æˆ·ç«¯æ‰§è¡Œçš„å†™å‘½ä»¤è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ä¸­,AOFæŒä¹…åŒ–ä¼šå°†è¢«æ‰§è¡Œçš„å†™å‘½ä»¤å†™åˆ°AOFçš„æ–‡ä»¶æœ«å°¾,ä»¥æ­¤æ¥è®°å½•æ•°æ®å‘ç”Ÿçš„å˜åŒ–,å› æ­¤åªè¦redisä»å¤´åˆ°å°¾æ‰§è¡Œä¸€æ¬¡AOFæ–‡ä»¶æ‰€åŒ…å«çš„æ‰€æœ‰å†™å‘½ä»¤,å°±å¯ä»¥æ¢å¤AOFæ–‡ä»¶çš„è®°å½•çš„æ•°æ®é›†.</p><img src="/posts/26216/image-20200623211330798.png"> <h4 id="2-å¼€å¯AOFæŒä¹…åŒ–"><a href="#2-å¼€å¯AOFæŒä¹…åŒ–" class="headerlink" title="2.å¼€å¯AOFæŒä¹…åŒ–"></a>2.å¼€å¯AOFæŒä¹…åŒ–</h4><p>åœ¨redisçš„é»˜è®¤é…ç½®ä¸­AOFæŒä¹…åŒ–æœºåˆ¶æ˜¯æ²¡æœ‰å¼€å¯çš„ï¼Œéœ€è¦åœ¨é…ç½®ä¸­å¼€å¯</p><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.å¼€å¯AOFæŒä¹…åŒ–- a.ä¿®æ”¹ appendonly yes å¼€å¯æŒä¹…åŒ–- b.ä¿®æ”¹ appendfilename "appendonly.aof" æŒ‡å®šç”Ÿæˆæ–‡ä»¶åç§°</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>{% asset_img image-20200623211508987.png %} <h4 id="3-æ—¥å¿—è¿½åŠ é¢‘ç‡"><a href="#3-æ—¥å¿—è¿½åŠ é¢‘ç‡" class="headerlink" title="3.æ—¥å¿—è¿½åŠ é¢‘ç‡"></a>3.æ—¥å¿—è¿½åŠ é¢‘ç‡</h4><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.always ã€è°¨æ…ä½¿ç”¨ã€‘- è¯´æ˜: æ¯ä¸ªrediså†™å‘½ä»¤éƒ½è¦åŒæ­¥å†™å…¥ç¡¬ç›˜,ä¸¥é‡é™ä½redisé€Ÿåº¦- è§£é‡Š: å¦‚æœç”¨æˆ·ä½¿ç”¨äº†alwaysé€‰é¡¹,é‚£ä¹ˆæ¯ä¸ªrediså†™å‘½ä»¤éƒ½ä¼šè¢«å†™å…¥ç¡¬ç›˜,ä»è€Œå°†å‘ç”Ÿç³»ç»Ÿå´©æºƒæ—¶å‡ºç°çš„æ•°æ®ä¸¢å¤±å‡åˆ°æœ€å°‘;é—æ†¾çš„æ˜¯,å› ä¸ºè¿™ç§åŒæ­¥ç­–ç•¥éœ€è¦å¯¹ç¡¬ç›˜è¿›è¡Œå¤§é‡çš„å†™å…¥æ“ä½œ,æ‰€ä»¥rediså¤„ç†å‘½ä»¤çš„é€Ÿåº¦ä¼šå—åˆ°ç¡¬ç›˜æ€§èƒ½çš„é™åˆ¶;- æ³¨æ„: è½¬ç›˜å¼ç¡¬ç›˜åœ¨è¿™ç§é¢‘ç‡ä¸‹200å·¦å³ä¸ªå‘½ä»¤/s ; å›ºæ€ç¡¬ç›˜(SSD) å‡ ç™¾ä¸‡ä¸ªå‘½ä»¤/s;- è­¦å‘Š: ä½¿ç”¨SSDç”¨æˆ·è¯·è°¨æ…ä½¿ç”¨alwaysé€‰é¡¹,è¿™ç§æ¨¡å¼ä¸æ–­å†™å…¥å°‘é‡æ•°æ®çš„åšæ³•æœ‰å¯èƒ½ä¼šå¼•å‘ä¸¥é‡çš„å†™å…¥æ”¾å¤§é—®é¢˜,å¯¼è‡´å°†å›ºæ€ç¡¬ç›˜çš„å¯¿å‘½ä»åŸæ¥çš„å‡ å¹´é™ä½ä¸ºå‡ ä¸ªæœˆã€‚# 2.everysec ã€æ¨èã€‘- è¯´æ˜: æ¯ç§’æ‰§è¡Œä¸€æ¬¡åŒæ­¥æ˜¾å¼çš„å°†å¤šä¸ªå†™å‘½ä»¤åŒæ­¥åˆ°ç£ç›˜- è§£é‡Šï¼š ä¸ºäº†å…¼é¡¾æ•°æ®å®‰å…¨å’Œå†™å…¥æ€§èƒ½,ç”¨æˆ·å¯ä»¥è€ƒè™‘ä½¿ç”¨everysecé€‰é¡¹,è®©redisæ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡å¯¹AOFæ–‡ä»¶è¿›è¡ŒåŒæ­¥;redisæ¯ç§’åŒæ­¥ä¸€æ¬¡AOFæ–‡ä»¶æ—¶æ€§èƒ½å’Œä¸ä½¿ç”¨ä»»ä½•æŒä¹…åŒ–ç‰¹æ€§æ—¶çš„æ€§èƒ½ç›¸å·®æ— å‡ ,è€Œé€šè¿‡æ¯ç§’åŒæ­¥ä¸€æ¬¡AOFæ–‡ä»¶,rediså¯ä»¥ä¿è¯,å³ä½¿ç³»ç»Ÿå´©æºƒ,ç”¨æˆ·æœ€å¤šä¸¢å¤±ä¸€ç§’ä¹‹å†…äº§ç”Ÿçš„æ•°æ®ã€‚# 3.no    ã€ä¸æ¨èã€‘- è¯´æ˜: ç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶åŒæ­¥ - è§£é‡Šï¼šæœ€åä½¿ç”¨noé€‰é¡¹,å°†å®Œå…¨æœ‰æ“ä½œç³»ç»Ÿå†³å®šä»€ä¹ˆæ—¶å€™åŒæ­¥AOFæ—¥å¿—æ–‡ä»¶,è¿™ä¸ªé€‰é¡¹ä¸ä¼šå¯¹redisæ€§èƒ½å¸¦æ¥å½±å“ä½†æ˜¯ç³»ç»Ÿå´©æºƒæ—¶,ä¼šä¸¢å¤±ä¸å®šæ•°é‡çš„æ•°æ®,å¦å¤–å¦‚æœç”¨æˆ·ç¡¬ç›˜å¤„ç†å†™å…¥æ“ä½œä¸å¤Ÿå¿«çš„è¯,å½“ç¼“å†²åŒºè¢«ç­‰å¾…å†™å…¥ç¡¬ç›˜æ•°æ®å¡«æ»¡æ—¶,redisä¼šå¤„äºé˜»å¡çŠ¶æ€,å¹¶å¯¼è‡´redisçš„å¤„ç†å‘½ä»¤è¯·æ±‚çš„é€Ÿåº¦å˜æ…¢ã€‚</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="4-ä¿®æ”¹åŒæ­¥é¢‘ç‡"><a href="#4-ä¿®æ”¹åŒæ­¥é¢‘ç‡" class="headerlink" title="4.ä¿®æ”¹åŒæ­¥é¢‘ç‡"></a>4.ä¿®æ”¹åŒæ­¥é¢‘ç‡</h4><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.ä¿®æ”¹æ—¥å¿—åŒæ­¥é¢‘ç‡- ä¿®æ”¹appendfsync everysec|always|no æŒ‡å®š</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>{% asset_img image-20200623211658910.png %} <hr><h3 id="9-3-AOFæ–‡ä»¶çš„é‡å†™"><a href="#9-3-AOFæ–‡ä»¶çš„é‡å†™" class="headerlink" title="9.3 AOFæ–‡ä»¶çš„é‡å†™"></a>9.3 AOFæ–‡ä»¶çš„é‡å†™</h3><h4 id="1-AOFå¸¦æ¥çš„é—®é¢˜"><a href="#1-AOFå¸¦æ¥çš„é—®é¢˜" class="headerlink" title="1. AOFå¸¦æ¥çš„é—®é¢˜"></a>1. AOFå¸¦æ¥çš„é—®é¢˜</h4><p>AOFçš„æ–¹å¼ä¹ŸåŒæ—¶å¸¦æ¥äº†å¦ä¸€ä¸ªé—®é¢˜ã€‚æŒä¹…åŒ–æ–‡ä»¶ä¼šå˜çš„è¶Šæ¥è¶Šå¤§ã€‚ä¾‹å¦‚æˆ‘ä»¬è°ƒç”¨incr testå‘½ä»¤100æ¬¡ï¼Œæ–‡ä»¶ä¸­å¿…é¡»ä¿å­˜å…¨éƒ¨çš„100æ¡å‘½ä»¤ï¼Œå…¶å®æœ‰99æ¡éƒ½æ˜¯å¤šä½™çš„ã€‚å› ä¸ºè¦æ¢å¤æ•°æ®åº“çš„çŠ¶æ€å…¶å®æ–‡ä»¶ä¸­ä¿å­˜ä¸€æ¡set test 100å°±å¤Ÿäº†ã€‚ä¸ºäº†å‹ç¼©aofçš„æŒä¹…åŒ–æ–‡ä»¶Redisæä¾›äº†AOFé‡å†™(ReWriter)æœºåˆ¶ã€‚</p><h4 id="2-AOFé‡å†™"><a href="#2-AOFé‡å†™" class="headerlink" title="2. AOFé‡å†™"></a>2. AOFé‡å†™</h4><p>ç”¨æ¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°AOFæ–‡ä»¶çš„ä½“ç§¯</p><h4 id="3-è§¦å‘é‡å†™æ–¹å¼"><a href="#3-è§¦å‘é‡å†™æ–¹å¼" class="headerlink" title="3. è§¦å‘é‡å†™æ–¹å¼"></a>3. è§¦å‘é‡å†™æ–¹å¼</h4><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.å®¢æˆ·ç«¯æ–¹å¼è§¦å‘é‡å†™</span><span class="token list punctuation">-</span> æ‰§è¡ŒBGREWRITEAOFå‘½ä»¤  ä¸ä¼šé˜»å¡redisçš„æœåŠ¡<span class="token title important"><span class="token punctuation">#</span> 2.æœåŠ¡å™¨é…ç½®æ–¹å¼è‡ªåŠ¨è§¦å‘</span><span class="token list punctuation">-</span> é…ç½®redis.confä¸­çš„auto-aof-rewrite-percentageé€‰é¡¹ å‚åŠ ä¸‹å›¾â†“â†“â†“<span class="token list punctuation">-</span> å¦‚æœè®¾ç½®auto-aof-rewrite-percentageå€¼ä¸º100å’Œauto-aof-rewrite-min-size 64mb,å¹¶ä¸”å¯ç”¨çš„AOFæŒä¹…åŒ–æ—¶,é‚£ä¹ˆå½“AOFæ–‡ä»¶ä½“ç§¯å¤§äº64M,å¹¶ä¸”AOFæ–‡ä»¶çš„ä½“ç§¯æ¯”ä¸Šä¸€æ¬¡é‡å†™ä¹‹åä½“ç§¯å¤§äº†è‡³å°‘ä¸€å€(100%)æ—¶,ä¼šè‡ªåŠ¨è§¦å‘,å¦‚æœé‡å†™è¿‡äºé¢‘ç¹,ç”¨æˆ·å¯ä»¥è€ƒè™‘å°†auto-aof-rewrite-percentageè®¾ç½®ä¸ºæ›´å¤§<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="/posts/26216/image-20200623212547775.png"> <h4 id="4-é‡å†™åŸç†"><a href="#4-é‡å†™åŸç†" class="headerlink" title="4. é‡å†™åŸç†"></a>4. é‡å†™åŸç†</h4><p> <strong>æ³¨æ„ï¼šé‡å†™aofæ–‡ä»¶çš„æ“ä½œï¼Œå¹¶æ²¡æœ‰è¯»å–æ—§çš„aofæ–‡ä»¶ï¼Œè€Œæ˜¯å°†æ•´ä¸ªå†…å­˜ä¸­çš„æ•°æ®åº“å†…å®¹ç”¨å‘½ä»¤çš„æ–¹å¼é‡å†™äº†ä¸€ä¸ªæ–°çš„aofæ–‡ä»¶,æ›¿æ¢åŸæœ‰çš„æ–‡ä»¶è¿™ç‚¹å’Œå¿«ç…§æœ‰ç‚¹ç±»ä¼¼ã€‚</strong></p><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> é‡å†™æµç¨‹</span><span class="token list punctuation">-</span> <span class="token list punctuation">1.</span> redisè°ƒç”¨fork ï¼Œç°åœ¨æœ‰çˆ¶å­ä¸¤ä¸ªè¿›ç¨‹ å­è¿›ç¨‹æ ¹æ®å†…å­˜ä¸­çš„æ•°æ®åº“å¿«ç…§ï¼Œå¾€ä¸´æ—¶æ–‡ä»¶ä¸­å†™å…¥é‡å»ºæ•°æ®åº“çŠ¶æ€çš„å‘½ä»¤<span class="token list punctuation">-</span> <span class="token list punctuation">2.</span> çˆ¶è¿›ç¨‹ç»§ç»­å¤„ç†clientè¯·æ±‚ï¼Œé™¤äº†æŠŠå†™å‘½ä»¤å†™å…¥åˆ°åŸæ¥çš„aofæ–‡ä»¶ä¸­ã€‚åŒæ—¶æŠŠæ”¶åˆ°çš„å†™å‘½ä»¤ç¼“å­˜èµ·æ¥ã€‚è¿™æ ·å°±èƒ½ä¿è¯å¦‚æœå­è¿›ç¨‹é‡å†™å¤±è´¥çš„è¯å¹¶ä¸ä¼šå‡ºé—®é¢˜ã€‚<span class="token list punctuation">-</span> <span class="token list punctuation">3.</span> å½“å­è¿›ç¨‹æŠŠå¿«ç…§å†…å®¹å†™å…¥å·²å‘½ä»¤æ–¹å¼å†™åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­åï¼Œå­è¿›ç¨‹å‘ä¿¡å·é€šçŸ¥çˆ¶è¿›ç¨‹ã€‚ç„¶åçˆ¶è¿›ç¨‹æŠŠç¼“å­˜çš„å†™å‘½ä»¤ä¹Ÿå†™å…¥åˆ°ä¸´æ—¶æ–‡ä»¶ã€‚<span class="token list punctuation">-</span> <span class="token list punctuation">4.</span> ç°åœ¨çˆ¶è¿›ç¨‹å¯ä»¥ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶æ›¿æ¢è€çš„aofæ–‡ä»¶ï¼Œå¹¶é‡å‘½åï¼Œåé¢æ”¶åˆ°çš„å†™å‘½ä»¤ä¹Ÿå¼€å§‹å¾€æ–°çš„aofæ–‡ä»¶ä¸­è¿½åŠ ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="/posts/26216/image-20200623214843123.png"> <hr><h3 id="9-4-æŒä¹…åŒ–æ€»ç»“"><a href="#9-4-æŒä¹…åŒ–æ€»ç»“" class="headerlink" title="9.4 æŒä¹…åŒ–æ€»ç»“"></a>9.4 æŒä¹…åŒ–æ€»ç»“</h3><p>ä¸¤ç§æŒä¹…åŒ–æ–¹æ¡ˆæ—¢å¯ä»¥åŒæ—¶ä½¿ç”¨(aof),åˆå¯ä»¥å•ç‹¬ä½¿ç”¨,åœ¨æŸç§æƒ…å†µä¸‹ä¹Ÿå¯ä»¥éƒ½ä¸ä½¿ç”¨,å…·ä½“ä½¿ç”¨é‚£ç§æŒä¹…åŒ–æ–¹æ¡ˆå–å†³äºç”¨æˆ·çš„æ•°æ®å’Œåº”ç”¨å†³å®šã€‚</p><p>æ— è®ºä½¿ç”¨AOFè¿˜æ˜¯å¿«ç…§æœºåˆ¶æŒä¹…åŒ–,å°†æ•°æ®æŒä¹…åŒ–åˆ°ç¡¬ç›˜éƒ½æ˜¯æœ‰å¿…è¦çš„,é™¤äº†æŒä¹…åŒ–å¤–,ç”¨æˆ·è¿˜åº”è¯¥å¯¹æŒä¹…åŒ–çš„æ–‡ä»¶è¿›è¡Œå¤‡ä»½(æœ€å¥½å¤‡ä»½åœ¨å¤šä¸ªä¸åŒåœ°æ–¹)ã€‚</p><hr><h2 id="10-javaæ“ä½œRedis"><a href="#10-javaæ“ä½œRedis" class="headerlink" title="10. javaæ“ä½œRedis"></a>10. javaæ“ä½œRedis</h2><h3 id="10-1-ç¯å¢ƒå‡†å¤‡"><a href="#10-1-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="10.1 ç¯å¢ƒå‡†å¤‡"></a>10.1 ç¯å¢ƒå‡†å¤‡</h3><h4 id="1-å¼•å…¥ä¾èµ–"><a href="#1-å¼•å…¥ä¾èµ–" class="headerlink" title="1. å¼•å…¥ä¾èµ–"></a>1. å¼•å…¥ä¾èµ–</h4><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--å¼•å…¥jedisè¿æ¥ä¾èµ–--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.9.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2-åˆ›å»ºjediså¯¹è±¡"><a href="#2-åˆ›å»ºjediså¯¹è±¡" class="headerlink" title="2.åˆ›å»ºjediså¯¹è±¡"></a>2.åˆ›å»ºjediså¯¹è±¡</h4><pre class="line-numbers language-java"><code class="language-java"> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment" spellcheck="true">//1.åˆ›å»ºjediså¯¹è±¡   Jedis jedis = new Jedis("192.168.40.4", 6379);//1.redisæœåŠ¡å¿…é¡»å…³é—­é˜²ç«å¢™  2.redisæœåŠ¡å¿…é¡»å¼€å¯è¿œç¨‹è¿æ¥   jedis.select(0);//é€‰æ‹©æ“ä½œçš„åº“é»˜è®¤0å·åº“   //2.æ‰§è¡Œç›¸å…³æ“ä½œ   //....   //3.é‡Šæ”¾èµ„æº   jedis.close(); }</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="/posts/26216/image-20200623201932000.png"> <h3 id="10-2-æ“ä½œkeyç›¸å…³API"><a href="#10-2-æ“ä½œkeyç›¸å…³API" class="headerlink" title="10.2 æ“ä½œkeyç›¸å…³API"></a>10.2 æ“ä½œkeyç›¸å…³API</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">private</span> Jedis jedis<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Before</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"192.168.202.205"</span><span class="token punctuation">,</span> <span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@After</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//æµ‹è¯•keyç›¸å…³</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//åˆ é™¤ä¸€ä¸ªkey</span>        jedis<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//åˆ é™¤å¤šä¸ªkey</span>        jedis<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//åˆ¤æ–­ä¸€ä¸ªkeyæ˜¯å¦å­˜åœ¨exits</span>        Boolean name <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//è®¾ç½®ä¸€ä¸ªkeyè¶…æ—¶æ—¶é—´ expire pexpire</span>        Long age <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//è·å–ä¸€ä¸ªkeyè¶…æ—¶æ—¶é—´ ttl</span>        Long age1 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">ttl</span><span class="token punctuation">(</span><span class="token string">"newage"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>age1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//éšæœºè·å–ä¸€ä¸ªkey</span>        String s <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">randomKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//ä¿®æ”¹keyåç§°</span>        jedis<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span><span class="token string">"newage"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//æŸ¥çœ‹å¯ä»¥å¯¹åº”å€¼çš„ç±»å‹</span>        String name1 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name1<span class="token punctuation">)</span><span class="token punctuation">;</span>        String maps <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">"maps"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>maps<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="/posts/26216/image-20200627180325687.png"> <h3 id="10-3æ“ä½œStringç›¸å…³API"><a href="#10-3æ“ä½œStringç›¸å…³API" class="headerlink" title="10.3æ“ä½œStringç›¸å…³API"></a>10.3æ“ä½œStringç›¸å…³API</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//æµ‹è¯•Stringç›¸å…³    @Test    public void testString(){        //set        jedis.set("name","å°é™ˆ");        //get        String s = jedis.get("name");        System.out.println(s);        //mset        jedis.mset("content","å¥½äºº","address","æµ·æ·€åŒº");        //mget        List&lt;String> mget = jedis.mget("name", "content", "address");        mget.forEach(v-> System.out.println("v = " + v));        //getset        String set = jedis.getSet("name", "å°æ˜");        System.out.println(set);        //............    }</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>{% asset_img image-20200627180352953.png %} <h3 id="10-4æ“ä½œListç›¸å…³API"><a href="#10-4æ“ä½œListç›¸å…³API" class="headerlink" title="10.4æ“ä½œListç›¸å…³API"></a>10.4æ“ä½œListç›¸å…³API</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//æµ‹è¯•Listç›¸å…³</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//lpush</span>        jedis<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span><span class="token string">"names1"</span><span class="token punctuation">,</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">,</span><span class="token string">"ç‹äº”"</span><span class="token punctuation">,</span><span class="token string">"èµµæŸ³"</span><span class="token punctuation">,</span><span class="token string">"win7"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//rpush</span>        jedis<span class="token punctuation">.</span><span class="token function">rpush</span><span class="token punctuation">(</span><span class="token string">"names1"</span><span class="token punctuation">,</span><span class="token string">"xiaomingming"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//lrange</span>        List<span class="token operator">&lt;</span>String<span class="token operator">></span> names1 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token string">"names1"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        names1<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>name<span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"name = "</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//lpop rpop</span>        String names11 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">lpop</span><span class="token punctuation">(</span><span class="token string">"names1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>names11<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//llen</span>        jedis<span class="token punctuation">.</span><span class="token function">linsert</span><span class="token punctuation">(</span><span class="token string">"lists"</span><span class="token punctuation">,</span> BinaryClient<span class="token punctuation">.</span>LIST_POSITION<span class="token punctuation">.</span>BEFORE<span class="token punctuation">,</span><span class="token string">"xiaohei"</span><span class="token punctuation">,</span><span class="token string">"xiaobai"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">//........</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="/posts/26216/image-20200627180435997.png"> <h3 id="10-5æ“ä½œSetçš„ç›¸å…³API"><a href="#10-5æ“ä½œSetçš„ç›¸å…³API" class="headerlink" title="10.5æ“ä½œSetçš„ç›¸å…³API"></a>10.5æ“ä½œSetçš„ç›¸å…³API</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//æµ‹è¯•SETç›¸å…³@Testpublic void testSet(){  //sadd  jedis.sadd("names","zhangsan","lisi");  //smembers  jedis.smembers("names");  //sismember  jedis.sismember("names","xiaochen");  //...}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>{% asset_img image-20200627181913715.png %} <h3 id="10-6-æ“ä½œZSetç›¸å…³API"><a href="#10-6-æ“ä½œZSetç›¸å…³API" class="headerlink" title="10.6 æ“ä½œZSetç›¸å…³API"></a>10.6 æ“ä½œZSetç›¸å…³API</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//æµ‹è¯•ZSETç›¸å…³@Testpublic void testZset(){  //zadd  jedis.zadd("names",10,"å¼ ä¸‰");  //zrange  jedis.zrange("names",0,-1);  //zcard  jedis.zcard("names");  //zrangeByScore  jedis.zrangeByScore("names","0","100",0,5);  //..}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="/posts/26216/image-20200627181947116.png"> <h3 id="10-7-æ“ä½œHashç›¸å…³API"><a href="#10-7-æ“ä½œHashç›¸å…³API" class="headerlink" title="10.7 æ“ä½œHashç›¸å…³API"></a>10.7 æ“ä½œHashç›¸å…³API</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//æµ‹è¯•HASHç›¸å…³@Testpublic void testHash(){  //hset  jedis.hset("maps","name","zhangsan");  //hget  jedis.hget("maps","name");  //hgetall  jedis.hgetAll("mps");  //hkeys  jedis.hkeys("maps");  //hvals  jedis.hvals("maps");  //....}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>{% asset_img image-20200628093242527.png %} <hr><h2 id="11-SpringBootæ•´åˆRedis"><a href="#11-SpringBootæ•´åˆRedis" class="headerlink" title="11.SpringBootæ•´åˆRedis"></a>11.SpringBootæ•´åˆRedis</h2><p>Spring Boot Data(æ•°æ®) Redis ä¸­æä¾›äº†<strong>RedisTemplateå’ŒStringRedisTemplate</strong>ï¼Œå…¶ä¸­StringRedisTemplateæ˜¯RedisTemplateçš„å­ç±»ï¼Œä¸¤ä¸ªæ–¹æ³•åŸºæœ¬ä¸€è‡´ï¼Œä¸åŒä¹‹å¤„ä¸»è¦ä½“ç°åœ¨æ“ä½œçš„æ•°æ®ç±»å‹ä¸åŒï¼Œ<strong>RedisTemplateä¸­çš„ä¸¤ä¸ªæ³›å‹éƒ½æ˜¯Objectï¼Œæ„å‘³ç€å­˜å‚¨çš„keyå’Œvalueéƒ½å¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè€ŒStringRedisTemplateçš„ä¸¤ä¸ªæ³›å‹éƒ½æ˜¯Stringï¼Œæ„å‘³ç€StringRedisTemplateçš„keyå’Œvalueéƒ½åªèƒ½æ˜¯å­—ç¬¦ä¸²ã€‚</strong></p><p><code>æ³¨æ„: ä½¿ç”¨RedisTemplateé»˜è®¤æ˜¯å°†å¯¹è±¡åºåˆ—åŒ–åˆ°Redisä¸­,æ‰€ä»¥æ”¾å…¥çš„å¯¹è±¡å¿…é¡»å®ç°å¯¹è±¡åºåˆ—åŒ–æ¥å£</code></p><h3 id="11-1-ç¯å¢ƒå‡†å¤‡"><a href="#11-1-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="11.1 ç¯å¢ƒå‡†å¤‡"></a>11.1 ç¯å¢ƒå‡†å¤‡</h3><h4 id="1-å¼•å…¥ä¾èµ–-1"><a href="#1-å¼•å…¥ä¾èµ–-1" class="headerlink" title="1.å¼•å…¥ä¾èµ–"></a>1.å¼•å…¥ä¾èµ–</h4><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2-é…ç½®application-propertie"><a href="#2-é…ç½®application-propertie" class="headerlink" title="2.é…ç½®application.propertie"></a>2.é…ç½®application.propertie</h4><pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">spring.redis.host</span><span class="token punctuation">=</span><span class="token attr-value">localhostspring.redis.port=6379spring.redis.database=0</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="11-2-ä½¿ç”¨StringRedisTemplateå’ŒRedisTemplate"><a href="#11-2-ä½¿ç”¨StringRedisTemplateå’ŒRedisTemplate" class="headerlink" title="11.2 ä½¿ç”¨StringRedisTemplateå’ŒRedisTemplate"></a>11.2 ä½¿ç”¨StringRedisTemplateå’ŒRedisTemplate</h3><h4 id="11-3-redisTemplateä¹‹åºåˆ—åŒ–"><a href="#11-3-redisTemplateä¹‹åºåˆ—åŒ–" class="headerlink" title="11.3 redisTemplateä¹‹åºåˆ—åŒ–"></a>11.3 redisTemplateä¹‹åºåˆ—åŒ–</h4><pre class="line-numbers language-java"><code class="language-java"> <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">/**         * redisTemplateå¯¹è±¡ä¸­çš„keyå’Œvalueçš„åºåˆ—åŒ–éƒ½æ˜¯ JdkSerializationRedisSerializer ==> ä¼šä½¿å­—ç¬¦ä¸²è½¬ä¹‰         *      key: string         *      value : object         *      ä¿®æ”¹é»˜è®¤keyåºåˆ—åŒ–æ–¹æ¡ˆ: key StringRedisSerilizer         */</span>        <span class="token comment" spellcheck="true">//ä¿®æ”¹keyçš„åºåˆ—åŒ–æ–¹æ¡ˆ</span>        redisTemplate<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//        //ä¿®æ”¹hash key åºåˆ—åŒ–æ–¹æ¡ˆ</span><span class="token comment" spellcheck="true">//        redisTemplate.setHashKeySerializer(new StringRedisSerializer());</span>        Student student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        student<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"å°æ ·"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//redisè¿›è¡Œå¯¹è±¡è®¾ç½®éœ€è¦ç»è¿‡åºåˆ—åŒ–</span>        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"student"</span><span class="token punctuation">,</span> student<span class="token punctuation">)</span><span class="token punctuation">;</span>        Student stu <span class="token operator">=</span> <span class="token punctuation">(</span>Student<span class="token punctuation">)</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"student"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stu<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="11-4-spring-data-æä¾›bound-apiç®€åŒ–æ“ä½œ"><a href="#11-4-spring-data-æä¾›bound-apiç®€åŒ–æ“ä½œ" class="headerlink" title="11.4 spring data æä¾›bound apiç®€åŒ–æ“ä½œ"></a>11.4 spring data æä¾›bound apiç®€åŒ–æ“ä½œ</h4><pre class="line-numbers language-java"><code class="language-java">   <span class="token comment" spellcheck="true">//bound apiç®€åŒ–Redisæ“ä½œ</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">TestBoundApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        redisTemplate<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        redisTemplate<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//å¯¹å­—ç¬¦ä¸²ç±»å‹keyè¿›è¡Œç»‘å®šï¼Œé‚£ä¹ˆåç»­æ“ä½œå¯ä»¥åŸºäºè¿™ä¸ªç»‘å®šå¯¹è±¡è¿›è¡Œç›¸å…³æ“ä½œ</span>        <span class="token comment" spellcheck="true">//å°±ä¸ç”¨æ¯æ¬¡å°±é‡å¤å†™keyï¼Œç®€åŒ–äº†ä»£ç </span><span class="token comment" spellcheck="true">//        redisTemplate.opsForValue().set("name","å°æ ·å„¿");</span><span class="token comment" spellcheck="true">//        redisTemplate.opsForValue().append("name","æ˜¯ä¸€ä¸ªå¥½äºº");</span>        <span class="token comment" spellcheck="true">//å¯¹å­—ç¬¦ä¸²ç±»å‹keyè¿›è¡Œç»‘å®šåï¼Œåç»­æ“ä½œéƒ½æ˜¯åŸºäºè¿™ä¸ªkey</span>        BoundValueOperations nameValueOperations <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        nameValueOperations<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"æå››"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        nameValueOperations<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"æ˜¯ä¸€ä¸ªå¤§å¤§çš„å¥½äºº"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        String s1 <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span> nameValueOperations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="11-5-stringRedisTemplateä¹‹å¸¸è§„æ“ä½œ"><a href="#11-5-stringRedisTemplateä¹‹å¸¸è§„æ“ä½œ" class="headerlink" title="11.5 stringRedisTemplateä¹‹å¸¸è§„æ“ä½œ"></a>11.5 stringRedisTemplateä¹‹å¸¸è§„æ“ä½œ</h4><pre class="line-numbers language-java"><code class="language-java">        <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> StringRedisTemplate stringRedisTemplate<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//å¯¹å­—ç¬¦ä¸²æ”¯æŒæ¯”è¾ƒå‹å¥½,ä¸èƒ½å­˜å‚¨å¯¹è±¡</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> RedisTemplate redisTemplate<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//å­˜å‚¨å¯¹è±¡</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//hashç›¸å…³æ“ä½œ opsForHash</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"maps"</span><span class="token punctuation">,</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"å°é»‘"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Object o <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"maps"</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//zsetç›¸å…³æ“ä½œ opsForZSet</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testZSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForZSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"zsets"</span><span class="token punctuation">,</span><span class="token string">"å°é»‘"</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Set<span class="token operator">&lt;</span>String<span class="token operator">></span> zsets <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForZSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token string">"zsets"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        zsets<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>value<span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//setç›¸å…³æ“ä½œ opsForSet</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"sets"</span><span class="token punctuation">,</span><span class="token string">"xiaosan"</span><span class="token punctuation">,</span><span class="token string">"xiaosi"</span><span class="token punctuation">,</span><span class="token string">"xiaowu"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Set<span class="token operator">&lt;</span>String<span class="token operator">></span> sets <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">members</span><span class="token punctuation">(</span><span class="token string">"sets"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sets<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>value<span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//listç›¸å…³çš„æ“ä½œopsForList</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// stringRedisTemplate.opsForList().leftPushAll("lists","å¼ ä¸‰","æå››","ç‹äº”");</span>        List<span class="token operator">&lt;</span>String<span class="token operator">></span> lists <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token string">"lists"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        lists<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>key <span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//Stringç›¸å…³çš„æ“ä½œ opsForValue</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//stringRedisTemplate.opsForValue().set("166","å¥½åŒå­¦");</span>        String s <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"166"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>        Long size <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token string">"166"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//keyç›¸å…³çš„æ“ä½œ</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        Set<span class="token operator">&lt;</span>String<span class="token operator">></span> keys <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æŸ¥çœ‹æ‰€æœ‰key</span>        Boolean name <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">hasKey</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//åˆ¤æ–­æŸä¸ªkeyæ˜¯å¦å­˜åœ¨</span>        stringRedisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ ¹æ®æŒ‡å®škeyåˆ é™¤</span>        stringRedisTemplate<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ä¿®æ”¹keyçš„åç§°</span>        stringRedisTemplate<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>HOURS<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">//è®¾ç½®keyè¶…æ—¶æ—¶é—´ å‚æ•°1:è®¾ç½®keyå å‚æ•°2:æ—¶é—´ å‚æ•°3:æ—¶é—´çš„å•ä½</span>        stringRedisTemplate<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ç§»åŠ¨key</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="12-Redis-ä¸»ä»å¤åˆ¶"><a href="#12-Redis-ä¸»ä»å¤åˆ¶" class="headerlink" title="12. Redis ä¸»ä»å¤åˆ¶"></a>12. Redis ä¸»ä»å¤åˆ¶</h2><h3 id="12-1-ä¸»ä»å¤åˆ¶"><a href="#12-1-ä¸»ä»å¤åˆ¶" class="headerlink" title="12.1 ä¸»ä»å¤åˆ¶"></a>12.1 ä¸»ä»å¤åˆ¶</h3><p>ä¸»ä»å¤åˆ¶æ¶æ„ä»…ä»…ç”¨æ¥è§£å†³æ•°æ®çš„å†—ä½™å¤‡ä»½,ä»èŠ‚ç‚¹ä»…ä»…ç”¨æ¥åŒæ­¥æ•°æ®</p><p><strong>æ— æ³•è§£å†³: 1.masterèŠ‚ç‚¹å‡ºç°æ•…éšœçš„è‡ªåŠ¨æ•…éšœè½¬ç§»</strong></p><h3 id="12-2-ä¸»ä»å¤åˆ¶æ¶æ„å›¾"><a href="#12-2-ä¸»ä»å¤åˆ¶æ¶æ„å›¾" class="headerlink" title="12.2 ä¸»ä»å¤åˆ¶æ¶æ„å›¾"></a>12.2 ä¸»ä»å¤åˆ¶æ¶æ„å›¾</h3><img src="/posts/26216/image-20200627201722700.png"> <h3 id="12-3-æ­å»ºä¸»ä»å¤åˆ¶"><a href="#12-3-æ­å»ºä¸»ä»å¤åˆ¶" class="headerlink" title="12.3 æ­å»ºä¸»ä»å¤åˆ¶"></a>12.3 æ­å»ºä¸»ä»å¤åˆ¶</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.å‡†å¤‡3å°æœºå™¨å¹¶ä¿®æ”¹é…ç½®- master    port 6379    bind 0.0.0.0    - slave1    port 6380    bind 0.0.0.0    slaveof masterip masterport- slave2    port 6381    bind 0.0.0.0    slaveof masterip masterport</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>{% asset_img image-20200627202443388 %} <pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 2.å¯åŠ¨3å°æœºå™¨è¿›è¡Œæµ‹è¯•- cd /usr/redis/bin- ./redis-server /root/master/redis.conf- ./redis-server /root/slave1/redis.conf- ./redis-server /root/slave2/redis.conf</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="13-Rediså“¨å…µæœºåˆ¶"><a href="#13-Rediså“¨å…µæœºåˆ¶" class="headerlink" title="13. Rediså“¨å…µæœºåˆ¶"></a>13. Rediså“¨å…µæœºåˆ¶</h2><h3 id="13-1-å“¨å…µSentinelæœºåˆ¶"><a href="#13-1-å“¨å…µSentinelæœºåˆ¶" class="headerlink" title="13.1 å“¨å…µSentinelæœºåˆ¶"></a>13.1 å“¨å…µSentinelæœºåˆ¶</h3><p>Sentinelï¼ˆå“¨å…µï¼‰æ˜¯Redis çš„é«˜å¯ç”¨æ€§è§£å†³æ–¹æ¡ˆï¼šç”±ä¸€ä¸ªæˆ–å¤šä¸ªSentinel å®ä¾‹ ç»„æˆçš„Sentinel ç³»ç»Ÿå¯ä»¥ç›‘è§†ä»»æ„å¤šä¸ªä¸»æœåŠ¡å™¨ï¼Œä»¥åŠè¿™äº›ä¸»æœåŠ¡å™¨å±ä¸‹çš„æ‰€æœ‰ä»æœåŠ¡å™¨ï¼Œå¹¶åœ¨è¢«ç›‘è§†çš„ä¸»æœåŠ¡å™¨è¿›å…¥ä¸‹çº¿çŠ¶æ€æ—¶ï¼Œè‡ªåŠ¨å°†ä¸‹çº¿ä¸»æœåŠ¡å™¨å±ä¸‹çš„æŸä¸ªä»æœåŠ¡å™¨å‡çº§ä¸ºæ–°çš„ä¸»æœåŠ¡å™¨ã€‚ç®€å•çš„è¯´å“¨å…µå°±æ˜¯å¸¦æœ‰<strong>è‡ªåŠ¨æ•…éšœè½¬ç§»åŠŸèƒ½çš„ä¸»ä»æ¶æ„</strong>ã€‚</p><p><strong>æ— æ³•è§£å†³: 1.å•èŠ‚ç‚¹å¹¶å‘å‹åŠ›é—®é¢˜   2.å•èŠ‚ç‚¹å†…å­˜å’Œç£ç›˜ç‰©ç†ä¸Šé™</strong></p><h3 id="13-2-å“¨å…µæ¶æ„åŸç†"><a href="#13-2-å“¨å…µæ¶æ„åŸç†" class="headerlink" title="13.2 å“¨å…µæ¶æ„åŸç†"></a>13.2 å“¨å…µæ¶æ„åŸç†</h3><img src="/posts/26216/image-20200627204422750.png"> <h3 id="13-3-æ­å»ºå“¨å…µæ¶æ„"><a href="#13-3-æ­å»ºå“¨å…µæ¶æ„" class="headerlink" title="13.3 æ­å»ºå“¨å…µæ¶æ„"></a>13.3 æ­å»ºå“¨å…µæ¶æ„</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.åœ¨ä¸»èŠ‚ç‚¹ä¸Šåˆ›å»ºå“¨å…µé…ç½®</span><span class="token list punctuation">-</span> åœ¨Masterå¯¹åº”redis.confåŒç›®å½•ä¸‹æ–°å»ºsentinel.confæ–‡ä»¶ï¼Œåå­—ç»å¯¹ä¸èƒ½é”™ï¼›<span class="token title important"><span class="token punctuation">#</span> 2.é…ç½®å“¨å…µï¼Œåœ¨sentinel.confæ–‡ä»¶ä¸­å¡«å…¥å†…å®¹ï¼š</span><span class="token list punctuation">-</span> sentinel monitor è¢«ç›‘æ§æ•°æ®åº“åå­—ï¼ˆè‡ªå·±èµ·åå­—ï¼‰ ip port 1<span class="token title important"><span class="token punctuation">#</span> 3.å¯åŠ¨å“¨å…µæ¨¡å¼è¿›è¡Œæµ‹è¯•</span><span class="token list punctuation">-</span> redis-sentinel  /root/sentinel/sentinel.conf<span class="token code keyword">    è¯´æ˜:è¿™ä¸ªåé¢çš„æ•°å­—2,æ˜¯æŒ‡å½“æœ‰ä¸¤ä¸ªåŠä»¥ä¸Šçš„sentinelæœåŠ¡æ£€æµ‹åˆ°masterå®•æœºï¼Œæ‰ä¼šå»æ‰§è¡Œä¸»ä»åˆ‡æ¢çš„åŠŸèƒ½ã€‚</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="13-4-é€šè¿‡springbootæ“ä½œå“¨å…µ"><a href="#13-4-é€šè¿‡springbootæ“ä½œå“¨å…µ" class="headerlink" title="13.4 é€šè¿‡springbootæ“ä½œå“¨å…µ"></a>13.4 é€šè¿‡springbootæ“ä½œå“¨å…µ</h3><pre class="line-numbers language-properties"><code class="language-properties"><span class="token comment" spellcheck="true"># redis sentinel é…ç½®</span><span class="token comment" spellcheck="true"># masterä¹¦å†™æ˜¯ä½¿ç”¨å“¨å…µç›‘å¬çš„é‚£ä¸ªåç§°</span><span class="token attr-name">spring.redis.sentinel.master</span><span class="token punctuation">=</span><span class="token attr-value">mymaster</span><span class="token comment" spellcheck="true"># è¿æ¥çš„ä¸å†æ˜¯ä¸€ä¸ªå…·ä½“redisä¸»æœº,ä¹¦å†™çš„æ˜¯å¤šä¸ªå“¨å…µèŠ‚ç‚¹</span><span class="token attr-name">spring.redis.sentinel.nodes</span><span class="token punctuation">=</span><span class="token attr-value">192.168.202.206:26379</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>æ³¨æ„:å¦‚æœè¿æ¥è¿‡ç¨‹ä¸­å‡ºç°å¦‚ä¸‹é”™è¯¯:RedisConnectionException: DENIED Redis is running in protected mode because protected mode is enabled, no bind address was specified, no authentication password is requested to clients. In this mode connections are only accepted from the loopback interface. If you want to connect from external computers to Redis you may adopt one of the following solutions: 1) Just disable protected mode sending the command â€˜CONFIG SET protected-mode noâ€™ from the loopback interface by connecting to Redis from the same host the server is running, however MAKE SURE Redis is not publicly accessible from internet if you do so. Use CONFIG REWRITE to make this change permanent. 2)</strong></li><li><strong>è§£å†³æ–¹æ¡ˆ:åœ¨å“¨å…µçš„é…ç½®æ–‡ä»¶ä¸­åŠ å…¥bind 0.0.0.0 å¼€å¯è¿œç¨‹è¿æ¥æƒé™</strong></li></ul><img src="/posts/26216/image-20200629154647970.png"> <h2 id="14-Redisé›†ç¾¤"><a href="#14-Redisé›†ç¾¤" class="headerlink" title="14. Redisé›†ç¾¤"></a>14. Redisé›†ç¾¤</h2><h3 id="14-1-é›†ç¾¤"><a href="#14-1-é›†ç¾¤" class="headerlink" title="14.1 é›†ç¾¤"></a>14.1 é›†ç¾¤</h3><p>Redisåœ¨3.0åå¼€å§‹æ”¯æŒCluster(æ¨¡å¼)æ¨¡å¼,ç›®å‰redisçš„é›†ç¾¤æ”¯æŒèŠ‚ç‚¹çš„è‡ªåŠ¨å‘ç°,æ”¯æŒslave-masteré€‰ä¸¾å’Œå®¹é”™,æ”¯æŒåœ¨çº¿åˆ†ç‰‡(sharding shard )ç­‰ç‰¹æ€§ã€‚reshard</p><h3 id="14-2-é›†ç¾¤æ¶æ„å›¾"><a href="#14-2-é›†ç¾¤æ¶æ„å›¾" class="headerlink" title="14.2 é›†ç¾¤æ¶æ„å›¾"></a>14.2 é›†ç¾¤æ¶æ„å›¾</h3> <h3 id="14-3-é›†ç¾¤ç»†èŠ‚"><a href="#14-3-é›†ç¾¤ç»†èŠ‚" class="headerlink" title="14.3 é›†ç¾¤ç»†èŠ‚"></a>14.3 é›†ç¾¤ç»†èŠ‚</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token list punctuation">-</span> æ‰€æœ‰çš„redisèŠ‚ç‚¹å½¼æ­¤äº’è”(PING-PONGæœºåˆ¶),å†…éƒ¨ä½¿ç”¨äºŒè¿›åˆ¶åè®®ä¼˜åŒ–ä¼ è¾“é€Ÿåº¦å’Œå¸¦å®½.- èŠ‚ç‚¹çš„failæ˜¯é€šè¿‡é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹æ£€æµ‹å¤±æ•ˆæ—¶æ‰ç”Ÿæ•ˆ. - å®¢æˆ·ç«¯ä¸redisèŠ‚ç‚¹ç›´è¿,ä¸éœ€è¦ä¸­é—´proxyå±‚.å®¢æˆ·ç«¯ä¸éœ€è¦è¿æ¥é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹,è¿æ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯- redis-clusteræŠŠæ‰€æœ‰çš„ç‰©ç†èŠ‚ç‚¹æ˜ å°„åˆ°[0-16383]slotä¸Š,cluster è´Ÿè´£ç»´æŠ¤node<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>-</span><span class="token punctuation">></span></span>slot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>-</span><span class="token punctuation">></span></span>value<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>{% asset_img image-20200629165226329.png %} <h3 id="14-4-é›†ç¾¤æ­å»º"><a href="#14-4-é›†ç¾¤æ­å»º" class="headerlink" title="14.4 é›†ç¾¤æ­å»º"></a>14.4 é›†ç¾¤æ­å»º</h3><p>åˆ¤æ–­ä¸€ä¸ªæ˜¯é›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ˜¯å¦å¯ç”¨,æ˜¯é›†ç¾¤ä¸­çš„æ‰€ç”¨ä¸»èŠ‚ç‚¹é€‰ä¸¾è¿‡ç¨‹,å¦‚æœåŠæ•°ä»¥ä¸Šçš„èŠ‚ç‚¹è®¤ä¸ºå½“å‰èŠ‚ç‚¹æŒ‚æ‰,é‚£ä¹ˆå½“å‰èŠ‚ç‚¹å°±æ˜¯æŒ‚æ‰äº†,æ‰€ä»¥æ­å»ºredisé›†ç¾¤æ—¶å»ºè®®èŠ‚ç‚¹æ•°æœ€å¥½ä¸ºå¥‡æ•°ï¼Œ<strong>æ­å»ºé›†ç¾¤è‡³å°‘éœ€è¦ä¸‰ä¸ªä¸»èŠ‚ç‚¹,ä¸‰ä¸ªä»èŠ‚ç‚¹,è‡³å°‘éœ€è¦6ä¸ªèŠ‚ç‚¹</strong>ã€‚</p><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.å‡†å¤‡ç¯å¢ƒå®‰è£…rubyä»¥åŠredisé›†ç¾¤ä¾èµ–- yum install -y ruby rubygems- gem install redis-xxx.gem</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="/posts/26216/image-20200627193219366.png"><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 2.åœ¨ä¸€å°æœºå™¨åˆ›å»º7ä¸ªç›®å½•</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>{% asset_img image-20200627193849867.png %} <pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 3.æ¯ä¸ªç›®å½•å¤åˆ¶ä¸€ä»½é…ç½®æ–‡ä»¶[root@localhost ~]# cp redis-4.0.10/redis.conf 7000/[root@localhost ~]# cp redis-4.0.10/redis.conf 7001/[root@localhost ~]# cp redis-4.0.10/redis.conf 7002/[root@localhost ~]# cp redis-4.0.10/redis.conf 7003/[root@localhost ~]# cp redis-4.0.10/redis.conf 7004/[root@localhost ~]# cp redis-4.0.10/redis.conf 7005/[root@localhost ~]# cp redis-4.0.10/redis.conf 7006/</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="/posts/26216/image-20200627194103354.png"><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 4.ä¿®æ”¹ä¸åŒç›®å½•é…ç½®æ–‡ä»¶</span><span class="token list punctuation">-</span> port     6379 .....                         //ä¿®æ”¹ç«¯å£<span class="token list punctuation">-</span> bind  0.0.0.0                            //å¼€å¯è¿œç¨‹è¿æ¥<span class="token list punctuation">-</span> cluster-enabled  yes                          //å¼€å¯é›†ç¾¤æ¨¡å¼<span class="token list punctuation">-</span> cluster-config-file  nodes-port.conf //é›†ç¾¤èŠ‚ç‚¹é…ç½®æ–‡ä»¶<span class="token list punctuation">-</span> cluster-node-timeout  5000             //é›†ç¾¤èŠ‚ç‚¹è¶…æ—¶æ—¶é—´<span class="token list punctuation">-</span> appendonly  yes                          //å¼€å¯AOFæŒä¹…åŒ–<span class="token title important"><span class="token punctuation">#</span> 5.æŒ‡å®šä¸åŒç›®å½•é…ç½®æ–‡ä»¶å¯åŠ¨ä¸ƒä¸ªèŠ‚ç‚¹</span><span class="token list punctuation">-</span> [root@localhost bin]# ./redis-server  /root/7000/redis.conf<span class="token list punctuation">-</span> [root@localhost bin]# ./redis-server  /root/7001/redis.conf<span class="token list punctuation">-</span> [root@localhost bin]# ./redis-server  /root/7002/redis.conf<span class="token list punctuation">-</span> [root@localhost bin]# ./redis-server  /root/7003/redis.conf<span class="token list punctuation">-</span> [root@localhost bin]# ./redis-server  /root/7004/redis.conf<span class="token list punctuation">-</span> [root@localhost bin]# ./redis-server  /root/7005/redis.conf<span class="token list punctuation">-</span> [root@localhost bin]# ./redis-server  /root/7006/redis.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="/posts/26216/image-20200627194913866.png"> <pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 6.æŸ¥çœ‹è¿›ç¨‹</span><span class="token list punctuation">-</span> [root@localhost bin]# ps aux|grep redis<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><img src="/posts/26216/image-20200627194954143.png"> <h4 id="1-åˆ›å»ºé›†ç¾¤"><a href="#1-åˆ›å»ºé›†ç¾¤" class="headerlink" title="1.åˆ›å»ºé›†ç¾¤"></a>1.åˆ›å»ºé›†ç¾¤</h4><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.å¤åˆ¶é›†ç¾¤æ“ä½œè„šæœ¬åˆ°binç›®å½•ä¸­- [root@localhost bin]# cp /root/redis-4.0.10/src/redis-trib.rb .# 2.åˆ›å»ºé›†ç¾¤- ./redis-trib.rb create --replicas 1 192.168.202.205:7000 192.168.202.205:7001 192.168.202.205:7002 192.168.202.205:7003 192.168.202.205:7004 192.168.202.205:7005</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>{% asset_img image-20200627195601307.png %} <pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 3.é›†ç¾¤åˆ›å»ºæˆåŠŸå‡ºç°å¦‚ä¸‹æç¤º</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="/posts/26216/image-20200627195647767.png"> <h4 id="2-æŸ¥çœ‹é›†ç¾¤çŠ¶æ€"><a href="#2-æŸ¥çœ‹é›†ç¾¤çŠ¶æ€" class="headerlink" title="2.æŸ¥çœ‹é›†ç¾¤çŠ¶æ€"></a>2.æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</h4><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ check [åŸå§‹é›†ç¾¤ä¸­ä»»æ„èŠ‚ç‚¹] [æ— ]- ./redis-trib.rb check 192.168.202.205:7000# 2.é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€è¯´æ˜- ä¸»èŠ‚ç‚¹     ä¸»èŠ‚ç‚¹å­˜åœ¨hash slots,ä¸”ä¸»èŠ‚ç‚¹çš„hash slots æ²¡æœ‰äº¤å‰    ä¸»èŠ‚ç‚¹ä¸èƒ½åˆ é™¤    ä¸€ä¸ªä¸»èŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªä»èŠ‚ç‚¹    ä¸»èŠ‚ç‚¹å®•æœºæ—¶å¤šä¸ªå‰¯æœ¬ä¹‹é—´è‡ªåŠ¨é€‰ä¸¾ä¸»èŠ‚ç‚¹- ä»èŠ‚ç‚¹    ä»èŠ‚ç‚¹æ²¡æœ‰hash slots    ä»èŠ‚ç‚¹å¯ä»¥åˆ é™¤    ä»èŠ‚ç‚¹ä¸è´Ÿè´£æ•°æ®çš„å†™,åªè´Ÿè´£æ•°æ®çš„åŒæ­¥</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="3-æ·»åŠ ä¸»èŠ‚ç‚¹"><a href="#3-æ·»åŠ ä¸»èŠ‚ç‚¹" class="headerlink" title="3.æ·»åŠ ä¸»èŠ‚ç‚¹"></a>3.æ·»åŠ ä¸»èŠ‚ç‚¹</h4><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.æ·»åŠ ä¸»èŠ‚ç‚¹ add-node [æ–°åŠ å…¥èŠ‚ç‚¹] [åŸå§‹é›†ç¾¤ä¸­ä»»æ„èŠ‚ç‚¹]- ./redis-trib.rb  add-node 192.168.1.158:7006  192.168.1.158:7005- æ³¨æ„:    1.è¯¥èŠ‚ç‚¹å¿…é¡»ä»¥é›†ç¾¤æ¨¡å¼å¯åŠ¨    2.é»˜è®¤æƒ…å†µä¸‹è¯¥èŠ‚ç‚¹å°±æ˜¯ä»¥masterèŠ‚ç‚¹å½¢å¼æ·»åŠ </span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="4-æ·»åŠ ä»èŠ‚ç‚¹"><a href="#4-æ·»åŠ ä»èŠ‚ç‚¹" class="headerlink" title="4.æ·»åŠ ä»èŠ‚ç‚¹"></a>4.æ·»åŠ ä»èŠ‚ç‚¹</h4><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.æ·»åŠ ä»èŠ‚ç‚¹ add-node --slave [æ–°åŠ å…¥èŠ‚ç‚¹] [é›†ç¾¤ä¸­ä»»æ„èŠ‚ç‚¹]</span><span class="token list punctuation">-</span> ./redis-trib.rb  add-node --slave 192.168.1.158:7006 192.168.1.158:7000<span class="token list punctuation">-</span> æ³¨æ„:<span class="token code keyword">    å½“æ·»åŠ å‰¯æœ¬èŠ‚ç‚¹æ—¶æ²¡æœ‰æŒ‡å®šä¸»èŠ‚ç‚¹,redisä¼šéšæœºç»™å‰¯æœ¬èŠ‚ç‚¹è¾ƒå°‘çš„ä¸»èŠ‚ç‚¹æ·»åŠ å½“å‰å‰¯æœ¬èŠ‚ç‚¹</span><span class="token title important"><span class="token punctuation">#</span> 2.ä¸ºç¡®å®šçš„masterèŠ‚ç‚¹æ·»åŠ ä¸»èŠ‚ç‚¹ add-node --slave --master-id masterèŠ‚ç‚¹id [æ–°åŠ å…¥èŠ‚ç‚¹] [é›†ç¾¤ä»»æ„èŠ‚ç‚¹]</span><span class="token list punctuation">-</span> ./redis-trib.rb  add-node --slave --master-id 3c3a0c74aae0b56170ccb03a76b60cfe7dc1912e 127.0.0.1:7006  127.0.0.1:7000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5-åˆ é™¤å‰¯æœ¬èŠ‚ç‚¹"><a href="#5-åˆ é™¤å‰¯æœ¬èŠ‚ç‚¹" class="headerlink" title="5.åˆ é™¤å‰¯æœ¬èŠ‚ç‚¹"></a>5.åˆ é™¤å‰¯æœ¬èŠ‚ç‚¹</h4><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.åˆ é™¤èŠ‚ç‚¹ del-node [é›†ç¾¤ä¸­ä»»æ„èŠ‚ç‚¹] [åˆ é™¤èŠ‚ç‚¹id]</span><span class="token list punctuation">-</span> ./redis-trib.rb  del-node 127.0.0.1:7002 0ca3f102ecf0c888fc7a7ce43a13e9be9f6d3dd1<span class="token list punctuation">-</span> æ³¨æ„: 1.è¢«åˆ é™¤çš„èŠ‚ç‚¹å¿…é¡»æ˜¯ä»èŠ‚ç‚¹æˆ–æ²¡æœ‰è¢«åˆ†é…hash slotsçš„èŠ‚ç‚¹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6-é›†ç¾¤åœ¨çº¿åˆ†ç‰‡"><a href="#6-é›†ç¾¤åœ¨çº¿åˆ†ç‰‡" class="headerlink" title="6.é›†ç¾¤åœ¨çº¿åˆ†ç‰‡"></a>6.é›†ç¾¤åœ¨çº¿åˆ†ç‰‡</h4><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.åœ¨çº¿åˆ†ç‰‡ reshard [é›†ç¾¤ä¸­ä»»æ„èŠ‚ç‚¹] [æ— ]</span><span class="token list punctuation">-</span> ./redis-trib.rb  reshard  192.168.1.158:7000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><hr><h2 id="15-Rediså®ç°åˆ†å¸ƒå¼Sessionç®¡ç†"><a href="#15-Rediså®ç°åˆ†å¸ƒå¼Sessionç®¡ç†" class="headerlink" title="15.Rediså®ç°åˆ†å¸ƒå¼Sessionç®¡ç†"></a>15.Rediså®ç°åˆ†å¸ƒå¼Sessionç®¡ç†</h2><h3 id="15-1-ç®¡ç†æœºåˆ¶"><a href="#15-1-ç®¡ç†æœºåˆ¶" class="headerlink" title="15.1 ç®¡ç†æœºåˆ¶"></a>15.1 ç®¡ç†æœºåˆ¶</h3><p><strong>redisçš„sessionç®¡ç†æ˜¯åˆ©ç”¨springæä¾›çš„sessionç®¡ç†è§£å†³æ–¹æ¡ˆ,å°†ä¸€ä¸ªåº”ç”¨sessionäº¤ç»™Rediså­˜å‚¨,æ•´ä¸ªåº”ç”¨ä¸­æ‰€æœ‰sessionçš„è¯·æ±‚éƒ½ä¼šå»redisä¸­è·å–å¯¹åº”çš„sessionæ•°æ®ã€‚</strong></p><img src="/posts/26216/image-20200628201643358.png"> <h3 id="15-2-å¼€å‘Sessionç®¡ç†"><a href="#15-2-å¼€å‘Sessionç®¡ç†" class="headerlink" title="15.2 å¼€å‘Sessionç®¡ç†"></a>15.2 å¼€å‘Sessionç®¡ç†</h3><h4 id="1-å¼•å…¥ä¾èµ–-2"><a href="#1-å¼•å…¥ä¾èµ–-2" class="headerlink" title="1. å¼•å…¥ä¾èµ–"></a>1. å¼•å…¥ä¾èµ–</h4><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.session<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-session-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-å¼€å‘Sessionç®¡ç†é…ç½®ç±»"><a href="#2-å¼€å‘Sessionç®¡ç†é…ç½®ç±»" class="headerlink" title="2. å¼€å‘Sessionç®¡ç†é…ç½®ç±»"></a>2. å¼€å‘Sessionç®¡ç†é…ç½®ç±»</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@EnableRedisHttpSessionpublic</span> <span class="token keyword">class</span> <span class="token class-name">RedisSessionManager</span> <span class="token punctuation">{</span>   <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="3-æ‰“åŒ…æµ‹è¯•å³å¯"><a href="#3-æ‰“åŒ…æµ‹è¯•å³å¯" class="headerlink" title="3.æ‰“åŒ…æµ‹è¯•å³å¯"></a>3.æ‰“åŒ…æµ‹è¯•å³å¯</h4><hr>]]></content>
      
      
      <categories>
          
          <category> redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisåˆ†å¸ƒå¼ç¼“å­˜</title>
      <link href="/posts/34809.html"/>
      <url>/posts/34809.html</url>
      
        <content type="html"><![CDATA[<h2 id="redisä¸­åˆ†å¸ƒå¼ç¼“å­˜å®ç°"><a href="#redisä¸­åˆ†å¸ƒå¼ç¼“å­˜å®ç°" class="headerlink" title="redisä¸­åˆ†å¸ƒå¼ç¼“å­˜å®ç°"></a>redisä¸­åˆ†å¸ƒå¼ç¼“å­˜å®ç°</h2><h3 id="1-é—®é¢˜æ€è€ƒ"><a href="#1-é—®é¢˜æ€è€ƒ" class="headerlink" title="1. é—®é¢˜æ€è€ƒ"></a>1. é—®é¢˜æ€è€ƒ</h3><h4 id="1-ä»€ä¹ˆæ˜¯ç¼“å­˜-Cache"><a href="#1-ä»€ä¹ˆæ˜¯ç¼“å­˜-Cache" class="headerlink" title="1.ä»€ä¹ˆæ˜¯ç¼“å­˜(Cache)"></a>1.ä»€ä¹ˆæ˜¯ç¼“å­˜(Cache)</h4><p>â€‹        å°±æ˜¯è®¡ç®—æœºå†…å­˜ä¸­çš„ä¸€æ®µæ•°æ®</p><h4 id="2-å†…å­˜ä¸­æ•°æ®ç‰¹ç‚¹"><a href="#2-å†…å­˜ä¸­æ•°æ®ç‰¹ç‚¹" class="headerlink" title="2.å†…å­˜ä¸­æ•°æ®ç‰¹ç‚¹"></a>2.å†…å­˜ä¸­æ•°æ®ç‰¹ç‚¹</h4><p>â€‹        <code>è¯»å†™å¿«</code>    <code>æ–­ç”µç«‹å³ä¸¢å¤±</code></p><h4 id="3-ç¼“å­˜è§£å†³äº†ä»€ä¹ˆé—®é¢˜"><a href="#3-ç¼“å­˜è§£å†³äº†ä»€ä¹ˆé—®é¢˜" class="headerlink" title="3. ç¼“å­˜è§£å†³äº†ä»€ä¹ˆé—®é¢˜"></a>3. ç¼“å­˜è§£å†³äº†ä»€ä¹ˆé—®é¢˜</h4><pre><code> 1. æé«˜äº†ç½‘ç«™ååé‡æé«˜ç½‘ç«™è¿è¡Œæ•ˆç‡ 2. `æ ¸å¿ƒè§£å†³é—®é¢˜`ï¼š ç¼“å­˜çš„å­˜åœ¨æ˜¯ç”¨æ¥å‡è½»æ•°æ®åº“è®¿é—®å‹åŠ›</code></pre><h4 id="4-æ—¢ç„¶ç¼“å­˜èƒ½æé«˜æ•ˆç‡ï¼Œé‚£é¡¹ç›®ä¸­æ‰€æœ‰æ•°æ®åŠ å…¥ç¼“å­˜å²‚ä¸æ˜¯æ›´å¥½ï¼Ÿ"><a href="#4-æ—¢ç„¶ç¼“å­˜èƒ½æé«˜æ•ˆç‡ï¼Œé‚£é¡¹ç›®ä¸­æ‰€æœ‰æ•°æ®åŠ å…¥ç¼“å­˜å²‚ä¸æ˜¯æ›´å¥½ï¼Ÿ" class="headerlink" title="4. æ—¢ç„¶ç¼“å­˜èƒ½æé«˜æ•ˆç‡ï¼Œé‚£é¡¹ç›®ä¸­æ‰€æœ‰æ•°æ®åŠ å…¥ç¼“å­˜å²‚ä¸æ˜¯æ›´å¥½ï¼Ÿ"></a>4. æ—¢ç„¶ç¼“å­˜èƒ½æé«˜æ•ˆç‡ï¼Œé‚£é¡¹ç›®ä¸­æ‰€æœ‰æ•°æ®åŠ å…¥ç¼“å­˜å²‚ä¸æ˜¯æ›´å¥½ï¼Ÿ</h4><p>   <code>æ³¨æ„</code>ï¼šä½¿ç”¨ç¼“å­˜æ—¶ä¸€å®šæ˜¯æ•°æ®åº“ä¸­æ•°æ®æå°‘å‘ç”Ÿä¿®æ”¹ï¼Œæ›´å¤šç”¨äºæŸ¥è¯¢è¿™ç§æƒ…å†µ</p><h4 id="5-æœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜åŒºåˆ«ï¼š"><a href="#5-æœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜åŒºåˆ«ï¼š" class="headerlink" title="5. æœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜åŒºåˆ«ï¼š"></a>5. æœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜åŒºåˆ«ï¼š</h4><p>â€‹        æœ¬åœ°ç¼“å­˜ï¼š å­˜åœ¨åº”ç”¨æœåŠ¡å™¨å†…å­˜ä¸­æ•°æ®ç§°ä¹‹ä¸ºæœ¬åœ°ç¼“å­˜  ï¼ˆlocal cacheï¼‰</p><p>â€‹        åˆ†å¸ƒå¼ç¼“å­˜ï¼š å­˜å‚¨åœ¨å½“å‰åº”ç”¨çº§æœåŠ¡å™¨å†…å­˜ä¹‹å¤–çš„æ•°æ®ç§°ä¹‹ä¸ºåˆ†å¸ƒå¼ç¼“å­˜(distribute cache)</p><p>â€‹        é›†ç¾¤ï¼š å°†åŒä¸€ç§æœåŠ¡çš„å¤šä¸ªèŠ‚ç‚¹æ”¾åœ¨ä¸€èµ·å…±åŒå¯¹ç³»ç»Ÿæä¾›æœåŠ¡è¿‡ç¨‹ç§°ä¹‹ä¸ºé›†ç¾¤</p><p>â€‹        åˆ†å¸ƒå¼: æœ‰<code>å¤šä¸ªä¸åŒæœåŠ¡é›†ç¾¤</code>å…±åŒå¯¹ç³»ç»Ÿæä¾›æœåŠ¡è¿™ä¸ªç³»ç»Ÿç§°ä¹‹ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿ</p><h4 id="6-åˆ©ç”¨mybatisè‡ªèº«æœ¬åœ°ç¼“å­˜ç»“åˆrediså®ç°åˆ†å¸ƒå¼ç¼“å­˜"><a href="#6-åˆ©ç”¨mybatisè‡ªèº«æœ¬åœ°ç¼“å­˜ç»“åˆrediså®ç°åˆ†å¸ƒå¼ç¼“å­˜" class="headerlink" title="6. åˆ©ç”¨mybatisè‡ªèº«æœ¬åœ°ç¼“å­˜ç»“åˆrediså®ç°åˆ†å¸ƒå¼ç¼“å­˜"></a>6. åˆ©ç”¨mybatisè‡ªèº«æœ¬åœ°ç¼“å­˜ç»“åˆrediså®ç°åˆ†å¸ƒå¼ç¼“å­˜</h4><p>â€‹        a. mybatisä¸­åº”ç”¨çº§ç¼“å­˜(äºŒçº§ç¼“å­˜ï¼‰sqlsessionFactotry çº§åˆ«ç¼“å­˜ï¹‘æ‰€æœ‰ä¼šè¯å…±äº«</p><p>â€‹        b.å¦‚ä½•å¼€å¯ã€ˆäºŒçº§ç¼“å­˜)</p><p>â€‹                mapper.xml</p><p>â€‹                        <code>&lt;cache / &gt;</code>     â€”<code>æœ¬åœ°ç¼“å­˜</code></p><p>c. æŸ¥çœ‹cacheæ ‡ç­¾ç¼“å­˜å®ç°</p><p>â€‹        ç»“è®º:mybatisåº•å±‚é»˜è®¤ä½¿ç”¨çš„æ˜¯ org.apache.ibatis.cache.impl.Perpetualcacheå®ç°</p><p>d.è‡ªå®šä¹‰Rediscacheå®ç°</p><p>â€‹        é€šè¿‡mybatisé»˜è®¤cacheæºç å¾—çŸ¥å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰Cacheç±»implements Cacheæ¥å£å¹¶å¯¹é‡Œé¢æ–¹æ³•è¿›è¡Œå®ç°public class Rediscache implements cachc</p><p>2.ä½¿ç”¨Recdiscacheå®ç°</p><p>â€‹        &lt;c=zhe typa=â€com. baizhi.cach=. Rediscacheâ€ i &gt;</p><h3 id="3-å®ç°è‡ªå®šä¹‰çš„rediscache"><a href="#3-å®ç°è‡ªå®šä¹‰çš„rediscache" class="headerlink" title="3. å®ç°è‡ªå®šä¹‰çš„rediscache"></a>3. å®ç°è‡ªå®šä¹‰çš„rediscache</h3><p>â€‹        </p><pre class="line-numbers language-java"><code class="language-java"> <span class="token comment" spellcheck="true">//æ­¤å¤„æ— æ³•ç›´æ¥æ³¨å…¥redisTemplateä½¿ç”¨==>å› ä¸ºæ­¤å¤„æ²¡æœ‰å·¥å‚,å¯ä»¥å†™ä¸ªå·¥å…·ç±»ï¼Œè·å–åˆ°å·¥ç¨‹ï¼Œåœ¨ä½¿ç”¨å®¹å™¨å¯¹è±¡</span>    <span class="token comment" spellcheck="true">//å½“å‰æ”¾å…¥ç¼“å­˜çš„mapperçš„namespace ==> å¯¹namespaceåˆ†ç±»ï¼Œå°†åŒä¸€ç±»çš„namespaceç¼“å­˜æ”¾ä¸€èµ·</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> String id<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//å¿…é¡»å­˜åœ¨æ„é€ æ–¹æ³•</span>    <span class="token keyword">public</span> <span class="token function">RedisCache</span><span class="token punctuation">(</span>String id<span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"id: ====================>"</span><span class="token operator">+</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//è¿”å›cacheå”¯ä¸€æ ‡è¯†</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> String <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//ç¼“å­˜æ”¾å…¥å€¼</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">putObject</span><span class="token punctuation">(</span>Object key<span class="token punctuation">,</span> Object value<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"key:"</span><span class="token operator">+</span>key<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token operator">+</span>value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//ä½¿ç”¨redishashç±»å‹ä½œä¸ºç¼“å­˜å­˜å‚¨ç±»å‹,key hashkey value</span>        <span class="token function">getRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>id<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//ç¼“å­˜è·å–æ•°æ®</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Object <span class="token function">getObject</span><span class="token punctuation">(</span>Object key<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"key:"</span><span class="token operator">+</span>key<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//æ ¹æ®keyä»redisçš„hashç±»å‹ä¸­è·å–æ•°æ®</span>        <span class="token keyword">return</span> <span class="token function">getRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>key<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//æ ¹æ®key ä»redisçš„hashç±»å‹ä¸­è·å–æ•°æ®</span><span class="token comment" spellcheck="true">//        return getRedisTemplate().opsForHash().get(id.toString(), getKeyToMD5(key.toString()));</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//æ³¨æ„ï¼šè¿™ä¸ªæ–¹æ³•ä¸ºmybatisçš„ä¿ç•™æ–¹æ³• é»˜è®¤æ²¡æœ‰å®ç° åç»­ç‰ˆæœ¬å¯èƒ½ä¼šå®ç°</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Object <span class="token function">removeObject</span><span class="token punctuation">(</span>Object o<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ ¹æ®æŒ‡å®šçš„keyåˆ é™¤ç¼“å­˜"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> null<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ ¹æ®æŒ‡å®šçš„keyæ¸…ç©ºç¼“å­˜"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//æ¸…ç©ºnamespace</span>        <span class="token function">getRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//è®¡ç®—ç¼“å­˜çš„æ•°é‡</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//è·å–hashä¸­çš„key valueçš„æ•°é‡</span>        <span class="token keyword">return</span> <span class="token function">getRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//è·å–RedisTemplate</span>    <span class="token keyword">public</span> RedisTemplate <span class="token function">getRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//é€šè¿‡applicationå·¥å…·ç±»è·å–RedisTemplate</span>        RedisTemplate redisTemplate <span class="token operator">=</span> <span class="token punctuation">(</span>RedisTemplate<span class="token punctuation">)</span> ApplicationContextUtils<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"redisTemplate"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        redisTemplate<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        redisTemplate<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-é—®é¢˜æ€è€ƒ2"><a href="#2-é—®é¢˜æ€è€ƒ2" class="headerlink" title="2. é—®é¢˜æ€è€ƒ2"></a>2. é—®é¢˜æ€è€ƒ2</h3><h4 id="1-ç¼“å­˜åœ¨é¡¹ç›®ä¸­åº”ç”¨"><a href="#1-ç¼“å­˜åœ¨é¡¹ç›®ä¸­åº”ç”¨" class="headerlink" title="1.ç¼“å­˜åœ¨é¡¹ç›®ä¸­åº”ç”¨"></a>1.ç¼“å­˜åœ¨é¡¹ç›®ä¸­åº”ç”¨</h4><p>â€‹        a. å¦‚æœé¡¹ç›®ä¸­è¡¨æŸ¥è¯¢ä¹‹é—´æ²¡æœ‰ä»»ä½•<code>å…³è”æŸ¥è¯¢</code>ä½¿ç”¨ç°åœ¨çš„è¿™ç§ç¼“å­˜æ–¹å¼<code>æ²¡æœ‰ä»»ä½•é—®é¢˜</code></p><p>â€‹        b. ç°æœ‰ç¼“å­˜æ–¹å¼åœ¨è¡¨è¿æ¥æŸ¥è¯¢è¿‡ç¨‹ä¸­ä¸€å®šå­˜åœ¨é—®é¢˜? </p><p>â€‹                å½“ä¸¤ä¸ªç›¸å…³è”çš„è¡¨è¿æ¥æ—¶ï¼Œæ•°æ®å‘ç”Ÿæ”¹å˜ï¼Œä¸ä¼šå°†æœ‰å…³è”çš„è¡¨ä¸€èµ·æ›´æ–°</p><h4 id="2-åœ¨mybatisçš„ç¼“å­˜ä¸­å¦‚ä½•è¦è§£å†³å…³è”å…³ç³»æ—¶æ›´æ–°ç¼“å­˜ä¿¡æ¯çš„é—®é¢˜"><a href="#2-åœ¨mybatisçš„ç¼“å­˜ä¸­å¦‚ä½•è¦è§£å†³å…³è”å…³ç³»æ—¶æ›´æ–°ç¼“å­˜ä¿¡æ¯çš„é—®é¢˜" class="headerlink" title="2. åœ¨mybatisçš„ç¼“å­˜ä¸­å¦‚ä½•è¦è§£å†³å…³è”å…³ç³»æ—¶æ›´æ–°ç¼“å­˜ä¿¡æ¯çš„é—®é¢˜?"></a>2. åœ¨mybatisçš„ç¼“å­˜ä¸­å¦‚ä½•è¦è§£å†³å…³è”å…³ç³»æ—¶æ›´æ–°ç¼“å­˜ä¿¡æ¯çš„é—®é¢˜?</h4><pre><code>  &lt;cache-ref/&gt;1/ç”¨æ¥å°†å¤šä¸ªå…·æœ‰å…³è”å…³ç³»æŸ¥è¯¢ç¼“å­˜æ”¾åœ¨ä¸€èµ·å¤„ç†</code></pre><h4 id="3-ç¼“å­˜ä¼˜åŒ–ç­–ç•¥"><a href="#3-ç¼“å­˜ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="3. ç¼“å­˜ä¼˜åŒ–ç­–ç•¥"></a>3. ç¼“å­˜ä¼˜åŒ–ç­–ç•¥</h4><p>â€‹        å¯¹æ”¾å…¥rediskeyè¿›è¡Œä¼˜åŒ–: keyçš„é•¿åº¦ä¸èƒ½å¤ªé•¿</p><p>â€‹        ä¾‹å¦‚: 1016170576:2258653568:com.baizh .dao.EmpDA.O.findAl11:0:2147483647:seclect id ,name from t_emp:$qlSes:ionFactoryBe an  å°½å¯èƒ½å°†keyè®¾è®¡ç®€æ´ä¸€äº›?</p><p>â€‹        ç®—æ³•: <code>MD5å¤„ç†â€•åŠ å¯†</code></p><p>â€‹        ç‰¹ç‚¹:</p><p>â€‹                1.ä¸€åˆ‡æ–‡ä»¶å­—ç¬¦ä¸²ç­‰ç»è¿‡mc5å¤„ç†ä¹‹åéƒ½ä¼šç”Ÿæˆ32ä½16è¿›åˆ¶å­—ç¬¦ä¸²</p><p>â€‹                2.ä¸åŒå†…å®¹æ–‡ä»¶ç»è¿‡mal5è¿›è¡ŒåŠ å¯†,åŠ å¯†ç»“æœä¸€å®šä¸ä¸€è‡´aa.txt bb.txt mâ€“=&gt;Md5å¯¹æ–‡ä»¶è¿›è¡ŒåŠ å¯†</p><p>â€‹                3.ç›¸å½“å†…å®¹æ–‡ä»¶å¤šæ¬¡ç»è¿‡md5ç”Ÿæˆç»“æœå§‹ç»ˆä¸€è‡´</p><p>â€‹            æ¨è: åœ¨redi=æ•´åˆmybatisè¿‡ç¨‹ä¸­å»ºè®®å°†keyè¿›è¡Œmd5ä¼˜åŒ–å¤„ç†</p><pre class="line-numbers language-java"><code class="language-java">    <span class="token comment" spellcheck="true">//å¯¹keyè¿›è¡ŒMD5åŠ å¯†</span>    <span class="token keyword">public</span> String <span class="token function">getKeyToMD5</span><span class="token punctuation">(</span>String key<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> DigestUtils<span class="token punctuation">.</span><span class="token function">md5DigestAsHex</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-é¢è¯•ç›¸å…³æ¦‚å¿µ"><a href="#4-é¢è¯•ç›¸å…³æ¦‚å¿µ" class="headerlink" title="4. é¢è¯•ç›¸å…³æ¦‚å¿µ"></a>4. é¢è¯•ç›¸å…³æ¦‚å¿µ</h4><h5 id="4-1-ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€-å‡»ç©¿"><a href="#4-1-ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€-å‡»ç©¿" class="headerlink" title="4.1 ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ å‡»ç©¿"></a>4.1 ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ å‡»ç©¿</h5><p>â€‹    å®šä¹‰ï¼š å®¢æˆ·ç«¯æŸ¥è¯¢ä¸€ä¸ªæ•°æ®åº“ä¸€ä¸ªæ²¡æœ‰çš„æ•°æ®è®°å½•ï¼Œå¯¼è‡´ç¼“å­˜åœ¨è¿™ç§æƒ…å†µä¸‹æ— æ³•åˆ©ç”¨ï¼Œç§°ä¹‹ä¸ºç¼“å­˜ç©¿é€ï¼Œæˆ–è€…ç¼“å­˜å‡»ç©¿</p><p> mybatisä¸­cache<code>è§£å†³äº†ç¼“å­˜ç©¿é€</code>: </p><p>â€‹            å°±æ˜¯å°†æ•°æ®åº“ä¸­æ²¡æœ‰æŸ¥è¯¢åˆ°çš„ç»“æœä¹Ÿè¿›è¡Œç¼“å­˜ï¼Œå°±è§£å†³äº†ç¼“å­˜ç©¿é€çš„é—®é¢˜;</p><h5 id="4-2-ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©"><a href="#4-2-ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©" class="headerlink" title="4.2 ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©"></a>4.2 ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©</h5><p>â€‹    å®šä¹‰: åœ¨ç³»ç»Ÿè¿è¡Œçš„æŸä¸€æ—¶åˆ»ï¼Œçªç„¶ç³»ç»Ÿä¸­çš„ç¼“å­˜å…¨éƒ¨å¤±æ•ˆï¼Œæ°å¥½åœ¨è¿™ä¸€æ—¶åˆ»ï¼Œæ¶Œæ¥å¤§é‡çš„å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå¯¼è‡´æ‰€                æœ‰æ¨¡å—ç¼“å­˜æ— æ³•åˆ©ç”¨ï¼Œå¤§é‡çš„è¯·æ±‚æ¶Œå‘æ•°æ®åº“ï¼Œå¯¼è‡´æç«¯æƒ…å†µï¼Œæ•°æ®åº“é˜»å¡æˆ–æŒ‚èµ·ï¼›</p><p>â€‹                <code>ç¼“å­˜å­˜å‚¨æ—¶</code>ï¼š ä¸šåŠ¡ç³»ç»Ÿéå¸¸å¤§  æ¨¡å—å¤š    ä¸šåŠ¡æ•°æ®ä¸åŒ     ä¸åŒæ¨¡å—åœ¨æ”¾å…¥ç¼“å­˜æ—¶   éƒ½ä¼šè®¾ç½®ä¸€ä¸ªç¼“å­˜è¶…                                        æ—¶æ—¶é—´</p><p>â€‹    è§£å†³æ–¹æ¡ˆï¼š 1.ç¼“å­˜æ°¸ä¹…å­˜å‚¨ï¼ˆ ä¸æ¨èï¼‰  2. <code>é’ˆå¯¹äºä¸åŒä¸šåŠ¡æ•°æ®ä¸€å®šè¦è®¾ç½®ä¸åŒçš„è¶…æ—¶æ—¶é—´</code></p><h5 id="4-3-é¡¹ç›®ä¸­æœ‰æ²¡æœ‰é‡åˆ°ï¼Œå¦‚ä½•è§£å†³"><a href="#4-3-é¡¹ç›®ä¸­æœ‰æ²¡æœ‰é‡åˆ°ï¼Œå¦‚ä½•è§£å†³" class="headerlink" title="4.3 é¡¹ç›®ä¸­æœ‰æ²¡æœ‰é‡åˆ°ï¼Œå¦‚ä½•è§£å†³?"></a>4.3 é¡¹ç›®ä¸­æœ‰æ²¡æœ‰é‡åˆ°ï¼Œå¦‚ä½•è§£å†³?</h5>]]></content>
      
      
      <categories>
          
          <category> redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JWTå®æˆ˜æ•™ç¨‹</title>
      <link href="/posts/39108.html"/>
      <url>/posts/39108.html</url>
      
        <content type="html"><![CDATA[<h1 id="JWT-å®æˆ˜æ•™ç¨‹"><a href="#JWT-å®æˆ˜æ•™ç¨‹" class="headerlink" title="JWT å®æˆ˜æ•™ç¨‹"></a>JWT å®æˆ˜æ•™ç¨‹</h1><p>[TOC]</p><h2 id="1-ä»€ä¹ˆæ˜¯JWT"><a href="#1-ä»€ä¹ˆæ˜¯JWT" class="headerlink" title="1.ä»€ä¹ˆæ˜¯JWT"></a>1.ä»€ä¹ˆæ˜¯JWT</h2><h1 id="1-å®˜æ–¹è§£é‡Š"><a href="#1-å®˜æ–¹è§£é‡Š" class="headerlink" title="1. å®˜æ–¹è§£é‡Š"></a>1. å®˜æ–¹è§£é‡Š</h1><ul><li>å®˜ç½‘åœ°å€: <a href="https://jwt.io/introduction/" target="_blank" rel="noopener">https://jwt.io/introduction/</a></li><li>ç¿»è¯‘: jsonwebtokenï¼ˆJWTï¼‰æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ï¼ˆrfc7519ï¼‰ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç´§å‡‘çš„ã€è‡ªåŒ…å«çš„æ–¹å¼ï¼Œç”¨äºåœ¨å„æ–¹ä¹‹é—´ä»¥JSONå¯¹è±¡å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯ã€‚æ­¤ä¿¡æ¯å¯ä»¥éªŒè¯å’Œä¿¡ä»»ï¼Œå› ä¸ºå®ƒæ˜¯æ•°å­—ç­¾åçš„ã€‚jwtå¯ä»¥ä½¿ç”¨ç§˜å¯†ï¼ˆä½¿ç”¨HMACç®—æ³•ï¼‰æˆ–ä½¿ç”¨RSAæˆ–ECDSAçš„å…¬é’¥/ç§é’¥å¯¹è¿›è¡Œç­¾å</li></ul><h1 id="2-é€šä¿—è§£é‡Š"><a href="#2-é€šä¿—è§£é‡Š" class="headerlink" title="2.é€šä¿—è§£é‡Š"></a>2.é€šä¿—è§£é‡Š</h1><ul><li>JWTç®€ç§°JSON Web Token,ä¹Ÿå°±æ˜¯é€šè¿‡JSONå½¢å¼ä½œä¸ºWebåº”ç”¨ä¸­çš„ä»¤ç‰Œ,ç”¨äºåœ¨å„æ–¹ä¹‹é—´å®‰å…¨åœ°å°†ä¿¡æ¯ä½œä¸ºJSONå¯¹è±¡ä¼ è¾“ã€‚åœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­è¿˜å¯ä»¥å®Œæˆæ•°æ®åŠ å¯†ã€ç­¾åç­‰ç›¸å…³å¤„ç†ã€‚</li></ul><h2 id="2-JWTèƒ½åšä»€ä¹ˆ"><a href="#2-JWTèƒ½åšä»€ä¹ˆ" class="headerlink" title="2.JWTèƒ½åšä»€ä¹ˆ"></a>2.JWTèƒ½åšä»€ä¹ˆ</h2><h3 id="2-1-æˆæƒ"><a href="#2-1-æˆæƒ" class="headerlink" title="2.1. æˆæƒ"></a>2.1. æˆæƒ</h3><ul><li>æ˜¯ä½¿ç”¨JWTçš„æœ€å¸¸è§æ–¹æ¡ˆã€‚ä¸€æ—¦ç”¨æˆ·ç™»å½•ï¼Œæ¯ä¸ªåç»­è¯·æ±‚å°†åŒ…æ‹¬JWTï¼Œä»è€Œå…è®¸ç”¨æˆ·è®¿é—®è¯¥ä»¤ç‰Œå…è®¸çš„è·¯ç”±ï¼ŒæœåŠ¡å’Œèµ„æºã€‚å•ç‚¹ç™»å½•æ˜¯å½“ä»Šå¹¿æ³›ä½¿ç”¨JWTçš„ä¸€é¡¹åŠŸèƒ½ï¼Œå› ä¸ºå®ƒçš„å¼€é”€å¾ˆå°å¹¶ä¸”å¯ä»¥åœ¨ä¸åŒçš„åŸŸä¸­è½»æ¾ä½¿ç”¨ã€‚</li></ul><h3 id="2-2-ä¿¡æ¯äº¤æ¢"><a href="#2-2-ä¿¡æ¯äº¤æ¢" class="headerlink" title="2.2 ä¿¡æ¯äº¤æ¢"></a>2.2 ä¿¡æ¯äº¤æ¢</h3><ul><li>JSON Web Tokenæ˜¯åœ¨å„æ–¹ä¹‹é—´å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯çš„å¥½æ–¹æ³•ã€‚å› ä¸ºå¯ä»¥å¯¹JWTè¿›è¡Œç­¾åï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨å…¬é’¥/ç§é’¥å¯¹ï¼‰ï¼Œæ‰€ä»¥æ‚¨å¯ä»¥ç¡®ä¿å‘ä»¶äººæ˜¯ä»–ä»¬æ‰€è¯´çš„äººã€‚æ­¤å¤–ï¼Œç”±äºç­¾åæ˜¯ä½¿ç”¨æ ‡å¤´å’Œæœ‰æ•ˆè´Ÿè½½è®¡ç®—çš„ï¼Œå› æ­¤æ‚¨è¿˜å¯ä»¥éªŒè¯å†…å®¹æ˜¯å¦é­åˆ°ç¯¡æ”¹ã€‚</li></ul><h2 id="3-ä¸ºä»€ä¹ˆæ˜¯JWT"><a href="#3-ä¸ºä»€ä¹ˆæ˜¯JWT" class="headerlink" title="3.ä¸ºä»€ä¹ˆæ˜¯JWT"></a>3.ä¸ºä»€ä¹ˆæ˜¯JWT</h2><h3 id="åŸºäºä¼ ç»Ÿçš„Sessionè®¤è¯"><a href="#åŸºäºä¼ ç»Ÿçš„Sessionè®¤è¯" class="headerlink" title="åŸºäºä¼ ç»Ÿçš„Sessionè®¤è¯"></a>åŸºäºä¼ ç»Ÿçš„Sessionè®¤è¯</h3><h3 id="3-1-è®¤è¯æ–¹å¼"><a href="#3-1-è®¤è¯æ–¹å¼" class="headerlink" title="3.1. è®¤è¯æ–¹å¼"></a>3.1. è®¤è¯æ–¹å¼</h3><ul><li>æˆ‘ä»¬çŸ¥é“ï¼Œhttpåè®®æœ¬èº«æ˜¯ä¸€ç§æ— çŠ¶æ€çš„åè®®ï¼Œè€Œè¿™å°±æ„å‘³ç€å¦‚æœç”¨æˆ·å‘æˆ‘ä»¬çš„åº”ç”¨æä¾›äº†ç”¨æˆ·åå’Œå¯†ç æ¥è¿›è¡Œç”¨æˆ·è®¤è¯ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡è¯·æ±‚æ—¶ï¼Œç”¨æˆ·è¿˜è¦å†ä¸€æ¬¡è¿›è¡Œç”¨æˆ·è®¤è¯æ‰è¡Œï¼Œå› ä¸ºæ ¹æ®httpåè®®ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½çŸ¥é“æ˜¯å“ªä¸ªç”¨æˆ·å‘å‡ºçš„è¯·æ±‚ï¼Œæ‰€ä»¥ä¸ºäº†è®©æˆ‘ä»¬çš„åº”ç”¨èƒ½è¯†åˆ«æ˜¯å“ªä¸ªç”¨æˆ·å‘å‡ºçš„è¯·æ±‚ï¼Œæˆ‘ä»¬åªèƒ½åœ¨æœåŠ¡å™¨å­˜å‚¨ä¸€ä»½ç”¨æˆ·ç™»å½•çš„ä¿¡æ¯ï¼Œè¿™ä»½ç™»å½•ä¿¡æ¯ä¼šåœ¨å“åº”æ—¶ä¼ é€’ç»™æµè§ˆå™¨ï¼Œå‘Šè¯‰å…¶ä¿å­˜ä¸ºcookie,ä»¥ä¾¿ä¸‹æ¬¡è¯·æ±‚æ—¶å‘é€ç»™æˆ‘ä»¬çš„åº”ç”¨ï¼Œè¿™æ ·æˆ‘ä»¬çš„åº”ç”¨å°±èƒ½è¯†åˆ«è¯·æ±‚æ¥è‡ªå“ªä¸ªç”¨æˆ·äº†,è¿™å°±æ˜¯ä¼ ç»Ÿçš„åŸºäºsessionè®¤è¯ã€‚<br>t</li></ul><h3 id="3-2-è®¤è¯æµç¨‹"><a href="#3-2-è®¤è¯æµç¨‹" class="headerlink" title="3.2. è®¤è¯æµç¨‹"></a>3.2. è®¤è¯æµç¨‹</h3><h3 id="3-3-æš´éœ²é—®é¢˜"><a href="#3-3-æš´éœ²é—®é¢˜" class="headerlink" title="3.3 æš´éœ²é—®é¢˜"></a>3.3 æš´éœ²é—®é¢˜</h3><ul><li><p>1.æ¯ä¸ªç”¨æˆ·ç»è¿‡æˆ‘ä»¬çš„åº”ç”¨è®¤è¯ä¹‹åï¼Œæˆ‘ä»¬çš„åº”ç”¨éƒ½è¦åœ¨æœåŠ¡ç«¯åšä¸€æ¬¡è®°å½•ï¼Œä»¥æ–¹ä¾¿ç”¨æˆ·ä¸‹æ¬¡è¯·æ±‚çš„é‰´åˆ«ï¼Œé€šå¸¸è€Œè¨€sessionéƒ½æ˜¯ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œè€Œéšç€è®¤è¯ç”¨æˆ·çš„å¢å¤šï¼ŒæœåŠ¡ç«¯çš„å¼€é”€ä¼šæ˜æ˜¾å¢å¤§</p></li><li><p>2.ç”¨æˆ·è®¤è¯ä¹‹åï¼ŒæœåŠ¡ç«¯åšè®¤è¯è®°å½•ï¼Œå¦‚æœè®¤è¯çš„è®°å½•è¢«ä¿å­˜åœ¨å†…å­˜ä¸­çš„è¯ï¼Œè¿™æ„å‘³ç€ç”¨æˆ·ä¸‹æ¬¡è¯·æ±‚è¿˜å¿…é¡»è¦è¯·æ±‚åœ¨è¿™å°æœåŠ¡å™¨ä¸Š,è¿™æ ·æ‰èƒ½æ‹¿åˆ°æˆæƒçš„èµ„æºï¼Œè¿™æ ·åœ¨åˆ†å¸ƒå¼çš„åº”ç”¨ä¸Šï¼Œç›¸åº”çš„é™åˆ¶äº†è´Ÿè½½å‡è¡¡å™¨çš„èƒ½åŠ›ã€‚è¿™ä¹Ÿæ„å‘³ç€é™åˆ¶äº†åº”ç”¨çš„æ‰©å±•èƒ½åŠ›ã€‚</p></li><li><p>3.å› ä¸ºæ˜¯åŸºäºcookieæ¥è¿›è¡Œç”¨æˆ·è¯†åˆ«çš„, cookieå¦‚æœè¢«æˆªè·ï¼Œç”¨æˆ·å°±ä¼šå¾ˆå®¹æ˜“å—åˆ°è·¨ç«™è¯·æ±‚ä¼ªé€ çš„æ”»å‡»ã€‚</p></li><li><p>4.åœ¨å‰åç«¯åˆ†ç¦»ç³»ç»Ÿä¸­å°±æ›´åŠ ç—›è‹¦:å¦‚ä¸‹å›¾æ‰€ç¤º</p></li></ul><blockquote><p>ä¹Ÿå°±æ˜¯è¯´å‰åç«¯åˆ†ç¦»åœ¨åº”ç”¨è§£è€¦åå¢åŠ äº†éƒ¨ç½²çš„å¤æ‚æ€§ã€‚é€šå¸¸ç”¨æˆ·ä¸€æ¬¡è¯·æ±‚å°±è¦è½¬å‘å¤šæ¬¡ã€‚å¦‚æœç”¨session æ¯æ¬¡æºå¸¦sessionid åˆ°æœåŠ¡    å™¨ï¼ŒæœåŠ¡å™¨è¿˜è¦æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ã€‚åŒæ—¶å¦‚æœç”¨æˆ·å¾ˆå¤šã€‚è¿™äº›ä¿¡æ¯å­˜å‚¨åœ¨æœåŠ¡å™¨å†…å­˜ä¸­ï¼Œç»™æœåŠ¡å™¨å¢åŠ è´Ÿæ‹…ã€‚è¿˜æœ‰å°±æ˜¯CSRFï¼ˆè·¨ç«™ä¼ªé€ è¯·æ±‚æ”»    å‡»ï¼‰æ”»å‡»ï¼Œsessionæ˜¯åŸºäºcookieè¿›è¡Œç”¨æˆ·è¯†åˆ«çš„, cookieå¦‚æœè¢«æˆªè·ï¼Œç”¨æˆ·å°±ä¼šå¾ˆå®¹æ˜“å—åˆ°è·¨ç«™è¯·æ±‚ä¼ªé€ çš„æ”»å‡»ã€‚è¿˜æœ‰å°±æ˜¯         sessionidå°±æ˜¯ä¸€ä¸ªç‰¹å¾å€¼ï¼Œè¡¨è¾¾çš„ä¿¡æ¯ä¸å¤Ÿä¸°å¯Œã€‚ä¸å®¹æ˜“æ‰©å±•ã€‚è€Œä¸”å¦‚æœä½ åç«¯åº”ç”¨æ˜¯å¤šèŠ‚ç‚¹éƒ¨ç½²ã€‚é‚£ä¹ˆå°±éœ€è¦å®ç°sessionå…±äº«æœºåˆ¶ã€‚    ä¸æ–¹ä¾¿é›†ç¾¤åº”ç”¨ã€‚</p></blockquote><h3 id="åŸºäºJWTè®¤è¯"><a href="#åŸºäºJWTè®¤è¯" class="headerlink" title="åŸºäºJWTè®¤è¯"></a>åŸºäºJWTè®¤è¯</h3><h2 id="4-è®¤è¯æµç¨‹"><a href="#4-è®¤è¯æµç¨‹" class="headerlink" title="4. è®¤è¯æµç¨‹"></a>4. è®¤è¯æµç¨‹</h2><ul><li><p>é¦–å…ˆï¼Œå‰ç«¯é€šè¿‡Webè¡¨å•å°†è‡ªå·±çš„ç”¨æˆ·åå’Œå¯†ç å‘é€åˆ°åç«¯çš„æ¥å£ã€‚è¿™ä¸€è¿‡ç¨‹ä¸€èˆ¬æ˜¯ä¸€ä¸ªHTTP POSTè¯·æ±‚ã€‚å»ºè®®çš„æ–¹å¼æ˜¯é€šè¿‡SSLåŠ å¯†çš„ä¼ è¾“ï¼ˆhttpsåè®®ï¼‰ï¼Œä»è€Œé¿å…æ•æ„Ÿä¿¡æ¯è¢«å—…æ¢ã€‚</p></li><li><p>åç«¯æ ¸å¯¹ç”¨æˆ·åå’Œå¯†ç æˆåŠŸåï¼Œå°†ç”¨æˆ·çš„idç­‰å…¶ä»–ä¿¡æ¯ä½œä¸ºJWT Payloadï¼ˆè´Ÿè½½ï¼‰ï¼Œå°†å…¶ä¸å¤´éƒ¨åˆ†åˆ«è¿›è¡ŒBase64ç¼–ç æ‹¼æ¥åç­¾åï¼Œå½¢æˆä¸€ä¸ªJWT(Token)ã€‚å½¢æˆçš„JWTå°±æ˜¯ä¸€ä¸ªå½¢åŒlll.zzz.xxxçš„å­—ç¬¦ä¸²ã€‚ token head.payload.singurater</p></li><li><p>åç«¯å°†JWTå­—ç¬¦ä¸²ä½œä¸ºç™»å½•æˆåŠŸçš„è¿”å›ç»“æœè¿”å›ç»™å‰ç«¯ã€‚å‰ç«¯å¯ä»¥å°†è¿”å›çš„ç»“æœä¿å­˜åœ¨localStorageæˆ–sessionStorageä¸Šï¼Œé€€å‡ºç™»å½•æ—¶å‰ç«¯åˆ é™¤ä¿å­˜çš„JWTå³å¯ã€‚</p></li><li><p>å‰ç«¯åœ¨æ¯æ¬¡è¯·æ±‚æ—¶å°†JWTæ”¾å…¥HTTP Headerä¸­çš„Authorizationä½ã€‚(è§£å†³XSSå’ŒXSRFé—®é¢˜) HEADER</p></li><li><p>åç«¯æ£€æŸ¥æ˜¯å¦å­˜åœ¨ï¼Œå¦‚å­˜åœ¨éªŒè¯JWTçš„æœ‰æ•ˆæ€§ã€‚ä¾‹å¦‚ï¼Œæ£€æŸ¥ç­¾åæ˜¯å¦æ­£ç¡®ï¼›æ£€æŸ¥Tokenæ˜¯å¦è¿‡æœŸï¼›æ£€æŸ¥Tokençš„æ¥æ”¶æ–¹æ˜¯å¦æ˜¯è‡ªå·±ï¼ˆå¯é€‰ï¼‰ã€‚</p></li><li><p>éªŒè¯é€šè¿‡ååç«¯ä½¿ç”¨JWTä¸­åŒ…å«çš„ç”¨æˆ·ä¿¡æ¯è¿›è¡Œå…¶ä»–é€»è¾‘æ“ä½œï¼Œè¿”å›ç›¸åº”ç»“æœã€‚</p></li></ul><h3 id="4-1-jwtä¼˜åŠ¿"><a href="#4-1-jwtä¼˜åŠ¿" class="headerlink" title="4.1 jwtä¼˜åŠ¿"></a>4.1 jwtä¼˜åŠ¿</h3><ul><li><p>ç®€æ´(Compact): å¯ä»¥é€šè¿‡URLï¼ŒPOSTå‚æ•°æˆ–è€…åœ¨HTTP headerå‘é€ï¼Œå› ä¸ºæ•°æ®é‡å°ï¼Œä¼ è¾“é€Ÿåº¦ä¹Ÿå¾ˆå¿«</p></li><li><p>è‡ªåŒ…å«(Self-contained)ï¼šè´Ÿè½½ä¸­åŒ…å«äº†æ‰€æœ‰ç”¨æˆ·æ‰€éœ€è¦çš„ä¿¡æ¯ï¼Œé¿å…äº†å¤šæ¬¡æŸ¥è¯¢æ•°æ®åº“</p></li><li><p>å› ä¸ºTokenæ˜¯ä»¥JSONåŠ å¯†çš„å½¢å¼ä¿å­˜åœ¨å®¢æˆ·ç«¯çš„ï¼Œæ‰€ä»¥JWTæ˜¯è·¨è¯­è¨€çš„ï¼ŒåŸåˆ™ä¸Šä»»ä½•webå½¢å¼éƒ½æ”¯æŒã€‚</p></li><li><p>ä¸éœ€è¦åœ¨æœåŠ¡ç«¯ä¿å­˜ä¼šè¯ä¿¡æ¯ï¼Œç‰¹åˆ«é€‚ç”¨äºåˆ†å¸ƒå¼å¾®æœåŠ¡ã€‚</p></li></ul><h3 id="4-2-JWTçš„ç»“æ„æ˜¯ä»€ä¹ˆ"><a href="#4-2-JWTçš„ç»“æ„æ˜¯ä»€ä¹ˆ" class="headerlink" title="4.2 JWTçš„ç»“æ„æ˜¯ä»€ä¹ˆ?"></a>4.2 JWTçš„ç»“æ„æ˜¯ä»€ä¹ˆ?</h3><h4 id="4-1-ä»¤ç‰Œç»„æˆ"><a href="#4-1-ä»¤ç‰Œç»„æˆ" class="headerlink" title="4.1 ä»¤ç‰Œç»„æˆ"></a>4.1 ä»¤ç‰Œç»„æˆ</h4><pre class="line-numbers language-markdown"><code class="language-markdown">token   string  ====>  header.payload.singnature   token   <span class="token title important"><span class="token punctuation">#</span> 1.ä»¤ç‰Œç»„æˆ</span><span class="token list punctuation">-</span> 1.æ ‡å¤´(Header)<span class="token list punctuation">-</span> 2.æœ‰æ•ˆè½½è·(Payload)<span class="token list punctuation">-</span> 3.ç­¾å(Signature)<span class="token list punctuation">-</span> å› æ­¤ï¼ŒJWTé€šå¸¸å¦‚ä¸‹æ‰€ç¤º:xxxxx.yyyyy.zzzzz   Header.Payload.Signature<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-2-Header"><a href="#4-2-Header" class="headerlink" title="4.2  Header"></a>4.2  Header</h4><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 2.Header</span><span class="token list punctuation">-</span> æ ‡å¤´é€šå¸¸ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šä»¤ç‰Œçš„ç±»å‹ï¼ˆå³JWTï¼‰å’Œæ‰€ä½¿ç”¨çš„ç­¾åç®—æ³•ï¼Œä¾‹å¦‚HMAC SHA256æˆ–RSAã€‚<span class="token list punctuation">-</span> å®ƒä¼šä½¿ç”¨ Base64 ç¼–ç ç»„æˆ JWT ç»“æ„çš„ç¬¬ä¸€éƒ¨åˆ†ã€‚<span class="token list punctuation">-</span> æ³¨æ„:Base64æ˜¯ä¸€ç§ç¼–ç ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯å¯ä»¥è¢«ç¿»è¯‘å›åŸæ¥çš„æ ·å­æ¥çš„ã€‚å®ƒå¹¶ä¸æ˜¯ä¸€ç§åŠ å¯†è¿‡ç¨‹ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"alg"</span><span class="token operator">:</span> <span class="token string">"HS256"</span><span class="token punctuation">,</span>  <span class="token property">"typ"</span><span class="token operator">:</span> <span class="token string">"JWT"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-3-Payload"><a href="#4-3-Payload" class="headerlink" title="4.3  Payload"></a>4.3  Payload</h4><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 3.Payload</span><span class="token list punctuation">-</span> ä»¤ç‰Œçš„ç¬¬äºŒéƒ¨åˆ†æ˜¯æœ‰æ•ˆè´Ÿè½½ï¼Œå…¶ä¸­åŒ…å«å£°æ˜ã€‚å£°æ˜æ˜¯æœ‰å…³å®ä½“ï¼ˆé€šå¸¸æ˜¯ç”¨æˆ·ï¼‰å’Œå…¶ä»–æ•°æ®çš„å£°æ˜ã€‚<span class="token list punctuation">-</span> åŒæ ·çš„ï¼Œå®ƒä¼šä½¿ç”¨ Base64 ç¼–ç ç»„æˆ JWT ç»“æ„çš„ç¬¬äºŒéƒ¨åˆ†<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"sub"</span><span class="token operator">:</span> <span class="token string">"1234567890"</span><span class="token punctuation">,</span>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"John Doe"</span><span class="token punctuation">,</span>  <span class="token property">"admin"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-4-Signature"><a href="#4-4-Signature" class="headerlink" title="4.4  Signature"></a>4.4  Signature</h4><ul><li>å‰é¢ä¸¤éƒ¨åˆ†éƒ½æ˜¯ä½¿ç”¨ Base64 è¿›è¡Œç¼–ç çš„ï¼Œå³å‰ç«¯å¯ä»¥è§£å¼€çŸ¥é“é‡Œé¢çš„ä¿¡æ¯ã€‚Signature éœ€è¦ä½¿ç”¨ç¼–ç åçš„ header å’Œ payload ä»¥åŠæˆ‘ä»¬æä¾›çš„ä¸€ä¸ªå¯†é’¥ï¼Œç„¶åä½¿ç”¨ header ä¸­æŒ‡å®šçš„ç­¾åç®—æ³•ï¼ˆHS256ï¼‰è¿›è¡Œç­¾åã€‚ç­¾åçš„ä½œç”¨æ˜¯ä¿è¯ JWT æ²¡æœ‰è¢«ç¯¡æ”¹è¿‡</li><li>å¦‚:</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token function">HMACSHA256</span><span class="token punctuation">(</span><span class="token function">base64UrlEncode</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> <span class="token function">base64UrlEncode</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">,</span>secret<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="4-4-1-ç­¾åç›®çš„"><a href="#4-4-1-ç­¾åç›®çš„" class="headerlink" title="4.4.1 ç­¾åç›®çš„"></a>4.4.1 ç­¾åç›®çš„</h5><ul><li>æœ€åä¸€æ­¥ç­¾åçš„è¿‡ç¨‹ï¼Œå®é™…ä¸Šæ˜¯å¯¹å¤´éƒ¨ä»¥åŠè´Ÿè½½å†…å®¹è¿›è¡Œç­¾åï¼Œé˜²æ­¢å†…å®¹è¢«çªœæ”¹ã€‚å¦‚æœæœ‰äººå¯¹å¤´éƒ¨ä»¥åŠè´Ÿè½½çš„å†…å®¹è§£ç ä¹‹åè¿›è¡Œä¿®æ”¹ï¼Œå†è¿›è¡Œç¼–ç ï¼Œæœ€ååŠ ä¸Šä¹‹å‰çš„ç­¾åç»„åˆå½¢æˆæ–°çš„JWTçš„è¯ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ç«¯ä¼šåˆ¤æ–­å‡ºæ–°çš„å¤´éƒ¨å’Œè´Ÿè½½å½¢æˆçš„ç­¾åå’ŒJWTé™„å¸¦ä¸Šçš„ç­¾åæ˜¯ä¸ä¸€æ ·çš„ã€‚å¦‚æœè¦å¯¹æ–°çš„å¤´éƒ¨å’Œè´Ÿè½½è¿›è¡Œç­¾åï¼Œåœ¨ä¸çŸ¥é“æœåŠ¡å™¨åŠ å¯†æ—¶ç”¨çš„å¯†é’¥çš„è¯ï¼Œå¾—å‡ºæ¥çš„ç­¾åä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚</li></ul><h3 id="4-3-ä¿¡æ¯å®‰å…¨é—®é¢˜"><a href="#4-3-ä¿¡æ¯å®‰å…¨é—®é¢˜" class="headerlink" title="4.3 ä¿¡æ¯å®‰å…¨é—®é¢˜"></a>4.3 ä¿¡æ¯å®‰å…¨é—®é¢˜</h3><ul><li><p>åœ¨è¿™é‡Œå¤§å®¶ä¸€å®šä¼šé—®ä¸€ä¸ªé—®é¢˜ï¼šBase64æ˜¯ä¸€ç§ç¼–ç ï¼Œæ˜¯å¯é€†çš„ï¼Œé‚£ä¹ˆæˆ‘çš„ä¿¡æ¯ä¸å°±è¢«æš´éœ²äº†å—ï¼Ÿ</p></li><li><p>æ˜¯çš„ã€‚æ‰€ä»¥ï¼Œåœ¨JWTä¸­ï¼Œä¸åº”è¯¥åœ¨è´Ÿè½½é‡Œé¢åŠ å…¥ä»»ä½•æ•æ„Ÿçš„æ•°æ®ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¼ è¾“çš„æ˜¯ç”¨æˆ·çš„User IDã€‚è¿™ä¸ªå€¼å®é™…ä¸Šä¸æ˜¯ä»€ä¹ˆæ•    æ„Ÿå†…å®¹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¢«çŸ¥é“ä¹Ÿæ˜¯å®‰å…¨çš„ã€‚ä½†æ˜¯åƒå¯†ç è¿™æ ·çš„å†…å®¹å°±ä¸èƒ½è¢«æ”¾åœ¨JWTä¸­äº†ã€‚å¦‚æœå°†ç”¨æˆ·çš„å¯†ç æ”¾åœ¨äº†JWTä¸­ï¼Œé‚£ä¹ˆæ€€æœ‰æ¶æ„çš„ç¬¬    ä¸‰æ–¹é€šè¿‡Base64è§£ç å°±èƒ½å¾ˆå¿«åœ°çŸ¥é“ä½ çš„å¯†ç äº†ã€‚å› æ­¤JWTé€‚åˆç”¨äºå‘Webåº”ç”¨ä¼ é€’ä¸€äº›éæ•æ„Ÿä¿¡æ¯ã€‚JWTè¿˜ç»å¸¸ç”¨äºè®¾è®¡ç”¨æˆ·è®¤è¯å’Œæˆæƒç³»    ç»Ÿï¼Œç”šè‡³å®ç°Webåº”ç”¨çš„å•ç‚¹ç™»å½•ã€‚</p></li></ul>{% asset_img image-20200726181136113.png %}<h4 id="4-3-1-æ”¾åœ¨ä¸€èµ·"><a href="#4-3-1-æ”¾åœ¨ä¸€èµ·" class="headerlink" title="4.3.1 æ”¾åœ¨ä¸€èµ·"></a>4.3.1 æ”¾åœ¨ä¸€èµ·</h4><ul><li>è¾“å‡ºæ˜¯ä¸‰ä¸ªç”±ç‚¹åˆ†éš”çš„Base64-URLå­—ç¬¦ä¸²ï¼Œå¯ä»¥åœ¨HTMLå’ŒHTTPç¯å¢ƒä¸­è½»æ¾ä¼ é€’è¿™äº›å­—ç¬¦ä¸²ï¼Œä¸åŸºäºXMLçš„æ ‡å‡†ï¼ˆä¾‹å¦‚SAMLï¼‰ç›¸æ¯”ï¼Œå®ƒæ›´ç´§å‡‘ã€‚</li><li>ç®€æ´(Compact)</li></ul><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token list punctuation">-</span> å¯ä»¥é€šè¿‡URL, POST å‚æ•°æˆ–è€…åœ¨ HTTP header å‘é€ï¼Œå› ä¸ºæ•°æ®é‡å°ï¼Œä¼ è¾“é€Ÿåº¦å¿«<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>è‡ªåŒ…å«(Self-contained)</li></ul><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token list punctuation">-</span> è´Ÿè½½ä¸­åŒ…å«äº†æ‰€æœ‰ç”¨æˆ·æ‰€éœ€è¦çš„ä¿¡æ¯ï¼Œé¿å…äº†å¤šæ¬¡æŸ¥è¯¢æ•°æ®åº“<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>{% asset_img image-20200726124257203.png%}<h2 id="5-ä½¿ç”¨JWT"><a href="#5-ä½¿ç”¨JWT" class="headerlink" title="5.ä½¿ç”¨JWT"></a>5.ä½¿ç”¨JWT</h2><h3 id="1-å¼•å…¥ä¾èµ–"><a href="#1-å¼•å…¥ä¾èµ–" class="headerlink" title="1.å¼•å…¥ä¾èµ–"></a>1.å¼•å…¥ä¾èµ–</h3><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--å¼•å…¥jwt--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.auth0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>java-jwt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.4.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-ç”Ÿæˆtoken"><a href="#2-ç”Ÿæˆtoken" class="headerlink" title="2.ç”Ÿæˆtoken"></a>2.ç”Ÿæˆtoken</h3><pre class="line-numbers language-java"><code class="language-java">Calendar instance <span class="token operator">=</span> Calendar<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>instance<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>Calendar<span class="token punctuation">.</span>SECOND<span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ç”Ÿæˆä»¤ç‰Œ</span>String token <span class="token operator">=</span> JWT<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">withClaim</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> <span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//è®¾ç½®è‡ªå®šä¹‰ç”¨æˆ·å</span>  <span class="token punctuation">.</span><span class="token function">withExpiresAt</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//è®¾ç½®è¿‡æœŸæ—¶é—´</span>  <span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>Algorithm<span class="token punctuation">.</span><span class="token function">HMAC256</span><span class="token punctuation">(</span><span class="token string">"token!Q2W#E$RW"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è®¾ç½®ç­¾å ä¿å¯† å¤æ‚</span><span class="token comment" spellcheck="true">//è¾“å‡ºä»¤ç‰Œ</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token list punctuation">-</span> ç”Ÿæˆç»“æœeyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdWQiOlsicGhvbmUiLCIxNDMyMzIzNDEzNCJdLCJleHAiOjE1OTU3Mzk0NDIsInVzZXJuYW1lIjoi5byg5LiJIn0.aHmE3RNqvAjFr<span class="token italic"><span class="token punctuation">_</span>dvyn<span class="token punctuation">_</span></span>sD2VJ46P7EGiS5OBMO_TI5jg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="3-æ ¹æ®ä»¤ç‰Œå’Œç­¾åè§£ææ•°æ®"><a href="#3-æ ¹æ®ä»¤ç‰Œå’Œç­¾åè§£ææ•°æ®" class="headerlink" title="3.æ ¹æ®ä»¤ç‰Œå’Œç­¾åè§£ææ•°æ®"></a>3.æ ¹æ®ä»¤ç‰Œå’Œç­¾åè§£ææ•°æ®</h3><pre class="line-numbers language-java"><code class="language-java">JWTVerifier jwtVerifier <span class="token operator">=</span> JWT<span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span>Algorithm<span class="token punctuation">.</span><span class="token function">HMAC256</span><span class="token punctuation">(</span><span class="token string">"token!Q2W#E$RW"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>DecodedJWT decodedJWT <span class="token operator">=</span> jwtVerifier<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç”¨æˆ·å: "</span> <span class="token operator">+</span> decodedJWT<span class="token punctuation">.</span><span class="token function">getClaim</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¿‡æœŸæ—¶é—´: "</span><span class="token operator">+</span>decodedJWT<span class="token punctuation">.</span><span class="token function">getExpiresAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-å¸¸è§å¼‚å¸¸ä¿¡æ¯"><a href="#4-å¸¸è§å¼‚å¸¸ä¿¡æ¯" class="headerlink" title="4.å¸¸è§å¼‚å¸¸ä¿¡æ¯"></a>4.å¸¸è§å¼‚å¸¸ä¿¡æ¯</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token list punctuation">-</span> SignatureVerificationException:                ç­¾åä¸ä¸€è‡´å¼‚å¸¸<span class="token list punctuation">-</span> TokenExpiredException:                            ä»¤ç‰Œè¿‡æœŸå¼‚å¸¸<span class="token list punctuation">-</span> AlgorithmMismatchException:                        ç®—æ³•ä¸åŒ¹é…å¼‚å¸¸<span class="token list punctuation">-</span> InvalidClaimException:                                å¤±æ•ˆçš„payloadå¼‚å¸¸<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="6-å°è£…å·¥å…·ç±»"><a href="#6-å°è£…å·¥å…·ç±»" class="headerlink" title="6.å°è£…å·¥å…·ç±»"></a>6.å°è£…å·¥å…·ç±»</h2><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JWTUtils</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> String TOKEN <span class="token operator">=</span> <span class="token string">"token!Q@W3e4r"</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * ç”Ÿæˆtoken     * @param map  //ä¼ å…¥payload     * @return è¿”å›token     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">getToken</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>String<span class="token operator">></span> map<span class="token punctuation">)</span><span class="token punctuation">{</span>        JWTCreator<span class="token punctuation">.</span>Builder builder <span class="token operator">=</span> JWT<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span>            builder<span class="token punctuation">.</span><span class="token function">withClaim</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Calendar instance <span class="token operator">=</span> Calendar<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        instance<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>Calendar<span class="token punctuation">.</span>SECOND<span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        builder<span class="token punctuation">.</span><span class="token function">withExpiresAt</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>Algorithm<span class="token punctuation">.</span><span class="token function">HMAC256</span><span class="token punctuation">(</span>TOKEN<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * éªŒè¯token     * @param token     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">verify</span><span class="token punctuation">(</span>String token<span class="token punctuation">)</span><span class="token punctuation">{</span>        JWT<span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span>Algorithm<span class="token punctuation">.</span><span class="token function">HMAC256</span><span class="token punctuation">(</span>TOKEN<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * è·å–tokenä¸­payload     * @param token     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> DecodedJWT <span class="token function">getToken</span><span class="token punctuation">(</span>String token<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> JWT<span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span>Algorithm<span class="token punctuation">.</span><span class="token function">HMAC256</span><span class="token punctuation">(</span>TOKEN<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="7-æ•´åˆspringboot"><a href="#7-æ•´åˆspringboot" class="headerlink" title="7.æ•´åˆspringboot"></a>7.æ•´åˆspringboot</h2><h3 id="1-æ­å»ºspringboot-mybatis-jwtç¯å¢ƒ"><a href="#1-æ­å»ºspringboot-mybatis-jwtç¯å¢ƒ" class="headerlink" title="1.æ­å»ºspringboot+mybatis+jwtç¯å¢ƒ"></a>1.æ­å»ºspringboot+mybatis+jwtç¯å¢ƒ</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token list punctuation">-</span> å¼•å…¥ä¾èµ–<span class="token list punctuation">-</span> ç¼–å†™é…ç½®<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--å¼•å…¥jwt--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.auth0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>java-jwt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.4.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--å¼•å…¥mybatis--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.1.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--å¼•å…¥lombok--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.18.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--å¼•å…¥druid--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>druid<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.1.19<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--å¼•å…¥mysql--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.1.38<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-ç›¸å…³é…ç½®ä¿¡æ¯"><a href="#2-ç›¸å…³é…ç½®ä¿¡æ¯" class="headerlink" title="2. ç›¸å…³é…ç½®ä¿¡æ¯"></a>2. ç›¸å…³é…ç½®ä¿¡æ¯</h3><pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">8989</span><span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">jwt</span><span class="token attr-name">spring.datasource.type</span><span class="token punctuation">=</span><span class="token attr-value">com.alibaba.druid.pool.DruidDataSource</span><span class="token attr-name">spring.datasource.driver-class-name</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.jdbc.Driver</span><span class="token attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://localhost:3306/jwt?characterEncoding=UTF-8</span><span class="token attr-name">spring.datasource.username</span><span class="token punctuation">=</span><span class="token attr-value">root</span><span class="token attr-name">spring.datasource.password</span><span class="token punctuation">=</span><span class="token attr-value">root</span><span class="token attr-name">mybatis.type-aliases-package</span><span class="token punctuation">=</span><span class="token attr-value">com.baizhi.entity</span><span class="token attr-name">mybatis.mapper-locations</span><span class="token punctuation">=</span><span class="token attr-value">classpath:com/baizhi/mapper/*.xml</span><span class="token attr-name">logging.level.com.baizhi.dao</span><span class="token punctuation">=</span><span class="token attr-value">debug</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-åˆ›å»ºä¸€ä¸ªç®€å•çš„æ•°æ®è¡¨"><a href="#3-åˆ›å»ºä¸€ä¸ªç®€å•çš„æ•°æ®è¡¨" class="headerlink" title="3. åˆ›å»ºä¸€ä¸ªç®€å•çš„æ•°æ®è¡¨"></a>3. åˆ›å»ºä¸€ä¸ªç®€å•çš„æ•°æ®è¡¨</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span><span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span> <span class="token punctuation">(</span>  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'ä¸»é”®'</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'ç”¨æˆ·å'</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>password<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'ç”¨æˆ·å¯†ç '</span><span class="token punctuation">,</span>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-å¼€å‘entity"><a href="#4-å¼€å‘entity" class="headerlink" title="4.å¼€å‘entity"></a>4.å¼€å‘entity</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@Accessors</span><span class="token punctuation">(</span>chain<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String id<span class="token punctuation">;</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token keyword">private</span> String password<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-å¼€å‘DAOæ¥å£å’Œmapper-xml"><a href="#5-å¼€å‘DAOæ¥å£å’Œmapper-xml" class="headerlink" title="5. å¼€å‘DAOæ¥å£å’Œmapper.xml"></a>5. å¼€å‘DAOæ¥å£å’Œmapper.xml</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Mapper</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserDAO</span> <span class="token punctuation">{</span>    User <span class="token function">login</span><span class="token punctuation">(</span>User user<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.baizhi.dao.UserDAO<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--è¿™é‡Œå°±å†™çš„ç®€å•ç‚¹äº†æ¯•ç«Ÿä¸æ˜¯é‡ç‚¹--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>login<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        select * from user where name=#{name} and password = #{password}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-å¼€å‘Service-æ¥å£ä»¥åŠå®ç°ç±»"><a href="#6-å¼€å‘Service-æ¥å£ä»¥åŠå®ç°ç±»" class="headerlink" title="6. å¼€å‘Service æ¥å£ä»¥åŠå®ç°ç±»"></a>6. å¼€å‘Service æ¥å£ä»¥åŠå®ç°ç±»</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>    User <span class="token function">login</span><span class="token punctuation">(</span>User user<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ç™»å½•æ¥å£</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Service</span><span class="token annotation punctuation">@Transactional</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> UserDAO userDAO<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> Propagation<span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>    <span class="token keyword">public</span> User <span class="token function">login</span><span class="token punctuation">(</span>User user<span class="token punctuation">)</span> <span class="token punctuation">{</span>        User userDB <span class="token operator">=</span> userDAO<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>userDB<span class="token operator">!=</span>null<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> userDB<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">throw</span>  <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"ç™»å½•å¤±è´¥~~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="7-å¼€å‘controller"><a href="#7-å¼€å‘controller" class="headerlink" title="7.å¼€å‘controller"></a>7.å¼€å‘controller</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> UserService userService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/user/login"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> <span class="token function">login</span><span class="token punctuation">(</span>User user<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ç”¨æˆ·å: [{}]"</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å¯†ç : [{}]"</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            User userDB <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>            Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ç”¨æ¥å­˜æ”¾payload</span>            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span>userDB<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> userDB<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            String token <span class="token operator">=</span> JWTUtils<span class="token punctuation">.</span><span class="token function">getToken</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>            result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"state"</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span><span class="token string">"ç™»å½•æˆåŠŸ!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">,</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//æˆåŠŸè¿”å›tokenä¿¡æ¯</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"state"</span><span class="token punctuation">,</span><span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="8-æ•°æ®åº“æ·»åŠ æµ‹è¯•æ•°æ®å¯åŠ¨é¡¹ç›®"><a href="#8-æ•°æ®åº“æ·»åŠ æµ‹è¯•æ•°æ®å¯åŠ¨é¡¹ç›®" class="headerlink" title="8.æ•°æ®åº“æ·»åŠ æµ‹è¯•æ•°æ®å¯åŠ¨é¡¹ç›®"></a>8.æ•°æ®åº“æ·»åŠ æµ‹è¯•æ•°æ®å¯åŠ¨é¡¹ç›®</h3><h3 id="9-é€šè¿‡postmanæ¨¡æ‹Ÿç™»å½•å¤±è´¥"><a href="#9-é€šè¿‡postmanæ¨¡æ‹Ÿç™»å½•å¤±è´¥" class="headerlink" title="9.é€šè¿‡postmanæ¨¡æ‹Ÿç™»å½•å¤±è´¥"></a>9.é€šè¿‡postmanæ¨¡æ‹Ÿç™»å½•å¤±è´¥</h3><h3 id="10-é€šè¿‡postmanæ¨¡æ‹Ÿç™»å½•æˆåŠŸ"><a href="#10-é€šè¿‡postmanæ¨¡æ‹Ÿç™»å½•æˆåŠŸ" class="headerlink" title="10.é€šè¿‡postmanæ¨¡æ‹Ÿç™»å½•æˆåŠŸ"></a>10.é€šè¿‡postmanæ¨¡æ‹Ÿç™»å½•æˆåŠŸ</h3><h3 id="11-ç¼–å†™æµ‹è¯•æ¥å£"><a href="#11-ç¼–å†™æµ‹è¯•æ¥å£" class="headerlink" title="11. ç¼–å†™æµ‹è¯•æ¥å£"></a>11. ç¼–å†™æµ‹è¯•æ¥å£</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/test/test"</span><span class="token punctuation">)</span><span class="token keyword">public</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> <span class="token function">test</span><span class="token punctuation">(</span>String token<span class="token punctuation">)</span> <span class="token punctuation">{</span>  Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">try</span> <span class="token punctuation">{</span>    JWTUtils<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"éªŒè¯é€šè¿‡~~~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"state"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">TokenExpiredException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"state"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"Tokenå·²ç»è¿‡æœŸ!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SignatureVerificationException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"state"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"ç­¾åé”™è¯¯!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AlgorithmMismatchException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"state"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"åŠ å¯†ç®—æ³•ä¸åŒ¹é…!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"state"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"æ— æ•ˆtoken~~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> map<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="11-é€šè¿‡postmanè¯·æ±‚æ¥å£"><a href="#11-é€šè¿‡postmanè¯·æ±‚æ¥å£" class="headerlink" title="11.é€šè¿‡postmanè¯·æ±‚æ¥å£"></a>11.é€šè¿‡postmanè¯·æ±‚æ¥å£</h3><h4 id="11-1-é—®é¢˜"><a href="#11-1-é—®é¢˜" class="headerlink" title="11.1.é—®é¢˜?"></a>11.1.é—®é¢˜?</h4><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token list punctuation">-</span> ä½¿ç”¨ä¸Šè¿°æ–¹å¼æ¯æ¬¡éƒ½è¦ä¼ é€’tokenæ•°æ®,æ¯ä¸ªæ–¹æ³•éƒ½éœ€è¦éªŒè¯tokenä»£ç å†—ä½™,ä¸å¤Ÿçµæ´»? å¦‚ä½•ä¼˜åŒ–<span class="token list punctuation">-</span> ä½¿ç”¨æ‹¦æˆªå™¨è¿›è¡Œä¼˜åŒ–<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="11-2-æ·»åŠ æ‹¦æˆªå™¨"><a href="#11-2-æ·»åŠ æ‹¦æˆªå™¨" class="headerlink" title="11.2 æ·»åŠ æ‹¦æˆªå™¨"></a>11.2 æ·»åŠ æ‹¦æˆªå™¨</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">,</span> Object handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>  String token <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">try</span> <span class="token punctuation">{</span>    JWTUtils<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">TokenExpiredException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"state"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"Tokenå·²ç»è¿‡æœŸ!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SignatureVerificationException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"state"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"ç­¾åé”™è¯¯!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AlgorithmMismatchException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"state"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"åŠ å¯†ç®—æ³•ä¸åŒ¹é…!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"state"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"æ— æ•ˆtoken~~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  String json <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>  response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"application/json;charset=UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InterceptorConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span>InterceptorRegistry registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>        registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JwtTokenInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>          <span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/user/**"</span><span class="token punctuation">)</span>          <span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">"/**"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> token </category>
          
          <category> è®¤è¯ </category>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JWT </tag>
            
            <tag> ä»¤ç‰Œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MybatisPlusä¹‹é…ç½®</title>
      <link href="/posts/31806.html"/>
      <url>/posts/31806.html</url>
      
        <content type="html"><![CDATA[<p>ä»Šæ—¥å†…å®¹ï¼š å­¦ä¹ MybatisPlus å¸¸ç”¨çš„é…ç½® â€”spring boot</p><h2 id="1-åŸºæœ¬é…ç½®"><a href="#1-åŸºæœ¬é…ç½®" class="headerlink" title="1. åŸºæœ¬é…ç½®"></a>1. åŸºæœ¬é…ç½®</h2><h3 id="1-1-configLocation"><a href="#1-1-configLocation" class="headerlink" title="1.1 configLocation"></a>1.1 configLocation</h3><p>MyBatis é…ç½®æ–‡ä»¶ä½ç½®</p><pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">mybatis-plus.config-location</span><span class="token punctuation">=</span><span class="token attr-value">classpath:mybatis-config.xml</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="1-2-mapperLocations"><a href="#1-2-mapperLocations" class="headerlink" title="1.2 mapperLocations"></a>1.2 mapperLocations</h3><p>MyBatis Mapper æ‰€å¯¹åº”çš„ XML æ–‡ä»¶ä½ç½®ï¼Œå¦‚æœæ‚¨åœ¨ Mapper ä¸­æœ‰è‡ªå®šä¹‰æ–¹æ³•ï¼ˆXML ä¸­æœ‰è‡ªå®šä¹‰å®ç°ï¼‰ï¼Œéœ€è¦è¿›è¡Œè¯¥é…ç½®ï¼Œå‘Šè¯‰ Mapper æ‰€å¯¹åº”çš„ XML æ–‡ä»¶ä½ç½®ã€‚</p><pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">mybatis-plus.mapper-locations</span><span class="token punctuation">=</span><span class="token attr-value">classpath*:mybatis/*.xml</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><blockquote><p><code>Maven å¤šæ¨¡å—é¡¹ç›®çš„æ‰«æè·¯å¾„éœ€ä»¥classpath*:å¼€å¤´ï¼ˆå³åŠ è½½å¤šä¸ª jar åŒ…ä¸‹çš„ XML æ–‡ä»¶ï¼‰</code></p></blockquote><h3 id="1-3-typeAliasesPackage"><a href="#1-3-typeAliasesPackage" class="headerlink" title="1.3  typeAliasesPackage"></a>1.3  typeAliasesPackage</h3><p>MyBaits åˆ«ååŒ…æ‰«æè·¯å¾„ï¼Œé€šè¿‡è¯¥å±æ€§å¯ä»¥ç»™åŒ…ä¸­çš„ç±»æ³¨å†Œåˆ«åï¼Œæ³¨å†Œååœ¨ Mapper å¯¹åº”çš„ XML æ–‡ä»¶ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨ç±»åï¼Œè€Œä¸ç”¨ä½¿ç”¨å…¨é™å®šçš„ç±»åï¼ˆå³ XML ä¸­è°ƒç”¨çš„æ—¶å€™ä¸ç”¨åŒ…å«åŒ…åï¼‰ã€‚</p><pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">mybatis-plus.type-aliases-package</span><span class="token punctuation">=</span><span class="token attr-value">cn.itcast.mp.pojo</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="2-è¿›é˜¶é…ç½®"><a href="#2-è¿›é˜¶é…ç½®" class="headerlink" title="2. è¿›é˜¶é…ç½®"></a>2. è¿›é˜¶é…ç½®</h2><h3 id="2-1-mapUnderscoreToCamelCase"><a href="#2-1-mapUnderscoreToCamelCase" class="headerlink" title="2.1 mapUnderscoreToCamelCase"></a>2.1 mapUnderscoreToCamelCase</h3><ul><li>ç±»å‹ï¼šboolean</li><li>é»˜è®¤å€¼ï¼štrue</li></ul><p>æ˜¯å¦å¼€å¯è‡ªåŠ¨é©¼å³°å‘½åè§„åˆ™ï¼ˆcamel caseï¼‰æ˜ å°„ï¼Œå³ä»ç»å…¸æ•°æ®åº“åˆ—å A_COLUMNï¼ˆä¸‹åˆ’çº¿å‘½åï¼‰åˆ°ç»å…¸ Java å±æ€§å aColumnï¼ˆé©¼å³°å‘½åï¼‰çš„ç±»ä¼¼æ˜ å°„ã€‚</p><pre class="line-numbers language-properties"><code class="language-properties"><span class="token comment" spellcheck="true">#å…³é—­è‡ªåŠ¨é©¼å³°æ˜ å°„ï¼Œè¯¥å‚æ•°ä¸èƒ½å’Œmybatis-plus.config-locationåŒæ—¶å­˜åœ¨</span><span class="token attr-name">mybatis-plus.configuration.map-underscore-to-camel-case</span><span class="token punctuation">=</span><span class="token attr-value">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-2-cacheEnabled"><a href="#2-2-cacheEnabled" class="headerlink" title="2.2  cacheEnabled"></a>2.2  cacheEnabled</h3><ul><li><p>ç±»å‹ï¼šboolean</p></li><li><p>é»˜è®¤å€¼ï¼štrue</p></li></ul><p>å…¨å±€åœ°å¼€å¯æˆ–å…³é—­é…ç½®æ–‡ä»¶ä¸­çš„æ‰€æœ‰æ˜ å°„å™¨å·²ç»é…ç½®çš„ä»»ä½•ç¼“å­˜ï¼Œé»˜è®¤ä¸º trueã€‚</p><pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">mybatis-plus.configuration.cache-enabled</span><span class="token punctuation">=</span><span class="token attr-value">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="3-DBç­–ç•¥"><a href="#3-DBç­–ç•¥" class="headerlink" title="3. DBç­–ç•¥"></a>3. DBç­–ç•¥</h2><h3 id="3-1-idType"><a href="#3-1-idType" class="headerlink" title="3.1  idType"></a>3.1  idType</h3><p>å…¨å±€é»˜è®¤ä¸»é”®ç±»å‹ï¼Œè®¾ç½®åï¼Œå³å¯çœç•¥å®ä½“å¯¹è±¡ä¸­çš„@TableId(type = IdType.AUTO)é…ç½®ã€‚</p><pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">mybatis-plus.global-config.db-config.id-type</span><span class="token punctuation">=</span><span class="token attr-value">auto</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-2-tablePrefix"><a href="#3-2-tablePrefix" class="headerlink" title="3.2 tablePrefix"></a>3.2 tablePrefix</h3><ul><li><p>ç±»å‹ï¼šString</p></li><li><p>é»˜è®¤å€¼ï¼šnull</p></li></ul><p>è¡¨åå‰ç¼€ï¼Œå…¨å±€é…ç½®åå¯çœç•¥@TableName()é…ç½®ã€‚</p><pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">mybatis-plus.global-config.db-config.table-prefix</span><span class="token punctuation">=</span><span class="token attr-value">tb</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="4-æ¡ä»¶æ„é€ å™¨"><a href="#4-æ¡ä»¶æ„é€ å™¨" class="headerlink" title="4. æ¡ä»¶æ„é€ å™¨"></a>4. æ¡ä»¶æ„é€ å™¨</h2><h3 id="4-1-allEq"><a href="#4-1-allEq" class="headerlink" title="4.1  allEq"></a>4.1  allEq</h3><h4 id="4-1-1-è¯´æ˜"><a href="#4-1-1-è¯´æ˜" class="headerlink" title="4.1.1 è¯´æ˜"></a>4.1.1 è¯´æ˜</h4><pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">allEq(Map&lt;R,V></span> <span class="token attr-value">params)</span><span class="token attr-name">allEq(Map&lt;R,V></span> <span class="token attr-value">params,boolean null2IsNull)</span><span class="token attr-name">allEq(boolean</span> <span class="token attr-value">condition,Map&lt;R,V> params,boolean null2IsNull)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>å…¨éƒ¨eq(æˆ–ä¸ªåˆ«isNull)</li></ul><blockquote><p>ä¸ªåˆ«å‚æ•°è¯´æ˜: <code>params</code> : <code>key</code>ä¸ºæ•°æ®åº“å­—æ®µå,<code>value</code>ä¸ºå­—æ®µå€¼,<code>null2IsNull</code> : ä¸ºtrueåˆ™åœ¨mapçš„valueä¸ºnullæ—¶è°ƒç”¨isNullæ–¹æ³•,ä¸ºfalseæ—¶åˆ™å¿½ç•¥valueä¸ºnullçš„</p><ul><li>ä¾‹1: allEq({id:1,name:â€è€ç‹â€,age:null})â€”&gt;id=1 and name=â€™è€ç‹â€™ and age isnull</li><li>ä¾‹2: allEq({id:1,name:â€è€ç‹â€,age:null},false)â€”&gt;id=1 and name=â€™è€ç‹â€™</li></ul></blockquote><blockquote><p>ä¸ªåˆ«å‚æ•°è¯´æ˜: <code>filter</code> : è¿‡æ»¤å‡½æ•°,æ˜¯å¦å…è®¸å­—æ®µä¼ å…¥æ¯”å¯¹æ¡ä»¶ä¸­,<code>params</code>ä¸<code>null2IsNull</code> : åŒä¸Š</p><ul><li>ä¾‹1: allEq( (k,v)-&gt;k.indexOf(â€œaâ€)&gt;0,{id:1,name:â€è€ç‹â€,age:null})â€”&gt;name=â€™è€ç‹â€™ and age is null</li><li>ä¾‹2: allEq( (k,v)-&gt;k.indexOf(â€œaâ€)&gt;0,{id:1,name:â€è€ç‹â€,age:null},false)â€”&gt;name=â€™è€ç‹â€™</li></ul></blockquote><h4 id="4-1-2-æµ‹è¯•ç”¨ä¾‹"><a href="#4-1-2-æµ‹è¯•ç”¨ä¾‹" class="headerlink" title="4.1.2 æµ‹è¯•ç”¨ä¾‹"></a>4.1.2 æµ‹è¯•ç”¨ä¾‹</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testWrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    QueryWrapper<span class="token operator">&lt;</span>User<span class="token operator">></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//è®¾ç½®æ¡ä»¶</span>    Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"æ›¹æ“"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token string">"20"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// wrapper.allEq(params);//SELECT * FROM tb_user WHERE password IS NULL AND</span>    name <span class="token operator">=</span> <span class="token operator">?</span> AND age <span class="token operator">=</span> <span class="token operator">?</span>        <span class="token comment" spellcheck="true">// wrapper.allEq(params,false); //SELECT * FROM tb_user WHERE name = ? AND age</span>        <span class="token operator">=</span> <span class="token operator">?</span>        <span class="token comment" spellcheck="true">// wrapper.allEq((k, v) -> (k.equals("name") || k.equals("age"))</span>        <span class="token punctuation">,</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//SELECT * FROM tb_user WHERE name = ? AND age = ?</span>    List<span class="token operator">&lt;</span>User<span class="token operator">></span> users <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>User user <span class="token operator">:</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-2-åŸºæœ¬æ¯”è¾ƒæ“ä½œ"><a href="#4-2-åŸºæœ¬æ¯”è¾ƒæ“ä½œ" class="headerlink" title="4.2  åŸºæœ¬æ¯”è¾ƒæ“ä½œ"></a>4.2  åŸºæœ¬æ¯”è¾ƒæ“ä½œ</h3><ul><li><p>eq </p><ul><li>ç­‰äº = </li></ul></li><li><p>ne </p><ul><li>ä¸ç­‰äº &lt;&gt; </li></ul></li><li><p>gt</p><ul><li>å¤§äº &gt; </li></ul></li><li><p>ge </p><ul><li>å¤§äºç­‰äº &gt;=</li></ul></li><li><p>lt </p><ul><li>å°äº &lt;</li></ul></li><li><p>le </p><ul><li>å°äºç­‰äº &lt;=</li></ul></li><li><p>between BETWEEN å€¼1 AND å€¼2 </p></li><li><p>notBetween</p><ul><li>NOT BETWEEN å€¼1 AND å€¼2 </li></ul></li><li><p>in </p><ul><li>å­—æ®µ IN (value.get(0), value.get(1), â€¦</li></ul></li><li><p>notIn</p><ul><li>å­—æ®µ NOT IN (v0, v1, â€¦)</li></ul></li></ul><h4 id="4-2-1-æµ‹è¯•ç”¨ä¾‹"><a href="#4-2-1-æµ‹è¯•ç”¨ä¾‹" class="headerlink" title="4.2.1 æµ‹è¯•ç”¨ä¾‹"></a>4.2.1 æµ‹è¯•ç”¨ä¾‹</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testEq</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    QueryWrapper<span class="token operator">&lt;</span>User<span class="token operator">></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//SELECT id,user_name,password,name,age,email FROM tb_user WHERE password = ?</span>    AND age <span class="token operator">>=</span> <span class="token operator">?</span> AND name <span class="token function">IN</span> <span class="token punctuation">(</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">)</span>        wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span> <span class="token string">"123456"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">ge</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"æå››"</span><span class="token punctuation">,</span> <span class="token string">"ç‹äº”"</span><span class="token punctuation">,</span> <span class="token string">"èµµå…­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    List<span class="token operator">&lt;</span>User<span class="token operator">></span> users <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>User user <span class="token operator">:</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-3-æ¨¡ç³ŠæŸ¥è¯¢"><a href="#4-3-æ¨¡ç³ŠæŸ¥è¯¢" class="headerlink" title="4.3 æ¨¡ç³ŠæŸ¥è¯¢"></a>4.3 æ¨¡ç³ŠæŸ¥è¯¢</h3><ul><li><p>like </p><ul><li>LIKE â€˜%å€¼%â€™ </li><li>ä¾‹: like(â€œnameâ€, â€œç‹â€) â€”&gt; name like â€˜%ç‹%â€™ </li></ul></li><li><p>notLike</p><ul><li>NOT LIKE â€˜%å€¼%â€™</li><li>ä¾‹: notLike(â€œnameâ€, â€œç‹â€) â€”&gt; name not like â€˜%ç‹%â€™</li></ul></li><li><p>likeLeft</p><ul><li>LIKE â€˜%å€¼â€™ </li><li>ä¾‹: likeLeft(â€œnameâ€, â€œç‹â€) â€”&gt; name like â€˜%ç‹â€™</li></ul></li><li><p>likeRight</p><ul><li>LIKE â€˜å€¼%â€™ </li><li>ä¾‹: likeRight(â€œnameâ€, â€œç‹â€) â€”&gt; name like â€˜ç‹%â€™</li></ul></li></ul><h3 id="4-4-æ’åº"><a href="#4-4-æ’åº" class="headerlink" title="4.4 æ’åº"></a>4.4 æ’åº</h3><ul><li><p>orderBy </p><ul><li>æ’åºï¼šORDER BY å­—æ®µ, â€¦</li><li>ä¾‹: orderBy(true, true, â€œidâ€, â€œnameâ€) â€”&gt; order by id ASC,name ASC</li></ul></li><li><p>orderByAsc </p><ul><li>æ’åºï¼šORDER BY å­—æ®µ, â€¦ ASC </li><li>ä¾‹: orderByAsc(â€œidâ€, â€œnameâ€) â€”&gt; order by id ASC,name ASC </li></ul></li><li><p>orderByDesc </p><ul><li>æ’åºï¼šORDER BY å­—æ®µ, â€¦ DESC</li><li>ä¾‹: orderByDesc(â€œidâ€, â€œnameâ€) â€”&gt; order by id DESC,name DESC</li></ul></li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testWrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    QueryWrapper<span class="token operator">&lt;</span>User<span class="token operator">></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//SELECT id,user_name,password,name,age,email FROM tb_user ORDER BY age DESC</span>    wrapper<span class="token punctuation">.</span><span class="token function">orderByDesc</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    List<span class="token operator">&lt;</span>User<span class="token operator">></span> users <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>User user <span class="token operator">:</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-5-é€»è¾‘æŸ¥è¯¢"><a href="#4-5-é€»è¾‘æŸ¥è¯¢" class="headerlink" title="4.5 é€»è¾‘æŸ¥è¯¢"></a>4.5 é€»è¾‘æŸ¥è¯¢</h3><ul><li><p>or</p><ul><li>æ‹¼æ¥ OR </li><li>ä¸»åŠ¨è°ƒç”¨ or è¡¨ç¤ºç´§æ¥ç€ä¸‹ä¸€ä¸ªæ–¹æ³•ä¸æ˜¯ç”¨ and è¿æ¥!(ä¸è°ƒç”¨ or åˆ™é»˜è®¤ä¸ºä½¿ç”¨ and è¿æ¥)</li></ul></li><li><p>and </p><ul><li>AND åµŒå¥— </li><li>ä¾‹: and(i -&gt; i.eq(â€œnameâ€, â€œæç™½â€).ne(â€œstatusâ€, â€œæ´»ç€â€)) â€”&gt; and (name = â€˜æç™½â€™ and status &lt;&gt; â€˜æ´»ç€â€™)</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ’ä»¶å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MybatisPlus - é…ç½® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MyBatisPlusä¹‹CRUD</title>
      <link href="/posts/32902.html"/>
      <url>/posts/32902.html</url>
      
        <content type="html"><![CDATA[<p>ä»Šæ—¥å†…å®¹:</p><p>mybatisplusé›†æˆä¸SpringBootâ€¦.</p><p>[TOC]</p><h2 id="1-å¯¼å…¥ä¾èµ–"><a href="#1-å¯¼å…¥ä¾èµ–" class="headerlink" title="1. å¯¼å…¥ä¾èµ–"></a>1. å¯¼å…¥ä¾èµ–</h2><pre class="line-numbers language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">></span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.4.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.example<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>study_mybatisPlus<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">></span></span>11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">></span></span>11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!--ç®€åŒ–ä»£ç çš„å·¥å…·åŒ…--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!--mybatis-plusçš„springbootæ”¯æŒ--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!--mysqlé©±åŠ¨--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.1.47<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>slf4j-log4j12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.3.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>4.13.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.4.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-log4j-properties"><a href="#2-log4j-properties" class="headerlink" title="2.log4j.properties"></a>2.log4j.properties</h2><pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">log4j.rootLogger</span><span class="token punctuation">=</span><span class="token attr-value">DEBUG,A1</span><span class="token attr-name">log4j.appender.A1</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.log4j.ConsoleAppender</span><span class="token attr-name">log4j.appender.A1.layout</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.log4j.PatternLayout</span><span class="token attr-name">log4j.appender.A1.layout.ConversionPattern</span><span class="token punctuation">=</span><span class="token attr-value">[%t] [%c]-[%p] %m%n</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-application-properties"><a href="#3-application-properties" class="headerlink" title="3.application.properties"></a>3.application.properties</h2><pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">spring.application.name</span> <span class="token punctuation">=</span> <span class="token attr-value">itcast-mp-springboot</span><span class="token attr-name">spring.datasource.driver-class-name</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.jdbc.Driver</span><span class="token attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://127.0.0.1:3306/mp?</span><span class="token attr-name">useUnicode</span><span class="token punctuation">=</span><span class="token attr-value">true&amp;characterEncoding=utf8&amp;autoReconnect=true&amp;allowMultiQueries=true&amp;useSSL</span><span class="token punctuation">=</span>false<span class="token attr-name">spring.datasource.username</span><span class="token punctuation">=</span><span class="token attr-value">root</span><span class="token attr-name">spring.datasource.password</span><span class="token punctuation">=</span><span class="token attr-value">root</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="PoJo"><a href="#PoJo" class="headerlink" title="PoJo"></a>PoJo</h2><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Data</span>  <span class="token comment" spellcheck="true">//ç”Ÿæˆgetterå’Œsetter</span><span class="token annotation punctuation">@NoArgsConstructor</span>  <span class="token comment" spellcheck="true">//æ— å‚æ„é€ å™¨</span><span class="token annotation punctuation">@AllArgsConstructor</span> <span class="token comment" spellcheck="true">//å…¨å‚æ„é€ å™¨</span><span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">"tb_user"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span><span class="token keyword">private</span> Long id<span class="token punctuation">;</span><span class="token keyword">private</span> String userName<span class="token punctuation">;</span><span class="token keyword">private</span> String password<span class="token punctuation">;</span><span class="token keyword">private</span> String name<span class="token punctuation">;</span><span class="token keyword">private</span> Integer age<span class="token punctuation">;</span><span class="token keyword">private</span> String email<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Mapper"><a href="#Mapper" class="headerlink" title="Mapper"></a>Mapper</h2><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">import</span> cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>mp<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span>User<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>ibaomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>BaseMapper<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token operator">&lt;</span>User<span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="CRUDæµ‹è¯•ç”¨ä¾‹"><a href="#CRUDæµ‹è¯•ç”¨ä¾‹" class="headerlink" title="CRUDæµ‹è¯•ç”¨ä¾‹"></a>CRUDæµ‹è¯•ç”¨ä¾‹</h2><h3 id="1-1-æ’å…¥"><a href="#1-1-æ’å…¥" class="headerlink" title="1.1 æ’å…¥"></a>1.1 æ’å…¥</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/*** æ’å…¥ä¸€æ¡è®°å½•** @param entity å®ä½“å¯¹è±¡*/</span><span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span>T entity<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span>SpringRunner<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@SpringBootTest</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserMapperTest</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@Autowired</span><span class="token keyword">private</span> UserMapper userMapper<span class="token punctuation">;</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testInsert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>User user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>user<span class="token punctuation">.</span><span class="token function">setEmail</span><span class="token punctuation">(</span><span class="token string">"test@itcast.cn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"æ›¹æ“"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>user<span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token string">"caocao"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>user<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//è¿”å›çš„resultæ˜¯å—å½±å“çš„è¡Œæ•°ï¼Œå¹¶ä¸æ˜¯è‡ªå¢</span>åçš„idSystem<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"result = "</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//è‡ªå¢åçš„idä¼šå›å¡«åˆ°å¯¹è±¡ä¸­</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€åç”Ÿæˆçš„idä¸æ˜¯è‡ªå¢é•¿â€¦ é™…æ˜¯MPç”Ÿæˆäº†idçš„å€¼ å†™å…¥åˆ°äº†æ•°æ®åº“ã€‚ å¦‚ä½•è®¾ç½®idçš„ç”Ÿæˆç­–ç•¥å‘¢ï¼Ÿ MPæ”¯æŒçš„idç­–ç•¥ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>Getter<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/*** ç”ŸæˆIDç±»å‹æšä¸¾ç±»** @author hubin* @since 2015-11-10*/</span><span class="token annotation punctuation">@Getter</span><span class="token keyword">public</span> <span class="token keyword">enum</span> IdType <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/*** æ•°æ®åº“IDè‡ªå¢*/</span>    <span class="token function">AUTO</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">/*** è¯¥ç±»å‹ä¸ºæœªè®¾ç½®ä¸»é”®ç±»å‹*/</span>    <span class="token function">NONE</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">/*** ç”¨æˆ·è¾“å…¥ID* &lt;p>è¯¥ç±»å‹å¯ä»¥é€šè¿‡è‡ªå·±æ³¨å†Œè‡ªåŠ¨å¡«å……æ’ä»¶è¿›è¡Œå¡«å……&lt;/p>*/</span>    <span class="token function">INPUT</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">/* ä»¥ä¸‹3ç§ç±»å‹ã€åªæœ‰å½“æ’å…¥å¯¹è±¡ID ä¸ºç©ºï¼Œæ‰è‡ªåŠ¨å¡«å……ã€‚ */</span>    <span class="token comment" spellcheck="true">/*** å…¨å±€å”¯ä¸€ID (idWorker)*/</span>    <span class="token function">ID_WORKER</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">/*** å…¨å±€å”¯ä¸€ID (UUID)*/</span>    <span class="token function">UUID</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">/*** å­—ç¬¦ä¸²å…¨å±€å”¯ä¸€ID (idWorker çš„å­—ç¬¦ä¸²è¡¨ç¤º)*/</span>    <span class="token function">ID_WORKER_STR</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> key<span class="token punctuation">;</span>    <span class="token function">IdType</span><span class="token punctuation">(</span><span class="token keyword">int</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¿®æ”¹Userå¯¹è±¡ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">package</span> cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>mp<span class="token punctuation">.</span>pojo<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>IdType<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>TableId<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>TableName<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>AllArgsConstructor<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>Data<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>NoArgsConstructor<span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">"tb_user"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> IdType<span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//æŒ‡å®šidç±»å‹ä¸ºè‡ªå¢é•¿</span>    <span class="token keyword">private</span> Long id<span class="token punctuation">;</span>    <span class="token keyword">private</span> String userName<span class="token punctuation">;</span>    <span class="token keyword">private</span> String password<span class="token punctuation">;</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token keyword">private</span> Integer age<span class="token punctuation">;</span>    <span class="token keyword">private</span> String email<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-1-1-TableField"><a href="#1-1-1-TableField" class="headerlink" title="1.1.1 @TableField"></a>1.1.1 @TableField</h4><p>åœ¨MPä¸­é€šè¿‡@TableFieldæ³¨è§£å¯ä»¥æŒ‡å®šå­—æ®µçš„ä¸€äº›å±æ€§ï¼Œå¸¸å¸¸è§£å†³çš„é—®é¢˜æœ‰2ä¸ªï¼š</p><p> 1ã€å¯¹è±¡ä¸­çš„å±æ€§åå’Œå­—æ®µåä¸ä¸€è‡´çš„é—®é¢˜ï¼ˆéé©¼å³°ï¼‰ </p><p>2ã€å¯¹è±¡ä¸­çš„å±æ€§å­—æ®µåœ¨è¡¨ä¸­ä¸å­˜åœ¨çš„é—®é¢˜</p><pre class="line-numbers language-java"><code class="language-java"> <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> IdType<span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//è‡ªå¢é•¿ç±»å‹</span>    <span class="token keyword">private</span> Long id<span class="token punctuation">;</span>    <span class="token keyword">private</span> String userName<span class="token punctuation">;</span>    <span class="token keyword">private</span> String password<span class="token punctuation">;</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token keyword">private</span> Integer age<span class="token punctuation">;</span>    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"email"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//è§£å†³å­—æ®µåä¸ä¸€è‡´</span>    <span class="token keyword">private</span> String mail<span class="token punctuation">;</span>    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>exist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String address<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//å­—æ®µåœ¨æ•°æ®åº“è¡¨ä¸­ä¸å­˜åœ¨</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-2-æ›´æ–°æ“ä½œ"><a href="#1-2-æ›´æ–°æ“ä½œ" class="headerlink" title="1.2 æ›´æ–°æ“ä½œ"></a>1.2 æ›´æ–°æ“ä½œ</h3><h4 id="1-2-1-æ ¹æ®idæ›´æ–°"><a href="#1-2-1-æ ¹æ®idæ›´æ–°" class="headerlink" title="1.2.1 æ ¹æ®idæ›´æ–°"></a>1.2.1 æ ¹æ®idæ›´æ–°</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span>SpringRunner<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@SpringBootTest</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserMapperTest</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> UserMapper userMapper<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testUpdateById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        User user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>6L<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//ä¸»é”®</span>        user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//æ›´æ–°çš„å­—æ®µ</span>        <span class="token comment" spellcheck="true">//æ ¹æ®idæ›´æ–°ï¼Œæ›´æ–°ä¸ä¸ºnullçš„å­—æ®µ</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>userMapper<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-2-2-æ ¹æ®æ¡ä»¶æ›´æ–°"><a href="#1-2-2-æ ¹æ®æ¡ä»¶æ›´æ–°" class="headerlink" title="1.2.2 æ ¹æ®æ¡ä»¶æ›´æ–°"></a>1.2.2 æ ¹æ®æ¡ä»¶æ›´æ–°</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">package</span> cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>mp<span class="token punctuation">;</span><span class="token keyword">import</span> cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>mp<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>UserMapper<span class="token punctuation">;</span><span class="token keyword">import</span> cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>mp<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span>User<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>conditions<span class="token punctuation">.</span>Wrapper<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>conditions<span class="token punctuation">.</span>query<span class="token punctuation">.</span>QueryWrapper<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>conditions<span class="token punctuation">.</span>update<span class="token punctuation">.</span>UpdateWrapper<span class="token punctuation">;</span><span class="token keyword">import</span> net<span class="token punctuation">.</span>minidev<span class="token punctuation">.</span>json<span class="token punctuation">.</span>writer<span class="token punctuation">.</span>UpdaterMapper<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Test<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span>RunWith<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>SpringBootTest<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>SpringRunner<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span>SpringRunner<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@SpringBootTest</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserMapperTest</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> UserMapper userMapper<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        User user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//æ›´æ–°çš„å­—æ®µ</span>        <span class="token comment" spellcheck="true">//æ›´æ–°çš„æ¡ä»¶</span>        QueryWrapper<span class="token operator">&lt;</span>User<span class="token operator">></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//æ‰§è¡Œæ›´æ–°æ“ä½œ</span>        <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"result = "</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ–è€…ï¼Œé€šè¿‡UpdateWrapperè¿›è¡Œæ›´æ–°ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//æ›´æ–°çš„æ¡ä»¶ä»¥åŠå­—æ®µ</span>    UpdateWrapper<span class="token operator">&lt;</span>User<span class="token operator">></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UpdateWrapper</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//æ‰§è¡Œæ›´æ–°æ“ä½œ</span>    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>null<span class="token punctuation">,</span> wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"result = "</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-3-åˆ é™¤æ“ä½œ"><a href="#1-3-åˆ é™¤æ“ä½œ" class="headerlink" title="1.3 åˆ é™¤æ“ä½œ"></a>1.3 åˆ é™¤æ“ä½œ</h3><h4 id="1-3-1-deleteById"><a href="#1-3-1-deleteById" class="headerlink" title="1.3.1 deleteById"></a>1.3.1 deleteById</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span><span class="token keyword">private</span> UserMapper userMapper<span class="token punctuation">;</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeleteById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//æ‰§è¡Œåˆ é™¤æ“ä½œ</span>    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userMapper<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span>6L<span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"result = "</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-3-2-deleteByMap"><a href="#1-3-2-deleteByMap" class="headerlink" title="1.3.2  deleteByMap"></a>1.3.2  deleteByMap</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeleteByMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> columnMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    columnMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    columnMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//å°†columnMapä¸­çš„å…ƒç´ è®¾ç½®ä¸ºåˆ é™¤çš„æ¡ä»¶ï¼Œå¤šä¸ªä¹‹é—´ä¸ºandå…³ç³»</span>    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userMapper<span class="token punctuation">.</span><span class="token function">deleteByMap</span><span class="token punctuation">(</span>columnMap<span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"result = "</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-3-3-delete"><a href="#1-3-3-delete" class="headerlink" title="1.3.3  delete"></a>1.3.3  delete</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeleteByMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    User user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//å°†å®ä½“å¯¹è±¡è¿›è¡ŒåŒ…è£…ï¼ŒåŒ…è£…ä¸ºæ“ä½œæ¡ä»¶</span>    QueryWrapper<span class="token operator">&lt;</span>User<span class="token operator">></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userMapper<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"result = "</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-3-4-deleteBatchIds"><a href="#1-3-4-deleteBatchIds" class="headerlink" title="1.3.4 deleteBatchIds"></a>1.3.4 deleteBatchIds</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span><span class="token keyword">private</span> UserMapper userMapper<span class="token punctuation">;</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeleteByMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//æ ¹æ®idé›†åˆæ‰¹é‡åˆ é™¤</span>    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userMapper<span class="token punctuation">.</span><span class="token function">deleteBatchIds</span><span class="token punctuation">(</span>Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>1L<span class="token punctuation">,</span>10L<span class="token punctuation">,</span>20L<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"result = "</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-4-æŸ¥è¯¢æ“ä½œ"><a href="#1-4-æŸ¥è¯¢æ“ä½œ" class="headerlink" title="1.4 æŸ¥è¯¢æ“ä½œ"></a>1.4 æŸ¥è¯¢æ“ä½œ</h3><h4 id="1-4-1-selectById"><a href="#1-4-1-selectById" class="headerlink" title="1.4.1 selectById"></a>1.4.1 selectById</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//æ ¹æ®idæŸ¥è¯¢æ•°æ®</span>    User user <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>2L<span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"result = "</span> <span class="token operator">+</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-4-2-selectBatchIds"><a href="#1-4-2-selectBatchIds" class="headerlink" title="1.4.2 selectBatchIds"></a>1.4.2 selectBatchIds</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectBatchIds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//æ ¹æ®idé›†åˆæ‰¹é‡æŸ¥è¯¢</span>    List<span class="token operator">&lt;</span>User<span class="token operator">></span> users <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userMapper<span class="token punctuation">.</span><span class="token function">selectBatchIds</span><span class="token punctuation">(</span>Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>2L<span class="token punctuation">,</span> 3L<span class="token punctuation">,</span> 10L<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>User user <span class="token operator">:</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-4-3-selectOne"><a href="#1-4-3-selectOne" class="headerlink" title="1.4.3 selectOne"></a>1.4.3 selectOne</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    QueryWrapper<span class="token operator">&lt;</span>User<span class="token operator">></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token operator">&lt;</span>User<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"æå››"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//æ ¹æ®æ¡ä»¶æŸ¥è¯¢ä¸€æ¡æ•°æ®ï¼Œå¦‚æœç»“æœè¶…è¿‡ä¸€æ¡ä¼šæŠ¥é”™</span>    User user <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-4-4-selectCount"><a href="#1-4-4-selectCount" class="headerlink" title="1.4.4 selectCount"></a>1.4.4 selectCount</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    QueryWrapper<span class="token operator">&lt;</span>User<span class="token operator">></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token operator">&lt;</span>User<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    wrapper<span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//å¹´é¾„å¤§äº23å²</span>    <span class="token comment" spellcheck="true">//æ ¹æ®æ¡ä»¶æŸ¥è¯¢æ•°æ®æ¡æ•°</span>    Integer count <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userMapper<span class="token punctuation">.</span><span class="token function">selectCount</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"count = "</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-4-5-selectList"><a href="#1-4-5-selectList" class="headerlink" title="1.4.5 selectList"></a>1.4.5 selectList</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    QueryWrapper<span class="token operator">&lt;</span>User<span class="token operator">></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token operator">&lt;</span>User<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    wrapper<span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//å¹´é¾„å¤§äº23å²</span>    <span class="token comment" spellcheck="true">//æ ¹æ®æ¡ä»¶æŸ¥è¯¢æ•°æ®</span>    List<span class="token operator">&lt;</span>User<span class="token operator">></span> users <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>User user <span class="token operator">:</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"user = "</span> <span class="token operator">+</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-4-6-selectPage"><a href="#1-4-6-selectPage" class="headerlink" title="1.4.6  selectPage"></a>1.4.6  selectPage</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MybatisPlusConfig</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/*** åˆ†é¡µæ’ä»¶*/</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> PaginationInterceptor <span class="token function">paginationInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PaginationInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    QueryWrapper<span class="token operator">&lt;</span>User<span class="token operator">></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token operator">&lt;</span>User<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    wrapper<span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//å¹´é¾„å¤§äº20å²</span>    Page<span class="token operator">&lt;</span>User<span class="token operator">></span> page <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Page</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//æ ¹æ®æ¡ä»¶æŸ¥è¯¢æ•°æ®</span>    IPage<span class="token operator">&lt;</span>User<span class="token operator">></span> iPage <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userMapper<span class="token punctuation">.</span><span class="token function">selectPage</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ•°æ®æ€»æ¡æ•°ï¼š"</span> <span class="token operator">+</span> iPage<span class="token punctuation">.</span><span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ€»é¡µæ•°ï¼š"</span> <span class="token operator">+</span> iPage<span class="token punctuation">.</span><span class="token function">getPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    List<span class="token operator">&lt;</span>User<span class="token operator">></span> users <span class="token operator">=</span> iPage<span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>User user <span class="token operator">:</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"user = "</span> <span class="token operator">+</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> æ’ä»¶å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MyBatisPlus </tag>
            
            <tag> CRUD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å­¦ä¹ å¾®ä¿¡å°ç¨‹åº-ç™»å½•æ¥å£</title>
      <link href="/posts/42562.html"/>
      <url>/posts/42562.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><p>å¾®ä¿¡å°ç¨‹åºï¼Œåç«¯çš„å˜åŒ–ä¸å¤§ï¼Œåªæ˜¯æœ‰æ—¶å€™éœ€è¦ç”¨åˆ°å¾®ä¿¡æä¾›çš„æ¥å£æ¥å®Œæˆä¸šåŠ¡â€¦</p><p><code>å®˜æ–¹æ–‡æ¡£</code>: <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/server-ability/backend-api.html" target="_blank" rel="noopener">https://developers.weixin.qq.com/miniprogram/dev/framework/server-ability/backend-api.html</a></p><p>å»ºè®®å…¨éƒ¨æ¥å£éƒ½çœ‹ä¸€éâ€¦</p><p>æ ¹æ®å®˜æ–¹æä¾›çš„èµ„æ–™ + åšå®¢ï¼›æ•´ç†å¦‚ä¸‹:</p><p>1.å½“å°ç¨‹åºå‰ç«¯è°ƒç”¨wx.login()æ—¶,ä¼šè·å¾—ä¸€ä¸ª<strong>code(ä¸´æ—¶ç™»å½•å‡­è¯)</strong>,ç„¶åå‰ç«¯éœ€è¦ç”¨wx.request()å°†codeå‘é€åˆ°åç«¯;</p><p>2.åœ¨æœåŠ¡å™¨çš„æ¥å£ä¸­,è°ƒç”¨ç™»å½•å‡­è¯æ ¡æ£€æ¥å£,å°†<strong>appid(å°ç¨‹åºå”¯ä¸€æ ‡è¯†)</strong>+<strong>appsecret(å°ç¨‹åºçš„app secret)</strong>+codeå‘é€åˆ°å¾®ä¿¡æ¥å£æœåŠ¡.ç„¶åå¾®ä¿¡æœåŠ¡å™¨ä¼šè¿”å›<strong>session_key(ä¼šè¯ç§˜é’¥)+openid(ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†)</strong>.</p><p>3.åœ¨æœåŠ¡å™¨çš„æ¥å£ä¸­,å·²ç»å¾—åˆ°å¾®ä¿¡ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†openid,ä»¥åŠæ•°æ®ä¼ è¾“çš„session_key,æ¥ä¸‹æ¥å°±å†™ä¸šåŠ¡é€»è¾‘äº†.</p><p>4.è¿”å›ç»™å°ç¨‹åºè‡ªå®šä¹‰ç™»å½•æ€,å°ç¨‹åºçš„å‰ç«¯å°†å®ƒå­˜å…¥storageä¸­.æ¥ä¸‹æ¥çš„wx.request()çš„ä¸šåŠ¡è¯·æ±‚,éƒ½ä¼šæºå¸¦è‡ªå®šä¹‰ç™»å½•æ€.</p><p>5.åœ¨æœåŠ¡å™¨çš„æ¥å£ä¸­é€šè¿‡è‡ªå®šä¹‰ç™»å½•æ€æŸ¥è¯¢openidå’Œsession_key,ç„¶åè¿”å›ä¸šåŠ¡æ•°æ®.</p><p><em>é‡ç‚¹:</em></p><p>åœ¨æœåŠ¡å™¨çš„æ¥å£ä¸­,éœ€è¦è¿›è¡Œä¸€ä¸ªhttpè¯·æ±‚,å°†ä»å°ç¨‹åºè·å¾—çš„codeå’Œæ¥å£ä¸­å­˜å‚¨çš„appidå’Œsecretå‘é€ç»™å¾®ä¿¡æ¥å£æœåŠ¡,ç„¶åå°±å¯ä»¥è·å¾—session_keyå’Œopenid.</p><p><code>æ¥å£åœ°å€</code></p><pre class="line-numbers language-ABAP"><code class="language-ABAP">https://api.weixin.qq.com/sns/jscode2session?appid=APPID&secret=SECRET&js_code=JSCODE&grant_type=authorization_code<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="è¯·æ±‚å‚æ•°"><a href="#è¯·æ±‚å‚æ•°" class="headerlink" title="è¯·æ±‚å‚æ•°"></a>è¯·æ±‚å‚æ•°</h4><table><thead><tr><th>å‚æ•°</th><th>å¿…å¡«</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>appid</td><td>æ˜¯</td><td>å°ç¨‹åºå”¯ä¸€æ ‡è¯†</td></tr><tr><td>secret</td><td>æ˜¯</td><td>å°ç¨‹åºçš„ app secret</td></tr><tr><td>js_code</td><td>æ˜¯</td><td>ç™»å½•æ—¶è·å–çš„ code</td></tr><tr><td>grant_type</td><td>æ˜¯</td><td>å¡«å†™ä¸º authorization_code</td></tr></tbody></table><h4 id="åœ¨ä¸æ»¡è¶³UnionIDä¸‹å‘æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œè¿”å›å‚æ•°"><a href="#åœ¨ä¸æ»¡è¶³UnionIDä¸‹å‘æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œè¿”å›å‚æ•°" class="headerlink" title="åœ¨ä¸æ»¡è¶³UnionIDä¸‹å‘æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œè¿”å›å‚æ•°"></a>åœ¨ä¸æ»¡è¶³UnionIDä¸‹å‘æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œè¿”å›å‚æ•°</h4><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>openid</td><td>ç”¨æˆ·å”¯ä¸€æ ‡è¯†</td></tr><tr><td>session_key</td><td>ä¼šè¯å¯†é’¥</td></tr></tbody></table><h4 id="åœ¨æ»¡è¶³UnionIDä¸‹å‘æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œè¿”å›å‚æ•°"><a href="#åœ¨æ»¡è¶³UnionIDä¸‹å‘æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œè¿”å›å‚æ•°" class="headerlink" title="åœ¨æ»¡è¶³UnionIDä¸‹å‘æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œè¿”å›å‚æ•°"></a>åœ¨æ»¡è¶³UnionIDä¸‹å‘æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œè¿”å›å‚æ•°</h4><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>openid</td><td>ç”¨æˆ·å”¯ä¸€æ ‡è¯†</td></tr><tr><td>session_key</td><td>ä¼šè¯å¯†é’¥</td></tr><tr><td>unionid</td><td>ç”¨æˆ·åœ¨å¼€æ”¾å¹³å°çš„å”¯ä¸€æ ‡è¯†ç¬¦</td></tr></tbody></table><p><code>Javaåå°æ¥å£ç¤ºä¾‹ä»£ç </code></p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//è¯·æ±‚çš„å‚æ•°å¯ä»¥è·å–</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String APPID <span class="token operator">=</span> <span class="token string">"wx9xxxxxxxxxxx9b4"</span><span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String SECRET <span class="token operator">=</span> <span class="token string">"685742***************84xs859"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è·å–å‡­è¯æ ¡æ£€æ¥å£</span><span class="token keyword">public</span> String <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//å¾®ä¿¡çš„æ¥å£</span>String url <span class="token operator">=</span> <span class="token string">"https://api.weixin.qq.com/sns/jscode2session?appid="</span><span class="token operator">+</span>APPID<span class="token operator">+</span><span class="token string">"&amp;secret="</span><span class="token operator">+</span>SECRET<span class="token operator">+</span><span class="token string">"&amp;js_code="</span><span class="token operator">+</span> code <span class="token operator">+</span><span class="token string">"&amp;grant_type=authorization_code"</span><span class="token punctuation">;</span>RestTemplate restTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è¿›è¡Œç½‘ç»œè¯·æ±‚,è®¿é—®urlæ¥å£</span>ResponseEntity<span class="token operator">&lt;</span>String<span class="token operator">></span> responseEntity <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">exchange</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> HttpMethod<span class="token punctuation">.</span>GET<span class="token punctuation">,</span> null<span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ ¹æ®è¿”å›å€¼è¿›è¡Œåç»­æ“ä½œ</span><span class="token keyword">if</span><span class="token punctuation">(</span>responseEntity <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> responseEntity<span class="token punctuation">.</span><span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> HttpStatus<span class="token punctuation">.</span>OK<span class="token punctuation">)</span><span class="token punctuation">{</span>String sessionData <span class="token operator">=</span> responseEntity<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Gson gson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è§£æä»å¾®ä¿¡æœåŠ¡å™¨è·å¾—çš„openidå’Œsession_key;</span>WeChatSession weChatSession <span class="token operator">=</span> gson<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>sessionData<span class="token punctuation">,</span>WeChatSession<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è·å–ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†</span>String openid <span class="token operator">=</span> weChatSession<span class="token punctuation">.</span><span class="token function">getOpenid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è·å–ä¼šè¯ç§˜é’¥</span>String session_key <span class="token operator">=</span> weChatSession<span class="token punctuation">.</span><span class="token function">getSession_key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ä¸‹é¢å°±å¯ä»¥å†™è‡ªå·±çš„ä¸šåŠ¡ä»£ç äº†</span><span class="token comment" spellcheck="true">//æœ€åè¦è¿”å›ä¸€ä¸ªè‡ªå®šä¹‰çš„ç™»å½•æ€,ç”¨æ¥åšåç»­æ•°æ®ä¼ è¾“çš„éªŒè¯</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> è‡ªå­¦ä¹‹è·¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¾®ä¿¡å°ç¨‹åº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootå¿«é€Ÿå…¥é—¨-å«è¯¦è§£</title>
      <link href="/posts/51807.html"/>
      <url>/posts/51807.html</url>
      
        <content type="html"><![CDATA[<p>ä»Šæ—¥å†…å®¹: ä¸»è¦å¤ä¹ SpringBootç›¸å…³æ¦‚å¿µï¼Œæ·±å…¥ç†è§£â€¦.</p><p>[TOC]</p><h2 id="1-å¿«é€Ÿåˆ›å»ºå…¥é—¨"><a href="#1-å¿«é€Ÿåˆ›å»ºå…¥é—¨" class="headerlink" title="1.å¿«é€Ÿåˆ›å»ºå…¥é—¨"></a>1.å¿«é€Ÿåˆ›å»ºå…¥é—¨</h2><p>1.å¼•å…¥ä¾èµ–</p><pre class="line-numbers language-java"><code class="language-java">    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> æ‰€æœ‰çš„springbootçš„å·¥ç¨‹éƒ½ä»¥springçˆ¶å·¥ç¨‹ä¸ºçˆ¶å·¥ç¨‹ <span class="token operator">--</span><span class="token operator">></span>    <span class="token operator">&lt;</span>parent<span class="token operator">></span>        <span class="token operator">&lt;</span>groupId<span class="token operator">></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>        <span class="token operator">&lt;</span>artifactId<span class="token operator">></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>parent<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>        <span class="token operator">&lt;</span>version<span class="token operator">></span><span class="token number">2.0</span><span class="token punctuation">.</span><span class="token number">6</span><span class="token punctuation">.</span>RELEASE<span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>parent<span class="token operator">></span>    <span class="token operator">&lt;</span>dependencies<span class="token operator">></span>        <span class="token operator">&lt;</span>dependency<span class="token operator">></span>            <span class="token operator">&lt;</span>groupId<span class="token operator">></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>            <span class="token operator">&lt;</span>artifactId<span class="token operator">></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>web<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸éœ€è¦æˆ‘å†æ“å¿ƒä¾èµ–ç‰ˆæœ¬çš„é—®é¢˜</p><p>2.ç¼–å†™Controller</p><pre class="line-numbers language-jav"><code class="language-jav">@RestController@EnableAutoConfigurationpublic class HelloController {    @GetMapping("show")    public String test(){        return "hello Spring Boot!";    }    public static void main(String[] args) {        SpringApplication.run(HelloController.class, args);    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯é€šè¿‡localhost:8080/showï¼š è®¿é—®æˆåŠŸâ€¦..</p><h2 id="2-ç›¸å…³è¯¦è§£"><a href="#2-ç›¸å…³è¯¦è§£" class="headerlink" title="2.ç›¸å…³è¯¦è§£"></a>2.ç›¸å…³è¯¦è§£</h2><h3 id="2-1-å¯åŠ¨å™¨"><a href="#2-1-å¯åŠ¨å™¨" class="headerlink" title="2.1 å¯åŠ¨å™¨:"></a>2.1 å¯åŠ¨å™¨:</h3><p>â€‹        spring-boot-starter-parentå·¥ç¨‹å°†ä¾èµ–å…³ç³»å£°æ˜ä¸ºä¸€ä¸ªæˆ–è€…å¤šä¸ªå¯åŠ¨å™¨ã€‚ã€‚ã€‚</p><p>â€‹        æ‰€ä»¥æˆ‘ä»¬å¿…é¡»å¼•å…¥å¯åŠ¨å™¨</p><p>â€‹        ä¾‹å¦‚:  è¿™ä¸ªé¡¹ç›®æ˜¯webé¡¹ç›®ï¼Œæˆ‘ä»¬å°±å¼•å…¥webå¯åŠ¨å™¨,ä½†å¹¶æ²¡æœ‰åœ¨è¿™é‡ŒæŒ‡å®šç‰ˆæœ¬ä¿¡æ¯ã€‚å› ä¸ºSpringBootçš„çˆ¶å·¥ç¨‹å·²ç»å¯¹ç‰ˆæœ¬è¿›è¡Œäº†ç®¡ç†äº†ã€‚</p><h3 id="2-2-è‹¥æœ‰ä¸¤ä¸ªController"><a href="#2-2-è‹¥æœ‰ä¸¤ä¸ªController" class="headerlink" title="2.2 è‹¥æœ‰ä¸¤ä¸ªController"></a>2.2 è‹¥æœ‰ä¸¤ä¸ªController</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Hello2Controller</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"show2"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"hello Spring Boot2!"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Hello1Controller</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"show2"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"hello Spring Boot1!"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>éš¾é“è¦åœ¨æ¯ä¸€ä¸ªControllerä¸­éƒ½æ·»åŠ ä¸€ä¸ªmainæ–¹æ³•å’Œ@EnableAutoConfigurationæ³¨è§£ï¼Œè¿™æ ·å¯åŠ¨ä¸€ä¸ªspringbootç¨‹åºä¹Ÿå¤ªéº»çƒ¦äº†ã€‚ä¹Ÿæ— æ³•åŒæ—¶å¯åŠ¨å¤šä¸ªControllerï¼Œå› ä¸ºæ¯ä¸ªmainæ–¹æ³•éƒ½ç›‘å¬8080ç«¯å£ã€‚æ‰€ä»¥ï¼Œä¸€ä¸ªspringbootç¨‹åºåº”è¯¥åªæœ‰ä¸€ä¸ªspringbootçš„mainæ–¹æ³•ã€‚</p><p>æ‰€ä»¥ï¼Œspringbootç¨‹åºå¼•å…¥äº†ä¸€ä¸ªå…¨å±€çš„å¼•å¯¼ç±»ã€‚</p><h3 id="2-3-æ·»åŠ å¼•å¯¼ç±»"><a href="#2-3-æ·»åŠ å¼•å¯¼ç±»" class="headerlink" title="2.3 æ·»åŠ å¼•å¯¼ç±»"></a>2.3 æ·»åŠ å¼•å¯¼ç±»</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@EnableAutoConfiguration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestApplication</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>TestApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‘ç°æ‰€æœ‰çš„Controlleréƒ½ä¸èƒ½è®¿é—®ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p><p>å›æƒ³ä»¥å‰ç¨‹åºï¼Œæˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ äº†æ³¨è§£æ‰«æï¼Œå®ƒèƒ½æ‰«ææŒ‡å®šåŒ…ä¸‹çš„æ‰€æœ‰Controllerï¼Œè€Œç°åœ¨å¹¶æ²¡æœ‰ã€‚æ€ä¹ˆè§£å†³â€”â€”@ComponentScanæ³¨è§£</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@EnableAutoConfiguration</span><span class="token annotation punctuation">@ComponentScan</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestApplication</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>TestApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŸ¥çœ‹@ComponentScanæ³¨è§£çš„æºç ,å¹¶æ²¡æœ‰çœ‹åˆ°ä»€ä¹ˆç‰¹æ®Šçš„åœ°æ–¹ã€‚</p><p>å¤§æ¦‚æ„æ€å°±æ˜¯:</p><p>[^é…ç½®ç»„ä»¶æ‰«æçš„æŒ‡ä»¤]: æä¾›äº†ç±»ä¼¼ä¸<code>&lt;context:component-scan&gt;</code>æ ‡ç­¾çš„ä½œç”¨.é€šè¿‡basePackageClassesæˆ–è€…basePackageså±æ€§æ¥æŒ‡å®šè¦æ‰«æçš„åŒ…ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šè¿™äº›å±æ€§ï¼Œé‚£ä¹ˆå°†ä»å£°æ˜è¿™ä¸ªæ³¨è§£çš„ç±»æ‰€åœ¨çš„åŒ…å¼€å§‹ï¼Œæ‰«æåŒ…åŠå­åŒ…</p><p>è€Œæˆ‘ä»¬çš„@ComponentScanæ³¨è§£å£°æ˜çš„ç±»å°±æ˜¯mainå‡½æ•°æ‰€åœ¨çš„å¯åŠ¨ç±»ï¼Œå› æ­¤æ‰«æçš„åŒ…æ˜¯è¯¥ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…ã€‚<strong>ä¸€èˆ¬å¯åŠ¨ç±»ä¼šæ”¾åœ¨ä¸€ä¸ªæ¯”è¾ƒæµ…çš„åŒ…ç›®å½•ä¸­ã€‚</strong></p><h3 id="2-4-å¼•å…¥SpringBootApplication"><a href="#2-4-å¼•å…¥SpringBootApplication" class="headerlink" title="2.4 å¼•å…¥SpringBootApplication"></a>2.4 å¼•å…¥SpringBootApplication</h3><p>å¼•å¯¼ç±»ä¸­ä½¿ç”¨äº†@EnableAutoConfigurationå’Œ@ComponentScanæ³¨è§£ï¼Œæœ‰ç‚¹éº»çƒ¦ã€‚springbootæä¾›äº†ä¸€ç§ç®€ä¾¿çš„ç©æ³•ï¼š@SpringBootApplicationæ³¨è§£</p><p>ä½¿ç”¨@SpringBootApplicationæ”¹é€ TestApplicationï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestApplication</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>TestApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŸ¥çœ‹SpringBootApplicationçš„æºç å‘ç°:</p><p>å®ƒæ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£,é‡ç‚¹æ³¨è§£æœ‰:</p><ul><li>@SpringBootConfiguration</li><li>@EnableAutoConfigurationï¼šå¼€å¯è‡ªåŠ¨é…ç½®</li><li>@ComponentScanï¼šå¼€å¯æ³¨è§£æ‰«æ</li></ul><h3 id="2-5-SpringBootConfiguration"><a href="#2-5-SpringBootConfiguration" class="headerlink" title="2.5 @SpringBootConfiguration"></a>2.5 @SpringBootConfiguration</h3><p>æŸ¥çœ‹æºç å‘ç°:</p><p>é€šè¿‡è¿™æ®µæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œåœ¨è¿™ä¸ªæ³¨è§£ä¸Šé¢ï¼Œåˆæœ‰ä¸€ä¸ª<code>@Configuration</code>æ³¨è§£ã€‚é€šè¿‡ä¸Šé¢çš„æ³¨é‡Šé˜…è¯»æˆ‘ä»¬çŸ¥é“ï¼šè¿™ä¸ªæ³¨è§£çš„ä½œç”¨å°±æ˜¯å£°æ˜å½“å‰ç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œç„¶åSpringä¼šè‡ªåŠ¨æ‰«æåˆ°æ·»åŠ äº†<code>@Configuration</code>çš„ç±»ï¼Œå¹¶ä¸”è¯»å–å…¶ä¸­çš„é…ç½®ä¿¡æ¯ã€‚è€Œ<code>@SpringBootConfiguration</code>æ˜¯æ¥å£°æ˜å½“å‰ç±»æ˜¯SpringBootåº”ç”¨çš„é…ç½®ç±»ï¼Œé¡¹ç›®ä¸­åªèƒ½æœ‰ä¸€ä¸ªã€‚æ‰€ä»¥ä¸€èˆ¬æˆ‘ä»¬æ— éœ€è‡ªå·±æ·»åŠ ã€‚</p><h2 id="3-é»˜è®¤é…ç½®åŸç†"><a href="#3-é»˜è®¤é…ç½®åŸç†" class="headerlink" title="3. é»˜è®¤é…ç½®åŸç†"></a>3. é»˜è®¤é…ç½®åŸç†</h2><p>pringbootçš„é»˜è®¤é…ç½®æ–¹å¼å’Œä¹‹å‰ç©çš„é…ç½®æ–¹å¼ä¸å¤ªä¸€æ ·ï¼Œæ²¡æœ‰ä»»ä½•çš„xmlã€‚é‚£ä¹ˆå¦‚æœè‡ªå·±è¦æ–°å¢é…ç½®è¯¥æ€ä¹ˆåŠï¼Ÿæ¯”å¦‚: æˆ‘ä»¬è¦é…ç½®ä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± ï¼Œä»¥å‰ä¼šè¿™ä¹ˆç©ï¼š</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- é…ç½®è¿æ¥æ±  --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.alibaba.druid.pool.DruidDataSource<span class="token punctuation">"</span></span>      <span class="token attr-name">init-method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>init<span class="token punctuation">"</span></span> <span class="token attr-name">destroy-method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>close<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${jdbc.url}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${jdbc.username}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${jdbc.password}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-1-å°è¯•javaé…ç½®"><a href="#3-1-å°è¯•javaé…ç½®" class="headerlink" title="3.1 å°è¯•javaé…ç½®"></a>3.1 å°è¯•javaé…ç½®</h3><p>javaé…ç½®ä¸»è¦é javaç±»å’Œä¸€äº›æ³¨è§£æ¥è¾¾åˆ°å’Œxmlé…ç½®ä¸€æ ·çš„æ•ˆæœï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æ³¨è§£æœ‰ï¼š</p><ul><li><code>@Configuration</code>ï¼šå£°æ˜ä¸€ä¸ªç±»ä½œä¸ºé…ç½®ç±»ï¼Œä»£æ›¿xmlæ–‡ä»¶</li><li><code>@Bean</code>ï¼šå£°æ˜åœ¨æ–¹æ³•ä¸Šï¼Œå°†æ–¹æ³•çš„è¿”å›å€¼åŠ å…¥Beanå®¹å™¨ï¼Œä»£æ›¿<code>&lt;bean&gt;</code>æ ‡ç­¾</li><li><code>@Value</code>ï¼šå±æ€§æ³¨å…¥ </li><li><code>@PropertySource</code>ï¼šæŒ‡å®šå¤–éƒ¨å±æ€§æ–‡ä»¶ã€‚</li></ul><h3 id="3-1-1-å¼•å…¥ä¾èµ–"><a href="#3-1-1-å¼•å…¥ä¾èµ–" class="headerlink" title="3.1.1 å¼•å…¥ä¾èµ–"></a>3.1.1 å¼•å…¥ä¾èµ–</h3><p>é¦–å…ˆåœ¨pom.xmlä¸­ï¼Œå¼•å…¥Druidè¿æ¥æ± ä¾èµ–:</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.github.drtrang<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.1.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-1-2-æ·»åŠ jdbc-properties"><a href="#3-1-2-æ·»åŠ jdbc-properties" class="headerlink" title="3.1.2 æ·»åŠ jdbc.properties"></a>3.1.2 æ·»åŠ jdbc.properties</h3><pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">jdbc.driverClassName</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.jdbc.Driver</span><span class="token attr-name">jdbc.url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://127.0.0.1:3306/mv</span><span class="token attr-name">jdbc.username</span><span class="token punctuation">=</span><span class="token attr-value">root</span><span class="token attr-name">jdbc.password</span><span class="token punctuation">=</span><span class="token attr-value">123</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-1-3-é…ç½®æ•°æ®æº"><a href="#3-1-3-é…ç½®æ•°æ®æº" class="headerlink" title="3.1.3 é…ç½®æ•°æ®æº"></a>3.1.3 é…ç½®æ•°æ®æº</h3><p>åˆ›å»ºJdbcConfigurationç±»ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">"classpath:jdbc.properties"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdbcConfiguration</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${jdbc.url}"</span><span class="token punctuation">)</span>    String url<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${jdbc.driverClassName}"</span><span class="token punctuation">)</span>    String driverClassName<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${jdbc.username}"</span><span class="token punctuation">)</span>    String username<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${jdbc.password}"</span><span class="token punctuation">)</span>    String password<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> DataSource <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        DruidDataSource dataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dataSource<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>        dataSource<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span>driverClassName<span class="token punctuation">)</span><span class="token punctuation">;</span>        dataSource<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>        dataSource<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> dataSource<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è§£è¯»ï¼š</p><ul><li><code>@Configuration</code>ï¼šå£°æ˜<code>JdbcConfiguration</code>æ˜¯ä¸€ä¸ªé…ç½®ç±»ã€‚</li><li><code>@PropertySource</code>ï¼šæŒ‡å®šå±æ€§æ–‡ä»¶çš„è·¯å¾„æ˜¯:<code>classpath:jdbc.properties</code></li><li>é€šè¿‡<code>@Value</code>ä¸ºå±æ€§æ³¨å…¥å€¼ã€‚</li><li>é€šè¿‡@Beanå°† <code>dataSource()</code>æ–¹æ³•å£°æ˜ä¸ºä¸€ä¸ªæ³¨å†ŒBeançš„æ–¹æ³•ï¼ŒSpringä¼šè‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå°†æ–¹æ³•çš„è¿”å›å€¼åŠ å…¥Springå®¹å™¨ä¸­ã€‚ç›¸å½“äºä»¥å‰çš„beanæ ‡ç­¾</li></ul><p>ç„¶åå°±å¯ä»¥åœ¨ä»»æ„ä½ç½®é€šè¿‡<code>@Autowired</code>æ³¨å…¥DataSourceäº†ï¼</p><h3 id="3-1-4-æµ‹è¯•"><a href="#3-1-4-æµ‹è¯•" class="headerlink" title="3.1.4 æµ‹è¯•"></a>3.1.4 æµ‹è¯•</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> DataSource dataSource<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"show"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"hello Spring Boot!"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥é€šè¿‡æ‰“æ–­ç‚¹çš„æ–¹å¼,debugæŸ¥çœ‹å±æ€§æ˜¯æˆåŠŸæ³¨å…¥äº†â€¦..</p><h3 id="3-2-SpringBootçš„å±æ€§æ³¨å…¥"><a href="#3-2-SpringBootçš„å±æ€§æ³¨å…¥" class="headerlink" title="3.2 SpringBootçš„å±æ€§æ³¨å…¥"></a>3.2 SpringBootçš„å±æ€§æ³¨å…¥</h3><p>åœ¨ä¸Šé¢çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬å®éªŒäº†javaé…ç½®æ–¹å¼ã€‚ä¸è¿‡å±æ€§æ³¨å…¥ä½¿ç”¨çš„æ˜¯@Valueæ³¨è§£ã€‚è¿™ç§æ–¹å¼è™½ç„¶å¯è¡Œï¼Œä½†æ˜¯ä¸å¤Ÿå¼ºå¤§ï¼Œå› ä¸ºå®ƒåªèƒ½æ³¨å…¥åŸºæœ¬ç±»å‹å€¼ã€‚</p><p>åœ¨SpringBootä¸­ï¼Œæä¾›äº†ä¸€ç§æ–°çš„å±æ€§æ³¨å…¥æ–¹å¼ï¼Œæ”¯æŒå„ç§javaåŸºæœ¬æ•°æ®ç±»å‹åŠå¤æ‚ç±»å‹çš„æ³¨å…¥ã€‚</p><p>1ï¼‰æ–°å»º<code>JdbcProperties</code>ï¼Œç”¨æ¥è¿›è¡Œå±æ€§æ³¨å…¥ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"jdbc"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdbcProperties</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String url<span class="token punctuation">;</span>    <span class="token keyword">private</span> String driverClassName<span class="token punctuation">;</span>    <span class="token keyword">private</span> String username<span class="token punctuation">;</span>    <span class="token keyword">private</span> String password<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// ... ç•¥</span>    <span class="token comment" spellcheck="true">// getters å’Œ setters</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>åœ¨ç±»ä¸Šé€šè¿‡@ConfigurationPropertiesæ³¨è§£å£°æ˜å½“å‰ç±»ä¸ºå±æ€§è¯»å–ç±»</p></li><li><p><code>prefix=&quot;jdbc&quot;</code>è¯»å–å±æ€§æ–‡ä»¶ä¸­ï¼Œå‰ç¼€ä¸ºjdbcçš„å€¼ã€‚</p></li><li><p>åœ¨ç±»ä¸Šå®šä¹‰å„ä¸ªå±æ€§ï¼Œåç§°å¿…é¡»ä¸å±æ€§æ–‡ä»¶ä¸­<code>jdbc.</code>åé¢éƒ¨åˆ†ä¸€è‡´ï¼Œå¹¶ä¸”å¿…é¡»å…·æœ‰getterå’Œsetteræ–¹æ³•</p></li><li><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæˆ‘ä»¬å¹¶æ²¡æœ‰æŒ‡å®šå±æ€§æ–‡ä»¶çš„åœ°å€ï¼ŒSpringBooté»˜è®¤ä¼šè¯»å–æ–‡ä»¶åä¸ºapplication.propertiesçš„èµ„æºæ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬<strong>æŠŠjdbc.propertiesåç§°æ”¹ä¸ºapplication.properties</strong></p></li></ul><p>2ï¼‰åœ¨JdbcConfigurationä¸­ä½¿ç”¨è¿™ä¸ªå±æ€§ï¼š</p><ul><li><p>é€šè¿‡<code>@EnableConfigurationProperties(JdbcProperties.class)</code>æ¥å£°æ˜è¦ä½¿ç”¨<code>JdbcProperties</code>è¿™ä¸ªç±»çš„å¯¹è±¡</p></li><li><p>ç„¶åä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åœ¨JdbcConfigurationç±»ä¸­æ³¨å…¥JdbcPropertiesï¼š</p><p>â€‹    1. @Autowiredæ³¨å…¥</p></li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span>JdbcProperties<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdbcConfiguration</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> JdbcProperties jdbcProperties<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> DataSource <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        DruidDataSource dataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dataSource<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>jdbcProperties<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dataSource<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span>jdbcProperties<span class="token punctuation">.</span><span class="token function">getDriverClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dataSource<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>jdbcProperties<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dataSource<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>jdbcProperties<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> dataSource<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>â€‹        2. æ„é€ å‡½æ•°æ³¨å…¥</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span>JdbcProperties<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdbcConfiguration</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> JdbcProperties jdbcProperties<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">JdbcConfiguration</span><span class="token punctuation">(</span>JdbcProperties jdbcProperties<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>jdbcProperties <span class="token operator">=</span> jdbcProperties<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> DataSource <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// ç•¥</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>â€‹         3. @Beanæ–¹æ³•çš„å‚æ•°æ³¨å…¥</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span>JdbcProperties<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdbcConfiguration</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> DataSource <span class="token function">dataSource</span><span class="token punctuation">(</span>JdbcProperties jdbcProperties<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// ...</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-3-SpringBootä¸­çš„é»˜è®¤é…ç½®"><a href="#3-3-SpringBootä¸­çš„é»˜è®¤é…ç½®" class="headerlink" title="3.3 SpringBootä¸­çš„é»˜è®¤é…ç½®"></a>3.3 SpringBootä¸­çš„é»˜è®¤é…ç½®</h3><hr><p>é€šè¿‡åˆšæ‰çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“@EnableAutoConfigurationä¼šå¼€å¯SpringBootçš„è‡ªåŠ¨é…ç½®ï¼Œå¹¶ä¸”æ ¹æ®ä½ å¼•å…¥çš„ä¾èµ–æ¥ç”Ÿæ•ˆå¯¹åº”çš„é»˜è®¤é…ç½®ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼š</p><ul><li>è¿™äº›é»˜è®¤é…ç½®æ˜¯æ€ä¹ˆé…ç½®çš„ï¼Œåœ¨å“ªé‡Œé…ç½®çš„å‘¢ï¼Ÿ</li><li>ä¸ºä½•ä¾èµ–å¼•å…¥å°±ä¼šè§¦å‘é…ç½®å‘¢ï¼Ÿ</li><li>è¿™äº›é»˜è®¤é…ç½®çš„å±æ€§æ¥è‡ªå“ªé‡Œå‘¢ï¼Ÿ</li></ul><p>å…¶å®åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œå·²ç»å¼•å…¥äº†ä¸€ä¸ªä¾èµ–ï¼šspring-boot-autoconfigureï¼Œå…¶ä¸­å®šä¹‰äº†å¤§é‡è‡ªåŠ¨é…ç½®ç±»ï¼š</p><p>ä»¥@WebMvcAutoConfigurationï¼šç†è§£,çœ‹æºç </p><p>å…¶ä¸­å®šä¹‰äº†å¾ˆå¤šé»˜è®¤çš„å±æ€§â€¦.</p><blockquote><p>å¦‚æœæˆ‘ä»¬è¦è¦†ç›–è¿™äº›é»˜è®¤å±æ€§ï¼Œåªéœ€è¦åœ¨application.propertiesä¸­å®šä¹‰ä¸å…¶å‰ç¼€prefixå’Œå­—æ®µåä¸€è‡´çš„å±æ€§å³å¯ã€‚</p></blockquote><h3 id="3-4-æ€»ç»“"><a href="#3-4-æ€»ç»“" class="headerlink" title="3.4 æ€»ç»“"></a>3.4 æ€»ç»“</h3><p>SpringBootä¸ºæˆ‘ä»¬æä¾›äº†é»˜è®¤é…ç½®ï¼Œè€Œé»˜è®¤é…ç½®ç”Ÿæ•ˆçš„æ¡ä»¶ä¸€èˆ¬æœ‰ä¸¤ä¸ªï¼š</p><ul><li>ä½ å¼•å…¥äº†ç›¸å…³ä¾èµ–</li><li>ä½ è‡ªå·±æ²¡æœ‰é…ç½®</li></ul><p>1ï¼‰å¯åŠ¨å™¨</p><p>ä¹‹æ‰€ä»¥ï¼Œæˆ‘ä»¬å¦‚æœä¸æƒ³é…ç½®ï¼Œåªéœ€è¦å¼•å…¥ä¾èµ–å³å¯ï¼Œè€Œä¾èµ–ç‰ˆæœ¬æˆ‘ä»¬ä¹Ÿä¸ç”¨æ“å¿ƒï¼Œå› ä¸ºåªè¦å¼•å…¥äº†SpringBootæä¾›çš„staterï¼ˆå¯åŠ¨å™¨ï¼‰ï¼Œå°±ä¼šè‡ªåŠ¨ç®¡ç†ä¾èµ–åŠç‰ˆæœ¬äº†ã€‚</p><p>å› æ­¤ï¼Œç©SpringBootçš„ç¬¬ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯æ‰¾å¯åŠ¨å™¨ï¼ŒSpringBootæä¾›äº†å¤§é‡çš„é»˜è®¤å¯åŠ¨å™¨ï¼Œ</p><p>2ï¼‰å…¨å±€é…ç½®</p><p>å¦å¤–ï¼ŒSpringBootçš„é»˜è®¤é…ç½®ï¼Œéƒ½ä¼šè¯»å–é»˜è®¤å±æ€§ï¼Œè€Œè¿™äº›å±æ€§å¯ä»¥é€šè¿‡è‡ªå®šä¹‰<code>application.properties</code>æ–‡ä»¶æ¥è¿›è¡Œè¦†ç›–ã€‚è¿™æ ·è™½ç„¶ä½¿ç”¨çš„è¿˜æ˜¯é»˜è®¤é…ç½®ï¼Œä½†æ˜¯é…ç½®ä¸­çš„å€¼æ”¹æˆäº†æˆ‘ä»¬è‡ªå®šä¹‰çš„ã€‚</p><p>å› æ­¤ï¼Œç©SpringBootçš„ç¬¬äºŒä»¶äº‹æƒ…ï¼Œå°±æ˜¯é€šè¿‡<code>application.properties</code>æ¥è¦†ç›–é»˜è®¤å±æ€§å€¼ï¼Œå½¢æˆè‡ªå®šä¹‰é…ç½®ã€‚æˆ‘ä»¬éœ€è¦çŸ¥é“SpringBootçš„é»˜è®¤å±æ€§keyï¼Œ</p><h2 id="4-SpringBootå®æˆ˜"><a href="#4-SpringBootå®æˆ˜" class="headerlink" title="4.SpringBootå®æˆ˜"></a>4.SpringBootå®æˆ˜</h2><h3 id="4-1-æ•´åˆSpringMVC"><a href="#4-1-æ•´åˆSpringMVC" class="headerlink" title="4.1 æ•´åˆSpringMVC"></a>4.1 æ•´åˆSpringMVC</h3><h4 id="4-1-1-è®¿é—®é™æ€èµ„æº"><a href="#4-1-1-è®¿é—®é™æ€èµ„æº" class="headerlink" title="4.1.1 è®¿é—®é™æ€èµ„æº"></a>4.1.1 è®¿é—®é™æ€èµ„æº</h4><blockquote><p>æœ‰ä¸€ä¸ªå«åšResourcePropertiesçš„ç±»ï¼Œé‡Œé¢å°±å®šä¹‰äº†é™æ€èµ„æºçš„é»˜è®¤æŸ¥æ‰¾è·¯å¾„ï¼š</p></blockquote><p>é»˜è®¤çš„é™æ€èµ„æºè·¯å¾„ä¸ºï¼š</p><ul><li>classpath:/META-INF/resources/</li><li>classpath:/resources/</li><li>classpath:/static/</li><li>classpath:/public/</li></ul><p>åªè¦é™æ€èµ„æºæ”¾åœ¨è¿™äº›ç›®å½•ä¸­ä»»ä½•ä¸€ä¸ªï¼ŒSpringMVCéƒ½ä¼šå¸®æˆ‘ä»¬å¤„ç†ã€‚</p><p>æˆ‘ä»¬ä¹ æƒ¯ä¼šæŠŠé™æ€èµ„æºæ”¾åœ¨<code>classpath:/static/</code>ç›®å½•ä¸‹ã€‚</p><h4 id="4-1-2-æ·»åŠ æ‹¦æˆªå™¨"><a href="#4-1-2-æ·»åŠ æ‹¦æˆªå™¨" class="headerlink" title="4.1.2 æ·»åŠ æ‹¦æˆªå™¨"></a>4.1.2 æ·»åŠ æ‹¦æˆªå™¨</h4><p>é€šè¿‡å®ç°<code>WebMvcConfigurer</code>å¹¶æ·»åŠ <code>@Configuration</code>æ³¨è§£æ¥å®ç°è‡ªå®šä¹‰éƒ¨åˆ†SpringMvcé…ç½®ã€‚</p><p>é¦–å…ˆè‡ªå®šä¹‰ä¸€ä¸ªæ‹¦æˆªå™¨ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">,</span> Object handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"preHandle method is running!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postHandle</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">,</span> Object handler<span class="token punctuation">,</span> ModelAndView modelAndView<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"postHandle method is running!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterCompletion</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">,</span> Object handler<span class="token punctuation">,</span> Exception ex<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"afterCompletion method is running!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åå®šä¹‰é…ç½®ç±»ï¼Œæ³¨å†Œæ‹¦æˆªå™¨ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MvcConfiguration</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> HandlerInterceptor myInterceptor<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * é‡å†™æ¥å£ä¸­çš„addInterceptorsæ–¹æ³•ï¼Œæ·»åŠ è‡ªå®šä¹‰æ‹¦æˆªå™¨     * @param registry     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span>InterceptorRegistry registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>        registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span>myInterceptor<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">"/**"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ä¸‹æ¥è¿è¡Œå¹¶æŸ¥çœ‹æ—¥å¿—ï¼š</p><pre class="line-numbers language-verilog"><code class="language-verilog">preHandle method is running<span class="token operator">!</span>postHandle method is running<span class="token operator">!</span>afterCompletion method is running<span class="token operator">!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä½ ä¼šå‘ç°æ—¥å¿—ä¸­åªæœ‰è¿™äº›æ‰“å°ä¿¡æ¯ï¼ŒspringMVCçš„æ—¥å¿—ä¿¡æ¯éƒ½æ²¡æœ‰ï¼Œå› ä¸ºspringMVCè®°å½•çš„logçº§åˆ«æ˜¯debugï¼Œspringbooté»˜è®¤æ˜¯æ˜¾ç¤ºinfoä»¥ä¸Šï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œé…ç½®ã€‚</p><p>SpringBooté€šè¿‡<code>logging.level.*=debug</code>æ¥é…ç½®æ—¥å¿—çº§åˆ«ï¼Œ*å¡«å†™åŒ…å</p><pre class="line-numbers language-properties"><code class="language-properties"><span class="token comment" spellcheck="true"># è®¾ç½®org.springframeworkåŒ…çš„æ—¥å¿—çº§åˆ«ä¸ºdebug</span><span class="token attr-name">logging.level.org.springframework</span><span class="token punctuation">=</span><span class="token attr-value">debug</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="4-2-æ•´åˆè¿æ¥æ± "><a href="#4-2-æ•´åˆè¿æ¥æ± " class="headerlink" title="4.2 æ•´åˆè¿æ¥æ± "></a>4.2 æ•´åˆè¿æ¥æ± </h3><p>åœ¨pom.xmlä¸­å¼•å…¥jdbcçš„å¯åŠ¨å™¨ï¼š</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--jdbcçš„å¯åŠ¨å™¨ï¼Œé»˜è®¤ä½¿ç”¨HikariCPè¿æ¥æ± --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--ä¸è¦å¿˜è®°æ•°æ®åº“é©±åŠ¨ï¼Œå› ä¸ºspringbootä¸çŸ¥é“æˆ‘ä»¬ä½¿ç”¨çš„ä»€ä¹ˆæ•°æ®åº“ï¼Œè¿™é‡Œé€‰æ‹©mysql--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>éœ€è¦æŒ‡å®šè¿æ¥æ± å‚æ•°: </p><pre class="line-numbers language-properties"><code class="language-properties"><span class="token comment" spellcheck="true"># è¿æ¥å››å¤§å‚æ•°</span><span class="token attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://localhost:3306/heima</span><span class="token attr-name">spring.datasource.username</span><span class="token punctuation">=</span><span class="token attr-value">root</span><span class="token attr-name">spring.datasource.password</span><span class="token punctuation">=</span><span class="token attr-value">root</span><span class="token comment" spellcheck="true"># å¯çœç•¥ï¼ŒSpringBootè‡ªåŠ¨æ¨æ–­</span><span class="token attr-name">spring.datasource.driverClassName</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.jdbc.Driver</span><span class="token attr-name">spring.datasource.hikari.idle-timeout</span><span class="token punctuation">=</span><span class="token attr-value">60000</span><span class="token attr-name">spring.datasource.hikari.maximum-pool-size</span><span class="token punctuation">=</span><span class="token attr-value">30</span><span class="token attr-name">spring.datasource.hikari.minimum-idle</span><span class="token punctuation">=</span><span class="token attr-value">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Druidå®˜æ–¹æä¾›çš„å¯åŠ¨å™¨ï¼š</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- Druidè¿æ¥æ±  --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.1.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è€Œè¿æ¥ä¿¡æ¯çš„é…ç½®ä¸ä¸Šé¢æ˜¯ç±»ä¼¼çš„ï¼Œåªä¸è¿‡åœ¨è¿æ¥æ± ç‰¹æœ‰å±æ€§ä¸Šï¼Œæ–¹å¼ç•¥æœ‰ä¸åŒï¼š</p><pre class="line-numbers language-properties"><code class="language-properties"><span class="token comment" spellcheck="true">#åˆå§‹åŒ–è¿æ¥æ•°</span><span class="token attr-name">spring.datasource.druid.initial-size</span><span class="token punctuation">=</span><span class="token attr-value">1</span><span class="token comment" spellcheck="true">#æœ€å°ç©ºé—²è¿æ¥</span><span class="token attr-name">spring.datasource.druid.min-idle</span><span class="token punctuation">=</span><span class="token attr-value">1</span><span class="token comment" spellcheck="true">#æœ€å¤§æ´»åŠ¨è¿æ¥</span><span class="token attr-name">spring.datasource.druid.max-active</span><span class="token punctuation">=</span><span class="token attr-value">20</span><span class="token comment" spellcheck="true">#è·å–è¿æ¥æ—¶æµ‹è¯•æ˜¯å¦å¯ç”¨</span><span class="token attr-name">spring.datasource.druid.test-on-borrow</span><span class="token punctuation">=</span><span class="token attr-value">true</span><span class="token comment" spellcheck="true">#ç›‘æ§é¡µé¢å¯åŠ¨</span><span class="token attr-name">spring.datasource.druid.stat-view-servlet.allow</span><span class="token punctuation">=</span><span class="token attr-value">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-3-æ•´åˆmybatis"><a href="#4-3-æ•´åˆmybatis" class="headerlink" title="4.3 æ•´åˆmybatis"></a>4.3 æ•´åˆmybatis</h3><hr><pre class="line-numbers language-xml"><code class="language-xml">// å¯åŠ¨å™¨<span class="token comment" spellcheck="true">&lt;!--mybatis --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.3.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é…ç½®ï¼ŒåŸºæœ¬æ²¡æœ‰éœ€è¦é…ç½®çš„ï¼š</p><pre class="line-numbers language-properties"><code class="language-properties"><span class="token comment" spellcheck="true"># mybatis åˆ«åæ‰«æ</span><span class="token attr-name">mybatis.type-aliases-package</span><span class="token punctuation">=</span><span class="token attr-value">cn.itcast.pojo</span><span class="token comment" spellcheck="true"># mapper.xmlæ–‡ä»¶ä½ç½®,å¦‚æœæ²¡æœ‰æ˜ å°„æ–‡ä»¶ï¼Œå¯ä»¥ä¸è¦</span><span class="token attr-name">mybatis.mapper-locations</span><span class="token punctuation">=</span><span class="token attr-value">classpath:mappers/*.xml</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>éœ€è¦æ³¨æ„ï¼Œè¿™é‡Œæ²¡æœ‰é…ç½®mapperæ¥å£æ‰«æåŒ…ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç»™æ¯ä¸€ä¸ªMapperæ¥å£æ·»åŠ <code>@Mapper</code>æ³¨è§£ï¼Œæ‰èƒ½è¢«è¯†åˆ«ã€‚</p></blockquote><h4 id="4-3-1-é€šç”¨mapper"><a href="#4-3-1-é€šç”¨mapper" class="headerlink" title="4.3.1 é€šç”¨mapper"></a>4.3.1 é€šç”¨mapper</h4><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- é€šç”¨mapper --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>tk.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mapper-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.0.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸éœ€è¦åšä»»ä½•é…ç½®å°±å¯ä»¥ä½¿ç”¨äº†ã€‚</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Mapper</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token keyword">extends</span> <span class="token class-name">tk<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>common<span class="token punctuation">.</span>Mapper</span><span class="token operator">&lt;</span>User<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="4-4-æ•´åˆäº‹åŠ¡"><a href="#4-4-æ•´åˆäº‹åŠ¡" class="headerlink" title="4.4 æ•´åˆäº‹åŠ¡"></a>4.4 æ•´åˆäº‹åŠ¡</h3><p>å…¶å®ï¼Œæˆ‘ä»¬å¼•å…¥jdbcæˆ–è€…webçš„å¯åŠ¨å™¨ï¼Œå°±å·²ç»å¼•å…¥äº‹åŠ¡ç›¸å…³çš„ä¾èµ–åŠé»˜è®¤é…ç½®äº†</p><p>è‡³äºäº‹åŠ¡ï¼ŒSpringBootä¸­é€šè¿‡æ³¨è§£æ¥æ§åˆ¶ã€‚å°±æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„<code>@Transactional</code></p><p>@Service<br>public class UserService {</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span><span class="token keyword">private</span> UserMapper userMapper<span class="token punctuation">;</span><span class="token keyword">public</span> User <span class="token function">queryById</span><span class="token punctuation">(</span>Long id<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userMapper<span class="token punctuation">.</span><span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token annotation punctuation">@Transactional</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteById</span><span class="token punctuation">(</span>Long id<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>userMapper<span class="token punctuation">.</span><span class="token function">deleteByPrimaryKey</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å¤ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxä¸‹æœ‰å…³Mysqlçš„ç›¸å…³å‘½ä»¤</title>
      <link href="/posts/546.html"/>
      <url>/posts/546.html</url>
      
        <content type="html"><![CDATA[<p>è®°å½•linuxä¸‹mysqlçš„ç›¸å…³é—®é¢˜â€¦.</p><p>[TOC]</p><h2 id="1-ä¿®æ”¹åŸæ¥çš„mysqlæ•°æ®åº“å¯†ç "><a href="#1-ä¿®æ”¹åŸæ¥çš„mysqlæ•°æ®åº“å¯†ç " class="headerlink" title="1.ä¿®æ”¹åŸæ¥çš„mysqlæ•°æ®åº“å¯†ç "></a>1.ä¿®æ”¹åŸæ¥çš„mysqlæ•°æ®åº“å¯†ç </h2><p>1.å…ˆç™»å½•mysql</p><pre class="line-numbers language-SAS"><code class="language-SAS">mysql -u root -p<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-SAS"><code class="language-SAS">use mysql;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-SAS"><code class="language-SAS">update user set password=password("æ–°å¯†ç ") where user='root';   <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-SAS"><code class="language-SAS">flush privileges;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-SAS"><code class="language-SAS">exit;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶åä½¿ç”¨åˆšæ‰è¾“å…¥çš„æ–°å¯†ç å³å¯ç™»å½•ã€‚</p><h2 id="2-ä¸çŸ¥é“åŸæ¥çš„myqlçš„rootçš„å¯†ç ï¼›"><a href="#2-ä¸çŸ¥é“åŸæ¥çš„myqlçš„rootçš„å¯†ç ï¼›" class="headerlink" title="2.ä¸çŸ¥é“åŸæ¥çš„myqlçš„rootçš„å¯†ç ï¼›"></a>2.<strong>ä¸çŸ¥é“åŸæ¥çš„myqlçš„rootçš„å¯†ç ï¼›</strong></h2><p>é¦–å…ˆï¼Œä½ å¿…é¡»è¦æœ‰æ“ä½œç³»ç»Ÿçš„rootæƒé™äº†ã€‚</p><p>éœ€è¦å…ˆåœæ­¢mysqlæœåŠ¡ï¼Œ<strong>/etc/init.d/mysqld stop</strong></p><p>å½“æç¤ºmysqlå·²åœæ­¢åè¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œ </p><pre class="line-numbers language-scala"><code class="language-scala">Shutting down MySQL<span class="token punctuation">.</span> SUCCESS<span class="token operator">!</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>åœ¨ç»ˆç«¯å‘½ä»¤è¡Œè¾“å…¥</strong></p><pre class="line-numbers language-SAS"><code class="language-SAS">mysqld_safe --skip-grant-tables &         ã€ç™»å½•mysqlç³»ç»Ÿã€‘<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>è¾“å…¥mysqlç™»å½•mysqlç³»ç»Ÿ</strong></p><pre class="line-numbers language-SAS"><code class="language-SAS">mysql> use mysql;mysql> UPDATE user SET password=password("æ–°å¯†ç ") WHERE user='root';      ã€å¯†ç æ³¨æ„å¤§å°å†™ã€‘mysql> flush privileges;mysql> exit;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>é‡æ–°å¯åŠ¨mysqlæœåŠ¡</strong></p><p>è¿™æ ·æ–°çš„rootå¯†ç å°±è®¾ç½®æˆåŠŸäº†ã€‚</p><h2 id="3-ä¿®æ”¹rootç™»å½•æƒé™"><a href="#3-ä¿®æ”¹rootç™»å½•æƒé™" class="headerlink" title="3.ä¿®æ”¹rootç™»å½•æƒé™"></a>3.<strong>ä¿®æ”¹rootç™»å½•æƒé™</strong></h2><p><strong>å½“ä½ ä¿®æ”¹å¥½rootå¯†ç åï¼Œå¾ˆæœ‰å¯èƒ½å‡ºç°è¿™ç§æƒ…å†µ</strong></p><pre class="line-numbers language-SAS"><code class="language-SAS">ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: YES)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>è¿™æ˜¯å› ä¸ºrootç™»å½•æƒé™ä¸è¶³ï¼Œå…·ä½“ä¿®æ”¹æ–¹æ³•å¦‚ä¸‹</strong></p><p>éœ€è¦å…ˆåœæ­¢mysqlæœåŠ¡ï¼Œ<strong>/etc/init.d/mysqld stop</strong></p><p>å½“æç¤ºmysqlå·²åœæ­¢åè¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œ  </p><p><strong>åœ¨ç»ˆç«¯å‘½ä»¤è¡Œè¾“å…¥</strong></p><pre class="line-numbers language-SAS"><code class="language-SAS">mysqld_safe --skip-grant-tables &         ã€ç™»å½•mysqlç³»ç»Ÿã€‘<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>è¾“å…¥mysqlç™»å½•mysqlç³»ç»Ÿ</strong></p><pre class="line-numbers language-SAS"><code class="language-SAS">mysql>use mysql;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-SAS"><code class="language-SAS">mysql>update user ``set` `host = ``'%'` `where` `user = ``'root'``;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-scala"><code class="language-scala">mysql<span class="token operator">></span>``select` `host<span class="token punctuation">,</span> user ``from` `user<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-scala"><code class="language-scala">mysql<span class="token operator">></span> flush privileges<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-scala"><code class="language-scala">mysql<span class="token operator">></span> exit<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>ç„¶åé‡æ–°å¯åŠ¨mysqlæœåŠ¡å°±å¯ä»¥äº†ã€‚</strong></p><h2 id="4-è§£å†³Access-denied-for-user-â€˜â€™-â€™localhostâ€™-to-database-â€˜mysqlâ€™"><a href="#4-è§£å†³Access-denied-for-user-â€˜â€™-â€™localhostâ€™-to-database-â€˜mysqlâ€™" class="headerlink" title="4. è§£å†³Access denied for user â€˜â€™@â€™localhostâ€™ to database â€˜mysqlâ€™"></a>4. è§£å†³Access denied for user â€˜â€™@â€™localhostâ€™ to database â€˜mysqlâ€™</h2><p>1.å…³é—­mysql:</p><pre class="line-numbers language-SAS"><code class="language-SAS"> service mysqld stop<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶å:</p><pre class="line-numbers language-SAS"><code class="language-SAS">mysqld_safe --skip-grant-tables<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯åŠ¨mysql:</p><pre class="line-numbers language-SAS"><code class="language-SAS">service mysqld start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-SAS"><code class="language-SAS">mysql -u rootmysql> use mysqlmysql> delete from user where user='';mysql> flush privileges;mysql>\q<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> MySql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå®‰è£…Mysql</title>
      <link href="/posts/35752.html"/>
      <url>/posts/35752.html</url>
      
        <content type="html"><![CDATA[<p>Linux é…ç½® Mysql ç¯å¢ƒ;é…äº†å¥½ä¹…ï¼Œç»ˆäºé…èµ·æ¥äº†â€¦â€¦</p><p>[TOC]</p><h2 id="å®‰è£…Mysql"><a href="#å®‰è£…Mysql" class="headerlink" title="å®‰è£…Mysql"></a>å®‰è£…Mysql</h2><p>ç›´æ¥ä¸Šæˆ‘å®‰è£…æˆåŠŸçš„æ­¥éª¤ã€‚ã€‚ã€‚</p><pre class="line-numbers language-sql"><code class="language-sql">yum install wget<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶åè¾“å…¥</p><pre class="line-numbers language-sql"><code class="language-sql">wget <span class="token operator">-</span>i <span class="token operator">-</span><span class="token number">c</span> http:<span class="token comment" spellcheck="true">//dev.mysql.com/get/mysql80-community-release-el7-1.noarch.rpm</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸‹è½½å:</p><pre class="line-numbers language-sql"><code class="language-sql">yum <span class="token operator">-</span>y install mysql80<span class="token operator">-</span>community<span class="token operator">-</span><span class="token keyword">release</span><span class="token operator">-</span>el7<span class="token number">-1</span><span class="token punctuation">.</span>noarch<span class="token punctuation">.</span>rpm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-sql"><code class="language-sql">yum <span class="token operator">-</span>y install mysql<span class="token operator">-</span>community<span class="token operator">-</span>server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="å®‰è£…å®Œæ¯•åè¿è¡Œ"><a href="#å®‰è£…å®Œæ¯•åè¿è¡Œ" class="headerlink" title="å®‰è£…å®Œæ¯•åè¿è¡Œ:"></a>å®‰è£…å®Œæ¯•åè¿è¡Œ:</h3><pre class="line-numbers language-sql"><code class="language-sql">service mysql <span class="token keyword">start</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>[^æˆ‘è¿™é‡ŒæŠ¥é”™äº†]: Failed to start mysql.service: Unit not found.æ²¡æŠ¥é”™è¯·å¿½ç•¥ä»¥ä¸‹å†…å®¹</p><p>â€‹              é¦–å…ˆçœ‹ä¸€ä¸‹æœåŠ¡åˆ—è¡¨é‡Œæœ‰æ²¡æœ‰è¿™ä¸ªæœåŠ¡ï¼š</p><pre class="line-numbers language-sql"><code class="language-sql">systemctl list<span class="token operator">-</span>unit<span class="token operator">-</span>files <span class="token comment" spellcheck="true">--type=service</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>â€‹            ç„¶åæŸ¥æ‰¾mysqlç›¸å…³çš„service</p><p>â€‹            å‘ç°äº†åªæœ‰mysqld.serviceï¼Œæ²¡æœ‰mysql.service</p><p>â€‹            ä½¿ç”¨ service mysqld start èƒ½å¯åŠ¨ï¼Œå¾ˆå¥‡æ€ªã€‚</p><h3 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h3><pre class="line-numbers language-sql"><code class="language-sql">mysql <span class="token operator">-</span>uroot <span class="token operator">-</span>p<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é€šå¸¸ç¬¬ä¸€æ¬¡æ²¡å¯†ç ï¼Œå¦‚æœæœ‰å¯†ç çš„è¯æ‰“å¼€mysqlé»˜è®¤æ—¥å¿—æ–‡ä»¶/var/log/mysqld.log</p><p>æ‰¾åˆ°A temporary passwordâ€¦â€¦é‚£ä¸€è¡Œï¼Œå°±æœ‰å¯†ç äº†;å†’å·åé¢å°±æ˜¯äº†</p><pre class="line-numbers language-sql"><code class="language-sql">å†æ¬¡è¾“å…¥:mysql <span class="token operator">-</span>uroot <span class="token operator">-</span>p<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿›å»</p><p>è¿™ä¸ªå¯†ç ä¸å¥½è®°ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹</p><p>æ ¼å¼alter user â€˜ç”¨æˆ·åâ€˜@â€™ä¸»æœºåâ€™ identified by â€˜æ–°å¯†ç â€™;</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">user</span> <span class="token string">'root'</span>@'localhost<span class="token string">' identified by '</span><span class="token number">123456</span>'<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>æ³¨æ„mySQL8å¼ºåˆ¶è¦æ±‚å¿…é¡»å«å¤§å°å†™å­—æ¯å’Œç‰¹æ®Šç¬¦å·</strong></p><h3 id="å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨çš„Mysql"><a href="#å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨çš„Mysql" class="headerlink" title="å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨çš„Mysql"></a>å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨çš„Mysql</h3><p>å‰æ: 1. ä¸€å®šè¦ åœ¨æœåŠ¡å™¨ä¸Šæ‰“å¼€3306ç«¯å£ ï¼›ä¸ç„¶æ— æ³•è¿æ¥ä¸Šå“ˆ</p><p>â€‹     2.  ç»™MySQLè®¾ç½®ä¸€ä¸ªèƒ½åœ¨ä»»æ„IPåœ°å€ç™»å½•çš„ç”¨æˆ·</p><p>#çœ‹çœ‹MySQLå¯åŠ¨æ²¡æœ‰</p><pre class="line-numbers language-sql"><code class="language-sql">systemctl <span class="token keyword">status</span> mysqld <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p> #æ²¡æœ‰å°±å¯åŠ¨ä¸€å“ˆ</p><pre class="line-numbers language-sql"><code class="language-sql">systemctl <span class="token keyword">start</span> mysqld <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>#å·²ç»å¯åŠ¨äº†</p><p>#é‚£å°±è¿›å…¥ MySQL monitorè®¾ç½®ç”¨æˆ·</p><pre class="line-numbers language-sql"><code class="language-sql">mysql <span class="token operator">-</span>u root <span class="token operator">-</span>p<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™é‡Œä½ å¯ä»¥æ–°å»ºä¸€ä¸ªç”¨æˆ·ï¼Œå¹¶ç»™å®ƒæƒé™ï¼Œè®¾ç½®å®ƒçš„host ä¸ºâ€™%â€™ ç„¶åå°±å¯ä½¿ç”¨SQLyogæ“ä½œæ•°æ®åº“äº†</p><p>/*</p><p>*è¿™é‡Œæˆ‘å°±ç®€å•ç‚¹ï¼Œä¸è®¾ç½®ç”¨æˆ·äº†ï¼Œä½¿ç”¨root</p><p>*é¦–å…ˆåˆ‡æ¢æ•°æ®åº“</p><p>*/</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">use</span> mysql<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>/*</p><p>*ä¿®æ”¹hostä¸º%</p><p>*/</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">update</span> <span class="token keyword">user</span> <span class="token keyword">set</span> host<span class="token operator">=</span><span class="token string">'%'</span> <span class="token keyword">where</span> <span class="token keyword">user</span><span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>/**</p><p>å†ä¿®æ”¹</p><p>*/</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">'root'</span>@'localhost<span class="token string">' IDENTIFIED WITH mysql_native_password BY '</span>password'<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>passwordæ˜¯ä½ è®¾ç½®çš„å¯†ç </p><p>å¦‚æœä¸è¡Œï¼Œå¯ä»¥è¯•ä¸€ä¸‹</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">'root'</span>@'<span class="token operator">%</span><span class="token string">' IDENTIFIED WITH mysql_native_password BY '</span>password'<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶åé‡å¯ç™»å½•:</p><pre class="line-numbers language-sql"><code class="language-sql">systemctl restart mysqld<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="è‹¥è¿˜æ˜¯æŠ¥2003"><a href="#è‹¥è¿˜æ˜¯æŠ¥2003" class="headerlink" title="è‹¥è¿˜æ˜¯æŠ¥2003"></a>è‹¥è¿˜æ˜¯æŠ¥2003</h3><p>è¿˜å¯ä»¥å°è¯•è¿™æ ·:</p><ol><li>éœ€è¦åœ¨cent7ä¸­å¼€æ”¾ç«¯å£ï¼Œå¼€æ”¾ç«¯å£éœ€è¦å¼€å¯é˜²ç«å¢™ã€‚</li></ol><pre class="line-numbers language-sql"><code class="language-sql">  systemctl stop firewalld<span class="token punctuation">.</span>service  å…³é—­é˜²ç«å¢™ã€€ã€€systemctl <span class="token keyword">start</span> firewalld<span class="token punctuation">.</span>service  å¼€å¯é˜²ç«å¢™<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2.æŒ‡å®šéœ€è¦å¼€æ”¾çš„ç«¯å£</p><pre class="line-numbers language-sql"><code class="language-sql">firewall<span class="token operator">-</span>cmd <span class="token comment" spellcheck="true">--zone=public --add-port=3306/tcp --permanent</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿”å›success</p><p>3.é‡æ–°åŠ è½½é˜²ç«å¢™</p><pre class="line-numbers language-sql"><code class="language-sql">firewall<span class="token operator">-</span>cmd <span class="token comment" spellcheck="true">--reload</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>4.æŸ¥çœ‹å¼€æ”¾çš„ç«¯å£</p><pre class="line-numbers language-sql"><code class="language-sql">firewall<span class="token operator">-</span>cmd <span class="token comment" spellcheck="true">--list-ports</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶åå†æµ‹è¯•è¿æ¥ï¼Œå·®ä¸å¤šå°±è¿™æ ·â€¦.</p><h2 id="æŸ¥çœ‹mysqlçš„ç«¯å£"><a href="#æŸ¥çœ‹mysqlçš„ç«¯å£" class="headerlink" title="æŸ¥çœ‹mysqlçš„ç«¯å£"></a>æŸ¥çœ‹mysqlçš„ç«¯å£</h2><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">show</span> <span class="token keyword">global</span> variables <span class="token operator">like</span> <span class="token string">'port'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLåŸºç¡€</title>
      <link href="/posts/39026.html"/>
      <url>/posts/39026.html</url>
      
        <content type="html"><![CDATA[<p>ä»Šæ—¥å†…å®¹ï¼šè®°å½•å¸¸ç”¨sqlå‘½ä»¤</p><h1 id="æ•°æ®åº“çš„åŸºæœ¬æ¦‚å¿µ"><a href="#æ•°æ®åº“çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="æ•°æ®åº“çš„åŸºæœ¬æ¦‚å¿µ"></a>æ•°æ®åº“çš„åŸºæœ¬æ¦‚å¿µ</h1><pre class="line-numbers language-java"><code class="language-java"><span class="token number">1</span><span class="token punctuation">.</span> æ•°æ®åº“çš„è‹±æ–‡å•è¯ï¼š DataBase ç®€ç§° ï¼š DB<span class="token number">2</span><span class="token punctuation">.</span> ä»€ä¹ˆæ•°æ®åº“ï¼Ÿ    <span class="token operator">*</span> ç”¨äºå­˜å‚¨å’Œç®¡ç†æ•°æ®çš„ä»“åº“ã€‚<span class="token number">3</span><span class="token punctuation">.</span> æ•°æ®åº“çš„ç‰¹ç‚¹ï¼š    <span class="token number">1</span><span class="token punctuation">.</span> æŒä¹…åŒ–å­˜å‚¨æ•°æ®çš„ã€‚å…¶å®æ•°æ®åº“å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿ    <span class="token number">2</span><span class="token punctuation">.</span> æ–¹ä¾¿å­˜å‚¨å’Œç®¡ç†æ•°æ®    <span class="token number">3</span><span class="token punctuation">.</span> ä½¿ç”¨äº†ç»Ÿä¸€çš„æ–¹å¼æ“ä½œæ•°æ®åº“ <span class="token operator">--</span> SQL<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="MySqlæ•°æ®åº“è½¯ä»¶"><a href="#MySqlæ•°æ®åº“è½¯ä»¶" class="headerlink" title="MySqlæ•°æ®åº“è½¯ä»¶"></a>MySqlæ•°æ®åº“è½¯ä»¶</h1><h3 id="1-å¸è½½"><a href="#1-å¸è½½" class="headerlink" title="1. å¸è½½"></a>1. å¸è½½</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token number">1</span><span class="token punctuation">.</span> å»mysqlçš„å®‰è£…ç›®å½•æ‰¾åˆ°my<span class="token punctuation">.</span>iniæ–‡ä»¶        <span class="token operator">*</span> å¤åˆ¶ datadir<span class="token operator">=</span><span class="token string">"C:/ProgramData/MySQL/MySQL Server 5.5/Data/"</span>    <span class="token number">2</span><span class="token punctuation">.</span> å¸è½½MySQL    <span class="token number">3</span><span class="token punctuation">.</span> åˆ é™¤C<span class="token operator">:</span><span class="token operator">/</span>ProgramDataç›®å½•ä¸‹çš„MySQLæ–‡ä»¶å¤¹ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-é…ç½®"><a href="#2-é…ç½®" class="headerlink" title="2. é…ç½®"></a>2. é…ç½®</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">*</span> MySQLæœåŠ¡å¯åŠ¨        <span class="token number">1</span><span class="token punctuation">.</span> æ‰‹åŠ¨ã€‚        <span class="token number">2</span><span class="token punctuation">.</span> cmd<span class="token operator">--</span><span class="token operator">></span> services<span class="token punctuation">.</span>msc æ‰“å¼€æœåŠ¡çš„çª—å£        <span class="token number">3</span><span class="token punctuation">.</span> ä½¿ç”¨ç®¡ç†å‘˜æ‰“å¼€cmd            <span class="token operator">*</span> net start mysql <span class="token operator">:</span> å¯åŠ¨mysqlçš„æœåŠ¡            <span class="token operator">*</span> net stop mysql<span class="token operator">:</span>å…³é—­mysqlæœåŠ¡    <span class="token operator">*</span> MySQLç™»å½•        <span class="token number">1</span><span class="token punctuation">.</span> mysql <span class="token operator">-</span>uroot <span class="token operator">-</span>på¯†ç         <span class="token number">2</span><span class="token punctuation">.</span> mysql <span class="token operator">-</span>hip <span class="token operator">-</span>uroot <span class="token operator">-</span>pè¿æ¥ç›®æ ‡çš„å¯†ç         <span class="token number">3</span><span class="token punctuation">.</span> mysql <span class="token operator">--</span>host<span class="token operator">=</span>ip <span class="token operator">--</span>user<span class="token operator">=</span>root <span class="token operator">--</span>password<span class="token operator">=</span>è¿æ¥ç›®æ ‡çš„å¯†ç     <span class="token operator">*</span> MySQLé€€å‡º        <span class="token number">1</span><span class="token punctuation">.</span> exit        <span class="token number">2</span><span class="token punctuation">.</span> quit    <span class="token operator">*</span> MySQLç›®å½•ç»“æ„        <span class="token number">1</span><span class="token punctuation">.</span> MySQLå®‰è£…ç›®å½•ï¼šbasedir<span class="token operator">=</span><span class="token string">"D:/develop/MySQL/"</span>            <span class="token operator">*</span> é…ç½®æ–‡ä»¶ my<span class="token punctuation">.</span>ini        <span class="token number">2</span><span class="token punctuation">.</span> MySQLæ•°æ®ç›®å½•ï¼šdatadir<span class="token operator">=</span><span class="token string">"C:/ProgramData/MySQL/MySQL Server 5.5/Data/"</span>            <span class="token operator">*</span> å‡ ä¸ªæ¦‚å¿µ                <span class="token operator">*</span> æ•°æ®åº“ï¼šæ–‡ä»¶å¤¹                <span class="token operator">*</span> è¡¨ï¼šæ–‡ä»¶                <span class="token operator">*</span> æ•°æ®ï¼šæ•°æ®<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h1><h3 id="1-åŸºæœ¬æ¦‚å¿µ"><a href="#1-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1.  åŸºæœ¬æ¦‚å¿µ"></a>1.  åŸºæœ¬æ¦‚å¿µ</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token number">1</span><span class="token punctuation">.</span>ä»€ä¹ˆæ˜¯SQLï¼Ÿ    Structured Query Languageï¼šç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€    å…¶å®å°±æ˜¯å®šä¹‰äº†æ“ä½œæ‰€æœ‰å…³ç³»å‹æ•°æ®åº“çš„è§„åˆ™ã€‚æ¯ä¸€ç§æ•°æ®åº“æ“ä½œçš„æ–¹å¼å­˜åœ¨ä¸ä¸€æ ·çš„åœ°æ–¹ï¼Œç§°ä¸ºâ€œæ–¹è¨€â€ã€‚<span class="token number">2</span><span class="token punctuation">.</span>SQLé€šç”¨è¯­æ³•    <span class="token number">1</span><span class="token punctuation">.</span> SQL è¯­å¥å¯ä»¥å•è¡Œæˆ–å¤šè¡Œä¹¦å†™ï¼Œä»¥åˆ†å·ç»“å°¾ã€‚    <span class="token number">2</span><span class="token punctuation">.</span> å¯ä½¿ç”¨ç©ºæ ¼å’Œç¼©è¿›æ¥å¢å¼ºè¯­å¥çš„å¯è¯»æ€§ã€‚    <span class="token number">3</span><span class="token punctuation">.</span> MySQL æ•°æ®åº“çš„ SQL è¯­å¥ä¸åŒºåˆ†å¤§å°å†™ï¼Œå…³é”®å­—å»ºè®®ä½¿ç”¨å¤§å†™ã€‚    <span class="token number">4</span><span class="token punctuation">.</span> <span class="token number">3</span> ç§æ³¨é‡Š        <span class="token operator">*</span> å•è¡Œæ³¨é‡Š<span class="token operator">:</span> <span class="token operator">--</span> æ³¨é‡Šå†…å®¹ æˆ– # æ³¨é‡Šå†…å®¹<span class="token punctuation">(</span>mysql ç‰¹æœ‰<span class="token punctuation">)</span>         <span class="token operator">*</span> å¤šè¡Œæ³¨é‡Š<span class="token operator">:</span> <span class="token comment" spellcheck="true">/* æ³¨é‡Š */</span><span class="token number">3</span><span class="token punctuation">.</span> SQLåˆ†ç±»    <span class="token number">1</span><span class="token punctuation">)</span> <span class="token function">DDL</span><span class="token punctuation">(</span>Data Definition Language<span class="token punctuation">)</span>æ•°æ®å®šä¹‰è¯­è¨€        ç”¨æ¥å®šä¹‰æ•°æ®åº“å¯¹è±¡ï¼šæ•°æ®åº“ï¼Œè¡¨ï¼Œåˆ—ç­‰ã€‚å…³é”®å­—ï¼šcreate<span class="token punctuation">,</span> drop<span class="token punctuation">,</span>alter ç­‰    <span class="token number">2</span><span class="token punctuation">)</span> <span class="token function">DML</span><span class="token punctuation">(</span>Data Manipulation Language<span class="token punctuation">)</span>æ•°æ®æ“ä½œè¯­è¨€        ç”¨æ¥å¯¹æ•°æ®åº“ä¸­è¡¨çš„æ•°æ®è¿›è¡Œå¢åˆ æ”¹ã€‚å…³é”®å­—ï¼šinsert<span class="token punctuation">,</span> delete<span class="token punctuation">,</span> update ç­‰    <span class="token number">3</span><span class="token punctuation">)</span> <span class="token function">DQL</span><span class="token punctuation">(</span>Data Query Language<span class="token punctuation">)</span>æ•°æ®æŸ¥è¯¢è¯­è¨€        ç”¨æ¥æŸ¥è¯¢æ•°æ®åº“ä¸­è¡¨çš„è®°å½•<span class="token punctuation">(</span>æ•°æ®<span class="token punctuation">)</span>ã€‚å…³é”®å­—ï¼šselect<span class="token punctuation">,</span> where ç­‰    <span class="token number">4</span><span class="token punctuation">)</span> <span class="token function">DCL</span><span class="token punctuation">(</span>Data Control Language<span class="token punctuation">)</span>æ•°æ®æ§åˆ¶è¯­è¨€<span class="token punctuation">(</span>äº†è§£<span class="token punctuation">)</span>        ç”¨æ¥å®šä¹‰æ•°æ®åº“çš„è®¿é—®æƒé™å’Œå®‰å…¨çº§åˆ«ï¼ŒåŠåˆ›å»ºç”¨æˆ·ã€‚å…³é”®å­—ï¼šGRANTï¼Œ REVOKE ç­‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-DDL-æ“ä½œæ•°æ®åº“ã€è¡¨"><a href="#2-DDL-æ“ä½œæ•°æ®åº“ã€è¡¨" class="headerlink" title="2. DDL:æ“ä½œæ•°æ®åº“ã€è¡¨"></a>2. DDL:æ“ä½œæ•°æ®åº“ã€è¡¨</h3><h4 id="1-æ“ä½œæ•°æ®åº“ï¼šCRUD"><a href="#1-æ“ä½œæ•°æ®åº“ï¼šCRUD" class="headerlink" title="1.  æ“ä½œæ•°æ®åº“ï¼šCRUD"></a>1.  æ“ä½œæ•°æ®åº“ï¼šCRUD</h4><h5 id="1-C-Create-åˆ›å»º"><a href="#1-C-Create-åˆ›å»º" class="headerlink" title="1.C(Create):åˆ›å»º"></a>1.C(Create):åˆ›å»º</h5><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">*</span>  åˆ›å»ºæ•°æ®åº“ï¼š    â€‹ <span class="token operator">*</span> create database æ•°æ®åº“åç§°<span class="token punctuation">;</span>    â€‹ <span class="token operator">*</span> åˆ›å»ºæ•°æ®åº“ï¼Œåˆ¤æ–­ä¸å­˜åœ¨ï¼Œå†åˆ›å»ºï¼š    â€‹ <span class="token operator">*</span> create database <span class="token keyword">if</span> not exists æ•°æ®åº“åç§°<span class="token punctuation">;</span>    â€‹ <span class="token operator">*</span> åˆ›å»ºæ•°æ®åº“ï¼Œå¹¶æŒ‡å®šå­—ç¬¦é›†    â€‹ <span class="token operator">*</span> create database æ•°æ®åº“åç§° character set å­—ç¬¦é›†å<span class="token punctuation">;</span>    â€‹ <span class="token operator">*</span> ç»ƒä¹ ï¼š åˆ›å»ºdb4æ•°æ®åº“ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼Œå¹¶åˆ¶å®šå­—ç¬¦é›†ä¸ºgbk    â€‹ <span class="token operator">*</span> create database <span class="token keyword">if</span> not exists db4 character set gbk<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2-R-Retrieve-ï¼šæŸ¥è¯¢"><a href="#2-R-Retrieve-ï¼šæŸ¥è¯¢" class="headerlink" title="2.R(Retrieve)ï¼šæŸ¥è¯¢"></a>2.R(Retrieve)ï¼šæŸ¥è¯¢</h5><p>â€‹            </p><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">*</span> æŸ¥è¯¢æ‰€æœ‰æ•°æ®åº“çš„åç§°<span class="token operator">:</span>  â€‹    <span class="token operator">*</span> show databases<span class="token punctuation">;</span>  â€‹    <span class="token operator">*</span> æŸ¥è¯¢æŸä¸ªæ•°æ®åº“çš„å­—ç¬¦é›†<span class="token operator">:</span>æŸ¥è¯¢æŸä¸ªæ•°æ®åº“çš„åˆ›å»ºè¯­å¥  â€‹    <span class="token operator">*</span> show create database æ•°æ®åº“åç§°<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3-U-Update-ä¿®æ”¹"><a href="#3-U-Update-ä¿®æ”¹" class="headerlink" title="3. U(Update):ä¿®æ”¹"></a>3. U(Update):ä¿®æ”¹</h5><p>â€‹            </p><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">*</span> ä¿®æ”¹æ•°æ®åº“çš„å­—ç¬¦é›†  â€‹    <span class="token operator">*</span> alter database æ•°æ®åº“åç§° character set å­—ç¬¦é›†åç§°<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h5 id="4-D-Delete-åˆ é™¤"><a href="#4-D-Delete-åˆ é™¤" class="headerlink" title="4. D(Delete):åˆ é™¤"></a>4. D(Delete):åˆ é™¤</h5><p>â€‹                </p><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">*</span> åˆ é™¤æ•°æ®åº“    â€‹  <span class="token operator">*</span> drop database æ•°æ®åº“åç§°<span class="token punctuation">;</span>    â€‹  <span class="token operator">*</span> åˆ¤æ–­æ•°æ®åº“å­˜åœ¨ï¼Œå­˜åœ¨å†åˆ é™¤    â€‹  <span class="token operator">*</span> drop database <span class="token keyword">if</span> exists æ•°æ®åº“åç§°<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="5-ä½¿ç”¨æ•°æ®åº“"><a href="#5-ä½¿ç”¨æ•°æ®åº“" class="headerlink" title="5. ä½¿ç”¨æ•°æ®åº“"></a>5. ä½¿ç”¨æ•°æ®åº“</h5><p>â€‹            </p><pre class="line-numbers language-java"><code class="language-java">                <span class="token operator">*</span> æŸ¥è¯¢å½“å‰æ­£åœ¨ä½¿ç”¨çš„æ•°æ®åº“åç§°â€‹                        <span class="token operator">*</span> select <span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>â€‹                <span class="token operator">*</span> ä½¿ç”¨æ•°æ®åº“â€‹                        <span class="token operator">*</span> use æ•°æ®åº“åç§°<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2-æ“ä½œè¡¨"><a href="#2-æ“ä½œè¡¨" class="headerlink" title="2. æ“ä½œè¡¨"></a>2. æ“ä½œè¡¨</h4><h5 id="1-C-Create-åˆ›å»º-1"><a href="#1-C-Create-åˆ›å»º-1" class="headerlink" title="1. C(Create):åˆ›å»º"></a>1. C(Create):åˆ›å»º</h5><pre class="line-numbers language-java"><code class="language-java"><span class="token number">1</span><span class="token punctuation">.</span> è¯­æ³•ï¼š    create table è¡¨å<span class="token punctuation">(</span>        åˆ—å<span class="token number">1</span> æ•°æ®ç±»å‹<span class="token number">1</span><span class="token punctuation">,</span>        åˆ—å<span class="token number">2</span> æ•°æ®ç±»å‹<span class="token number">2</span><span class="token punctuation">,</span>            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>        åˆ—ån æ•°æ®ç±»å‹n    <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token operator">*</span> æ³¨æ„ï¼šæœ€åä¸€åˆ—ï¼Œä¸éœ€è¦åŠ é€—å·ï¼ˆ<span class="token punctuation">,</span>ï¼‰        <span class="token operator">*</span> æ•°æ®åº“ç±»å‹ï¼š        <span class="token number">1</span><span class="token punctuation">.</span> <span class="token keyword">int</span>ï¼šæ•´æ•°ç±»å‹            <span class="token operator">*</span> age <span class="token keyword">int</span><span class="token punctuation">,</span>        <span class="token number">2</span><span class="token punctuation">.</span> <span class="token keyword">double</span><span class="token operator">:</span>å°æ•°ç±»å‹        <span class="token operator">*</span> score <span class="token keyword">double</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>    <span class="token number">3</span><span class="token punctuation">.</span> date<span class="token operator">:</span>æ—¥æœŸï¼ŒåªåŒ…å«å¹´æœˆæ—¥ï¼Œyyyy<span class="token operator">-</span>MM<span class="token operator">-</span>dd    <span class="token number">4</span><span class="token punctuation">.</span> datetime<span class="token operator">:</span>æ—¥æœŸï¼ŒåŒ…å«å¹´æœˆæ—¥æ—¶åˆ†ç§’     yyyy<span class="token operator">-</span>MM<span class="token operator">-</span>dd HH<span class="token operator">:</span>mm<span class="token operator">:</span>ss        <span class="token number">5</span><span class="token punctuation">.</span> timestamp<span class="token operator">:</span>æ—¶é—´é”™ç±»å‹    åŒ…å«å¹´æœˆæ—¥æ—¶åˆ†ç§’     yyyy<span class="token operator">-</span>MM<span class="token operator">-</span>dd HH<span class="token operator">:</span>mm<span class="token operator">:</span>ss        <span class="token operator">*</span> å¦‚æœå°†æ¥ä¸ç»™è¿™ä¸ªå­—æ®µèµ‹å€¼ï¼Œæˆ–èµ‹å€¼ä¸ºnullï¼Œåˆ™é»˜è®¤ä½¿ç”¨å½“å‰çš„ç³»ç»Ÿæ—¶é—´ï¼Œæ¥è‡ªåŠ¨èµ‹å€¼<span class="token number">6</span><span class="token punctuation">.</span> varcharï¼šå­—ç¬¦ä¸²        <span class="token operator">*</span> name <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token operator">:</span>å§“åæœ€å¤§<span class="token number">20</span>ä¸ªå­—ç¬¦                <span class="token operator">*</span>            zhangsan <span class="token number">8</span>ä¸ªå­—ç¬¦  å¼ ä¸‰ <span class="token number">2</span>ä¸ªå­—ç¬¦<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹:"></a>ç¤ºä¾‹:</h6><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">*</span> åˆ›å»ºè¡¨            create table <span class="token function">student</span><span class="token punctuation">(</span>            id <span class="token keyword">int</span><span class="token punctuation">,</span>            name <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            age <span class="token keyword">int</span> <span class="token punctuation">,</span>                score <span class="token keyword">double</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            birthday date<span class="token punctuation">,</span>            insert_time timestamp            <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">*</span> å¤åˆ¶è¡¨ï¼š            <span class="token operator">*</span> create table è¡¨å like è¢«å¤åˆ¶çš„è¡¨å<span class="token punctuation">;</span>          <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2-R-Retrieve-ï¼šæŸ¥è¯¢-è¡¨åç§°å’Œ-è¡¨ç»“æ„"><a href="#2-R-Retrieve-ï¼šæŸ¥è¯¢-è¡¨åç§°å’Œ-è¡¨ç»“æ„" class="headerlink" title="2.  R(Retrieve)ï¼šæŸ¥è¯¢ è¡¨åç§°å’Œ è¡¨ç»“æ„"></a>2.  R(Retrieve)ï¼šæŸ¥è¯¢ è¡¨åç§°å’Œ è¡¨ç»“æ„</h5><pre class="line-numbers language-java"><code class="language-java">        <span class="token operator">*</span> æŸ¥è¯¢æŸä¸ªæ•°æ®åº“ä¸­æ‰€æœ‰çš„è¡¨åç§°            <span class="token operator">*</span> show tables<span class="token punctuation">;</span>        <span class="token operator">*</span> æŸ¥è¯¢è¡¨ç»“æ„            <span class="token operator">*</span> desc è¡¨å<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="3-U-Update-ä¿®æ”¹-è¡¨çš„ç›¸å…³å±æ€§"><a href="#3-U-Update-ä¿®æ”¹-è¡¨çš„ç›¸å…³å±æ€§" class="headerlink" title="3.  U(Update):ä¿®æ”¹ è¡¨çš„ç›¸å…³å±æ€§"></a>3.  U(Update):ä¿®æ”¹ è¡¨çš„ç›¸å…³å±æ€§</h5><pre class="line-numbers language-java"><code class="language-java"><span class="token number">1</span><span class="token punctuation">.</span> ä¿®æ”¹è¡¨å            alter table è¡¨å rename to æ–°çš„è¡¨å<span class="token punctuation">;</span>    <span class="token number">2</span><span class="token punctuation">.</span> ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†            alter table è¡¨å character set å­—ç¬¦é›†åç§°<span class="token punctuation">;</span>    <span class="token number">3</span><span class="token punctuation">.</span> æ·»åŠ ä¸€åˆ—            alter table è¡¨å add åˆ—å æ•°æ®ç±»å‹<span class="token punctuation">;</span>    <span class="token number">4</span><span class="token punctuation">.</span> ä¿®æ”¹åˆ—åç§° ç±»å‹            alter table è¡¨å change åˆ—å æ–°åˆ—åˆ« æ–°æ•°æ®ç±»å‹<span class="token punctuation">;</span>                 alter table è¡¨å modify åˆ—å æ–°æ•°æ®ç±»å‹<span class="token punctuation">;</span>    <span class="token number">5</span><span class="token punctuation">.</span> åˆ é™¤åˆ—            alter table è¡¨å drop åˆ—å<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="4-D-Delete-åˆ é™¤-1"><a href="#4-D-Delete-åˆ é™¤-1" class="headerlink" title="4.  D(Delete):åˆ é™¤"></a>4.  D(Delete):åˆ é™¤</h5><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">*</span> drop table è¡¨å<span class="token punctuation">;</span>    <span class="token operator">*</span> drop table  <span class="token keyword">if</span> exists è¡¨å <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="3-DMLï¼šå¢åˆ æ”¹è¡¨ä¸­æ•°æ®"><a href="#3-DMLï¼šå¢åˆ æ”¹è¡¨ä¸­æ•°æ®" class="headerlink" title="3. DMLï¼šå¢åˆ æ”¹è¡¨ä¸­æ•°æ®"></a>3. DMLï¼šå¢åˆ æ”¹è¡¨ä¸­æ•°æ®</h3><p>#### </p><h4 id="1-æ·»åŠ æ•°æ®ï¼š"><a href="#1-æ·»åŠ æ•°æ®ï¼š" class="headerlink" title="1.  æ·»åŠ æ•°æ®ï¼š"></a>1.  æ·»åŠ æ•°æ®ï¼š</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">*</span> è¯­æ³•ï¼š        <span class="token operator">*</span> insert into è¡¨å<span class="token punctuation">(</span>åˆ—å<span class="token number">1</span><span class="token punctuation">,</span>åˆ—å<span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>åˆ—ån<span class="token punctuation">)</span> <span class="token function">values</span><span class="token punctuation">(</span>å€¼<span class="token number">1</span><span class="token punctuation">,</span>å€¼<span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>å€¼n<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token operator">*</span> æ³¨æ„ï¼š                <span class="token number">1</span><span class="token punctuation">.</span> åˆ—åå’Œå€¼è¦ä¸€ä¸€å¯¹åº”ã€‚            <span class="token number">2</span><span class="token punctuation">.</span> å¦‚æœè¡¨ååï¼Œä¸å®šä¹‰åˆ—åï¼Œåˆ™é»˜è®¤ç»™æ‰€æœ‰åˆ—æ·»åŠ å€¼                    insert into è¡¨å <span class="token function">values</span><span class="token punctuation">(</span>å€¼<span class="token number">1</span><span class="token punctuation">,</span>å€¼<span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>å€¼n<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token number">3</span><span class="token punctuation">.</span> é™¤äº†æ•°å­—ç±»å‹ï¼Œå…¶ä»–ç±»å‹éœ€è¦ä½¿ç”¨å¼•å·<span class="token punctuation">(</span>å•åŒéƒ½å¯ä»¥<span class="token punctuation">)</span>å¼•èµ·æ¥<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-åˆ é™¤æ•°æ®ï¼š"><a href="#2-åˆ é™¤æ•°æ®ï¼š" class="headerlink" title="2. åˆ é™¤æ•°æ®ï¼š"></a>2. åˆ é™¤æ•°æ®ï¼š</h4><h5 id><a href="#" class="headerlink" title=" "></a> </h5><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">*</span> è¯­æ³•ï¼š        <span class="token operator">*</span> delete from è¡¨å <span class="token punctuation">[</span>where æ¡ä»¶<span class="token punctuation">]</span>        <span class="token operator">*</span> æ³¨æ„ï¼š            <span class="token number">1</span><span class="token punctuation">.</span> å¦‚æœä¸åŠ æ¡ä»¶ï¼Œåˆ™åˆ é™¤è¡¨ä¸­æ‰€æœ‰è®°å½•ã€‚        <span class="token number">2</span><span class="token punctuation">.</span> å¦‚æœè¦åˆ é™¤æ‰€æœ‰è®°å½•                <span class="token number">1</span><span class="token punctuation">.</span> delete from è¡¨å<span class="token punctuation">;</span> <span class="token operator">--</span> ä¸æ¨èä½¿ç”¨ã€‚æœ‰å¤šå°‘æ¡è®°å½•å°±ä¼šæ‰§è¡Œå¤šå°‘æ¬¡åˆ é™¤æ“ä½œ                 <span class="token number">2</span><span class="token punctuation">.</span> TRUNCATE TABLE è¡¨å<span class="token punctuation">;</span> <span class="token operator">--</span> æ¨èä½¿ç”¨ï¼Œæ•ˆç‡æ›´é«˜ å…ˆåˆ é™¤è¡¨ï¼Œç„¶åå†åˆ›å»ºä¸€å¼ ä¸€æ ·çš„è¡¨ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-ä¿®æ”¹æ•°æ®ï¼š"><a href="#3-ä¿®æ”¹æ•°æ®ï¼š" class="headerlink" title="3. ä¿®æ”¹æ•°æ®ï¼š"></a>3. ä¿®æ”¹æ•°æ®ï¼š</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">*</span> è¯­æ³•ï¼š        <span class="token operator">*</span> update è¡¨å set åˆ—å<span class="token number">1</span> <span class="token operator">=</span> å€¼<span class="token number">1</span><span class="token punctuation">,</span> åˆ—å<span class="token number">2</span> <span class="token operator">=</span> å€¼<span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span>where æ¡ä»¶<span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token operator">*</span> æ³¨æ„ï¼š           <span class="token number">1</span><span class="token punctuation">.</span> å¦‚æœä¸åŠ ä»»ä½•æ¡ä»¶ï¼Œåˆ™ä¼šå°†è¡¨ä¸­æ‰€æœ‰è®°å½•å…¨éƒ¨ä¿®æ”¹ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-DQLï¼šæŸ¥è¯¢è¡¨ä¸­çš„è®°å½•"><a href="#4-DQLï¼šæŸ¥è¯¢è¡¨ä¸­çš„è®°å½•" class="headerlink" title="4.DQLï¼šæŸ¥è¯¢è¡¨ä¸­çš„è®°å½•"></a>4.DQLï¼šæŸ¥è¯¢è¡¨ä¸­çš„è®°å½•</h3><ul><li>select * from è¡¨å;</li></ul><h4 id="1-æ’åºæŸ¥è¯¢ï¼š"><a href="#1-æ’åºæŸ¥è¯¢ï¼š" class="headerlink" title="1. æ’åºæŸ¥è¯¢ï¼š"></a>1. æ’åºæŸ¥è¯¢ï¼š</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">*</span>è¯­æ³• ï¼šorder by å­å¥        <span class="token operator">*</span>order by æ’åºå­—æ®µ<span class="token number">1</span> æ’åºæ–¹å¼<span class="token number">1</span>ï¼Œ æ’åºå­—æ®µ<span class="token number">2</span> æ’åºæ–¹å¼<span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token operator">*</span>æ’åºæ–¹å¼ï¼š            <span class="token operator">*</span>ASC<span class="token operator">:</span>å‡åºï¼Œé»˜è®¤çš„                <span class="token operator">*</span>DESC<span class="token operator">:</span>é™åºçš„ï¼Œ             <span class="token operator">*</span>æ³¨æ„ï¼š                <span class="token operator">*</span>å¦‚æœæœ‰å¤šä¸ªæ’åºæ¡ä»¶ï¼Œå‰é¢çš„æ¡ä»¶å€¼ä¸€æ ·æ—¶ï¼Œæ‰ä¼šåˆ¤æ–­ç¬¬äºŒæ¡ä»¶<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-èšåˆå‡½æ•°"><a href="#2-èšåˆå‡½æ•°" class="headerlink" title="2. èšåˆå‡½æ•°:"></a>2. èšåˆå‡½æ•°:</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token number">1</span><span class="token punctuation">.</span>count<span class="token operator">:</span>è®¡ç®—ä¸ªæ•°    <span class="token number">1</span><span class="token punctuation">.</span>ä¸€èˆ¬é€‰æ‹©éç©ºçš„åˆ—ï¼šä¸»é”®        <span class="token number">2</span><span class="token punctuation">.</span>countï¼ˆ<span class="token operator">*</span>ï¼‰SELECT <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token function">IFNULL</span><span class="token punctuation">(</span>english<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> FROM student3<span class="token punctuation">;</span><span class="token number">2</span><span class="token punctuation">.</span>max<span class="token operator">:</span>æœ€å¤§å€¼        <span class="token number">3</span><span class="token punctuation">.</span>minï¼šæœ€å°å€¼<span class="token number">4</span><span class="token punctuation">.</span>sumï¼šæ±‚å’Œ<span class="token number">5</span><span class="token punctuation">.</span>avgï¼šè®¡ç®—å¹³å‡å€¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java"><code class="language-java">    <span class="token operator">*</span>æ³¨æ„ï¼šèšåˆå‡½æ•°çš„è®¡ç®—ä¼šæ’é™¤nullå€¼<span class="token punctuation">.</span><span class="token punctuation">.</span>        <span class="token operator">*</span>è§£å†³æ–¹æ³•ï¼š            <span class="token number">1</span><span class="token punctuation">.</span>é€‰æ‹©ä¸åŒ…å«éç©ºçš„åˆ—ï¼›                <span class="token number">2</span><span class="token punctuation">.</span>IFNULLå‡½æ•°    <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="3-åˆ†ç»„æŸ¥è¯¢ï¼š"><a href="#3-åˆ†ç»„æŸ¥è¯¢ï¼š" class="headerlink" title="3.åˆ†ç»„æŸ¥è¯¢ï¼š"></a>3.åˆ†ç»„æŸ¥è¯¢ï¼š</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token number">1</span><span class="token punctuation">.</span>è¯­æ³•ï¼šgroup by åˆ†ç»„å­—æ®µ<span class="token punctuation">;</span><span class="token number">2</span><span class="token punctuation">.</span>æ³¨æ„ï¼š        <span class="token number">1</span><span class="token punctuation">.</span>åˆ†ç»„ä¹‹åæŸ¥è¯¢çš„å­—æ®µï¼šåˆ†ç»„å­—æ®µï¼Œèšåˆå‡½æ•°        <span class="token number">2</span><span class="token punctuation">.</span>where å’Œ having çš„åŒºåˆ«ï¼Ÿ                <span class="token number">1</span><span class="token punctuation">.</span>where åœ¨åˆ†ç»„ä¹‹å‰è¿›è¡Œé™å®šã€‚å¦‚æœä¸æ»¡è¶³æ¡ä»¶ï¼Œåˆ™ä¸å‚ä¸åˆ†ç»„          havingåœ¨åˆ†ç»„ä¹‹åè¿›è¡Œé™å®šã€‚å¦‚æœä¸æ»¡è¶³æ¡ä»¶ï¼Œåˆ™ä¸ä¼šè¢«æŸ¥è¯¢å‡ºæ¥ã€‚                    <span class="token number">2</span><span class="token punctuation">.</span>whereåä¸å¯ä»¥è·Ÿèšåˆå‡½æ•°ï¼Œhavingå¯ä»¥è·Ÿèšåˆå‡½æ•°<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java"><code class="language-java"><span class="token number">1</span><span class="token punctuation">.</span> è¯­æ³•ï¼š    select        å­—æ®µåˆ—è¡¨    from        è¡¨ååˆ—è¡¨    where        æ¡ä»¶åˆ—è¡¨    group by        åˆ†ç»„å­—æ®µ    having        åˆ†ç»„ä¹‹åçš„æ¡ä»¶    order by        æ’åº    limit        åˆ†é¡µé™å®š<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="4-åŸºç¡€æŸ¥è¯¢"><a href="#4-åŸºç¡€æŸ¥è¯¢" class="headerlink" title="4.  åŸºç¡€æŸ¥è¯¢"></a>4.  åŸºç¡€æŸ¥è¯¢</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token number">1</span><span class="token punctuation">.</span> å¤šä¸ªå­—æ®µçš„æŸ¥è¯¢        select å­—æ®µå<span class="token number">1</span>ï¼Œå­—æ®µå<span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> from è¡¨åï¼›    <span class="token operator">*</span> æ³¨æ„ï¼š            <span class="token operator">*</span> å¦‚æœæŸ¥è¯¢æ‰€æœ‰å­—æ®µï¼Œåˆ™å¯ä»¥ä½¿ç”¨<span class="token operator">*</span>æ¥æ›¿ä»£å­—æ®µåˆ—è¡¨ã€‚<span class="token number">2</span><span class="token punctuation">.</span> å»é™¤é‡å¤ï¼š        <span class="token operator">*</span> distinct<span class="token number">3</span><span class="token punctuation">.</span> è®¡ç®—åˆ—            <span class="token operator">*</span> ä¸€èˆ¬å¯ä»¥ä½¿ç”¨å››åˆ™è¿ç®—è®¡ç®—ä¸€äº›åˆ—çš„å€¼ã€‚ï¼ˆä¸€èˆ¬åªä¼šè¿›è¡Œæ•°å€¼å‹çš„è®¡ç®—ï¼‰            <span class="token operator">*</span> <span class="token function">ifnull</span><span class="token punctuation">(</span>è¡¨è¾¾å¼<span class="token number">1</span><span class="token punctuation">,</span>è¡¨è¾¾å¼<span class="token number">2</span><span class="token punctuation">)</span>ï¼šnullå‚ä¸çš„è¿ç®—ï¼Œè®¡ç®—ç»“æœéƒ½ä¸ºnull            <span class="token operator">*</span> è¡¨è¾¾å¼<span class="token number">1</span>ï¼šå“ªä¸ªå­—æ®µéœ€è¦åˆ¤æ–­æ˜¯å¦ä¸ºnull        <span class="token operator">*</span> å¦‚æœè¯¥å­—æ®µä¸ºnullåçš„æ›¿æ¢å€¼ã€‚<span class="token number">4</span><span class="token punctuation">.</span> èµ·åˆ«åï¼š        <span class="token operator">*</span> asï¼šasä¹Ÿå¯ä»¥çœç•¥<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5-æ¡ä»¶æŸ¥è¯¢"><a href="#5-æ¡ä»¶æŸ¥è¯¢" class="headerlink" title="5.  æ¡ä»¶æŸ¥è¯¢"></a>5.  æ¡ä»¶æŸ¥è¯¢</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token number">1</span><span class="token punctuation">.</span> whereå­å¥åè·Ÿæ¡ä»¶    <span class="token number">2</span><span class="token punctuation">.</span> è¿ç®—ç¬¦        <span class="token operator">*</span> <span class="token operator">></span> ã€<span class="token operator">&lt;</span> ã€<span class="token operator">&lt;=</span> ã€<span class="token operator">>=</span> ã€<span class="token operator">=</span> ã€<span class="token operator">&lt;</span><span class="token operator">></span>        <span class="token operator">*</span> BETWEEN<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>AND          <span class="token operator">*</span> <span class="token function">IN</span><span class="token punctuation">(</span> é›†åˆ<span class="token punctuation">)</span>         <span class="token operator">*</span> LIKEï¼šæ¨¡ç³ŠæŸ¥è¯¢            <span class="token operator">*</span> å ä½ç¬¦ï¼š               <span class="token operator">*</span> _<span class="token operator">:</span>å•ä¸ªä»»æ„å­—ç¬¦               <span class="token operator">*</span> <span class="token operator">%</span>ï¼šå¤šä¸ªä»»æ„å­—ç¬¦           <span class="token operator">*</span> IS NULL         <span class="token operator">*</span> and  æˆ– <span class="token operator">&amp;&amp;</span>               <span class="token operator">*</span> or  æˆ– <span class="token operator">||</span>            <span class="token operator">*</span> not  æˆ– <span class="token operator">!</span>    <span class="token operator">--</span> æŸ¥è¯¢å¹´é¾„å¤§äº<span class="token number">20</span>å²       SELECT <span class="token operator">*</span> FROM student WHERE age <span class="token operator">></span> <span class="token number">20</span><span class="token punctuation">;</span>                    SELECT <span class="token operator">*</span> FROM student WHERE age <span class="token operator">>=</span> <span class="token number">20</span><span class="token punctuation">;</span>                <span class="token operator">--</span> æŸ¥è¯¢å¹´é¾„ç­‰äº<span class="token number">20</span>å²       SELECT <span class="token operator">*</span> FROM student WHERE age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span><span class="token operator">--</span> æŸ¥è¯¢å¹´é¾„ä¸ç­‰äº<span class="token number">20</span>å²   SELECT <span class="token operator">*</span> FROM student WHERE age <span class="token operator">!=</span> <span class="token number">20</span><span class="token punctuation">;</span>                    SELECT <span class="token operator">*</span> FROM student WHERE age <span class="token operator">&lt;</span><span class="token operator">></span> <span class="token number">20</span><span class="token punctuation">;</span>                <span class="token operator">--</span> æŸ¥è¯¢å¹´é¾„å¤§äºç­‰äº<span class="token number">20</span> å°äºç­‰äº<span class="token number">30</span>                               SELECT <span class="token operator">*</span> FROM student WHERE age <span class="token operator">>=</span> <span class="token number">20</span> <span class="token operator">&amp;&amp;</span>  age <span class="token operator">&lt;=</span><span class="token number">30</span><span class="token punctuation">;</span>       SELECT <span class="token operator">*</span> FROM student WHERE age <span class="token operator">>=</span> <span class="token number">20</span> AND  age <span class="token operator">&lt;=</span><span class="token number">30</span><span class="token punctuation">;</span>       SELECT <span class="token operator">*</span> FROM student WHERE age BETWEEN <span class="token number">20</span> AND <span class="token number">30</span><span class="token punctuation">;</span>    <span class="token operator">--</span> æŸ¥è¯¢å¹´é¾„<span class="token number">22</span>å²ï¼Œ<span class="token number">18</span>å²ï¼Œ<span class="token number">25</span>å²çš„ä¿¡æ¯      SELECT <span class="token operator">*</span> FROM student WHERE age <span class="token operator">=</span> <span class="token number">22</span> OR age <span class="token operator">=</span> <span class="token number">18</span> OR age <span class="token operator">=</span> <span class="token number">25</span>           SELECT <span class="token operator">*</span> FROM student WHERE age <span class="token function">IN</span> <span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">--</span> æŸ¥è¯¢è‹±è¯­æˆç»©ä¸ºnull       SELECT <span class="token operator">*</span> FROM student WHERE english <span class="token operator">=</span> NULL<span class="token punctuation">;</span><span class="token operator">--</span> ä¸å¯¹çš„ã€‚nullå€¼ä¸èƒ½ä½¿ç”¨ <span class="token operator">=</span> ï¼ˆ<span class="token operator">!=</span>ï¼‰ åˆ¤æ–­                            SELECT <span class="token operator">*</span> FROM student WHERE english IS NULL<span class="token punctuation">;</span>    <span class="token operator">--</span> æŸ¥è¯¢è‹±è¯­æˆç»©ä¸ä¸ºnull        SELECT <span class="token operator">*</span> FROM student WHERE english  IS NOT NULL<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">--</span> æŸ¥è¯¢å§“é©¬çš„æœ‰å“ªäº›ï¼Ÿ    like            SELECT <span class="token operator">*</span> FROM student WHERE NAME LIKE <span class="token string">'é©¬%'</span><span class="token punctuation">;</span>            <span class="token operator">--</span> æŸ¥è¯¢å§“åç¬¬äºŒä¸ªå­—æ˜¯åŒ–çš„äºº        SELECT <span class="token operator">*</span> FROM student WHERE NAME LIKE <span class="token string">"_åŒ–%"</span><span class="token punctuation">;</span>        <span class="token operator">--</span> æŸ¥è¯¢å§“åæ˜¯<span class="token number">3</span>ä¸ªå­—çš„äºº        SELECT <span class="token operator">*</span> FROM student WHERE NAME LIKE <span class="token string">'___'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">--</span> æŸ¥è¯¢å§“åä¸­åŒ…å«å¾·çš„äºº            SELECT <span class="token operator">*</span> FROM student WHERE NAME LIKE <span class="token string">'%å¾·%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Sql </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
