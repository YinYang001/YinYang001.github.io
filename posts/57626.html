<!DOCTYPE HTML>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="数据库知识点整理---持续更新, JAVA,IO,Spring,SpringBoot,Vue">
    <meta name="baidu-site-verification" content="fmlEuI34ir">
    <meta name="google-site-verification" content="yCy2azpds5XSuGZvis6OuA-XIGF5GuGpYRAaGfD6o48">
    <meta name="360-site-verification" content="b7c11a830ef90fd1464ad6206bb7b6e7">
    <meta name="description" content="东拼西凑………..
1. 索引的本质索引是帮助Mysql高效获取数据的排好序的数据结构。 

索引的数据结构：
二叉树
红黑树
Hash表
B-Tree



索引优缺点

优点:
提高数据查询的效率,降低数据库的IO成本
通过索引对数据进">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>数据库知识点整理---持续更新 | 智慧屋~様</title>
    <link rel="icon" type="image/jpeg" href="/favicon.jpg">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        code[class*="language-"],
            pre[class*="language-"] {
                white-space: pre !important;
            }

            
    </style>

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?ce84511d3df71640a9378a69f6293044";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

    

    <script>
        (function(){
        var src = "https://jspassport.ssl.qhimg.com/11.0.1.js?d182b3f28525f2db83acfaaf6e696dba";
        document.write('<script src="' + src + '" id="sozz"><\/script>');
        })();
    </script>

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body>

    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.jpg" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">智慧屋~様</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>关于</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fa-address-book"></i>
            
            <span>友情链接</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/contact" class="waves-effect waves-light">
            
            <i class="fa fa-comments"></i>
            
            <span>留言板</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="搜索"></i>
        </a>
    </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.jpg" class="logo-img circle responsive-img">
        
        <div class="logo-name">智慧屋~様</div>
        <div class="logo-desc">
            
            专注于技术,分享生活,分享知识
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                关于
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-address-book"></i>
                
                友情链接
            </a>
        </li>
        
        <li>
            <a href="/contact" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-comments"></i>
                
                留言板
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/YinYang001" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/YinYang001" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/25.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        数据库知识点整理---持续更新
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 20px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                        <a href="/tags/数据库相关概念/" target="_blank">
                            <span class="chip bg-color">数据库相关概念</span>
                        </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                        <a href="/categories/学习笔记/" class="post-category" target="_blank">
                            学习笔记
                        </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-11-10
                </div>

                <div class="post-author info-break-policy">
                    <i class="fa fa-user-o fa-fw"></i>作者:&nbsp;&nbsp;
                    
                    YinSir
                    
                </div>

                
                
                <div class="info-break-policy">
                    <i class="fa fa-file-word-o fa-fw"></i>文章字数:&nbsp;&nbsp;
                    12.5k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="fa fa-clock-o fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    45 分
                </div>
                
                

                
                <div id="busuanzi_container_page_pv" class="info-break-policy">
                    <i class="fa fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                    <span id="busuanzi_value_page_pv"></span>
                </div>
                
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>东拼西凑………..</p>
<h2 id="1-索引的本质"><a href="#1-索引的本质" class="headerlink" title="1. 索引的本质"></a>1. 索引的本质</h2><p><code>索引是帮助Mysql高效获取数据的排好序的数据结构</code>。 </p>
<ul>
<li>索引的数据结构：<ul>
<li>二叉树</li>
<li>红黑树</li>
<li>Hash表</li>
<li>B-Tree</li>
</ul>
</li>
</ul>
<p><strong>索引优缺点</strong></p>
<ul>
<li>优点:<ul>
<li>提高数据查询的效率,降低数据库的IO成本</li>
<li>通过索引对数据进行排序,降低数据排序的成本,降低CPU的消耗</li>
</ul>
</li>
<li>缺点:<ul>
<li>索引本身也是一张表,该表保存了主键与索引字段,并指向实体表的记录,所以索引列也要占用空间</li>
<li>虽然索引大大提高了查询的速度,同时反向影响增删改操作的效率,因为表中数据变化之后,会导致索引内容不准,所以也需要更新索引表信息,增加了数据库的工作量</li>
<li>随着业务的不断变化,之前建立的索引可能不能满足查询需求,需要消耗我们的时间去更新索引</li>
</ul>
</li>
</ul>
<p><strong>B树</strong></p>
<p>大多数存储引擎都支持B树索引。B树通常意味着所有的值都是按顺序存储的，并且每一个叶子到根的距离相同。B树索引能够加快访问数据的速度，因为存储引擎不再需要进行全表扫描来获取数据。下图就是一颗简单的B数</p>
<img src="/posts/57626/20190905145008911.png">

<p>B树的查询流程：<br>如上图我要从找到E字母，查找流程如下：</p>
<ol>
<li>获取根节点的关键字进行比较，当前根节点关键字为M，E&lt;M（26个字母顺序），所以往找到指向左边的子节点（二分法规则，左小右大，左边放小于当前节点值的子节点、右边放大于当前节点值的子节点）；</li>
<li>拿到关键字D和G，D&lt;E&lt;G 所以直接找到D和G中间的节点；</li>
<li>拿到E和F，因为E=E 所以直接返回关键字和指针信息（如果树结构里面没有包含所要查找的节点则返回null）；</li>
<li>通过指针信息取出这条记录的所有信息；</li>
</ol>
<p><strong>哈希表</strong></p>
<p>只有精确匹配索引所有列的查询才有效。对于每一行数据，存储引擎都会对所有的索引列计算一个哈希码。哈希索引将所有的哈希码存储在索引中，同时在哈希表中保存指向每个数据行的指针。如果多个列的哈希值相同，索引会以链表的方式存放多个指针记录到同一个哈希条目中。</p>
<p>因为索引自身只存储对应的哈希值，所以索引的结构十分紧凑，哈希索引查找的速度非常快。但是哈希索引也有它的限制：</p>
<blockquote>
<ol>
<li>哈希索引不是按照索引顺序存储的，无法用于排序。</li>
<li>不支持部分索引列匹配查找。</li>
<li>不支持范围查找</li>
</ol>
</blockquote>
<p><strong>二叉树</strong></p>
<p>从二叉树开始，去用二叉树实现我们mysql索引的查询。如上表所示，我们使用col2 列做为索引列，用二叉树的，结构就是</p>
<img src="/posts/57626/20210419142406700.png">

<p>如果我们需要查询 col2 = 66，需要查询 25&gt;30&gt;66，三次就可以遍历到我们需要的数据。</p>
<p>是不是开始觉得二叉树也不错，为什么数据库不使用二叉树作为底层数据结构那？看下面这个，你就明白了</p>
<p>接下来，我们以col1 为索引列，这样我们得到树状图是什么样子的，如下图。</p>
<img src="/posts/57626/20210419145426989.png">

<p>样其实就相当于是一条链表，如果我们想要查询col1 = 7 的数据，1&gt;2&gt;3&gt;4&gt;5&gt;6&gt;7 七次才可以查询到我们想要的结果，如果更多数据那，那这个索引将毫无意义。</p>
<p>这个时候，就需要我们红黑树登场了，红黑树的话，其实是二叉平衡树，可以自动平衡col1 这种节点的数据，如下图所示</p>
<p><strong>红黑树</strong></p>
<img src="/posts/57626/20210419145747827.png">

<p>这个时候如果我们在查询col1 = 7 ，2&gt;4&gt;6&gt;7 只需要四次就可以查询到。红黑树可以自动去平衡二叉树，其实还是二叉树，相对于二叉树而言，红黑树提高了效率。但是因为数的高度是不可控的，我们查询的次数跟树的高度是成正比的，树的高度越高，查询次数就越多，效率也就越低，如果是百万、千万，树的高度是不是就控制不了。所以树的高度不可控也是数据库 底层不使用红黑树的原因。<br>而b+tree的话，树的高度是可控的。下图为例;</p>
<p><strong>B+树</strong></p>
<img src="/posts/57626/20210419151645235.png">

<p>b+tree,是以页的方式来存储索引，最下层叶子节点，存储的是数据的一个地址。现在我们查询col=1的时候，只需要三次。相对于来说比较耗时的地方，就是第一次跟第二次，这里就是两次I/o,将数据加载到内存当中，在内存中遍历，耗费的性能忽略不计。</p>
<pre><code>    每一页的大小，mysql给出的大约是16kb(建议不要更改)。我们就算字段类型是bigint，一个索引字段占用8B，中间的磁盘地址算6B。16kb/（8b+6B） 大约 为1170，第二层同样是1170,第三层存储的是我们的磁盘地址或者是数据，一行数据最多算1kb，估计都算大的数据了。也就是说，一页索引存满的话，大约可以存储1170*1170*16    = 两千多万数据，一般能到两千多万数据的话， 基本上都分库分表了。</code></pre><p>b+tree:非叶子节点不存储数据，只存储索引。叶子节点包含所有的索引字段。叶子节点用指针链接，提高了区间访问的性能（这块下一篇跟b-tree一起更容易理解）</p>
<p><strong>这时候的出来了一个疑问，如果超过了两千多万，怎么存储，这个简单，树的高度在+1 不就可以了。这样的话，数据存储到上亿了。</strong></p>
<p>也就是说，百万级别的数据，我们使用b+tree，也就是两次IO就可以找到你需要的数据。树的高度 也可控。只不过是横向扩展。</p>
<p>B+树是B树的升级版</p>
{% asset_img 20190905145248712.png %}

<p><code>以表来分析</code></p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> Student<span class="token punctuation">(</span>
 last_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> 
 first_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> 
 birthday <span class="token keyword">date</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> 
 gender <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> 
 <span class="token keyword">key</span><span class="token punctuation">(</span>last_name<span class="token punctuation">,</span> first_name<span class="token punctuation">,</span> birthday<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>对于表中的每一行数据，索引中包含了name，birthday列的值。下图显示了该索引的结构：</p>
<img src="/posts/57626/20190905145820549.png">

<p><strong>索引对多个值进行排序的依据是create table语句中定义索引时列的顺序，即如果名字相同，则根据生日来排序。</strong><br><strong>B+树的结构决定了这种索引对以下类型的查询有效</strong>:</p>
<ol>
<li>全值匹配 和索引中所有的列进行匹配，例如查找姓名为Cuba Allen，生日为1960-01-01的人。</li>
<li>匹配最左前缀 查找姓为Allen的人，即只用索引的第一列。</li>
<li>匹配列前缀 匹配某一列的值的开头部分，例如查找所有以J开头的姓的人。</li>
<li>匹配范围值 查找姓在Allen和Barrymore之间的人。</li>
<li>精确匹配某一列并范围匹配另外一列 查找姓为Allen，名字是字母K开头的人。即第一列last_name全匹配，第二列first_name范围匹配。</li>
<li>只访问索引的查询 查询只需要访问索引，无需访问数据行。这种索引叫做覆盖索引。</li>
</ol>
<p><code>一些限制</code>：<br>\1. 如果不是按照索引的最左列开始查找，无法使用索引。例如上面例子中的索引无法用于查找某个特定生日的人，因为生日不是最左数据列。也不能查找last_name以某个字母结尾的人。<br>\2. 不能跳过索引的列。上述索引无法用于查找last_name为Smith并且某个特定生日的人。如果不指定first_name，则mysql只能使用索引的第一列。<br>3.如果查询中有某个列的范围查询，则右边所有的列都无法使用索引优化查找。例如查询WHERE last_name=’Smith’ AND first_name LIKE ‘J%’ AND birthday=‘1996-05-19’，这个查询只能使用索引的前两列。</p>
<h3 id="1-1-各自的优劣"><a href="#1-1-各自的优劣" class="headerlink" title="1.1 各自的优劣"></a>1.1 各自的优劣</h3><p>索引的数据结构和具体存储引擎的实现有关，mysql中使用较多的索引有hash索引，B+树索引，innodb的索引实现为B+树，memory存储引擎为hash索引。</p>
<ul>
<li><p>B+树是一个平衡的多叉树，从根节点到每个叶子节点的高度差值不超过1，而且同层级的二节点间有指针相关连接，在B+树上的常规检索，从根节点到叶子节点的搜索效率基本相当，不会出现大幅波动，而且基于索引的顺序扫描时，也可以利用双向指针快速左右移动，效率非常高。因为，B+树索引被广泛应用于数据库、文件系统等场景。</p>
</li>
<li><p>哈希索引就是采用一定的哈希算法，把键值换算成新的哈希值，检索时不需要类似B+树那样从根节点到叶子节点逐级查找，只需一次哈希算法即可立刻定位到相应的位置，速度非常快。</p>
</li>
</ul>
<blockquote>
<p>如果是等值查询，那么哈希索引明显有绝对优势，因为只需要经过一次算法即可找到相应的键值，前提是键值都是唯一的。如果键值不是唯一的，就需要先找到该键所在位置，然后再根据链表往后扫描，知道找到对应的数据</p>
<p>如果是范围查询检索，这时候哈徐索引就毫无用武之地了，因为原先是有序的键值，经过哈希算法后，有可能变成不连续的了，就没办法再利用索引完成范围查询检索</p>
<p>哈希所有也没办法利用索引完成排序，以及like这样的部分模糊查询</p>
<p>哈希索引也不支持多列联合索引的最左匹配规则</p>
</blockquote>
<p>B+树索引的关键字检索效率比较平均，不像B树那样波动大，在有大量重复键值情况下，哈希索引的效率也是极低的，因此存在哈希碰撞问题。</p>
<h3 id="1-2-Mysql索引原理整理"><a href="#1-2-Mysql索引原理整理" class="headerlink" title="1.2  Mysql索引原理整理"></a>1.2  Mysql索引原理整理</h3><p>  索引，可能让好很多人望而生畏，毕竟每次面试时候 MySQL 的索引一定是必问内容，哪怕先撇开面试，就在平常的开发中，对于 SQL 的优化也而是重中之重。</p>
<p>可以毫不夸张的说，系统中 SQL 的好坏，是能直接决定你系统的快慢的。但是在优化之前大家是否想过一个问题？那就是：我们优化的原则是什么？优化SQL的理论基础是什么？</p>
<p>虽然说实践出真知，但是我更相信理论是支撑实践的基础，因为我们不可能毫无目的的去盲目的实践，因为这样往往事倍功半。</p>
<p>所以说了这么多只想告诉大家，在真正的开始索引优化之前，我们需要彻底搞明白索引的原理。这样再谈优化你将觉得更丝滑~</p>
<img src="/posts/57626/a6de673e6de44c4aa98a58577c5d4234.png">

<h5 id="索引的本质"><a href="#索引的本质" class="headerlink" title="索引的本质"></a>索引的本质</h5><p>索引的本质是一种排好序的数据结构。这个我相信其实大家并不陌生，因为谈到索引很多人自然而然的就会联想到字典中的目录。</p>
<p>没错，这样的类比是很形象的，但是如果再往深处说，恐怕很多小伙伴就有点张口结舌了，那既然你已经知道了索引的本质，那么您就已经有了看这篇文章的基础，相信读文本文的你，一定会对索引的原理有一个全新的了解。</p>
<h5 id="索引分类"><a href="#索引分类" class="headerlink" title="索引分类"></a><strong>索引分类</strong></h5><p>在数据库中，索引是分很多种类的（千万不要狭隘的认为索引只有 B+ 树，那是因为我们平时使用的基本都是 MySQL）。而不同的种类很显然是为了应付不同的场合，那索引到底有那些种类呢？下面就让我们来大致的了解下。</p>
<ul>
<li><p>Hash 索引</p>
<p>Hash 索引是比较常见的一种索引，他的单条记录查询的效率很高，时间复杂度为1。但是，Hash索引并不是最常用的数据库索引类型，尤其是我们常用的Mysql Innodb引擎就是不支持hash索引的。主要有以下原因：</p>
<ul>
<li>Hash索引适合精确查找，但是范围查找不适合</li>
<li>因为存储引擎都会为每一行计算一个hash码，hash码都是比较小的，并且不同键值行的hash码通常是不一样的，hash索引中存储的就是Hash码，hash 码彼此之间是没有规律的，且 Hash  操作并不能保证顺序性，所以值相近的两个数据，Hash值相差很远，被分到不同的桶中。这就是为什么hash索引只能进行全职匹配的查询，因为只有这样，hash码才能够匹配到数据。</li>
</ul>
<p>对于 hash 索引，小伙伴们只需要了解到这里就可以了。</p>
</li>
<li><p>二叉树</p>
</li>
</ul>
<p>​      另外，常见的索引使用的数据结构是树结构，首先我们来介绍下最经典的二叉树。</p>
<p>​       先来介绍下二叉树的特点：</p>
<pre><code>     ```markdown
         1. 二叉树的时间复杂度为 O(n)
         1. 一个节点只能有两个子节点。即度不超过2
         1. 左子节点 小于 本节点，右子节点 大于 本节点
     ```</code></pre><p>​      首先来看一下二叉树的样子</p>
<img src="/posts/57626/a5249fd4af724930bb111c69d24849bc.jpg">

<p>​      但是在极端情况下会出现链化的情况，即节点一直在某一边增加。如下图</p>
<img src="/posts/57626/3dda063cc2dd4cc499b38cf94d3ef3ce.jpg">

<p>二叉树中，有一种特殊的结构——平衡二叉树，平衡二叉树的特点：</p>
<pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token code keyword">    1. 根节点会随着数据的改变而变更</span>
<span class="token code keyword">    1. 数据量越多，遍历次数越多，IO次数就越多，就越慢（磁盘的IO由树高决定）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li><p>B树（二三树）</p>
<p>了解了二叉树之后，可以进一步谈一下什么是B树了。B 树大概是这样子的：</p>
</li>
</ul>
<img src="/posts/57626/8dfe8242e8e545c0a91175f6fbbc3f6a.png">

<p>从B树的结构图中可以看到每个节点中不仅包含数据的 key 值，还有 data 值。</p>
<p>而每页的存储空间是有限的，如果 data 比较大，会导致每个节点的 key 存储的较少，当数据量较大的时候，同样会导致B树很深，从而增加了磁盘 IO 的次数，进而影响查询效率。</p>
<p>好了，说到这里，常见的索引的种类也说完了，上面的内容仅仅是作为一个铺垫，下面我们正式开始 MySQL 的 B+ 树。</p>
<img src="/posts/57626/54dcb75dae1343628fc738398673256a.png">

<ul>
<li>B+树<ul>
<li>在 B+ 树中，所有数据记录节点都是按照键值的大小存放在同一层的叶子节点上，而非叶子结点只存储key的信息，这样可以大大减少每个节点的存储的key的数量，降低B+ 树的高度</li>
<li>B+ 树叶子节点的关键字从小到大有序排列，左边结尾数据都会保存右边节点开始数据的指针。</li>
<li>B+ 树的层级更少：相较于 B 树 B+ 每个非叶子节点存储的关键字数更多，树的层级更少所以查询数据更快</li>
<li>B+ 树查询速度更稳定：B+ 所有关键字数据地址都存在叶子节点上，所以每次查找的次数都相同所以查询速度要比B树更稳定;</li>
<li>B+ 树天然具备排序功能：B+ 树所有的叶子节点数据构成了一个有序链表，在查询大小区间的数据时候更方便，数据紧密性很高，缓存的命中率也会比B树高。</li>
<li>B+ 树全节点遍历更快：B+ 树遍历整棵树只需要遍历所有的叶子节点即可，，而不需要像 B 树一样需要对每一层进行遍历，这有利于数据库做全表扫描。</li>
</ul>
</li>
</ul>
<p>​         好了说了这么多的 B+ 树的特点，我们来张图看看 B+ 树到底长什么样子（如果看不懂，也没有关系，下文会一步一步解释说明的）</p>
<img src="/posts/57626/d836f0e2602f44fdb95d3229a539ad53.png">

<p>上面的数据页就是实际存放数据页的地方，且数据页之间是通过双向链表进行连接的，好了到这里我们就将各个索引的类型快速了解了下，下面我们就开始正式B+树的分析。</p>
<h5 id="主键目录"><a href="#主键目录" class="headerlink" title="主键目录"></a>主键目录</h5><p>我们将上图中的数据页拿出来再细化下，就成了下面的这张图</p>
<img src="/posts/57626/13c71b40aa37474785deb89428639a06.png">

<p>我们都知道 MySQL 在存储数据的时候是以<strong>数据页</strong>为最小单位的，且数据在数据页中的存储是<strong>连续</strong>的，数据页中的数据是按照主键排序的（没有主键是由 MySQL自己维护的 ROW_ID 来排序的），数据页和数据页之间是通过<strong>双向链表</strong>来关联的，数据与数据时间是通过<strong>单向链表</strong>来关联的。</p>
<p>也就是说有一个在每个数据页中，他必然就有一个最小的主键，然后每个数据页的页号和最小的主键会组成一个<strong>主键目录</strong>（就像上图中的左边部分），假设现在要查找主键为 2 的数据，通过二分查找法最后确定下主键为 2 的记录在数据页 1 中，此时就会定位到数据页 1 接着再去定位主键为 2 的记录，我们先知道大致的流程，细节先不要深究，先从宏观看结构原理，再到微观看实现原理。</p>
<p>刚刚上面是说的其实可以理解为是主键索引，主键索引也是最简单的最基础的索引。这个时候大家应该知道为什么你建立了主键查询就能变快了吧？</p>
<h5 id="索引页"><a href="#索引页" class="headerlink" title="索引页"></a>索引页</h5><p>但是现在假设有很多很多的是数据页，那是不是对应的主键目录会很大很大呢？</p>
<p>那假设有1000万条记录、5000万条记录呢？是不是就算是二分法查找，其效率也依旧是很低的，所以为了解决这种问题 MySQL 又设计出了一种新的存储结构—<strong>索引页</strong>。例如有下面这样情况，</p>
<img src="/posts/57626/d2ed17bfe583473ba1947efe8a8c2f0f.jpg">

<p>假设上面的主键目录中的记录是非常非常多的，此时上面的结构是演变成这样子的，MySQL 会将里面的记录拆分到不同的索引页中，也就是下面这样子的</p>
<img src="/posts/57626/c298716fe9434993a6ffeb8f9c594e30.jpg">

<p>索引页中记录的是每页数据页的页号和该数据页中最小的主键的记录，也就是说最小主键和数据页号不是单纯的维护在主键目录中了，而是演变成了索引页，索引页和数据页类似，一张不够存就分裂到下一张。</p>
<p>假如现在要查找 id=20 的这条记录，咦？那我应该到哪个索引页中查找该条记录呢？所以这个时候肯定是需要去维护索引页的。</p>
<p>没错，MySQL 也是这么设计的，也就是说 MySQL 同时也设计出了用于维护索引页的数据结构，其实也还叫<strong>索引页</strong>，只不过他们是在不同的层级，类似下面这样子的：</p>
<img src="/posts/57626/b72f83176f58443c8e2f11d735b2f1ad.jpg">

<p>也就是说<strong>维护索引页的索引页</strong>是在真正<strong>存储记录和数据页的索引页</strong>的上一层，现在如果你想查找 id=20 的这条记录，那就是从最上层的索引页开始查找，通过二分法查找，很快就能够定位到 id=20 s这条记录是在索引页 2  上，然后到就索引页 2 上面查找，接着就是和之前一样了（注意，索引页中的记录也是通过单向链表连接的），根据各个最小的主键能够定位到 id=20  是在数据页5上，假设数据页5是这样子的</p>
<img src="/posts/57626/cfa0c5914ee44018b3d908291003dd01.jpg">

<p>那这个时候你是不是能够想明白数据是怎么定位的了呢？</p>
<h5 id="索引页的分层"><a href="#索引页的分层" class="headerlink" title="索引页的分层"></a>索引页的分层</h5><p>好，既然你已经知道到索引页太多会往上一层扩散，那现在假设上一层的索引页记录也太多了，那该怎么办？很简单，继续分裂，再往上一层继续，不废话，我来画图帮助大家理解</p>
<img src="/posts/57626/98ead49ca0224b6d962762cf4a61fda2.png">

<p>我看明白了，你看明白了吗？我们来模拟一个查找的过程，假设你要查找 37 这条记录，说实话我根本不知道这条记录在哪里。好，现在我们就来模拟 MySQL 的查找过程，首先从<strong>最顶层的索引页</strong>开始查找，因为 id=37，因此定位到了索引页16，然后到索引页 16 中继续查找，此时同样能够定位到 id=37 在索引页 3 中，然后继续查找，最终能够定位到数据实在数据页 8 中，假设数据页 8 是这样子的</p>
<img src="/posts/57626/acb278680ad1402a8c7763a0a853a2a2.jpg">

<p>是不是很完美？如果非要我把上面的图画完整，那….小弟义不容辞（图太大了，索引页中数据的链表结构就不画出来了）</p>
<img src="/posts/57626/ce0930235feb4ffab1805347fa7d4cfe.png">

<p>这个时候机智的你是不是已经发现了什么小秘密？他是不是很像一颗二叉树？实际上这就是一颗 B+ 树的结构，这也是数据在磁盘中真正存储的物理结构。B+树的特性是什么呢？B+树，也是二叉搜索树的一种，但是他的数据仅仅存储在叶子节点（在这里就是数据页），像这种<strong>索引页+数据页</strong>组成的组成的B+树就是<strong>聚簇索引</strong>(这句话很重要)。</p>
<blockquote>
<p>聚簇索引是 MySQL 基于主键索引结构创建的</p>
</blockquote>
<h5 id="非主键索引"><a href="#非主键索引" class="headerlink" title="非主键索引"></a>非主键索引</h5><p>但是现在问题又来了，既然这里强调的是<strong>主键索引</strong>，那我们平时开发中除了主键索引其他的索引也用的不少，这时候该怎么办？假设你现在 对name、age建立索引。现在回顾下主键索引，是不是在插入数据的时候基于主键的顺序去维护一个 B+ 树的？</p>
<p>而实际上非主键索引其原理是一样的，MySQL 都是去维护一颗 B+  树，说白了，你建立多少个索引，MySQL  就会帮你维护多少的B+树（这下是不是也突然想明白了为什么索引不能建立太多了？以前就知道不能建立太多索引，因为索引也会占用空间，实际上这就是根本原因）</p>
<p>假如现在真的对 name+age 建立索引，那此时是存放的呢？此时 MySQL 根据会 name+age 维护一个单独的 B+  树结构，数据依旧是存放在数据页中的，只不过是原来数据中的每条记录写的是  id=xx，现在写的是name=xx，age=xx，id=xx，不管怎么样，主键肯定会存放的，先来张图压压惊</p>
<img src="/posts/57626/b553d884b8eb4a169324ae426ef02bf5.jpg">

<p>在插入数据的时候，MySQL 首先会根据 name 进行排序，如果 name 一样，就根据联合索引中的 age 去排序，如果还一样，那么就会根据 主键 字段去排序。插入的原理就是这样子的。</p>
<p>此时每个数据页中的记录存放的实际是<strong>索引字段</strong>和主键字段，而其他字段是不存的（为什么不存放？一样的数据到处存放很浪费空间的，也没必要，所以才会有下面的索引优化），至于查找，原理和过程跟聚簇索引一样，这里就不再赘述，但是，下面说的内容却是至关重要的：假设现在执行这样的SQL：</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> name<span class="token operator">=</span><span class="token string">'wx'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>那么此时的查询是完美的，使用到了索引且不需要<strong>回表</strong></p>
<h5 id="回表"><a href="#回表" class="headerlink" title="回表"></a>回表</h5><p>是这样子的，现在要根据 name 查找到该条记录，且查询的字段（即 select 后面的查询字段）也仅仅有 name（只要是在 name,age,id 这三个字段中都可以）这个时候是能够直接获取到最终的记录的</p>
<p>换句话说，因为联合索引中的记录也仅仅有 name，age，id，所以在查询的如果也仅仅查询这三个字段，那么在该B+树中就能够查询到想要的结果了。</p>
<p>那现在假设查询的 SQL 是这样子的（我们假设 student 中还有除了name，age，id 其他的字段 ）</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> name<span class="token operator">=</span><span class="token string">'wx'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>那这下子就完蛋了，因为你现在虽然根据 name 很快的定位到了该条记录，但是因为 name+age 不是聚簇索引，此时的 B+ 树的数据页中存放的仅仅是自己关联的索引和主键索引字段，并不会存其他的字段，所以这个时候其他的属性值是获取不到的，这时候该怎么办？</p>
<p>这种情况下，MySQL 就需要进行<strong>回表</strong>查询了。此时 MySQL 就会根据定位到的某条记录中的 id 再次进行聚簇索引查找，也就是说会根据 id 去维护 id 的那么 B+ 树中查找。因为聚簇索引中数据页记录的是一条记录的完整的记录，这个过程就叫<strong>回表</strong>。</p>
<p>再强调下回表的含义：<strong>根据非主键索引查询到的结果并没有查找的字段值，此时就需要再次根据主键从聚簇索引的根节点开始查找，这样再次查找到的记录才是完成的。</strong></p>
<p>最后，让我一起看下 MySQL 对于非主键索引的维护过程：</p>
<p>对于非主键索引（一般都是联合索引），在维护 B+ 树的时候，会根据联合索引的字段依次去判断，假设联合索引为：name + address + age，那么 MySQL 在维护该索引的  B+ 树的时候，首先会根据 name 进行排序，name 相同的话会根据第二个 address 排序，如果 address 也一样，那么就会根据 age 去排序，如果 age 也一样，那么就会根据主键字段值去排序，且对于非主键索引，MySQL 在维护 B+  树的时候，仅仅是维护索引字段和主键字段。</p>
<hr>
<h3 id="1-2-B树与B-树"><a href="#1-2-B树与B-树" class="headerlink" title="1.2 B树与B+树"></a>1.2 B树与B+树</h3><p><strong>B树和B+树的区别，为什么Mysql使用B+树</strong></p>
<p>B+树和B树的区别是：</p>
<ol>
<li>B树的节点(根节点/父节点/中间节点/叶子节点)中没有重复元素，B+树有。</li>
<li>B树的中间节点会存储数据指针信息，而B+树只有叶子节点才存储。</li>
<li>B+树的每个叶子节点有一个指针指向下一个节点，把所有的叶子节点串在了一起。</li>
</ol>
<p><strong>从下图我们可以直观的看到B树和B+树的区别：紫红色的箭头是指向被索引的数据的指针，大红色的箭头即指向下一个叶子节点的指针。</strong></p>
<img src="/posts/57626/20190905145443436.png">

<p>我们假设被索引的列是主键，现在查找主键为5的记录，模拟一下查找的过程：<br>B树，在倒数第二层的节点中找到5后，可以立刻拿到指针获取行数据，查找停止。<br>B+树，在倒数第二层的节点中找到5后，由于中间节点不存有指针信息，则继续往下查找，在叶子节点中找到5，拿到指针获取行数据，查找停止。</p>
<p>B+树每个父节点的元素都会出现在子节点中，是子节点的最大（或最小）元素。叶子节点存储了被索引列的所有的数据。</p>
<p><strong>那B+树比起B树有什么优点呢？</strong><br>\1. 由于中间节点不存指针，同样大小的磁盘页可以容纳更多的节点元素，树的高度就小。（数据量相同的情况下，B+树比B树更加“矮胖”），查找起来就更快。<br>\2. B+树每次查找都必须到叶子节点才能获取数据，而B树不一定，B树可以在非叶子节点上获取数据。因此B+树查找的时间更稳定。<br>\3. B+树的每一个叶子节点都有指向下一个叶子节点的指针，方便范围查询和全表查询：只需要从第一个叶子节点开始顺着指针一直扫描下去即可，而B树则要对树做中序遍历。</p>
<h3 id="1-1-索引的执行计划"><a href="#1-1-索引的执行计划" class="headerlink" title="1.1 索引的执行计划"></a>1.1 索引的执行计划</h3><p>参考链接：<a href="https://www.cnblogs.com/gdwkong/articles/8505125.html" target="_blank" rel="noopener">https://www.cnblogs.com/gdwkong/articles/8505125.html</a></p>
<h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><ol>
<li>查看表的读取顺序</li>
<li>查看数据库读取操作的操作类型</li>
<li>查看哪些索引有可能被用到</li>
<li>查看哪些索引真正被用到</li>
<li>查看表之间的引用</li>
<li>查看表中有多少行记录被优化器查询</li>
</ol>
<p><strong>使用explain关键字可以模拟优化器执行SQL查询语句,从而知道MYSQL是如何处理SQL语句的.我们可以用执行计划来分析查询语句或者表结构的性能瓶</strong></p>
<pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token list punctuation">-</span> explain + sql语句

<span class="token list punctuation">*</span> explain select * from tsmall;
+----+-------------+---------+------+---------------+------+---------+------+------+-------+
| id | select<span class="token italic"><span class="token punctuation">_</span>type | table   | type | possible<span class="token punctuation">_</span></span>keys | key  | key_len | ref  | rows | Extra |
+----+-------------+---------+------+---------------+------+---------+------+------+-------+
|  1 | SIMPLE      | product | ALL  | NULL          | NULL | NULL    | NULL |   16 |       |
+----+-------------+---------+------+---------------+------+---------+------+------+-------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>环境准备</strong></p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> t1<span class="token punctuation">(</span>
  id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  col1 <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  col2 <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  col3 <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> t2<span class="token punctuation">(</span>
  id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   col1 <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   col2 <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  col3 <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> t3<span class="token punctuation">(</span>
  id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    col1 <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   col2 <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  col3 <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t1 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'zs1'</span><span class="token punctuation">,</span><span class="token string">'col1'</span><span class="token punctuation">,</span><span class="token string">'col2'</span><span class="token punctuation">,</span><span class="token string">'col3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t2 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'zs2'</span><span class="token punctuation">,</span><span class="token string">'col2'</span><span class="token punctuation">,</span><span class="token string">'col2'</span><span class="token punctuation">,</span><span class="token string">'col3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t3 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'zs3'</span><span class="token punctuation">,</span><span class="token string">'col3'</span><span class="token punctuation">,</span><span class="token string">'col2'</span><span class="token punctuation">,</span><span class="token string">'col3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">index</span> ind_t1_c1 <span class="token keyword">on</span> t1<span class="token punctuation">(</span>col1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">index</span> ind_t2_c1 <span class="token keyword">on</span> t2<span class="token punctuation">(</span>col1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">index</span> ind_t3_c1 <span class="token keyword">on</span> t3<span class="token punctuation">(</span>col1<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">index</span> ind_t1_c12 <span class="token keyword">on</span> t1<span class="token punctuation">(</span>col1<span class="token punctuation">,</span>col2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">index</span> ind_t2_c12 <span class="token keyword">on</span> t2<span class="token punctuation">(</span>col1<span class="token punctuation">,</span>col2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">index</span> ind_t3_c12 <span class="token keyword">on</span> t3<span class="token punctuation">(</span>col1<span class="token punctuation">,</span>col2<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="id"><a href="#id" class="headerlink" title="id"></a>id</h4><ul>
<li>select 查询的序列号,包含一组数字,表示查询中执行Select子句或操作表的顺序</li>
<li>三种情况:</li>
</ul>
<p>​       <code>a. id值相同,执行顺序由上而下</code></p>
<pre class="line-numbers language-sql"><code class="language-sql"> <span class="token keyword">explain</span> <span class="token keyword">select</span> t2<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> t1<span class="token punctuation">,</span>t2<span class="token punctuation">,</span>t3 <span class="token keyword">where</span> t1<span class="token punctuation">.</span>id <span class="token operator">=</span> t2<span class="token punctuation">.</span>id <span class="token operator">and</span> t1<span class="token punctuation">.</span>id<span class="token operator">=</span> t3<span class="token punctuation">.</span>id <span class="token operator">and</span> t1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'zs'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
{% asset_img index.png %}

<p>​      <code>b. id值不同,id值越大优先级越高,越先被执行</code></p>
<pre class="line-numbers language-sql"><code class="language-sql"> <span class="token keyword">explain</span> <span class="token keyword">select</span> t2<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> t2 <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> id <span class="token keyword">from</span> t1 <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> t3<span class="token punctuation">.</span>id <span class="token keyword">from</span> t3 <span class="token keyword">where</span> t3<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'zs3'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>​     <img src="/posts/57626/index1.png"></p>
<p> <code>c. id值有相同的也有不同的,如果id相同,从上往下执行,id值越大,优先级越高,越先执行</code></p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token number">2</span>  <span class="token keyword">explain</span> <span class="token keyword">select</span> t2<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> t3<span class="token punctuation">.</span>id <span class="token keyword">from</span> t3 <span class="token keyword">where</span> t3<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'zs3'</span><span class="token punctuation">)</span> s1<span class="token punctuation">,</span>t2 <span class="token keyword">where</span> s1<span class="token punctuation">.</span>id <span class="token operator">=</span> t2<span class="token punctuation">.</span>id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>​     {% asset_img index2.png %}</p>
<h4 id="select-type"><a href="#select-type" class="headerlink" title="select_type"></a>select_type</h4><p> 查询类型,主要用于区别</p>
<ul>
<li>SIMPLE : 简单的select查询,查询中不包含子查询或者UNION</li>
<li>PRIMARY: 查询中若包含复杂的子查询,最外层的查询则标记为PRIMARY</li>
<li>SUBQUERY : 在SELECT或者WHERE列表中包含子查询</li>
<li>DERIVED : 在from列表中包含子查询被标记为DRIVED衍生,MYSQL会递归执行这些子查询,把结果放到临时表中</li>
<li>UNION: 若第二个SELECT出现在union之后,则被标记为UNION, 若union包含在from子句的子查询中,外层select被标记为:derived</li>
<li>UNION RESULT: 从union表获取结果的select</li>
</ul>
<pre class="line-numbers language-sql"><code class="language-sql">  <span class="token keyword">explain</span> <span class="token keyword">select</span> col1<span class="token punctuation">,</span>col2 <span class="token keyword">from</span> t1 <span class="token keyword">union</span> <span class="token keyword">select</span> col1<span class="token punctuation">,</span>col2 <span class="token keyword">from</span> t2<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>​     <img src="/posts/57626/index3.png"></p>
<h4 id="table"><a href="#table" class="headerlink" title="table"></a>table</h4><p>　　显示这一行的数据是和哪张表相关</p>
<h4 id="type"><a href="#type" class="headerlink" title="type"></a>type</h4><p>访问类型: all, index,range,ref,eq_ref, const,system,null</p>
<p>最好到最差依次是: system &gt; const &gt; eq_ref&gt;ref &gt;range &gt; index &gt; all , 最好能优化到range级别或则ref级别</p>
<ul>
<li>system: 表中只有一行记录(系统表), 这是const类型的特例, 基本上不会出现</li>
<li>const: 通过索引一次查询就找到了,const用于比较primary key或者unique索引,因为只匹配一行数据,所以很快,如将主键置于where列表中,mysql就会将该查询转换为一个常量</li>
</ul>
<pre class="line-numbers language-sql"><code class="language-sql"> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> s1<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>​    {% asset_img index4.png %}</p>
<ul>
<li>eq_ref: 唯一性索引扫描, 对于每个索引键,表中只有一条记录与之匹配, 常见于主键或者唯一索引扫描</li>
</ul>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1<span class="token punctuation">,</span>t2 <span class="token keyword">where</span> t1<span class="token punctuation">.</span>id <span class="token operator">=</span> t2<span class="token punctuation">.</span>id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>​    <img src="/posts/57626/index5.png"></p>
<ul>
<li>ref : 非唯一性索引扫描,返回匹配某个单独值的所有行,本质上也是一种索引访问,它返回所有符合条件的行,然而它可能返回多个符合条件的行</li>
</ul>
<p>​    <img src="/posts/57626/index6.png"></p>
<p><img src="data:image/jpg;base64,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" alt="img"></p>
<ul>
<li>range : 只检索给定范围的行,  使用一个索引来选择行.key列显示的是真正使用了哪个索引,一般就是在where条件中使用between,&gt;,&lt;,in  等范围的条件,这种在索引范围内的扫描比全表扫描要好,因为它只在某个范围中扫描,不需要扫描全部的索引</li>
</ul>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> id <span class="token operator">between</span> <span class="token number">1</span> <span class="token operator">and</span> <span class="token number">10</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>​    {% asset_img index7.png %}</p>
<ul>
<li>index : 扫描整个索引表, index 和all的区别为index类型只遍历索引树. 这通常比all快,因为索引文件通常比数据文件小,虽然index和all都是读全表,但是index是从索引中读取,而all是从硬盘中读取数据</li>
</ul>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> id <span class="token keyword">from</span> t1<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>​    <img src="/posts/57626/index8.png"></p>
<ul>
<li>all : full table scan全表扫描 ,将遍历全表以找到匹配的行</li>
</ul>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>​    {% asset_img index9.png %}</p>
<p><code>注意: 开发中,我们得保证查询至少达到range级别,最好能达到ref以上</code></p>
<h4 id="possible-keys"><a href="#possible-keys" class="headerlink" title="possible_keys"></a>possible_keys</h4><p>　　SQL查询中可能用到的索引,但查询的过程中不一定真正使用</p>
<h4 id="key"><a href="#key" class="headerlink" title="key"></a>key</h4><p>查询过程中真正使用的索引,如果为null,则表示没有使用索引</p>
<p>查询中使用了覆盖索引,则该索引仅出现在key列表中</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token number">1</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> t2<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> t1<span class="token punctuation">,</span>t2<span class="token punctuation">,</span>t3 <span class="token keyword">where</span> t1<span class="token punctuation">.</span>col1 <span class="token operator">=</span> <span class="token string">' '</span> <span class="token operator">and</span> t1<span class="token punctuation">.</span>id <span class="token operator">=</span> t2<span class="token punctuation">.</span>id <span class="token operator">and</span> t1<span class="token punctuation">.</span>id<span class="token operator">=</span> t3<span class="token punctuation">.</span>id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
 <img src="/posts/57626/index10.png">

<pre class="line-numbers language-sql"><code class="language-sql"><span class="token number">1</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> col1 <span class="token keyword">from</span> t1<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
 {% asset_img index11.png %}

<h4 id="key-len"><a href="#key-len" class="headerlink" title="key_len"></a>key_len</h4><p>　　索引中使用的字节数,可通过该列计算查询中使用的索引的长度,在不损失精确度的情况下,长度越短越好, key_len显示的值为索引字段的最大可能长度,并非实际使用长度, 即key_len是根据表定义计算而得</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token number">1</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> col1<span class="token operator">=</span><span class="token string">'c1'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
 <img src="/posts/57626/index12.png">

<pre class="line-numbers language-sql"><code class="language-sql">  <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> col1<span class="token operator">=</span><span class="token string">'col1'</span> <span class="token operator">and</span> col2 <span class="token operator">=</span> <span class="token string">'col2'</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">-- 注意: 为了演示这个结果,我们删除了c1上面的索引</span>
  <span class="token keyword">alter</span> <span class="token keyword">table</span> t1 <span class="token keyword">drop</span> <span class="token keyword">index</span> ind_t1_c1<span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">-- 执行完成之后,再次创建索引</span>
  <span class="token keyword">create</span> <span class="token keyword">index</span> ind_t1_c1 <span class="token keyword">on</span> t1<span class="token punctuation">(</span>col1<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<img src="/posts/57626/index13.png">

<h4 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h4><p>　　显示索引的哪一列被使用了,如果可能的话,是一个常数.哪些列或者常量被用于查找索引列上的值</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1<span class="token punctuation">,</span>t2 <span class="token keyword">where</span> t1<span class="token punctuation">.</span>col1 <span class="token operator">=</span> t2<span class="token punctuation">.</span>col1 <span class="token operator">and</span> t1<span class="token punctuation">.</span>col2 <span class="token operator">=</span> <span class="token string">'col2'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
{% asset_img index14.png %}

<h4 id="rows"><a href="#rows" class="headerlink" title="rows"></a>rows</h4><p>根据表统计信息及索引选用的情况,估算找出所需记录要读取的行数 (有多少行记录被优化器读取)</p>
<h4 id="extra"><a href="#extra" class="headerlink" title="extra"></a>extra</h4><p>包含其它一些非常重要的额外信息</p>
<ul>
<li>Using filesort : 说明mysql会对数据使用一个外部的索引排序,而不是按照表内的索引顺序进行读取,Mysql中无法利用索引完成的排序操作称为文件排序</li>
</ul>
<pre class="line-numbers language-sql"><code class="language-sql">  <span class="token keyword">explain</span> <span class="token keyword">select</span> col1 <span class="token keyword">from</span> t1 <span class="token keyword">where</span> col1<span class="token operator">=</span><span class="token string">'col1'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> col3<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<img src="/posts/57626/index15.png">

<pre class="line-numbers language-sql"><code class="language-sql"> <span class="token comment" spellcheck="true">-- 上面这条SQL语句出现了using filesort,但是我们去执行下面这条SQL语句的时候它,又不会出现using filesort</span>
<span class="token number">3</span>   <span class="token keyword">explain</span> <span class="token keyword">select</span> col1 <span class="token keyword">from</span> t1 <span class="token keyword">where</span> col1<span class="token operator">=</span><span class="token string">'col1'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> col2<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<img src="/posts/57626/index16.png">

<pre class="line-numbers language-sql"><code class="language-sql"><span class="token number">2</span>   <span class="token comment" spellcheck="true">-- 如何优化第一条SQL语句 ? </span>
<span class="token number">3</span>   <span class="token keyword">create</span> <span class="token keyword">index</span> ind_t1_c13 <span class="token keyword">on</span> t1<span class="token punctuation">(</span>col1<span class="token punctuation">,</span>col3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">4</span>   <span class="token keyword">explain</span> <span class="token keyword">select</span> col1 <span class="token keyword">from</span> t1 <span class="token keyword">where</span> col1<span class="token operator">=</span><span class="token string">'col1'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> col3<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<img src="/posts/57626/index17.png">

<ul>
<li>Using temporary : 使用了临时表保存中间结果,Mysql在对查询结果排序时使用了临时表,常见于order by 和分组查询group by</li>
</ul>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> col1 <span class="token keyword">from</span> t1 <span class="token keyword">where</span> col1<span class="token operator">></span><span class="token string">'col1'</span> <span class="token keyword">group</span> <span class="token keyword">by</span> col2<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
{% asset_img index18.png %}

<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> col1 <span class="token keyword">from</span> t1 <span class="token keyword">where</span> col1 <span class="token operator">></span><span class="token string">'col1'</span> <span class="token keyword">group</span> <span class="token keyword">by</span> col1<span class="token punctuation">,</span>col2<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<img src="/posts/57626/index19.png">

<ul>
<li>Using index <ul>
<li>查询操作中使用了覆盖索引(查询的列和索引列一致),避免访问了表的数据行,效率好</li>
<li>如果同时出现了using where, 表明索引被用来执行索引键值的查找</li>
<li>如果没有同时出现using where, 表明索引用来读取数据而非执行查找动作</li>
<li>覆盖索引: 查询的列和索引列一致, 换句话说查询的列要被所键的索引覆盖,就是select中数据列只需从索引中就能读取,不必读取原来的数据行,MySql可以利用索引返回select列表中的字段,而不必根据索引再次读取数据文件</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> col2 <span class="token keyword">from</span> t1 <span class="token keyword">where</span> col1<span class="token operator">=</span><span class="token string">'col1'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
{% asset_img index20.png %}

<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> col2 <span class="token keyword">from</span> t1<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<img src="/posts/57626/index21.png">

<ul>
<li>using where : 表明使用了where条件过滤</li>
<li>using join buffer : 表明使用了连接缓存, join次数太多了可能会出现</li>
<li>impossible where : where子句中的值总是false,不能用来获取任何数据</li>
</ul>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> col1<span class="token operator">=</span><span class="token string">'zs'</span> <span class="token operator">and</span> col1<span class="token operator">=</span><span class="token string">'ls'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
{% asset_img index22.png %}

<ul>
<li>select tables optimized away :</li>
<li>在没有group by 子句的情况下, 基于索引优化min/max操作或者对于MyISAM存储引擎优化count(*)操作,不必等到执行阶段再进行计算,查询执行计划生成阶段即完成优化</li>
<li>distinct : 优化distinct操作,在找到第一个匹配的数据后即停止查找同样的值的动作</li>
</ul>
<h4 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h4><pre class="line-numbers language-sql"><code class="language-sql"><span class="token number">1</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token number">a1</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> id <span class="token keyword">from</span> t3<span class="token punctuation">)</span> <span class="token number">a2</span>
<span class="token number">2</span> <span class="token keyword">from</span>
<span class="token number">3</span>     <span class="token punctuation">(</span><span class="token keyword">select</span> id<span class="token punctuation">,</span>name <span class="token keyword">from</span> t1 <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">'zs1'</span><span class="token punctuation">)</span> <span class="token number">a1</span>
<span class="token number">4</span> <span class="token keyword">union</span>
<span class="token number">5</span>     <span class="token keyword">select</span> name<span class="token punctuation">,</span>id <span class="token keyword">from</span> t2<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<img src="/posts/57626/index23.png">

<p><code>执行顺序如下:</code></p>
<pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token list punctuation">*</span> id=4, select_type为union, union后的select语句先被执行

<span class="token list punctuation">*</span> id=3, 因为(select id,name from t1 where name='zs1')被当作一张表处理,所以为select_type 为derived

<span class="token list punctuation">*</span> id=2, select_type为SUBQUERY,为select后面的子查询

<span class="token list punctuation">*</span> id=1, 表示union中的第一个select, select_type为primary表示该查询为外层查询,table被标记为<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>derived3</span><span class="token punctuation">></span></span>,表示结果来自衍生表

-- id=null,代表从union的临时表中读取行记录, <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>union1,4</span><span class="token punctuation">></span></span>表示将id=1和id=4的结果进行union操作
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="1-2-Mysql是如何选择最优索引的"><a href="#1-2-Mysql是如何选择最优索引的" class="headerlink" title="1.2 Mysql是如何选择最优索引的"></a>1.2 Mysql是如何选择最优索引的</h3><h4 id="1-2-1-如何选择索引"><a href="#1-2-1-如何选择索引" class="headerlink" title="1.2.1 如何选择索引"></a>1.2.1 如何选择索引</h4><p><strong>影响优化器的几大因素</strong></p>
<p>一条查询SQL执行需要经过连接器、分析器、优化器、执行器，而选择索引的重任就交给了优化器。</p>
<p>优化器在多个索引中选择目的是为了找出执行代价最低的方案。</p>
<p>影响优化器选择无非就这几个因素，<code>扫描行数</code>、<code>是否使用了临时表</code>、<code>是否使用文件排序</code>。</p>
<p><code>扫描行数</code>:  扫描行数越少则访问磁盘数据的次数就越少，消耗的CPU资源越少。</p>
<p><strong>那么这个扫描行数是从哪里取的呢</strong>?</p>
<p>创建索引一直提倡大家给区分度高的列建立索引，在一个索引上不同值的个数称之为基数(cardinality)。</p>
<p>使用show index from table_name可以查看每个索引的基数是多少。(Cardinality)</p>
<p><strong>索引基数怎么计算</strong></p>
<p>MySQL使用采样统计的方法，会选出N个数据页，每个数据页大小16kb，接着统计选出来的数据页上的不同值就会得到一个平均值，用平均值在乘以索引的页面数得到的结果就是这个索引的基数。</p>
<p>表数据是持续增加或删减的，统计的这个数据也不是时时变化的，当变更的数据超过1/M时会自动触发重新计算。</p>
<p>这个M是根据参数innodb_stats_persistent的值选则的，设置为on值为10，设置为off值为16。</p>
<p>索引基数通过这种方式计算不是精准的但也差不了多少。</p>
<p><strong>为什么优化器选择了扫描行数多的索引</strong></p>
<ul>
<li>第一种情况</li>
</ul>
<p>​          表增删十分频繁，导致扫描行数不准确。</p>
<ul>
<li><p>第二种情况</p>
<p>假设你主键索引扫描行数是10W行，而普通索引需要扫描5W行，这种情况就会遇到优化器选择了扫描行数多的。</p>
<p>主键索引是不需要回表的，找到值直接就返回对应的数据了。</p>
<p>而普通索引是需要先拿到主键值，再根据主键值获取对应的数据，这个过程优化器选择索引时需要计算的一个成本。</p>
</li>
<li><p>如何解决这种情况</p>
</li>
</ul>
<p>​       扫描行数不准确时可以执行analyze table table_name命令，重新统计索引信息，达到预期优化器选择的索引。</p>
<ul>
<li>索引选择异常如何处理</li>
</ul>
<h3 id="1-3-覆盖索引底层原理与执行流程"><a href="#1-3-覆盖索引底层原理与执行流程" class="headerlink" title="1.3 覆盖索引底层原理与执行流程"></a>1.3 覆盖索引底层原理与执行流程</h3><h3 id="1-4-索引下推底层原理与执行流程精讲"><a href="#1-4-索引下推底层原理与执行流程精讲" class="headerlink" title="1.4 索引下推底层原理与执行流程精讲"></a>1.4 索引下推底层原理与执行流程精讲</h3><h3 id="1-5-Mysql为什么出现索引失效"><a href="#1-5-Mysql为什么出现索引失效" class="headerlink" title="1.5 Mysql为什么出现索引失效"></a>1.5 Mysql为什么出现索引失效</h3><p>参考链接： <a href="https://www.cnblogs.com/gdwkong/articles/8505125.html" target="_blank" rel="noopener">https://www.cnblogs.com/gdwkong/articles/8505125.html</a></p>
<h3 id="1-6-索引最左前缀原理剖析"><a href="#1-6-索引最左前缀原理剖析" class="headerlink" title="1.6 索引最左前缀原理剖析"></a>1.6 索引最左前缀原理剖析</h3><h3 id="1-7-亿级流量下Mysql索引优化策略"><a href="#1-7-亿级流量下Mysql索引优化策略" class="headerlink" title="1.7 亿级流量下Mysql索引优化策略"></a>1.7 亿级流量下Mysql索引优化策略</h3><h3 id="1-8-Mysql的聚簇索引和非聚簇索引的区别"><a href="#1-8-Mysql的聚簇索引和非聚簇索引的区别" class="headerlink" title="1.8 Mysql的聚簇索引和非聚簇索引的区别"></a>1.8 Mysql的聚簇索引和非聚簇索引的区别</h3><p><strong>聚集索引</strong></p>
<p>每个存储引擎为InnoDB的表都有一个特殊的索引，叫聚集索引。聚集索引并不是一种单独的索引类型，而是一种数据存储方式。当表有聚集索引的时候，它的数据行实际上存放在叶子页中。一个表不可能有两个地方存放数据，所以一个表只能有一个聚集索引。</p>
<p>因为是存储引擎负责实现索引，因此不是所有的存储引擎都支持聚集索引。InnoDB表中聚集索引的索引列就是主键，所以聚集索引也叫主键索引。</p>
<p><code>聚集索引（主键索引）的结构如下图：</code></p>
<img src="/posts/57626/20190905150221394.png">

<p>这是一颗B+树，它的叶子页包含了行的全部数据，节点页只包含了索引列（即主键）。</p>
<p><strong>聚集索引的优点：</strong></p>
<ul>
<li>插入速度严重依赖插入顺序。按照主键的顺序插入是加载数据到InnoDB表中速度最快的方式。假如磁盘中的某一个已经存满了，但是新增的行要插入到这一页当中，存储引擎就会把该也分裂成两个页面来容纳该行，这就是一次页分裂操作。页分裂会导致表占用更多的磁盘空间。</li>
<li>更新聚集索引列的代价很高，会强制InnoDB将每个被更新的行移动到新的位置。</li>
<li>用二级索引访问数据需要两个索引查找，不是一次。因为要先从二级索引的叶子节点获得主键值，再根据这主键去聚集索引中查到对应的行，所以需要两次B树查找。</li>
</ul>
<h2 id="2-Buffer-Pool内存结构详解与优化策略"><a href="#2-Buffer-Pool内存结构详解与优化策略" class="headerlink" title="2. Buffer Pool内存结构详解与优化策略"></a>2. Buffer Pool内存结构详解与优化策略</h2><h2 id="3-事务"><a href="#3-事务" class="headerlink" title="3. 事务"></a>3. 事务</h2><h3 id="3-1Mysql事务底层实现原理及源码详解"><a href="#3-1Mysql事务底层实现原理及源码详解" class="headerlink" title="3.1Mysql事务底层实现原理及源码详解"></a>3.1Mysql事务底层实现原理及源码详解</h3><h3 id="3-2MVCC机制是如何保证事务的隔离性的"><a href="#3-2MVCC机制是如何保证事务的隔离性的" class="headerlink" title="3.2MVCC机制是如何保证事务的隔离性的"></a>3.2MVCC机制是如何保证事务的隔离性的</h3><h3 id="3-3-超并发下使用事务时避免死锁策略分析"><a href="#3-3-超并发下使用事务时避免死锁策略分析" class="headerlink" title="3.3 超并发下使用事务时避免死锁策略分析"></a>3.3 超并发下使用事务时避免死锁策略分析</h3><h3 id="3-4-超并发下如何正确的使用Mysql事务及优化策略"><a href="#3-4-超并发下如何正确的使用Mysql事务及优化策略" class="headerlink" title="3.4 超并发下如何正确的使用Mysql事务及优化策略"></a>3.4 超并发下如何正确的使用Mysql事务及优化策略</h3><h3 id="3-4-分布式事务与Mysql事务之间的关系是什么"><a href="#3-4-分布式事务与Mysql事务之间的关系是什么" class="headerlink" title="3.4 分布式事务与Mysql事务之间的关系是什么?"></a>3.4 分布式事务与Mysql事务之间的关系是什么?</h3><h2 id="4-存储引擎"><a href="#4-存储引擎" class="headerlink" title="4. 存储引擎"></a>4. 存储引擎</h2><h3 id="4-1-MyISAM存储引擎"><a href="#4-1-MyISAM存储引擎" class="headerlink" title="4.1 MyISAM存储引擎"></a>4.1 MyISAM存储引擎</h3><p><strong>MYISAM存储引擎索引原理</strong></p>
<h3 id="4-2-InnoDB存储引擎"><a href="#4-2-InnoDB存储引擎" class="headerlink" title="4.2 InnoDB存储引擎"></a>4.2 InnoDB存储引擎</h3><p><strong>InnoDB存储索引原理分析</strong></p>
<p><strong>InnoDB本身针对语句做了哪些优化</strong></p>
<p><strong>Innodb怎么实现事务的?</strong></p>
<h2 id="5-分库分表"><a href="#5-分库分表" class="headerlink" title="5. 分库分表"></a>5. 分库分表</h2><h3 id="5-1-分库分表产生背景"><a href="#5-1-分库分表产生背景" class="headerlink" title="5.1 分库分表产生背景"></a>5.1 分库分表产生背景</h3><h3 id="5-2-分库分表手段有哪些，海量数据怎么分"><a href="#5-2-分库分表手段有哪些，海量数据怎么分" class="headerlink" title="5.2 分库分表手段有哪些，海量数据怎么分"></a>5.2 分库分表手段有哪些，海量数据怎么分</h3><h3 id="5-3-垂直拆分优缺点"><a href="#5-3-垂直拆分优缺点" class="headerlink" title="5.3 垂直拆分优缺点"></a>5.3 垂直拆分优缺点</h3><h3 id="5-4-水平拆分优缺点"><a href="#5-4-水平拆分优缺点" class="headerlink" title="5.4 水平拆分优缺点"></a>5.4 水平拆分优缺点</h3><h3 id="5-5-JDBC和Proxy方案优缺点"><a href="#5-5-JDBC和Proxy方案优缺点" class="headerlink" title="5.5 JDBC和Proxy方案优缺点"></a>5.5 JDBC和Proxy方案优缺点</h3><h3 id="5-6-分库分表会面临哪些技术问题，如何解决"><a href="#5-6-分库分表会面临哪些技术问题，如何解决" class="headerlink" title="5.6 分库分表会面临哪些技术问题，如何解决"></a>5.6 分库分表会面临哪些技术问题，如何解决</h3><h3 id="5-7-生产环境分库分表技术如何选型"><a href="#5-7-生产环境分库分表技术如何选型" class="headerlink" title="5.7 生产环境分库分表技术如何选型?"></a>5.7 生产环境分库分表技术如何选型?</h3><h2 id="6-锁"><a href="#6-锁" class="headerlink" title="6. 锁"></a>6. 锁</h2><p><strong>Mysql的锁你了解哪些</strong></p>
<h2 id="7-日志"><a href="#7-日志" class="headerlink" title="7. 日志"></a>7. 日志</h2><p><strong>必须了解的MySQL三种日志</strong></p>
<p>大家有没有想过为什么MySQL数据库可以实现主从复制，实现持久化，实现回滚的呢？其实关键在于MySQL里的三种log，分别是：</p>
<ul>
<li>binlog</li>
<li>redo log</li>
<li>undo log</li>
</ul>
<p>这三种log也是面试经常会问的问题，下面我们一起来探讨一下吧。</p>
<h3 id="binlog"><a href="#binlog" class="headerlink" title="binlog"></a>binlog</h3><p>binlog应该是日常中听的最多的关于mysql中的log。</p>
<blockquote>
<p>那么什么是binlog呢？</p>
</blockquote>
<p>binlog是用于<strong>记录数据库表结构和表数据变更的二进制日志</strong>，比如insert、update、delete、create、truncate等等操作，不会记录select、show操作，因为没有对数据本身发生变更。</p>
<blockquote>
<p>binlog文件长什么样子呢？</p>
</blockquote>
<p>使用mysqlbinlog命令可以查看。</p>
<img src="/posts/57626/5580ed0088d2404c945874231c598300.png">

<p>会记录下每条变更的sql语句，还有执行开始时间，结束时间，事务id等等信息。</p>
<blockquote>
<p>如何查看binlog是否打开，如果没打开怎么设置？</p>
</blockquote>
<p>使用命令show variables like ‘%log_bin%’;查看binlog是否打开。</p>
<img src="/posts/57626/0de234381a2f4599809248ca7df8b77f.jpg">

<p>如果像上图一样，没有开启binlog，那怎么开启呢？</p>
<p>找到my.cnf配置文件，增加下面配置(mysql版本5.7.31)：</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token comment" spellcheck="true"># 打开binlog</span>
log<span class="token operator">-</span>bin<span class="token operator">=</span>mysql<span class="token operator">-</span>bin
<span class="token comment" spellcheck="true"># 选择ROW(行)模式</span>
binlog<span class="token operator">-</span>format<span class="token operator">=</span><span class="token keyword">ROW</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>修改后，重启mysql，配置生效。</p>
<p>执行SHOW MASTER STATUS;可以查看当前写入的binlog文件名。</p>
<img src="/posts/57626/55c1af0b9ab4439b8208818fc8b596c8.jpg">

<blockquote>
<p>binlog用来干嘛的呢？</p>
</blockquote>
<p>第一，用于主从复制。一般在公司中做一主二从的结构时，就需要master节点打开binlog日志，从机订阅binlog日志的信息，因为binlog日志记录了数据库数据的变更，所以当master发生数据变更时，从机也能随着master节点的数据变更而变更，做到主从复制的效果。</p>
<img src="/posts/57626/e3ebb1f0ef9b4d65891bfe59003a1678.jpg">

<p>第二，用于数据恢复。因为binlog记录了数据库的变更，所以可以用于数据恢复。我们看到上面图中有个字段叫Position，这个参数是用于记录binlog日志的指针。当我们需要恢复数据时，只要指定–start-position和–stop-position，或者指定–start-datetime和–stop-datetime，那么就可以恢复指定区间的数据。</p>
<h3 id="redo-log"><a href="#redo-log" class="headerlink" title="redo log"></a>redo log</h3><p>假设有一条update语句：</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">UPDATE</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span> <span class="token keyword">SET</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'刘德华'</span> <span class="token keyword">WHERE</span> <span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'1'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>我们想象一下mysql修改数据的步骤，肯定是先把id=’1’的数据查出来，然后修改名称为’刘德华’。再深层一点，mysql是使用页作为存储结构，所以MySQL会先把这条记录所在的页加载到内存中，然后对记录进行修改。但是我们都知道mysql支持持久化，最终数据都是存在于磁盘中。</p>
<p>假设需要修改的数据加载到内存中，并且修改成功了，但是还没来得及刷到磁盘中，这时数据库宕机了</p>
<p>，那么这次修改成功后的数据就丢失了。</p>
<p>为了避免出现这种问题，MySQL引入了redo log。</p>
<img src="/posts/57626/6089fdbb72134f5ebcae0b085d7ef515.jpg">

<p>如图所示，当执行数据变更操作时，首先把数据也加载到内存中，然后在内存中进行更新，更新完成后写入到redo log buffer中，然后由redo log buffer在写入到redo log file中。</p>
<p>redo log file记录着xxx页做了xxx修改，所以即使mysql发生宕机，也可以通过redo log进行数据恢复，也就是说在内存中更新成功后，即使没有刷新到磁盘中，但也不会因为宕机而导致数据丢失。</p>
<blockquote>
<p>redo log与事务机制是如何配合工作的？</p>
</blockquote>
<img src="/posts/57626/944d44e150114f5e9a38d3b421053ecc.png">

<p>如图所示：</p>
<p>第1-3步骤就是把数据变更，然后写入到内存中。</p>
<p>第4步记录到redo log中，然后把记录置为prepare(准备)状态。</p>
<p>第5，6步提交事务，提交事务之后，第7步把记录状态改成commit(提交)状态。</p>
<p>保证了事务与redo log的一致性。</p>
<blockquote>
<p>binlog和redo log都可以数据恢复，有什么区别？</p>
</blockquote>
<p>redo log是恢复在内存更新后，还没来得及刷到磁盘的数据。</p>
<p>binlog是存储所有数据变更的情况，理论上只要记录在binlog上的数据，都可以恢复。</p>
<p>举个例子，<strong>假如不小心整个数据库的数据被删除了，能使用redo log文件恢复数据吗</strong>？</p>
<p>不可以使用redo log文件恢复，只能使用binlog文件恢复。因为redo log文件不会存储历史所有的数据的变更，当内存数据刷新到磁盘中，redo log的数据就失效了，也就是redo log文件内容是会被覆盖的。</p>
<blockquote>
<p>binlog又是在什么时候记录的呢？</p>
</blockquote>
<p>答，在提交事务的时候。</p>
<img src="/posts/57626/73eb4001b0cf44afa9ca8fb1291b13d7.png">

<h3 id="undo-log"><a href="#undo-log" class="headerlink" title="undo log"></a>undo log</h3><p>undo log的作用主要<strong>用于回滚</strong>，mysql数据库的事务的原子性就是通过undo log实现的。我们都知道原子性是指对数据库的一系列操作，要么全部成功，要么全部失败。</p>
<p>undo log主要存储的是数据的逻辑变化日志，比如说我们要insert一条数据，那么undo log就会生成一条对应的delete日志。简单点说，undo log记录的是数据修改之前的数据，因为需要支持回滚。</p>
<p>那么当需要回滚时，只需要利用undo log的日志就可以恢复到修改前的数据。</p>
<p>undo log另一个作用是<strong>实现多版本控制(MVCC)</strong>，undo记录中包含了记录更改前的镜像，<strong>如果更改数据的事务未提交</strong>，对于隔离级别大于等于read commit的事务而言，<strong>不应该返回更改后数据，而应该返回老版本的数据</strong>。</p>
<p><strong>学完之后，我们知道这三种日志在mysql中都有着重要的作用，再回顾一下：</strong></p>
<ul>
<li>binlog主要用于复制和数据恢复。</li>
<li>redo log用于恢复在内存更新后，还没来得及刷到磁盘的数据。</li>
<li>undo log用于实现回滚和多版本控制。</li>
</ul>

            </div>
            <hr />

            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">写作不易，客官能否打赏一杯奶茶？</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            


        </div>
    </div>

    

    

    

    

    
    <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments input[type=text],
    #vcomments input[type=email],
    #vcomments input[type=url],
    #vcomments textarea {
        box-sizing: border-box;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #42b983;
        font-weight: 500;
        text-decoration: underline;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div id="vcomments" class="card-content"></div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<!-- <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script> -->

<script>
    new Valine({
          el: '#vcomments',
        appId: 'hY7rXybwkLK8aVUKb2lrsVfk-gzGzoHsz',
        appKey: 'UaV9Gzg9SGxbx6wqhNzN8crD',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'false' === 'true',
        avatar: 'wavatar',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '可以在这里评论啦！',
        enableQQ: true,
        emojiCDN: '//i0.hdslb.com/bfs/emote/', 
        // ����title��ͼƬӳ��
        emojiMaps: {
        "tv_doge": "6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png",
        "tv_����": "a8111ad55953ef5e3be3327ef94eb4a39d535d06.png",
        "tv_͵Ц": "bb690d4107620f1c15cff29509db529a73aee261.png",
        "tv_�ټ�": "180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png",
        "tv_��Į": "b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png",
        "tv_��ŭ": "34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png",
        "tv_����": "34db290afd2963723c6eb3c4560667db7253a21a.png",
        "tv_�ɰ�": "9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png",
        "tv_��Ѫ": "09dd16a7aa59b77baa1155d47484409624470c77.png",
        "tv_��": "fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png",
        "tv_Ż��": "9f996894a39e282ccf5e66856af49483f81870f3.png",
        "tv_��": "241ee304e44c0af029adceb294399391e4737ef2.png",
        "tv_��Ц": "1f0b87f731a671079842116e0991c91c2c88645a.png",
        "tv_����": "093c1e2c490161aca397afc45573c877cdead616.png",
        "tv_���": "23269aeb35f99daee28dda129676f6e9ea87934f.png",
        "tv_ί��": "d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png",
        "tv_����": "a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png",
        "tv_����": "7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png",
        "tv_΢Ц": "70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png",
        "tv_˼��": "90cf159733e558137ed20aa04d09964436f618a1.png",
        "tv_����": "0d15c7e2ee58e935adc6a7193ee042388adc22af.png",
        "tv_����": "56ab10b624063e966bfcb76ea5dc4794d87dfd47.png",
        "tv_ץ��": "fe31c08edad661d63762b04e17b8d5ae3c71a757.png",
        "tv_�ٱ�": "c666f55e88d471e51bbd9fab9bb308110824a6eb.png",
        "tv_б��Ц": "911f987aa8bc1bee12d52aafe62bc41ef4474e6c.png",
        "tv_����": "ea8ed89ee9878f2fece2dda0ea8a5dbfe21b5751.png",
        "tv_��": "5443c22b4d07fb1907ccc610c8e6db254f2461b7.png",
        "tv_����": "cead1c351ab8d79e9f369605beb90148db0fbed3.png",
        "tv_����": "7e71cde7858f0cd50d74b0264aa26db612a8a167.png",
        "tv_����Ѫ": "c32d39db2737f89b904ca32700d140a9241b0767.png",
        "tv_����": "f85c354995bd99e28fc76c869bfe42ba6438eff4.png",
        "tv_����": "26702dcafdab5e8225b43ffd23c94ac1ff932654.png",
        "tv_����": "8b0ec90e6b86771092a498c54f09fc94621c1900.png",
        "tv_����": "0793d949b18d7be716078349c202c15ff166f314.png",
        "tv_����": "c1d59f439e379ee50eef488bcb5e5378e5044ea4.png",
        "tv_��ü": "72ccad6679fea0d14cce648b4d818e09b8ffea2d.png",
        "tv_Ŀ�ɿڴ�": "0b8cb81a68de5d5365212c99375e7ace3e7891b7.png",
        "tv_˯��": "8b196675b53af58264f383c50ad0945048290b33.png",
        "tv_Ц��": "1abc628f6d4f4caf9d0e7800878f4697abbc8273.png",
        "tv_����": "89712c0d4af73e67f89e35cbc518420380a7f6f4.png",
        "tv_ɫ": "61822c7e9aae5da76475e7892534545336b23a6f.png",
        "tv_��٩": "4bc022533ef31544ca0d72c12c808cf4a1cce3e3.png",
        "tv_��Ƥ": "b9c41de8e82dd7a8515ae5e3cb63e898bf245186.png",
        "tv_����": "6e72339f346a692a495b123174b49e4e8e781303.png",
        "tv_����": "c9e990da7f6e93975e25fd8b70e2e290aa4086ef.png",
        "tv_�ѹ�": "87f46748d3f142ebc6586ff58860d0e2fc8263ba.png",
        "tv_��": "fc7e829b845c43c623c8b490ee3602b7f0e76a31.png",
        "tv_����": "0ffbbddf8a94d124ca2f54b360bbc04feb6bbfea.png",
        "tv_�����ʺ�": "45821a01f51bc867da9edbaa2e070410819a95b2.png",
        "tv_����": "1d21793f96ef4e6f48b23e53e3b9e42da833a0f6.png"
        },
        requiredFields: ['nick','mail'], //���ñ�����
    });
</script>

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-dot-circle-o"></i>&nbsp;本篇
            </div>
            <div class="card">
                <a href="/posts/57626.html">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/25.jpg" class="responsive-img" alt="数据库知识点整理---持续更新">
                        
                        <span class="card-title">数据库知识点整理---持续更新</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            东拼西凑………..
1. 索引的本质索引是帮助Mysql高效获取数据的排好序的数据结构。 

索引的数据结构：
二叉树
红黑树
Hash表
B-Tree



索引优缺点

优点:
提高数据查询的效率,降低数据库的IO成本
通过索引对数据进
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2021-11-10
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/学习笔记/" class="post-category" target="_blank">
                                    学习笔记
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/数据库相关概念/" target="_blank">
                        <span class="chip bg-color">数据库相关概念</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/posts/62405.html">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/8.jpg" class="responsive-img" alt="操作系统知识点整理--持续更新增加">
                        
                        <span class="card-title">操作系统知识点整理--持续更新增加</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            1. 总线1.1 5种分类
数据总线:  处理CPU 和 RAM 之间来回传送的数据
地址总线: 用来指定RAM种数据的地址
控制总线: 常见的USB, Bus, 1394 Bus；是将微处理器控制单元的信号，传送到周边设备
扩展总线: 可
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2021-11-09
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/学习笔记/" class="post-category" target="_blank">
                                    学习笔记
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/操作系统/" target="_blank">
                        <span class="chip bg-color">操作系统</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fa fa-list"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).slideUp(500);
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).slideDown(500);
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>
    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\(', '\)']]}
    });
</script>

<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
<script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>


    <footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            &copy; 2021-2022 YinYang. 版权所有

            
            &nbsp;<i class="fa fa-area-chart"></i>&nbsp;站点总字数:&nbsp;
            <span class="white-color">176.9k</span>
            

            <br>
            <span id="sitetime"></span>

            
            
            <br>
            
            <span id="busuanzi_container_site_pv" style='display:none'>
                <i class="fa fa-heart-o"></i>
                本站总访问量 <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
            <span id="busuanzi_container_site_uv" style='display:none'>
                人次,&nbsp;访客数 <span id="busuanzi_value_site_uv" class="white-color"></span> 人.
            </span>
            
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">


    <a href="mailto:3359595167@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>





    <a href="http://wpa.qq.com/msgrd?v=3&uin=3359595167&site=qq&menu=yes" class="tooltipped" target="_blank" data-tooltip="访问我的知乎" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>





    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>
</div>
    </div>
</footer>

<div class="progress-bar"></div>

<!-- 不蒜子计数初始值纠正 -->
<script>
    $(document).ready(function () {

        var int = setInterval(fixCount, 50);
        var pvcountOffset = 80000;
        var uvcountOffset = 20000;

        function fixCount() {
            if (document.getElementById("busuanzi_container_site_pv").style.display != "none") {
                $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + pvcountOffset);
                clearInterval(int);
            }
            if ($("#busuanzi_container_site_pv").css("display") != "none") {
                $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + uvcountOffset); // 加上初始数据 
                clearInterval(int);
            }
        }
    });
</script>

<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();
        /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
        year - 作为date对象的年份，为4位年份值
        month - 0-11之间的整数，做为date对象的月份
        day - 1-31之间的整数，做为date对象的天数
        hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
        minutes - 0-59之间的整数，做为date对象的分钟数
        seconds - 0-59之间的整数，做为date对象的秒数
        microseconds - 0-999之间的整数，做为date对象的毫秒数 */
        var t1 = Date.UTC(2017, 09, 11, 00, 00, 00); //北京时间2018-2-13 00:00:00
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes * minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "本站已运行 " + diffYears + " 年 " + diffDays + " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
    }/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
</script>

    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <script type="text/javascript"> var OriginTitile = document.title, st; document.addEventListener("visibilitychange", function () { document.hidden ? (document.title = "Σ(っ °Д °;)っ喔哟，崩溃啦！", clearTimeout(st)) : (document.title = "φ(゜▽゜*)♪咦，又好了！", st = setTimeout(function () { document.title = OriginTitile }, 3e3)) })
    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->



    
    <script src="/libs/others/clicklove.js"></script>
    

    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    <!-- 雪花特效 -->
    
<!--动态线条背景-->
<script type="text/javascript"
color="122 103 238" opacity='0.7' zIndex="-2" count="200" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
</script>
<script type="text/javascript">
//只在桌面版网页启用特效
var windowWidth = $(window).width();
if (windowWidth > 768) {
    document.write('<script type="text/javascript" src="/js/sakura.js"><\/script>');
}
</script>

</body>

</html>